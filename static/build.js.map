{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"react-intl\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/map\"","webpack:///external \"@material-ui/core/styles\"","webpack:///external \"@material-ui/core\"","webpack:///external \"electron\"","webpack:///external \"@babel/runtime-corejs3/helpers/extends\"","webpack:///./src/logger.js","webpack:///external \"@babel/runtime-corejs3/core-js-stable/object/assign\"","webpack:///external \"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\"","webpack:///external \"@material-ui/core/Button\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/json/stringify\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/array/is-array\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/filter\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/values\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/slice\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/for-each\"","webpack:///external \"@material-ui/core/Dialog\"","webpack:///external \"@material-ui/core/DialogContent\"","webpack:///external \"@material-ui/core/Typography\"","webpack:///external \"@material-ui/core/MenuItem\"","webpack:///external \"@material-ui/core/DialogTitle\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/object/keys\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/find\"","webpack:///external \"styled-components\"","webpack:///external \"@material-ui/core/DialogActions\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/date/now\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/map\"","webpack:///external \"path\"","webpack:///external \"clsx\"","webpack:///external \"@material-ui/core/AppBar\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/index-of\"","webpack:///external \"@material-ui/core/IconButton\"","webpack:///external \"@material-ui/core/FormControl\"","webpack:///external \"@material-ui/icons\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/reduce\"","webpack:///external \"react-mapbox-gl\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/includes\"","webpack:///external \"@material-ui/core/Toolbar\"","webpack:///external \"@material-ui/core/Select\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/parse-float\"","webpack:///external \"id-mapeo\"","webpack:///external \"@material-ui/icons/MoreVert\"","webpack:///external \"@material-ui/core/Menu\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/sort\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/concat\"","webpack:///external \"@material-ui/pickers\"","webpack:///external \"react-virtualized-auto-sizer\"","webpack:///external \"@material-ui/core/Paper\"","webpack:///external \"mapbox-gl\"","webpack:///external \"@material-ui/core/InputLabel\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/set-timeout\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/every\"","webpack:///external \"insert-css\"","webpack:///external \"@material-ui/core/DialogContentText\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/trim\"","webpack:///external \"clone-deep\"","webpack:///external \"react-virtualized\"","webpack:///external \"react-dom\"","webpack:///./src/store.js","webpack:///external \"lodash/debounce\"","webpack:///external \"ky/umd\"","webpack:///external \"@material-ui/core/Tooltip\"","webpack:///external \"@material-ui/core/Input\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/number/is-nan\"","webpack:///external \"mime/lite\"","webpack:///external \"@segment/isodate\"","webpack:///external \"@mapbox/sexagesimal\"","webpack:///external \"@material-ui/core/CircularProgress\"","webpack:///external \"utm\"","webpack:///external \"fs-write-stream-atomic\"","webpack:///external \"pump\"","webpack:///external \"react-mapfilter/commonjs/ViewWrapper\"","webpack:///external \"@material-ui/icons/Error\"","webpack:///external \"@material-ui/styles\"","webpack:///external \"electron-is-dev\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/promise\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/find-index\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/starts-with\"","webpack:///external \"lodash/isEqual\"","webpack:///external \"@material-ui/icons/ExpandMore\"","webpack:///external \"@material-ui/lab/Autocomplete\"","webpack:///external \"@material-ui/core/TableCell\"","webpack:///external \"d3-dsv\"","webpack:///external \"node-wifi\"","webpack:///external \"react-intl-formatted-duration\"","webpack:///external \"semver\"","webpack:///external \"@material-ui/core/CssBaseline\"","webpack:///external \"@material-ui/core/Tabs\"","webpack:///external \"@material-ui/core/Tab\"","webpack:///external \"react-transition-group\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/object/entries\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/keys\"","webpack:///external \"url\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/some\"","webpack:///external \"object-path-immutable\"","webpack:///external \"react-image\"","webpack:///external \"@material-ui/icons/BrokenImage\"","webpack:///external \"mapeo-entity-filter\"","webpack:///external \"@material-ui/icons/Close\"","webpack:///external \"@material-ui/core/Collapse\"","webpack:///external \"@material-ui/core/Fade\"","webpack:///external \"@date-io/date-fns\"","webpack:///external \"date-fns/locale/en-US\"","webpack:///external \"date-fns/locale/fr\"","webpack:///external \"date-fns/locale/pt-BR\"","webpack:///external \"date-fns/locale/es\"","webpack:///external \"@material-ui/core/Accordion\"","webpack:///external \"@material-ui/core/AccordionSummary\"","webpack:///external \"@material-ui/core/AccordionDetails\"","webpack:///external \"@material-ui/core/CardHeader\"","webpack:///external \"@material-ui/icons/Place\"","webpack:///external \"@material-ui/core/Avatar\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/fill\"","webpack:///external \"@material-ui/icons/NavigateNext\"","webpack:///external \"@material-ui/icons/NavigateBefore\"","webpack:///external \"react-swipeable-views\"","webpack:///external \"@material-ui/core/Table\"","webpack:///external \"@material-ui/core/TableBody\"","webpack:///external \"@material-ui/core/TableRow\"","webpack:///external \"@material-ui/icons/Print\"","webpack:///external \"@material-ui/icons/VisibilityOff\"","webpack:///external \"@material-ui/core/Popover\"","webpack:///external \"@material-ui/core/List\"","webpack:///external \"@material-ui/core/ListItem\"","webpack:///external \"@material-ui/core/ListItemText\"","webpack:///external \"@material-ui/core/ListItemSecondaryAction\"","webpack:///external \"@material-ui/core/Switch\"","webpack:///external \"react-window\"","webpack:///external \"get-scrollbar-width\"","webpack:///external \"react-error-boundary\"","webpack:///external \"@material-ui/icons/Map\"","webpack:///external \"@material-ui/icons/Apps\"","webpack:///external \"@material-ui/icons/LibraryBooks\"","webpack:///external \"react-mapfilter\"","webpack:///external \"yazl\"","webpack:///external \"run-parallel-limit\"","webpack:///external \"once\"","webpack:///external \"@material-ui/core/FormHelperText\"","webpack:///external \"flat\"","webpack:///external \"fs\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/number/parse-int\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/set-interval\"","webpack:///external \"@material-ui/icons/PhoneAndroid\"","webpack:///external \"@material-ui/icons/Laptop\"","webpack:///external \"@material-ui/icons/Usb\"","webpack:///external \"@material-ui/icons/Check\"","webpack:///external \"@fortawesome/react-fontawesome\"","webpack:///external \"@fortawesome/free-solid-svg-icons\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/array/from\"","webpack:///external \"winston\"","webpack:///external \"winston-daily-rotate-file\"","webpack:///external \"util\"","webpack:///external \"conf\"","webpack:///external \"@bugsnag/node\"","webpack:///external \"@bugsnag/browser\"","webpack:///external \"core-js/es/reflect\"","webpack:///external \"react-mapfilter/translations/en.json\"","webpack:///external \"react-mapfilter/translations/es.json\"","webpack:///external \"react-mapfilter/translations/pt.json\"","webpack:///./src/renderer/theme.js","webpack:///./src/renderer/new-api.js","webpack:///./src/renderer/components/MapEditor/ExportButton.js","webpack:///./src/renderer/components/MapEditor/index.js","webpack:///./src/renderer/components/dialogs/LatLon.js","webpack:///./src/renderer/components/dialogs/Error.js","webpack:///./src/renderer/components/dialogs/ChangeLanguage.js","webpack:///./src/renderer/components/TitleBarShim.js","webpack:///./src/renderer/components/MapFilter/constants/value_types.js","webpack:///./src/renderer/components/MapFilter/lib/data_analysis/value_types.js","webpack:///./src/renderer/components/MapFilter/utils/flat_object_entries.js","webpack:///./src/renderer/components/MapFilter/utils/get_set.js","webpack:///./src/renderer/components/MapFilter/lib/data_analysis/statistics.js","webpack:///./src/renderer/components/MapFilter/lib/data_analysis/index.js","webpack:///./src/renderer/components/MapFilter/utils/helpers.js","webpack:///./src/renderer/components/MapFilter/MapView/ObservationLayer.js","webpack:///./src/renderer/components/MapFilter/internal/Image.js","webpack:///./src/renderer/components/MapFilter/MapView/Popup.js","webpack:///./src/renderer/components/MapFilter/MapView/MapViewContent.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/TextField.js","webpack:///./src/renderer/components/MapFilter/constants/coord_formats.js","webpack:///./src/renderer/components/MapFilter/internal/Context.js","webpack:///./src/renderer/components/MapFilter/internal/FormattedLocation.js","webpack:///./src/renderer/components/MapFilter/messages.js","webpack:///./src/renderer/components/MapFilter/internal/FeatureHeader.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/MediaCarousel.js","webpack:///./src/renderer/components/MapFilter/utils/strings.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/Select.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/NumberField.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/DateField.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/DateTimeField.js","webpack:///./src/renderer/components/MapFilter/internal/FormattedFieldname.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/Field.js","webpack:///./src/renderer/components/MapFilter/ObservationDialog/ObservationDialog.js","webpack:///./src/renderer/components/MapFilter/stats.js","webpack:///./src/renderer/components/MapFilter/ViewWrapper.js","webpack:///./src/renderer/components/MapFilter/MapView/MapView.js","webpack:///./src/renderer/components/MapFilter/constants/field_types.js","webpack:///./src/renderer/components/MapFilter/internal/FormattedValue.js","webpack:///./src/renderer/components/MapFilter/ReportView/DetailsTable.js","webpack:///./src/renderer/components/MapFilter/utils/dom.js","webpack:///./src/renderer/components/MapFilter/ReportView/ReportPageContent.js","webpack:///./src/renderer/components/MapFilter/ReportView/ReportPaper.js","webpack:///./src/renderer/components/MapFilter/ReportView/ReportViewContent.js","webpack:///./src/renderer/components/MapFilter/internal/Toolbar.js","webpack:///./src/renderer/components/MapFilter/internal/ToolbarButton.js","webpack:///./src/renderer/components/MapFilter/ReportView/PrintButton.js","webpack:///./src/renderer/components/MapFilter/ReportView/HideFieldsButton.js","webpack:///./src/renderer/components/MapFilter/ReportView/ReportView.js","webpack:///./src/renderer/components/MapFilter/MediaView/ImageGrid.js","webpack:///./src/renderer/components/MapFilter/MediaView/MediaViewContent.js","webpack:///./src/renderer/components/MapFilter/MediaView/MediaView.js","webpack:///./src/renderer/components/MapFilter/Toolbar.js","webpack:///./src/renderer/components/MapFilter/FilterPanel.js","webpack:///./src/renderer/components/Loader.js","webpack:///./src/renderer/components/MapFilter/Loading.js","webpack:///./src/renderer/components/MapFilter/MapStyleProvider.js","webpack:///./src/renderer/create-zip.js","webpack:///./src/renderer/components/MapFilter/MapExportDialog.js","webpack:///./src/renderer/components/MapFilter/DataExportDialog.js","webpack:///./src/renderer/components/MapFilter/ExportButton.js","webpack:///./src/renderer/components/MapFilter/MapFilter.js","webpack:///./src/renderer/hooks/createPersistedState.js","webpack:///./src/renderer/components/SyncView/Searching.js","webpack:///./src/renderer/components/SyncView/SyncAppBar.js","webpack:///./src/renderer/components/SyncView/SyncButton.js","webpack:///./src/renderer/components/DateDistance.js","webpack:///./src/renderer/components/SyncView/SyncTarget.js","webpack:///./src/renderer/components/SyncView/SyncGrid.js","webpack:///./src/renderer/components/SyncView/SyncFooter.js","webpack:///./src/renderer/components/SyncView/index.js","webpack:///./src/renderer/components/UpdaterView/states.js","webpack:///./src/renderer/components/UpdaterView/index.js","webpack:///./src/renderer/electron-ipc.js","webpack:///./src/renderer/components/Home.js","webpack:///./src/renderer/components/UpdaterView/useUpdater.js","webpack:///./src/renderer/app.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","winston","path","DailyRotateFile","util","store","appVersion","version","Bugsnag","logger","constructor","this","createLogger","configured","_messageQueue","_debug","configure","userDataPath","isDev","label","_startBugsnag","prettyPrint","format","printf","level","message","timestamp","combine","dirname","join","transport","transports","close","mainLog","filename","datePattern","zippedArchive","maxFiles","on","debugging","add","errorTransport","Console","length","_drainQueue","debug","_level","set","port","error","Error","msg","pop","_log","args","log","notify","event","context","push","warn","arguments","err","info","releaseStage","apiKey","enabledReleaseStages","__proto__","unref","start","projectName","projectSuffix","configName","systemFontFamily","createMuiTheme","typography","fontFamily","body1","body2","caption","palette","primary","main","secondary","BASE_URL","remote","getGlobal","Api","baseUrl","ipc","startupTime","req","ky","extend","prefixUrl","timeout","headers","pragma","logRequest","prefix","promise","then","data","catch","url","json","api","getPresets","id","getObservations","getMapStyle","deleteObservation","delete","updateObservation","valueForServer","type","schemaVersion","put","createObservation","post","addPeerListener","handler","onPeerUpdate","peers","syncGetPeers","remove","removeListener","addDataChangedListener","ev","getEncryptionKey","resolve","reject","send","encryptionKey","syncJoin","syncLeave","syncStart","target","exportData","getIconUrl","iconId","size","roundedRatio","Math","min","ceil","window","devicePixelRatio","getMediaUrl","attachmentId","getMapStyleUrl","zoomToData","cb","middlewareClient","defineMessages","exportButton","exportGeoJson","exportShapefile","okButton","closeButton","dialogTitle","dialogSuccess","dialogError","saveTitle","defaultFilename","DialogTitle","DialogAction","children","onClick","color","variant","autoFocus","ExportButton","formatMessage","useIntl","status","setStatus","React","useState","cx","useStyles","menuAnchor","setMenuAnchor","handleMenuItemClick","ext","dialog","showSaveDialog","title","defaultPath","filters","extensions","canceled","filePath","dialogContent","indeterminate","aria-label","currentTarget","aria-controls","aria-haspopup","className","button","anchorEl","open","Boolean","onClose","aria-labelledby","maxWidth","fullWidth","disableBackdropClick","disableEscapeKeyDown","makeStyles","width","margin","notes","insertCss","localStorage","location","MapEditor","rootRef","useRef","customDefs","locale","toolbarEl","setToolbarEl","useCallback","_","loc","current","centerZoomEase","updateSettings","presets","ipcRenderer","sendSync","customCss","imagery","icons","translations","currentLocale","translationsInLocale","iD","en","fallbackFields","iDPresets","presetsObj","fields","fallbackPresets","presetId","preset","tags","categoryId","fieldId","field","snakeCase","snake_case","appearance","options","opt","mapeoOptions","iDStringOptions","strings","convertPresets","dataImagery","img","idx","unshift","iconsSvg","DOMParser","parseFromString","documentElement","defs","node","replaceChild","firstChild","useEffect","subscription","history","saved","toJSON","flush","fromJSON","refreshWindow","prevhash","getItem","hash","onHashChange","debounce","setItem","addEventListener","removeEventListener","useLayoutEffect","serverUrl","coreContext","assetPath","preauth","minEditableZoom","container","append","style","attr","ui","links","document","querySelectorAll","link","href","getAttribute","onclick","preventDefault","shell","openExternal","contributeBtn","querySelector","innerHTML","toolbar","select","aboutList","map","latlon","text","latlonToPosString","center","mouseCoordinates","onbeforeunload","e","save","returnValue","ref","ReactDOM","createPortal","pos","floor","toString","area","geometry","matchScore","line","point","relation","placeholder","LatLonDialog","latLon","setLatLon","onChange","match","exec","pt","stopPropagation","ErrorDialog","Component","render","props","cols","rows","disabled","languages","es","fr","ChangeLanguage","onCancel","onSelectLanguage","lang","setLang","code","TitleBarArea","styled","div","TitleBarShim","win","getCurrentWindow","getSize","getContentSize","STRING","DATE","URL","shortDateRegExp","TYPES","boolean","number","undefined","guessValueType","isUrl","parsedUrl","parse","pathname","valueTypes","mimeType","mime","getType","split","isShortDate","isodate","is","coerceValue","parsedLocation","parsed","sexagesimal","pair","parts","isFloat","withinBounds","parseLocation","spaceSplit","commaSplit","parsedBool","v","toLowerCase","TRUE_STRINGS","FALSE_STRINGS","parseBoolean","isNaN","Date","parsedDateValue","date","getFullYear","getMonth","getDate","test","lon","lat","isArrayOfPrimitives","isObj","flatObjectEntries","entries","step","prev","currentDepth","keys","newKey","defaultValue","propertyIsEnumerable","originalSet","defaultStats","count","values","addItemStats","item","stats","addFieldStats","fieldStats","arrayStats","lengthMin","Infinity","lengthMax","valueStats","addArrayStats","lengthStats","statReduce","max","variance","lengthVariance","mean","lengthMean","wordStats","wordsMin","wordsMax","wordsVariance","wordsMean","has","addStringStats","addNumberStats","dateAsNumber","dateToNumber","YYYY","MM","leftPad","DD","numberToDate","addDateStats","toISOString","addDateTimeStats","NaN","x","newMean","year","month","day","Number","getTime","compareKeys","a","b","localeCompare","getFields","cur","JSON","flatStatsEntries","acc","keyArray","createSelectOneField","getOptions","createTextField","readonly","createNumberField","createSelectMultipleField","min_value","max_value","createDateField","createDateTimeField","createLinkField","getField","string","isImageAttachment","attachment","getLastImage","observation","imageAttachments","attachments","hiddenTags","note","defaultGetPreset","additionalFields","getFieldsFromTags","fieldKey","str","len","char","pad","observationSourceId","pointStyleLayer","sourceId","paint","base","stops","pointHoverStyleLayer","noop","ObservationLayer","observations","onMouseLeave","onMouseMove","print","hovered","useContext","MapContext","geoJsonSource","useMemo","features","obs","coordinates","properties","observationsToGeoJsonSource","handleMouseMove","getCanvas","cursor","setFeatureState","source","hover","handleMouseLeave","handleClick","wrapper","height","display","alignItems","justifyContent","top","position","backgroundSize","backgroundPosition","backgroundRepeat","ImageLoader","classes","BrokenImage","Image","src","objectFit","loader","unloader","padding","backgroundColor","willChange","left","pointerEvents","wrapperImage","image","background","titleBox","bottom","boxSizing","subheading","Popup","imageUrl","subtitle","getPopupTransform","offsetWidth","offsetHeight","project","round","anchor","y","transform","setTransform","update","off","clsx","imageSize","flex","fitBoundsOptions","duration","forwardRef","mapboxAccessToken","getPreset","getMedia","initialMapPosition","onMapMove","mapStyle","intl","setHovered","styleLoaded","setStyleLoaded","useImperativeHandle","fitBounds","apply","flyTo","initialBounds","zoom","getBounds","__hasMoved","bounds","bearing","pitch","Mapbox","ReactMapboxGl","accessToken","dragRotate","pitchWithRotate","attributionControl","logoPosition","scrollZoom","injectCSS","handleStyleLoad","mapInstance","addControl","mapboxgl","NavigationControl","ScaleControl","AttributionControl","compact","handleMapMove","getCenter","toArray","getZoom","getBearing","getPitch","onStyleLoad","onMove","lastImageAttachment","media","getLastImageUrl","getName","formatTime","created_at","extent","TextField","otherProps","InputLabelProps","shrink","UTM","defaultSettings","coordFormat","coordFormats","SettingsContext","FormattedLocation","latitude","longitude","formatDecDeg","formatPair","replace","easting","northing","zoneNum","zoneLetter","fromLatLon","toFixed","formatUtm","defaultObservationName","avatar","fontSize","fontWeight","action","alignSelf","FeatureHeader","iconLabel","iconColor","coords","createdAt","subheaderParts","component","msgs","subheader","widget","buttonPrevContainer","buttonNextContainer","right","dotsWidget","marginBottom","zIndex","dot","borderRadius","backgroundClip","border","dotHighlight","NextPrevButtons","index","total","onChangeIndex","showNext","showPrev","Dots","Array","role","MediaItem","MediaCarousel","items","initialIndex","setIndex","enableMouseEvents","getLocalizedFieldProp","prop","languageTag","languageCode","primitiveToString","fieldKeyToLabel","fieldkey","labelArray","titleCase","word","charAt","toUpperCase","capitalize","theme","root","flexGrow","paper","marginTop","spacing","chip","inputRoot","flexWrap","inputInput","divider","renderInput","inputProps","InputProps","other","inputRef","input","Encoder","toValue","opts","ops","toLabel","getLabeledSelectOptions","isSelectableFieldValue","SelectOne","labeledOptions","encoder","params","SelectMultiple","arrayValue","multiple","freeSolo","valueAsNumber","DateField","valueAsDate","parseDateString","inputVariant","autoOk","getDateString","styles","groupText","FormattedFieldname","fieldText","Field","handleChange","newValue","isMultiline","multiline","NumberField","DateTimeField","confirmCloseTitle","confirmCloseDescription","confirmCloseButtonConfirm","confirmCloseButtonCancel","confirmDeleteTitle","confirmDeleteButtonConfirm","confirmDeleteButtonCancel","detailsHeader","additionalHeader","cancelEditButton","saveEditButton","deleteObservationMenuItem","localeMap","enLocale","frLocale","ptLocale","esLocale","getLocaleData","defaultGetMedia","ConfirmCloseDialog","onConfirm","aria-describedby","ConfirmDeleteDialog","Accordion","withStyles","boxShadow","expanded","MuiAccordion","AccordionSummary","minHeight","content","MuiAccordionSummary","AccordionDetails","flexDirection","MuiAccordionDetails","ObservationActions","onDeleteClick","setAnchorEl","confirm","setConfirm","handleClose","keepMounted","state","didConfirm","createHandleItemClick","DialogContent","onRequestClose","onSave","onDelete","initialImageIndex","setValues","clone","dirty","setDirty","handleRequestClose","descriptionKey","mediaItems","utils","DateFnsUtils","mediaWrapper","icon","descriptionField","TransitionProps","unmountOnExit","expandIcon","sectionHeading","in","actions","ObservationDialog","shouldConfirm","scroll","opacity","transition","borderColor","paddingTop","details","minWidth","flexBasis","overflowY","textAlign","marginLeft","getStats","dataMemo","added","removed","oldArray","newArray","diffArrays","cloneDeep","createMemoizedStats","WrappedMapView","onUpdateObservation","onDeleteObservation","filter","editingObservation","setEditingObservation","editingInitialImageIndex","setEditingInitialImageIndex","getPresetWithFallback","defaultPreset","additionalField","additionalFieldKey","isEqual","handleObservationClick","observationId","imageIndex","dpr","filterFunction","presetFilter","subFilter","createFilterOrig","createFilter","filteredObservations","onClickObservation","ViewWrapper","textOverflow","overflow","whiteSpace","defaultTextField","FormattedValue","valueAsArray","separator","joinedChildren","joinReactChildren","valueAsDatetime","valueAsUrl","rel","row","verticalAlign","col1","col1Text","direction","col2","col2Edit","paddingBottom","col2TextEdit","col2Text","Label","Value","DetailsTable","renderTable","isEmptyValue","disableHeight","PPI","createElement","visibility","body","appendChild","rect","getBoundingClientRect","removeChild","getPPI","inch","cm","imageWrapper","borderTop","borderBottom","ReportPageContent","imageSrc","paperSize","pageBreakAfter","pageBreak","outline","letter","a4","ReportPaper","elevation","BORDER_SIZE","ReportViewContent","mapPosition","setMapPosition","cache","CellMeasurerCache","fixedWidth","paperWidthPx","renderPage","parent","columnIndex","rowIndex","renderMapPage","renderFeaturePage","paperContentMap","scrollWrapper","Fragment","reportWrapper","containerStyle","overflowX","rowCount","rowRenderer","deferredMeasurementCache","rowHeight","overscanRowCount","estimatedRowSize","tr","pageBreakInside","Toolbar","marginRight","textTransform","paddingRight","ToolbarButton","muiName","messages","PrintButton","dialogOpen","handleKeyDown","metaKey","handleKeyUp","requestPrint","openDialog","setState","closeDialog","handleChangePaperSize","changePaperSize","htmlFor","native","hideFieldsLabel","showAll","hideAll","listItem","fieldname","HideFieldsButton","fieldState","onFieldStateUpdate","hiddenCount","f","hidden","console","anchorOrigin","vertical","horizontal","PaperProps","maxHeight","newState","dense","toggleFieldVisibility","checked","ReportView","setPaperSize","setPrint","setFieldState","fieldKeyString","didCancel","timeoutId","clearTimeout","newSize","hiddenFieldsFilter","fs","ImageGrid","images","onImageClick","defaultSize","scrollbarWidth","getScrollBarWidth","columnsCount","rowsCount","cellSize","columnCount","columnWidth","MediaViewContent","sortedObservations","MapView","mapTabLabel","mediaTabLabel","reportTabLabel","TabItem","selected","disableRipple","tabItem","MapFilterToolbar","view","actionRight","tabGroup","tabLabel","borderLeft","borderTopRightRadius","borderBottomRightRadius","borderTopLeftRadius","borderBottomLeftRadius","tab","tabIcon","toolbarButton","filterHeader","LeftPanel","header","Styled","Loader","loading","Searching","gutterBottom","loadingTitle","justifySelf","MapStyleProvider","setStyle","offlineStyleURL","createZip","localFiles","remoteFiles","zipfile","yazl","ZipFile","missing","metadataPath","Buffer","from","addBuffer","tasks","once","arrayBuffer","arrBuf","run","end","outputStream","cancel","titleLabel","descriptionLabel","termsLabel","termsHint","styleLabel","EditDialogContent","saving","setSaving","setTitle","description","setDescription","noValidate","autoComplete","rowsMax","points","observationsToGeoJson","metadata","output","fsWriteStreamAtomic","archive","pump","createArchive","basename","EditDialog","appBar","filteredOrAll","exportAll","exportFiltered","noData","includePhotos","includePhotosHint","includePhotosNone","includePhotosOriginal","includePhotosPreview","defaultExportFilename","ExportDialogContent","allObservations","isFiltered","include","photos","formControl","labelId","observationsToSave","feature","$created","$modified","$version","$photos","allKeys","flattenedTags","flatten","parsedTags","formatCsvDatetime","hasLocation","locationData","$lon","$lat","$utmX","$utmY","$utmZone","$id","columns","csvFormat","observationsToCsv","X","Y","PHOTOS","ID","MAPEO_ID","formatCsvDate","TIME","formatCsvTime","COMMENT","observationsToSmartCsv","saveExt","writeFile","photosToSave","onSelectFile","DataExportDialog","num","dp","factor","pow","isoDateString","getHours","getMinutes","getSeconds","exportMap","onExport","errorTitle","errorDescription","MAPBOX_ACCESS_TOKEN","MyFallbackComponent","componentStack","errorFallback","FilterView","mapRef","viewWrapper","FallbackComponent","MediaView","usePresets","setLoading","setError","setPresets","setFields","async","mapToArray","presetsWithFields","fieldDefs","addFieldDefinitions","MapFilter","setView","setFilter","setPosition","savedPosition","persistPosition","usePositionRef","setDialog","observationsLoading","observationsError","isMounted","setObservations","updatedObservations","loadObservations","useObservations","presetsError","presetsLoading","Loading","FilterPanel","onChangeFilter","styleUrl","createPersistedState","initialState","searchingTitle","searchingHint","searchingWrapper","searching","searchingText","wifiInit","wifi","init","getQualityStyle","connection","quality","disconnected","disconnectedTooltip","wifiError","wifiErrorTooltip","qualityTooltipPoor","qualityTooltipWeak","qualityTooltipAdequate","selectSyncfile","newSyncfile","SyncAppBar","onClickSelectSyncfile","onClickNewSyncfile","currentConnection","setCurrentConnection","setWifiError","check","conn","getCurrentConnections","intervalCheck","clearInterval","titleBar","wifiIcon","wifiName","ssid","wifiQuality","lineHeight","actionArea","sync","starting","complete","retry","finishing","SyncIcon","faBolt","ProgressBackground","ProgressIcon","progress","awaitingCompletion","setAwaitingCompletion","thickness","progressCircle","StyledButton","SyncButton","connected","fontVariantNumeric","transitionDuration","DateDistance","distanceInSeconds","absValue","abs","hour","minute","numeric","updateIntervalInSeconds","unit","errorMsg","lastSync","database","SyncTarget","lastCompleted","deviceType","formatNumber","errorDetail","align","sofar","dbSofar","dbTotal","mediaSofar","mediaTotal","percent","fontStyle","SyncGrid","gridTemplateColumns","alignContent","gridGap","SyncFooter","setEncryptionKey","peerStatus","openSyncFileDialog","createSyncFileDialog","errorMsgVersionThemBad","errorMsgVersionUsBad","IGNORED_ERROR_CODES","fileDialogFilters","SyncView","focusState","listenForSyncPeers","syncPeer","listen","lastClosed","serverPeers","setServerPeers","syncErrors","setSyncErrors","syncRequests","setSyncRequests","peerListener","updatedServerPeers","newErrors","peer","topic","newSyncRequests","since","serverPeer","lastCompletedDate","parseVersionMajor","usVersion","themVersion","deviceName","started","getPeerProgress","getPeersStatus","peerId","file","usePeers","showOpenDialog","filePaths","peerState","db","versionString","major","IDLE","AVAILABLE","DOWNLOADING","PROGRESS","READY_FOR_RESTART","ERROR","INACTIVE","updateAvailable","updateNotAvailable","downloadButtonText","calculatingProgress","downloadProgress","restartMapeoText","restartMapeoButton","errorMessage","patchUpdate","minorUpdate","majorUpdate","unknownDownloadSpeed","estimatedDownloadTime","errors","ERR_UPDATER_CHANNEL_FILE_NOT_FOUND","UpdateTab","updateTab","STATES","internal","UpdaterView","setUpdate","UpdateAvailableView","DownloadProgressView","RestartView","UPDATE_NOT_AVAILABLE","UpdateNotAvailableView","updateInfo","estimatedTimeLeft","transferred","bytesPerSecond","seconds","downloadSpeed","minor","patch","handleDownlaoadClick","downloadUpdate","bps","downloadUpdateClick","addUpdateStatusListener","onupdate","serverState","checkForUpdates","quitAndInstall","mapeditor","mapfilter","Root","Sidebar","Logo","MapeoIcon","LocationOn","StyledTabs","Tabs","StyledTab","Tab","TabContent","StyledPanel","Version","focusStates","entering","entered","exiting","exited","TabPanel","extras","transitionStyles","transitionState","useTabIndex","Home","tabIndex","setTabIndex","updateListener","electronIpc","past","semver","next","files","UPDATE_INACTIVE","useUpdater","openLatLonDialog","openErrorDialog","openChangeLangDialog","reload","hasUpdate","updateStates","orientation","pkg","LatLon","app","getPath","bool","initialLocale","mdMsgs","mfMsgs","allMsgs","setLocale","handleLanguageChange","injectFirst","getElementById","testMode","removeItem"],"mappings":"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BjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,0D,cCAzBjC,EAAOD,QAAUkC,QAAQ,0D,cCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,4D,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,oC,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,+B,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,sD,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,sB,cCAzBjC,EAAOD,QAAUkC,QAAQ,oC,cCAzBjC,EAAOD,QAAUkC,QAAQ,mD,cCAzBjC,EAAOD,QAAUkC,QAAQ,8C,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,4D,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,uB,cCAzBjC,EAAOD,QAAUkC,QAAQ,0D,cCAzBjC,EAAOD,QAAUkC,QAAQ,oB,cCAzBjC,EAAOD,QAAUkC,QAAQ,4D,cCAzBjC,EAAOD,QAAUkC,QAAQ,8B,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,sD,cCAzBjC,EAAOD,QAAUkC,QAAQ,a,cCAzBjC,EAAOD,QAAUkC,QAAQ,gC,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,0D,cCAzBjC,EAAOD,QAAUkC,QAAQ,yB,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,sD,yqRCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,e,cCAzBjC,EAAOD,QAAUkC,QAAQ,wC,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,e,cCAzBjC,EAAOD,QAAUkC,QAAQ,sB,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,gBCAzB,MAEMK,EAAQ,IAFAL,EAAQ,KAER,CAAU,CACtBsE,YAAa,QACbC,cAAe,GACfC,WAAY,mBAGdzG,EAAOD,QAAUuC,G,cCRjBtC,EAAOD,QAAUkC,QAAQ,oB,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,8B,cCAzBjC,EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,cCAzBjC,EAAOD,QAAUkC,QAAQ,qB,cCAzBjC,EAAOD,QAAUkC,QAAQ,wB,cCAzBjC,EAAOD,QAAUkC,QAAQ,uC,cCAzBjC,EAAOD,QAAUkC,QAAQ,Q,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,yC,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,wB,cCAzBjC,EAAOD,QAAUkC,QAAQ,oB,cCAzBjC,EAAOD,QAAUkC,QAAQ,kD,cCAzBjC,EAAOD,QAAUkC,QAAQ,8D,cCAzBjC,EAAOD,QAAUkC,QAAQ,+D,cCAzBjC,EAAOD,QAAUkC,QAAQ,mB,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,gC,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,Q,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,gB,cCAzBjC,EAAOD,QAAUkC,QAAQ,mC,cCAzBjC,EAAOD,QAAUkC,QAAQ,wB,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,+B,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,sB,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,uB,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,uB,cCAzBjC,EAAOD,QAAUkC,QAAQ,gC,cCAzBjC,EAAOD,QAAUkC,QAAQ,uC,cCAzBjC,EAAOD,QAAUkC,QAAQ,uC,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,oC,cCAzBjC,EAAOD,QAAUkC,QAAQ,sC,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,gC,cCAzBjC,EAAOD,QAAUkC,QAAQ,+B,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,qC,cCAzBjC,EAAOD,QAAUkC,QAAQ,8B,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,+B,cCAzBjC,EAAOD,QAAUkC,QAAQ,mC,cCAzBjC,EAAOD,QAAUkC,QAAQ,8C,cCAzBjC,EAAOD,QAAUkC,QAAQ,6B,cCAzBjC,EAAOD,QAAUkC,QAAQ,iB,cCAzBjC,EAAOD,QAAUkC,QAAQ,wB,cCAzBjC,EAAOD,QAAUkC,QAAQ,yB,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAA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","file":"build.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 164);\n","module.exports = require(\"react\");","module.exports = require(\"react-intl\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/map\");","module.exports = require(\"@material-ui/core/styles\");","module.exports = require(\"@material-ui/core\");","module.exports = require(\"electron\");","module.exports = require(\"@babel/runtime-corejs3/helpers/extends\");","const winston = require('winston')\nconst path = require('path')\nconst DailyRotateFile = require('winston-daily-rotate-file')\nconst util = require('util')\n\nconst store = require('./store')\nconst appVersion = require('../package.json').version\n\nlet Bugsnag\n\nconst BUGSNAG_API_KEY = 'fcd92279c11ac971b4bd29b646ec4125'\n\nclass Logger {\n  constructor () {\n    this.winston = winston.createLogger()\n    this.configured = false\n    this._messageQueue = []\n    this._debug = store.get('debugging')\n  }\n\n  configure ({\n    userDataPath,\n    isDev,\n    label\n  }) {\n    this.isDev = isDev\n    this._startBugsnag(isDev ? 'development' : 'production')\n    const prettyPrint = winston.format.printf(({ level, message, label, timestamp }) => {\n      return `${timestamp} [${label}] ${level}: ${message}`\n    })\n\n    this.winston.format = winston.format.combine(\n      winston.format.label({ label }),\n      winston.format.timestamp(),\n      prettyPrint\n    )\n    this.dirname = path.join(userDataPath, 'logs')\n\n    for (const transport of this.winston.transports) {\n      if (transport.close) {\n        transport.close()\n      }\n    }\n\n    const mainLog = new (DailyRotateFile)({\n      filename: '%DATE%.log',\n      dirname: this.dirname,\n      datePattern: 'YYYY-MM-DD',\n      zippedArchive: true,\n      maxFiles: '365d',\n      level: 'info'\n    })\n    mainLog.name = 'main'\n    mainLog.on('new', () => {\n      // if debugging is on and a new log file is created, turn it off\n      this.debugging(false)\n    })\n    mainLog.on('rotate', () => {\n      // if debugging is on during a rotate, turn it off\n      this.debugging(false)\n    })\n    this.winston.add(mainLog)\n\n    const errorTransport = new (DailyRotateFile)({\n      filename: '%DATE%.error.log',\n      dirname: this.dirname,\n      datePattern: 'YYYY-MM',\n      zippedArchive: true,\n      maxFiles: '365d',\n      level: 'error'\n    })\n    this.winston.add(errorTransport)\n\n    if (isDev) {\n      this.winston.add(new winston.transports.Console({\n        level: 'debug'\n      }))\n    }\n    this.configured = true\n    if (this._messageQueue.length > 0) this._drainQueue()\n  }\n\n  debugging (debug) {\n    this._level(debug ? 'debug' : 'info')\n    store.set('debugging', debug)\n    this._debug = debug\n  }\n\n  _level (level) {\n    var port = this.winston.transports.find(t => t.name === 'main')\n    if (port) port.level = level\n    else this.error('logger', new Error('Could not find transport main'))\n  }\n\n  configured () {\n    return this.configured\n  }\n\n  _drainQueue () {\n    while (this._messageQueue.length) {\n      var msg = this._messageQueue.pop()\n      this._log(msg.level, msg.args)\n    }\n  }\n\n  _log (level, args) {\n    if (!this.configured) this._messageQueue.push({ level, args })\n    else {\n      this.winston.log({\n        level,\n        message: util.format(...args)\n      })\n      if (level === 'error') {\n        Bugsnag.notify(args[1], (event) => {\n          event.context = args[0]\n        })\n      }\n    }\n  }\n\n  warn () {\n    this._log('warn', Array.from(arguments))\n  }\n\n  error (context, err) {\n    if (!err) err = context\n    this._log('error', [context, err])\n  }\n\n  info () {\n    this._log('info', Array.from(arguments))\n  }\n\n  debug () {\n    this._log('debug', Array.from(arguments))\n  }\n\n  _startBugsnag (releaseStage) {\n    // This is really hacky because the @bugsnag/js package\n    // does not properly handle an electron background\n    // window with nodeIntegration: true\n    const args = {\n      releaseStage,\n      apiKey: BUGSNAG_API_KEY,\n      appVersion,\n      enabledReleaseStages: ['production']\n    }\n\n    setTimeout(function () {}).__proto__.unref = function () {}\n    try {\n      Bugsnag = require('@bugsnag/node')\n      Bugsnag.start(args)\n    } catch (err) {\n      logger.error('Failed to load bugsnag!', err)\n      Bugsnag = require('@bugsnag/browser')\n      Bugsnag.start(args)\n    }\n  }\n}\n\nconst logger = new Logger()\n\nmodule.exports = logger\n","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/object/assign\");","module.exports = require(\"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\");","module.exports = require(\"@material-ui/core/Button\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/values\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\");","module.exports = require(\"@material-ui/core/Dialog\");","module.exports = require(\"@material-ui/core/DialogContent\");","module.exports = require(\"@material-ui/core/Typography\");","module.exports = require(\"@material-ui/core/MenuItem\");","module.exports = require(\"@material-ui/core/DialogTitle\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/object/keys\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/find\");","module.exports = require(\"styled-components\");","module.exports = require(\"@material-ui/core/DialogActions\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/date/now\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/map\");","module.exports = require(\"path\");","module.exports = require(\"clsx\");","module.exports = require(\"@material-ui/core/AppBar\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\");","module.exports = require(\"@material-ui/core/IconButton\");","module.exports = require(\"@material-ui/core/FormControl\");","module.exports = require(\"@material-ui/icons\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/reduce\");","module.exports = require(\"react-mapbox-gl\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\");","module.exports = require(\"@material-ui/core/Toolbar\");","module.exports = require(\"@material-ui/core/Select\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/parse-float\");","module.exports = require(\"id-mapeo\");","module.exports = require(\"@material-ui/icons/MoreVert\");","module.exports = require(\"@material-ui/core/Menu\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/sort\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\");","module.exports = require(\"@material-ui/pickers\");","module.exports = require(\"react-virtualized-auto-sizer\");","module.exports = require(\"@material-ui/core/Paper\");","module.exports = require(\"mapbox-gl\");","module.exports = require(\"@material-ui/core/InputLabel\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/set-timeout\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/every\");","module.exports = require(\"insert-css\");","module.exports = require(\"@material-ui/core/DialogContentText\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/trim\");","module.exports = require(\"clone-deep\");","module.exports = require(\"react-virtualized\");","module.exports = require(\"react-dom\");","const Store = require('conf')\n\nconst store = new Store({\n  projectName: 'Mapeo',\n  projectSuffix: '',\n  configName: 'mapeo-settings'\n})\n\nmodule.exports = store\n","module.exports = require(\"lodash/debounce\");","module.exports = require(\"ky/umd\");","module.exports = require(\"@material-ui/core/Tooltip\");","module.exports = require(\"@material-ui/core/Input\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/number/is-nan\");","module.exports = require(\"mime/lite\");","module.exports = require(\"@segment/isodate\");","module.exports = require(\"@mapbox/sexagesimal\");","module.exports = require(\"@material-ui/core/CircularProgress\");","module.exports = require(\"utm\");","module.exports = require(\"fs-write-stream-atomic\");","module.exports = require(\"pump\");","module.exports = require(\"react-mapfilter/commonjs/ViewWrapper\");","module.exports = require(\"@material-ui/icons/Error\");","module.exports = require(\"@material-ui/styles\");","module.exports = require(\"electron-is-dev\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/promise\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/find-index\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/starts-with\");","module.exports = require(\"lodash/isEqual\");","module.exports = require(\"@material-ui/icons/ExpandMore\");","module.exports = require(\"@material-ui/lab/Autocomplete\");","module.exports = require(\"@material-ui/core/TableCell\");","module.exports = require(\"d3-dsv\");","module.exports = require(\"node-wifi\");","module.exports = require(\"react-intl-formatted-duration\");","module.exports = require(\"semver\");","module.exports = require(\"@material-ui/core/CssBaseline\");","module.exports = require(\"@material-ui/core/Tabs\");","module.exports = require(\"@material-ui/core/Tab\");","module.exports = require(\"react-transition-group\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/object/entries\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/keys\");","module.exports = require(\"url\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/some\");","module.exports = require(\"object-path-immutable\");","module.exports = require(\"react-image\");","module.exports = require(\"@material-ui/icons/BrokenImage\");","module.exports = require(\"mapeo-entity-filter\");","module.exports = require(\"@material-ui/icons/Close\");","module.exports = require(\"@material-ui/core/Collapse\");","module.exports = require(\"@material-ui/core/Fade\");","module.exports = require(\"@date-io/date-fns\");","module.exports = require(\"date-fns/locale/en-US\");","module.exports = require(\"date-fns/locale/fr\");","module.exports = require(\"date-fns/locale/pt-BR\");","module.exports = require(\"date-fns/locale/es\");","module.exports = require(\"@material-ui/core/Accordion\");","module.exports = require(\"@material-ui/core/AccordionSummary\");","module.exports = require(\"@material-ui/core/AccordionDetails\");","module.exports = require(\"@material-ui/core/CardHeader\");","module.exports = require(\"@material-ui/icons/Place\");","module.exports = require(\"@material-ui/core/Avatar\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/fill\");","module.exports = require(\"@material-ui/icons/NavigateNext\");","module.exports = require(\"@material-ui/icons/NavigateBefore\");","module.exports = require(\"react-swipeable-views\");","module.exports = require(\"@material-ui/core/Table\");","module.exports = require(\"@material-ui/core/TableBody\");","module.exports = require(\"@material-ui/core/TableRow\");","module.exports = require(\"@material-ui/icons/Print\");","module.exports = require(\"@material-ui/icons/VisibilityOff\");","module.exports = require(\"@material-ui/core/Popover\");","module.exports = require(\"@material-ui/core/List\");","module.exports = require(\"@material-ui/core/ListItem\");","module.exports = require(\"@material-ui/core/ListItemText\");","module.exports = require(\"@material-ui/core/ListItemSecondaryAction\");","module.exports = require(\"@material-ui/core/Switch\");","module.exports = require(\"react-window\");","module.exports = require(\"get-scrollbar-width\");","module.exports = require(\"react-error-boundary\");","module.exports = require(\"@material-ui/icons/Map\");","module.exports = require(\"@material-ui/icons/Apps\");","module.exports = require(\"@material-ui/icons/LibraryBooks\");","module.exports = require(\"react-mapfilter\");","module.exports = require(\"yazl\");","module.exports = require(\"run-parallel-limit\");","module.exports = require(\"once\");","module.exports = require(\"@material-ui/core/FormHelperText\");","module.exports = require(\"flat\");","module.exports = require(\"fs\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/number/parse-int\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/set-interval\");","module.exports = require(\"@material-ui/icons/PhoneAndroid\");","module.exports = require(\"@material-ui/icons/Laptop\");","module.exports = require(\"@material-ui/icons/Usb\");","module.exports = require(\"@material-ui/icons/Check\");","module.exports = require(\"@fortawesome/react-fontawesome\");","module.exports = require(\"@fortawesome/free-solid-svg-icons\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/array/from\");","module.exports = require(\"winston\");","module.exports = require(\"winston-daily-rotate-file\");","module.exports = require(\"util\");","module.exports = require(\"conf\");","module.exports = require(\"@bugsnag/node\");","module.exports = require(\"@bugsnag/browser\");","module.exports = require(\"core-js/es/reflect\");","module.exports = require(\"react-mapfilter/translations/en.json\");","module.exports = require(\"react-mapfilter/translations/es.json\");","module.exports = require(\"react-mapfilter/translations/pt.json\");","import { createMuiTheme } from '@material-ui/core/styles'\n\nconst systemFontFamily = [\n  '-apple-system',\n  'BlinkMacSystemFont',\n  '\"Segoe UI\"',\n  'Roboto',\n  '\"Helvetica Neue\"',\n  'Arial',\n  'sans-serif',\n  '\"Apple Color Emoji\"',\n  '\"Segoe UI Emoji\"',\n  '\"Segoe UI Symbol\"'\n].join(',')\n\nexport default createMuiTheme({\n  typography: {\n    fontFamily: 'Rubik, sans-serif',\n    body1: {\n      fontFamily: systemFontFamily\n    },\n    body2: {\n      fontFamily: systemFontFamily\n    },\n    caption: {\n      fontFamily: systemFontFamily\n    }\n  },\n  palette: {\n    primary: {\n      main: '#0066FF'\n    },\n    secondary: {\n      main: '#FF9933'\n    }\n  }\n})\n","import { remote } from 'electron'\nimport 'core-js/es/reflect'\nimport ky from 'ky/umd'\nimport logger from '../logger'\n\nconst BASE_URL = 'http://' + remote.getGlobal('osmServerHost') + '/'\n\nexport default Api({\n  // window.middlewareClient is set in src/middleware/client-preload.js\n  ipc: window.middlewareClient,\n  baseUrl: BASE_URL\n})\n\nfunction Api ({ baseUrl, ipc }) {\n  // We append this to requests for presets and map styles, in order to override\n  // the local static server cache whenever the app is restarted. NB. sprite,\n  // font, and map tile requests might still be cached, only changes in the map\n  // style will be cache-busted.\n  const startupTime = Date.now()\n\n  const req = ky.extend({\n    prefixUrl: baseUrl,\n    // No timeout because indexing after first sync takes a long time, which mean\n    // requests to the server take a long time\n    timeout: false,\n    headers: {\n      'cache-control': 'no-cache',\n      pragma: 'no-cache'\n    }\n  })\n\n  function logRequest (prefix, promise) {\n    const start = Date.now()\n    promise\n      .then(data => {\n        logger.debug(prefix, Date.now() - start + 'ms')\n      })\n      .catch(error => {\n        // Preset errors aren't fatal errors.\n        if (prefix.indexOf('presets') > -1) logger.info(prefix, error)\n        else logger.error(prefix, error)\n      })\n    return promise\n  }\n  // Request convenience methods that wait for the server to be ready\n  function get (url) {\n    return logRequest('<GET: ' + url, req.get(url).json())\n  }\n  function del (url) {\n    return logRequest('<DEL: ' + url, req.delete(url).json())\n  }\n  function put (url, data) {\n    return logRequest('<PUT: ' + url, req.put(url, { json: data }).json())\n  }\n  function post (url, data) {\n    return logRequest('<POST: ' + url, req.post(url, { json: data }).json())\n  }\n\n  // All public methods\n  const api = {\n    /**\n     * GET async methods\n     */\n\n    getPresets: function getPresets (id) {\n      if (!id) id = 'default'\n      return get(`presets/${id}/presets.json?${startupTime}`)\n    },\n\n    getObservations: function getObservations () {\n      return get('observations')\n    },\n\n    getMapStyle: function getMapStyle (id) {\n      return get(`styles/${id}/style.json?${startupTime}`)\n    },\n\n    /**\n     * DELETE methods\n     */\n\n    deleteObservation: function deleteObservation (id) {\n      return del(`observations/${id}`)\n    },\n\n    /**\n     * PUT and POST methods\n     */\n\n    updateObservation: function updateObservation (id, value) {\n      const valueForServer = {\n        ...value,\n        type: 'observation',\n        schemaVersion: 3,\n        id\n      }\n      return put(`observations/${id}`, valueForServer)\n    },\n\n    createObservation: function createObservation (value) {\n      const valueForServer = {\n        ...value,\n        type: 'observation',\n        schemaVersion: 3\n      }\n      return post('observations', valueForServer)\n    },\n\n    /**\n     * SYNC methods\n     */\n\n    // Listens to the server for updates to the list of peers available for sync\n    // returns a remove() function to unscubribe\n    addPeerListener: function addPeerListener (handler) {\n      // We sidestep the http API here, and instead of polling the endpoint, we\n      // listen for an event from mapeo-core whenever the peers change, then\n      // request an updated peer list.\n      function onPeerUpdate (peers) {\n        logger.debug('peer-update', peers)\n        handler(peers)\n      }\n      ipc.on('peer-update', onPeerUpdate)\n      api.syncGetPeers().then(handler)\n      return {\n        remove: () => ipc.removeListener('peer-update', onPeerUpdate)\n      }\n    },\n\n    addDataChangedListener: function (ev, handler) {\n      ipc.on('sync-complete', handler)\n      ipc.on(ev, handler)\n      return {\n        remove: () => {\n          ipc.removeListener('sync-complete', handler)\n          ipc.removeListener(ev, handler)\n        }\n      }\n    },\n\n    getEncryptionKey: function () {\n      return new Promise((resolve, reject) => {\n        ipc.send('encryption-key', null, (err, encryptionKey) => {\n          if (err) return reject(err)\n          resolve(encryptionKey)\n        })\n      })\n    },\n\n    // Start listening for sync peers and advertise with `deviceName`\n    syncJoin: function syncJoin () {\n      logger.debug('Join sync')\n      ipc.send('sync-join')\n    },\n\n    // Stop listening for sync peers and stop advertising\n    syncLeave: function syncLeave () {\n      logger.debug('Leave sync')\n      ipc.send('sync-leave')\n    },\n\n    // Get a list of discovered sync peers\n    syncGetPeers: function syncGetPeers () {\n      return get('sync/peers').then(data => data && data.message)\n    },\n\n    // Start sync with a peer\n    syncStart: function syncStart (target) {\n      ipc.send('sync-start', target)\n    },\n\n    exportData: function (filename, { format = 'geojson' } = {}) {\n      return new Promise((resolve, reject) => {\n        ipc.send('export-data', { filename, format }, (err) => {\n          if (err) {\n            logger.error('export data', err)\n            reject(err)\n          } else resolve()\n        })\n      })\n    },\n\n    /**\n     * HELPER synchronous methods\n     */\n\n    // Return the url for an icon\n    getIconUrl: function getIconUrl (iconId, size = 'medium') {\n      // Some devices are @4x or above, but we only generate icons up to @3x\n      // Also we don't have @1.5x, so we round it up\n      const roundedRatio = Math.min(Math.ceil(window.devicePixelRatio), 3)\n      return `${baseUrl}presets/default/icons/${iconId}-medium@${roundedRatio}x.png`\n    },\n\n    // Return the url for a media attachment\n    getMediaUrl: function getMediaUrl (attachmentId, size = 'preview') {\n      return `${baseUrl}media/${size}/${attachmentId}`\n    },\n\n    // Return the url to a map style\n    getMapStyleUrl: function getMapStyleUrl (id) {\n      return `${baseUrl}styles/${id}/style.json?${startupTime}`\n    },\n\n    zoomToData: function (type, cb) {\n      ipc.send('zoom-to-data-get-centroid', type, cb)\n    }\n  }\n\n  return api\n}\n","import React from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport ExportIcon from '@material-ui/icons/MoreVert'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Dialog from '@material-ui/core/Dialog'\nimport MuiDialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport Button from '@material-ui/core/Button'\nimport { LinearProgress } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { remote } from 'electron'\n\nimport logger from '../../../logger'\nimport api from '../../new-api'\n\nconst m = defineMessages({\n  // Button tooltip on iD Editor toolbar\n  exportButton: 'Export map data',\n  // Menu item for exporting GeoJSON\n  exportGeoJson: 'Export GeoJSON',\n  // Menu item for exporting Shapefile\n  exportShapefile: 'Export Shapefile',\n  // OK button after successful export\n  okButton: 'OK',\n  // Close button after export error\n  closeButton: 'Close',\n  // Export dialog title - shown during export progress and after success/failure\n  dialogTitle: 'Exporting data',\n  // Export success message,\n  dialogSuccess: 'Export complete',\n  // Expor error message - if there was an error during export\n  dialogError: 'Export failed due to an internal error',\n  // Save dialog title\n  saveTitle: 'Export map data',\n  // Default filename for map export\n  defaultFilename: 'mapeo-map-data'\n})\n\nconst DialogTitle = () => (\n  <MuiDialogTitle id='dialog-title'>\n    <FormattedMessage {...m.dialogTitle} />\n  </MuiDialogTitle>\n)\n\nconst DialogAction = ({ children, onClick }) => (\n  <DialogActions>\n    <Button onClick={onClick} color='primary' variant='contained' autoFocus>\n      {children}\n    </Button>\n  </DialogActions>\n)\n\nconst ExportButton = () => {\n  const { formatMessage: t } = useIntl()\n  const [status, setStatus] = React.useState('idle')\n  const cx = useStyles()\n  const [menuAnchor, setMenuAnchor] = React.useState(null)\n\n  const handleExportClick = event => {\n    setMenuAnchor(event.currentTarget)\n  }\n\n  const handleMenuItemClick = format => () => {\n    setMenuAnchor(null)\n    const ext = format === 'shapefile' ? 'zip' : 'geojson'\n    remote.dialog.showSaveDialog(\n      {\n        title: t(m.saveTitle),\n        defaultPath: t(m.defaultFilename) + '.' + ext,\n        filters: [{ name: format, extensions: [ext] }]\n      }\n    ).then(({ canceled, filePath }) => {\n      if (!filePath || canceled) return\n      setStatus('pending')\n      api\n        .exportData(filePath, { format })\n        .then(() => {\n          setStatus('success')\n        })\n        .catch(err => {\n          setStatus('reject')\n          logger.error('ExportButton save dialog', err)\n        })\n    }\n    )\n  }\n\n  const close = event => {\n    setStatus('idle')\n  }\n\n  let dialogContent\n  switch (status) {\n    case 'idle':\n      dialogContent = null\n      break\n    case 'pending':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <LinearProgress indeterminate />\n          </DialogContent>\n        </>\n      )\n      break\n    case 'success':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <DialogContentText>\n              <FormattedMessage {...m.dialogSuccess} />\n            </DialogContentText>\n          </DialogContent>\n          <DialogAction onClick={close}>\n            <FormattedMessage {...m.okButton} />\n          </DialogAction>\n        </>\n      )\n      break\n    case 'reject':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <DialogContentText>\n              <FormattedMessage {...m.dialogError} />\n            </DialogContentText>\n          </DialogContent>\n          <DialogAction onClick={close}>\n            <FormattedMessage {...m.closeButton} />\n          </DialogAction>\n        </>\n      )\n      break\n  }\n\n  return (\n    <>\n      <Tooltip title={t(m.exportButton)}>\n        <IconButton\n          aria-label='export'\n          onClick={handleExportClick}\n          aria-controls='export-menu'\n          aria-haspopup='true'\n          className={cx.button}\n        >\n          <ExportIcon />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        id='export-menu'\n        anchorEl={menuAnchor}\n        open={Boolean(menuAnchor)}\n        onClose={handleMenuItemClick(null)}\n      >\n        <MenuItem onClick={handleMenuItemClick('geojson')}>\n          <FormattedMessage {...m.exportGeoJson} />\n        </MenuItem>\n      </Menu>\n      <Dialog\n        open={status !== 'idle'}\n        aria-labelledby='dialog-title'\n        maxWidth='xs'\n        fullWidth\n        disableBackdropClick={status === 'pending'}\n        disableEscapeKeyDown={status === 'pending'}\n        onClose={() => setStatus('idle')}\n      >\n        {dialogContent}\n      </Dialog>\n    </>\n  )\n}\n\nexport default ExportButton\n\nconst useStyles = makeStyles({\n  button: {\n    width: 40,\n    margin: '0 5px'\n  }\n})\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { ipcRenderer, remote, shell } from 'electron'\nimport iD from 'id-mapeo'\nimport debounce from 'lodash/debounce'\nimport insertCss from 'insert-css'\n\nimport api from '../../new-api'\nimport { defineMessages, useIntl } from 'react-intl'\nimport ExportButton from './ExportButton'\n\nconst m = defineMessages({\n  'feedback-contribute-button': 'Feedback & Contribute',\n  notes: 'Description'\n})\n\n// iD Editor style overrides\ninsertCss(`\n  .id-container .header {\n    height: 64px;\n  }\n  .id-container .pane {\n    bottom: 0;\n  }\n  .id-container .entity-editor-pane .inspector-body, .id-container .selection-list-pane .inspector-body {\n    top: 64px;\n  }\n  .id-container #bar {\n    height: 64px;\n    background-color: white;\n    padding: 0 8px 0 8px;\n    align-items: center;\n  }\n  .id-container #bar .toolbar-item .item-label {\n    display: none;\n  }\n  .id-container #bar .toolbar-item .item-content {\n    flex: 1;\n    display: inline-flex;\n    border-radius: 4px;\n  }\n  .id-container #bar .toolbar-item.sidebar-toggle {\n    display: none;\n  }\n  .id-container #bar > .toolbar-item.spacer:nth-child(2) {\n    display: none;\n  }\n  .id-container button.bar-button {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    background-color: rgba(0,0,0,0);\n    height: 44px;\n    font-family: Rubik, sans-serif;\n    font-weight: 500;\n    line-height: 1.75;\n    font-size: 0.875rem;\n    padding: 0 16px;\n  }\n  .id-container [dir='ltr'] .add-point .tooltip {\n    left: 0 !important;\n  }\n  .id-container [dir='ltr'] .add-point .tooltip .tooltip-arrow {\n    left: 20px;\n  }\n  .id-container button.bar-button.active {\n    background-color: #7092ff;\n  }\n  .id-container button.bar-button:not(:last-child) {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n  .id-container button.bar-button:not(:first-child) {\n    border-left: 1px solid transparent;\n    margin-left: -1px;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  }\n  .id-container .joined > *:last-child {\n    border-right-width: 1px;\n  }\n  .id-container button.save .count {\n    min-width: auto;\n    padding-left: 8px\n  }\n  .id-container #bar .mapeo-toolbar-item.mapeo-spacer {\n    width: 100%;\n    flex-grow: 2;\n  }\n  .id-container #bar .mapeo-toolbar-item {\n    display: flex;\n    flex: 0 1 auto;\n    flex-flow: column wrap;\n    justify-content: center;\n    position: relative;\n  }\n`)\n\nconst { localStorage, location } = window\n\nconst MapEditor = () => {\n  const rootRef = React.useRef()\n  const id = React.useRef()\n  const customDefs = React.useRef()\n  const { formatMessage: t, locale } = useIntl()\n  const [toolbarEl, setToolbarEl] = React.useState()\n\n  const zoomToData = React.useCallback((_, loc) => {\n    if (!id.current) return\n    id.current.map().centerZoomEase(loc, 14, 1000)\n  }, [])\n\n  React.useEffect(\n    function setupListeners () {\n      ipcRenderer.on('zoom-to-data-node', zoomToData)\n      ipcRenderer.on('zoom-to-latlon-response', zoomToData)\n      return () => {\n        ipcRenderer.removeListener('zoom-to-data-node', zoomToData)\n        ipcRenderer.removeListener('zoom-to-latlon-response', zoomToData)\n      }\n    },\n    [zoomToData]\n  )\n\n  React.useEffect(() => {\n    function refreshWindow () {\n      if (!id.current) return\n      var history = id.current.history()\n      var saved = history.toJSON()\n      id.current.flush()\n      if (saved) history.fromJSON(saved)\n      api.zoomToData('node', (_, loc) => {\n        zoomToData(_, loc)\n      })\n    }\n    const subscription = api.addDataChangedListener('observation-edit', () =>\n      refreshWindow()\n    )\n    return () => {\n      subscription.remove()\n    }\n  }, [zoomToData])\n\n  React.useEffect(function saveLocation () {\n    var prevhash = localStorage.getItem('location')\n    if (prevhash) location.hash = prevhash\n\n    const onHashChange = debounce(() => {\n      localStorage.setItem('location', window.location.hash)\n    }, 200)\n\n    window.addEventListener('hashchange', onHashChange)\n\n    return () => {\n      window.removeEventListener('hashchange', onHashChange)\n    }\n  }, [])\n\n  React.useLayoutEffect(\n    function initIdEditor () {\n      if (!rootRef.current) return\n      updateSettings()\n\n      var serverUrl = 'http://' + remote.getGlobal('osmServerHost')\n      id.current = window.id = iD\n        .coreContext()\n        .assetPath('node_modules/id-mapeo/dist/')\n        .preauth({ url: serverUrl })\n        .minEditableZoom(window.localStorage.getItem('minEditableZoom') || 14)\n\n      // Calling iD.coreContext() detects the locale from the browser. We need\n      // to override it with the app locale, before we call ui()\n      id.current.locale(locale)\n\n      if (!customDefs.current) {\n        customDefs.current = id.current\n          .container()\n          .append('svg')\n          .style('position', 'absolute')\n          .style('width', '0px')\n          .style('height', '0px')\n          .attr('id', 'custom-defs')\n          .append('defs')\n\n        customDefs.current.append('svg')\n      }\n\n      id.current.ui()(rootRef.current, function onLoad () {\n        var links = document.querySelectorAll('.id-container a[href^=\"http\"]')\n        links.forEach(function (link) {\n          var href = link.getAttribute('href')\n          link.onclick = function (event) {\n            event.preventDefault()\n            shell.openExternal(href)\n            return false\n          }\n        })\n\n        var contributeBtn = document.querySelector(\n          '.id-container .overlay-layer-attribution a'\n        )\n        if (contributeBtn) {\n          contributeBtn.innerHTML = t(m['feedback-contribute-button'])\n        }\n\n        // Add custom buttons to toolbar\n        const toolbar = id.current.container().select('#bar')\n        toolbar.append('div').attr('class', 'mapeo-toolbar-item mapeo-spacer')\n        setToolbarEl(toolbar.append('div').node())\n\n        // Update label on map move\n        var aboutList = id.current.container().select('#about-list')\n        var map = id.current.map()\n        var latlon = aboutList\n          .append('li')\n          .append('span')\n          .text(latlonToPosString(map.center()))\n        id.current.container().on('mousemove', function () {\n          var pos = map.mouseCoordinates()\n          var s = latlonToPosString(pos)\n          latlon.text(s)\n        })\n\n        updateSettings()\n\n        // iD uses onbeforeunload to prompt the user about unsaved changes.\n        // Electron does not prompt the user on this event, and iD saves changes\n        // to local storage anyway, so we can just ignore it\n        window.onbeforeunload = e => {\n          if (!id.current || typeof id.current.context !== 'function') return\n          id.current.context().save()\n          // This guarantees that the unload continues\n          delete e.returnValue\n        }\n        // setTimeout(() => id.current.flush(), 1500)\n      })\n    },\n    // This should have a dependency of `t` and `locale`, so that it re-runs if\n    // the locale or the `t` function changes, but we don't have an easy way to\n    // teardown iD editor and then recreate it, so we need to never re=-run this\n    // effect\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  function updateSettings () {\n    var presets = ipcRenderer.sendSync('get-user-data', 'presets')\n    var customCss = ipcRenderer.sendSync('get-user-data', 'css')\n    var imagery = ipcRenderer.sendSync('get-user-data', 'imagery')\n    var icons = ipcRenderer.sendSync('get-user-data', 'icons')\n    var translations = ipcRenderer.sendSync('get-user-data', 'translations')\n\n    if (translations && id.current) {\n      const currentLocale = id.current.locale()\n      // Todo fallback should be default language of presets. Currently it's\n      // random - it just uses the first locale returned from Object.keys()\n      const translationsInLocale =\n        translations[currentLocale] ||\n        translations[Object.keys(translations)[0]] ||\n        {}\n      if (translationsInLocale.presets) {\n        ;(iD.translations[currentLocale] || iD.translations.en).presets =\n          translationsInLocale.presets\n      }\n    }\n    if (presets) {\n      fallbackFields.notes.label = t(m.notes) // translate notes field\n      const iDPresets = convertPresets(presets)\n\n      if (!id.current) {\n        iDPresets.fields = { ...iD.data.presets.fields, ...iDPresets.fields }\n        iD.data.presets = iDPresets\n      }\n    }\n    if (customCss) insertCss(customCss)\n    if (imagery) {\n      // iD upgraded to use 'dataImagery' in 2.14.3, this is for backwards\n      // compatibility\n      if (imagery.dataImagery) imagery = imagery.dataImagery\n      imagery.forEach((img, idx) => {\n        // Add id\n        img.id = img.name + '_' + idx\n        iD.data.imagery.unshift(img)\n      })\n    }\n    if (icons) {\n      var parser = new window.DOMParser()\n      var iconsSvg = parser.parseFromString(icons, 'image/svg+xml')\n        .documentElement\n      var defs = customDefs.current && customDefs.current.node()\n      if (defs) defs.replaceChild(iconsSvg, defs.firstChild)\n    }\n  }\n\n  return (\n    <div className='id-container'>\n      <div ref={rootRef} />\n      {toolbarEl && ReactDOM.createPortal(<ExportButton />, toolbarEl)}\n    </div>\n  )\n}\n\nexport default MapEditor\n\nfunction latlonToPosString (pos) {\n  pos[0] = (Math.floor(pos[0] * 1000000) / 1000000).toString()\n  pos[1] = (Math.floor(pos[1] * 1000000) / 1000000).toString()\n  while (pos[0].length < 10) pos[0] += '0'\n  while (pos[1].length < 10) pos[1] += '0'\n  return pos.toString()\n}\n\n// iD Editor requires that [fallback presets are\n// defined](https://github.com/openstreetmap/iD/tree/develop/data/presets#custom-presets),\n// so that entities on the map always match _something_.\nconst fallbackPresets = {\n  area: {\n    name: 'Area',\n    tags: {},\n    geometry: ['area'],\n    matchScore: 0.1\n  },\n  line: {\n    name: 'Line',\n    tags: {},\n    geometry: ['line'],\n    matchScore: 0.1\n  },\n  point: {\n    name: 'Point',\n    tags: {},\n    geometry: ['point', 'vertex'],\n    matchScore: 0.1\n  },\n  relation: {\n    name: 'Relation',\n    tags: {},\n    geometry: ['relation'],\n    matchScore: 0.1\n  }\n}\n\n// iD Editor requires that a \"name\" field is always defined.\nconst fallbackFields = {\n  name: {\n    key: 'name',\n    type: 'localized',\n    label: 'Name',\n    placeholder: 'Common name (if any)'\n  },\n  notes: {\n    key: 'notes',\n    type: 'textarea',\n    label: 'Description'\n  }\n}\n\n/**\n * Presets for Mapeo use a slightly different schema than presets for iD Editor.\n * Currently the main difference is select_one fields\n */\nfunction convertPresets (presetsObj) {\n  const fields = { ...fallbackFields, ...presetsObj.fields }\n  const presets = { ...fallbackPresets, ...presetsObj.presets }\n\n  // In Mapeo Mobile (and Observation View) we do not yet use the preset.tags\n  // property to match presets to entities on the map. Instead we match based on\n  // categoryId === presetId. For using presets from Mapeo Mobile in iD, if a\n  // preset does not have any properties set on `preset.tags` then we use\n  // `categoryId`\n  Object.keys(presets).forEach(presetId => {\n    const preset = presets[presetId]\n    if (\n      Object.keys(preset.tags || {}).length === 0 &&\n      // Skip for fallback presets `point`, `line`, `area`, `relation`\n      !Object.keys(fallbackPresets).includes(presetId)\n    ) {\n      presets[presetId] = {\n        ...preset,\n        tags: {\n          categoryId: presetId\n        }\n      }\n    }\n  })\n\n  Object.keys(fields).forEach(fieldId => {\n    const field = fields[fieldId]\n    let type\n    let snakeCase\n    switch (field.type) {\n      // The iD equivalent of the mapeo select_one is a `combo` field\n      case 'select_one':\n        type = 'combo'\n        // iD defaults to combo fields being \"snake case\", which means that it\n        // converts any value selected / entered to snake case. Mapeo defaults\n        // snake_case to false.\n        snakeCase =\n          typeof field.snake_case === 'boolean' ? field.snake_case : false\n        break\n      // iD equivalent of select_multiple is `semiCombo`, but note that iD\n      // stores the value as a semi-colon separated string, whereas Mapeo will\n      // store this as an array, so this field is not compatible between the\n      // two.\n      case 'select_multiple':\n        type = 'semiCombo'\n        break\n      // Mapeo does not have a `textarea` field, instead text fields have an\n      // appearance of `singleline` or `multiline`, with the default\n      // `multiline`.\n      case 'text':\n        if (!field.appearance || field.appearance === 'multiline') {\n          type = 'textarea'\n        } else {\n          type = 'text'\n        }\n        break\n      default:\n        type = field.type\n    }\n\n    fields[fieldId] = {\n      ...field,\n      type,\n      snake_case: snakeCase\n    }\n\n    // Mapeo supports translatable descriptions of field values for select\n    // fields with an array of option objects with \"label\" and \"value\"\n    // properties. iD supports this with a separate property `strings.options`\n    // which is an object of value:name pairs. This does not allow ordering of\n    // options like Mapeo supports.\n    // https://github.com/openstreetmap/iD/tree/develop/data/presets#strings\n    if (\n      Array.isArray(field.options) &&\n      field.options.every(opt => typeof opt === 'object')\n    ) {\n      const mapeoOptions = field.options\n      const iDStringOptions = {}\n      mapeoOptions.forEach(opt => {\n        iDStringOptions[opt.value] = opt.label\n      })\n      delete fields[fieldId].options\n      fields[fieldId].strings = { options: iDStringOptions }\n    }\n  })\n\n  return {\n    ...presetsObj,\n    fields,\n    presets\n  }\n}\n","import DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Input from '@material-ui/core/Input'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormControl from '@material-ui/core/FormControl'\nimport React, { useState } from 'react'\nimport { ipcRenderer } from 'electron'\n\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst m = defineMessages({\n  'dialog-enter-latlon-coordinates': 'Enter Coordinates',\n  'button-submit': 'Submit'\n})\n\nconst LatLonDialog = ({ onClose, open }) => {\n  const { formatMessage: t } = useIntl()\n  const [latLon, setLatLon] = useState()\n\n  const submitHandler = event => {\n    var rx = /(-?\\d+\\.?\\d*)[^01234567890-]+(-?\\d+\\.?\\d*)/\n    var match = rx.exec(latLon)\n    if (match) {\n      var pt = [parseFloat(match[1].trim()), parseFloat(match[2].trim())]\n      ipcRenderer.send('zoom-to-latlon-request', pt[0], pt[1])\n      onClose()\n    }\n    if (event) {\n      event.preventDefault()\n      event.stopPropagation()\n    }\n    return false\n  }\n\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle>{t(m['dialog-enter-latlon-coordinates'])}</DialogTitle>\n      <DialogContent>\n        <FormControl>\n          <Input\n            id='latlon-text'\n            placeholder='Lon, Lat'\n            type='text'\n            value={latLon}\n            onChange={event => setLatLon(event.target.value)}\n          />\n          <DialogActions>\n            <Button onClick={submitHandler}>{t(m['button-submit'])}</Button>\n          </DialogActions>\n        </FormControl>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default LatLonDialog\n","import React from 'react'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nexport default class ErrorDialog extends React.Component {\n  render () {\n    // TODO: escape this html for displaying newlines\n    return (\n      <Dialog open={this.props.open} onClose={this.props.onClose}>\n        <DialogTitle>Error</DialogTitle>\n        <DialogContent>\n          <textarea cols='20' rows='40' value={this.props.message} disabled />\n        </DialogContent>\n      </Dialog>\n    )\n  }\n}\n","import DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Select from '@material-ui/core/Select'\nimport Dialog from '@material-ui/core/Dialog'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormControl from '@material-ui/core/FormControl'\nimport React, { useState } from 'react'\n\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst languages = {\n  es: 'Espaol',\n  en: 'English',\n  fr: 'Franais',\n  pt: 'Portugus'\n}\n\nconst m = defineMessages({\n  'dialog-enter-language': 'Choose a language',\n  'button-submit': 'Submit',\n  'button-cancel': 'Cancel'\n})\n\nconst ChangeLanguage = ({ onCancel, onSelectLanguage, open }) => {\n  const { formatMessage: t, locale } = useIntl()\n  // Set default state to app locale\n  const [lang, setLang] = useState(locale)\n\n  const submitHandler = () => {\n    onSelectLanguage(lang)\n  }\n\n  const closeHandler = () => {\n    // This will remember state between open/close, so if the user cancels this\n    // should reset to the currently selected locale\n    setLang(locale)\n    onCancel()\n  }\n\n  return (\n    <Dialog open={open} onClose={onCancel} fullWidth maxWidth='xs'>\n      <DialogTitle>{t(m['dialog-enter-language'])}</DialogTitle>\n      <DialogContent>\n        <FormControl>\n          <Select\n            id='dialog-change-language'\n            value={lang}\n            onChange={event => setLang(event.target.value)}\n          >\n            {Object.keys(languages).map(code => (\n              <MenuItem key={code} value={code}>\n                {languages[code]} ({code})\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button color='default' onClick={closeHandler}>\n          {t(m['button-cancel'])}\n        </Button>\n        <Button color='primary' onClick={submitHandler}>\n          {t(m['button-submit'])}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default ChangeLanguage\n","import React from 'react'\nimport { remote } from 'electron'\nimport styled from 'styled-components'\n\nconst TitleBarArea = styled.div`\n  position: relative;\n  height: 22px;\n`\n\n// Create a space for MacOS title bar buttons on a frameless Window\nconst TitleBarShim = () => {\n  const win = remote.getCurrentWindow()\n  const titleBarSize = win.getSize()[1] - win.getContentSize()[1]\n  if (titleBarSize > 0) return null\n  return <TitleBarArea />\n}\n\nexport default TitleBarShim\n","// @flow\n\n/**\n * These values are used to choose the field type displayed for editing the\n * value, and are used for validation, e.g. a `uuid` field should be unique\n * across the dataset.\n */\nexport const STRING: 'string' = 'string'\nexport const BOOLEAN: 'boolean' = 'boolean'\nexport const NUMBER: 'number' = 'number'\nexport const DATE: 'date' = 'date'\nexport const DATETIME: 'datetime' = 'datetime'\nexport const URL: 'url' = 'url'\nexport const IMAGE_URL: 'image' = 'image'\nexport const VIDEO_URL: 'video' = 'video'\nexport const AUDIO_URL: 'audio' = 'audio'\nexport const ARRAY: 'array' = 'array'\nexport const LOCATION: 'location' = 'location'\nexport const UNDEFINED: 'undefined' = 'undefined'\nexport const NULL: 'null' = 'null'\n","// @flow\nimport isodate from '@segment/isodate'\nimport sexagesimal from '@mapbox/sexagesimal'\nimport url from 'url'\nimport mime from 'mime/lite'\n\nimport * as valueTypes from '../../constants/value_types'\nimport type { Primitive } from '../../types'\n\n// Match dates of the form 1999-12-31\nconst shortDateRegExp = /^(\\d{4})-(\\d{2})-(\\d{2})$/\n\nconst TYPES = {\n  boolean: valueTypes.BOOLEAN,\n  number: valueTypes.NUMBER,\n  undefined: valueTypes.UNDEFINED\n}\n\n/**\n * Guess the type of a value:\n * - primitive types (excluding Symbol)\n * - dates\n * - urls (guessing contentType from extension)\n */\nexport function guessValueType (\n  value: Primitive | Array<Primitive>\n): $Values<typeof valueTypes> {\n  if (Array.isArray(value)) return valueTypes.ARRAY\n  if (value === null) return valueTypes.NULL\n  if (typeof value !== 'string') return TYPES[typeof value]\n\n  if (isUrl(value)) {\n    // eslint-disable-next-line node/no-deprecated-api\n    const parsedUrl = url.parse(value)\n    if (!parsedUrl.pathname) return valueTypes.URL\n    const mimeType = mime.getType(parsedUrl.pathname)\n    if (!mimeType) return valueTypes.URL\n    if (mimeType.split('/')[0] === 'image') return valueTypes.IMAGE_URL\n    if (mimeType.split('/')[0] === 'video') return valueTypes.VIDEO_URL\n    if (mimeType.split('/')[0] === 'audio') return valueTypes.AUDIO_URL\n    return valueTypes.URL\n  }\n\n  // Test date last because this is the most expensive\n  if (isShortDate(value)) return valueTypes.DATE\n  if (isodate.is(value)) return valueTypes.DATETIME\n\n  return valueTypes.STRING\n}\n\ntype NonNullishPrimitive = number | boolean | string\ntype Value = NonNullishPrimitive | Array<Primitive>\n// This seems rather complicated, but all these declares tell Flow that the\n// returned type of the function depends on the `type` argument passed to the\n// coerceValue function\n/* eslint-disable no-redeclare */\ndeclare function coerceValue(\n  value: null,\n  type: $Values<typeof valueTypes>\n): null\ndeclare function coerceValue(\n  value: void,\n  type: $Values<typeof valueTypes>\n): void\ndeclare function coerceValue(value: Value, type: typeof valueTypes.NULL): null\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.UNDEFINED\n): void\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.LOCATION\n): [number, number]\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.ARRAY\n): Array<Primitive>\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.BOOLEAN\n): boolean\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.NUMBER\n): number\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.STRING\n): string\ndeclare function coerceValue(\n  value: Value,\n  type: typeof valueTypes.DATE | typeof valueTypes.DATETIME\n): Date\ndeclare function coerceValue(\n  value: Value,\n  type:\n    | typeof valueTypes.IMAGE_URL\n    | typeof valueTypes.URL\n    | typeof valueTypes.VIDEO_URL\n    | typeof valueTypes.AUDIO_URL\n): string\n/* eslint-enable no-redeclare */\n\n/**\n * Attempts to coerce a value to `type`, throws if it can't coerce\n */\n// eslint-disable-next-line no-redeclare\nexport function coerceValue (value, type) {\n  if (value === undefined || value === null) return value\n  switch (type) {\n    case valueTypes.UNDEFINED:\n      return\n    case valueTypes.NULL:\n      return null\n    case valueTypes.LOCATION: {\n      const parsedLocation = parseLocation(value)\n      if (parsedLocation) return parsedLocation\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n    }\n    case valueTypes.ARRAY:\n      if (Array.isArray(value)) return value\n      // If string assume either comma-separated or space-separated - choose the\n      // one that results in the largest number of values\n      if (typeof value === 'string') {\n        const spaceSplit = value.split(' ')\n        const commaSplit = value.split(',')\n        return commaSplit.length >= spaceSplit.length ? commaSplit : spaceSplit\n      }\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n    case valueTypes.BOOLEAN:\n      if (typeof value === 'boolean') return value\n      if (typeof value === 'number') return !!value\n      if (typeof value === 'string') {\n        const parsedBool = parseBoolean(value)\n        if (parsedBool !== null) return parsedBool\n      }\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n    case valueTypes.NUMBER:\n      if (typeof value === 'number') return value\n      if (typeof value === 'string' && !isNaN(parseFloat(value))) {\n        return parseFloat(value)\n      }\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n    case valueTypes.STRING:\n      if (typeof value === 'string') return value\n      if (typeof value === 'boolean') return value ? 'yes' : 'no'\n      if (typeof value === 'number') return value + ''\n      if (Array.isArray(value))\n        return value.map(v => coerceValue(v, valueTypes.STRING)).join(',')\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n    case valueTypes.DATE: {\n      // returns midday (local timezone) dates\n      if (typeof value === 'number') return new Date(value)\n      if (typeof value !== 'string')\n        throw new Error(\n          'Cannot coerce ' + JSON.stringify(value) + ' to ' + type\n        )\n      // TODO: Needs to construct date from components, otherwise it will be\n      // assumed to be in UTC timezone\n      if (isShortDate(value))\n        return new Date(+new Date(value) + 12 * 60 * 60 * 1000)\n      const parsedDateValue = Date.parse(value)\n      if (isNaN(parsedDateValue))\n        throw new Error(\n          'Cannot coerce ' + JSON.stringify(value) + ' to ' + type\n        )\n      const date = new Date(parsedDateValue)\n      return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12)\n    }\n    case valueTypes.DATETIME: {\n      if (typeof value === 'number') return new Date(value)\n      if (typeof value !== 'string')\n        throw new Error(\n          'Cannot coerce ' + JSON.stringify(value) + ' to ' + type\n        )\n      const parsedDateValue = Date.parse(value)\n      if (isNaN(parsedDateValue))\n        throw new Error(\n          'Cannot coerce ' + JSON.stringify(value) + ' to ' + type\n        )\n      return new Date(parsedDateValue)\n    }\n    case valueTypes.IMAGE_URL:\n    case valueTypes.URL:\n    case valueTypes.VIDEO_URL:\n    case valueTypes.AUDIO_URL:\n      if (typeof value === 'string' && isUrl(value)) return value\n      throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n  }\n  throw new Error('Cannot coerce ' + JSON.stringify(value) + ' to ' + type)\n}\n\nconst TRUE_STRINGS = ['yes', 'true', '1']\nconst FALSE_STRINGS = ['no', 'false', '0']\n\nfunction parseBoolean (value: string) {\n  const v = value.toLowerCase().trim()\n  if (TRUE_STRINGS.indexOf(v) > -1) return true\n  if (FALSE_STRINGS.indexOf(v) > -1) return false\n  return null\n}\n\n/**\n * Parses location from one of:\n * - a string location record from an ODK form\n * - a sexagesimal pair e.g. `66N 32W`\n * - an array [lon, lat] of either numbers or strings which can be coerced to numbers\n */\nfunction parseLocation (value: any): [number, number] | null {\n  if (typeof value === 'string') {\n    var parsed = sexagesimal.pair(value)\n    if (parsed) return [parsed[1], parsed[0]]\n    const parts = value.split(' ')\n    // ODK location is a string like `-77.23 2.24 10 200` (lon, lat, accuracy, altitude)\n    if (parts.length !== 4) return null\n    if (parts.every(isFloat) && withinBounds(+parts[0], +parts[1])) {\n      return parts.map(parseFloat).slice(0, 2)\n    }\n  } else if (\n    Array.isArray(value) &&\n    value.length === 2 &&\n    value.every(isFloat) &&\n    withinBounds(+value[0], +value[1])\n  ) {\n    return value.map(parseFloat).slice(0, 2)\n  }\n  return null\n}\n\n// Stricter parsing function, from\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseFloat\nfunction isFloat (value: string | number) {\n  if (typeof value === 'number') return true\n  return /^(-|\\+)?([0-9]+(\\.[0-9]+)?|Infinity)$/.test(value)\n}\n\nfunction isShortDate (value: string) {\n  return shortDateRegExp.test(value)\n}\n\n// Check whether a location is within bounds\nfunction withinBounds (lon: number, lat: number) {\n  return lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180\n}\n\nfunction isUrl (url: string): boolean {\n  return url.startsWith('https://') || url.startsWith('http://')\n}\n","// @flow\nimport { isObj } from './helpers'\n\nfunction isArrayOfPrimitives (value: any): boolean {\n  return Array.isArray(value) && value.length && !value.some(isObj)\n}\n\ntype Primitive = string | boolean | null | void | number\n\n/**\n * Similar to Object.entries, but flattens an object and keys are arrays. Arrays\n * of primitives are *not* flattened.\n *\n * @example\n * flatObjectEntries({\n *   foo: { bar: 'qux' },\n *   hello: 'world',\n *   arr: ['biz', 'baz'],\n *   other: [{ foo: 'bar'}]\n * })\n * // [\n * //   [['foo', 'bar'], 'qux'],\n * //   [['hello'], 'world'],\n * //   [['arr'], ['biz', 'baz']],\n * //   [['other', 0, 'foo'], 'bar']\n * // ]\n */\nexport function flatObjectEntries (object: {}): Array<\n  [Array<string | number>, Primitive | Primitive[]]\n> {\n  var entries = []\n\n  ;(function step (\n    object: any,\n    prev: Array<string | number> = [],\n    currentDepth: number = 1\n  ) {\n    const keys = Array.isArray(object)\n      ? object.map((_, i) => i)\n      : Object.keys(object)\n    for (const key of keys) {\n      const value = object[key]\n      const newKey = prev.concat([key])\n\n      if (isObj(value) && !isArrayOfPrimitives(value)) {\n        step(value, newKey, currentDepth + 1)\n      } else {\n        entries.push([newKey, value])\n      }\n    }\n  })(object)\n\n  return entries\n}\n","import { set as originalSet } from 'object-path-immutable'\n\nimport { isObj } from './helpers'\n\nexport function get (object, path, defaultValue) {\n  if (typeof path === 'string') path = [path]\n  if (!Array.isArray(path)) return object\n  if (!isObj(object) || path.length === 0) {\n    return defaultValue === undefined && path.length === 0\n      ? object\n      : defaultValue\n  }\n\n  if (!Object.prototype.propertyIsEnumerable.call(object, path[0])) {\n    return defaultValue\n  }\n\n  return get(object[path[0]], path.slice(1), defaultValue)\n}\n\nexport const set = originalSet\n","// @flow\nimport cloneDeep from 'clone-deep'\n\nimport { flatObjectEntries } from '../../utils/flat_object_entries'\nimport { guessValueType } from './value_types'\nimport * as valueTypes from '../../constants/value_types'\nimport { leftPad } from '../../utils/helpers'\n\nimport type {\n  JSONObject,\n  Statistics,\n  FieldStatistic,\n  StringStatistic,\n  NumberStatistic,\n  DateStatistic\n} from '../../types'\n\nfunction defaultStats (): FieldStatistic {\n  return {\n    [valueTypes.STRING]: {\n      count: 0,\n      values: new Map()\n    },\n    [valueTypes.NUMBER]: {\n      count: 0,\n      values: new Map()\n    },\n    [valueTypes.DATE]: {\n      count: 0,\n      values: new Map()\n    },\n    [valueTypes.DATETIME]: {\n      count: 0,\n      values: new Map()\n    },\n    [valueTypes.BOOLEAN]: {\n      count: 0,\n      values: new Map([\n        [true, 0],\n        [false, 0]\n      ])\n    },\n    [valueTypes.URL]: 0,\n    [valueTypes.IMAGE_URL]: 0,\n    [valueTypes.AUDIO_URL]: 0,\n    [valueTypes.VIDEO_URL]: 0,\n    [valueTypes.NULL]: 0,\n    [valueTypes.UNDEFINED]: 0,\n    [valueTypes.LOCATION]: 0\n  }\n}\n\nexport default function createMemoizedStats () {\n  let stats: Statistics = {}\n  let dataMemo = []\n\n  return function getStats (data: Array<JSONObject>): Statistics {\n    if (data === dataMemo) return stats\n    const { added, removed } = diffArrays(dataMemo, data)\n    if (!added.length && !removed.length) return cloneDeep(stats)\n    if (removed.length) {\n      // Anything removed, calculate all the stats\n      // TODO: more efficient stats on removal\n      stats = {}\n      data.forEach(item => addItemStats(item, stats))\n    } else {\n      // Only added items -> only need to process new items\n      added.forEach(item => addItemStats(item, stats))\n    }\n    dataMemo = data\n    return cloneDeep(stats)\n  }\n}\n\nfunction addItemStats (item: JSONObject = {}, stats: Statistics) {\n  flatObjectEntries(item).forEach(function ([path, value]) {\n    const key = JSON.stringify(path)\n    if (!stats[key]) stats[key] = defaultStats()\n    addFieldStats(value, stats[key])\n  })\n}\n\nfunction addFieldStats (value: any, fieldStats: FieldStatistic) {\n  const type = guessValueType(value)\n  if (typeof fieldStats[type] === 'number') {\n    fieldStats[type] += 1\n    return\n  }\n  switch (type) {\n    case valueTypes.ARRAY: {\n      let arrayStats = fieldStats[valueTypes.ARRAY]\n      if (arrayStats === undefined) {\n        arrayStats = fieldStats[valueTypes.ARRAY] = {\n          count: 0,\n          lengthMin: +Infinity,\n          lengthMax: -Infinity,\n          valueStats: defaultStats()\n        }\n      }\n      addArrayStats(value, arrayStats)\n      return\n    }\n    case valueTypes.STRING:\n      addStringStats(value, fieldStats[valueTypes.STRING])\n      return\n    case valueTypes.NUMBER:\n      addNumberStats(value, fieldStats[valueTypes.NUMBER])\n      return\n    case valueTypes.DATE:\n      addDateStats(value, fieldStats[valueTypes.DATE])\n      return\n    case valueTypes.DATETIME:\n      addDateTimeStats(value, fieldStats[valueTypes.DATETIME])\n      return\n    case valueTypes.BOOLEAN:\n      fieldStats[valueTypes.BOOLEAN].count += 1\n      fieldStats[valueTypes.BOOLEAN].values.set(\n        value,\n        fieldStats[valueTypes.BOOLEAN].values.get(value) + 1\n      )\n      return\n    default:\n      // $FlowFixMe - flow doesn't realise that type is not values above\n      fieldStats[type].count += 1\n  }\n}\n\nfunction addArrayStats (\n  value: [],\n  stats: $NonMaybeType<$ElementType<FieldStatistic, 'array'>>\n) {\n  if (value.length > stats.lengthMax) stats.lengthMax = value.length\n  if (value.length < stats.lengthMin) stats.lengthMin = value.length\n  stats.count += 1\n  value.forEach(function (item) {\n    addFieldStats(item, stats.valueStats)\n  })\n}\n\nfunction addNumberStats (value: number, stats: NumberStatistic) {\n  stats.count += 1\n  const { min, max, variance, mean } = statReduce(stats, value, stats.count - 1)\n  stats.min = min\n  stats.max = max\n  stats.variance = variance\n  stats.mean = mean\n  if (stats.values.has(value))\n    stats.values.set(value, stats.values.get(value) + 1)\n  else stats.values.set(value, 1)\n}\n\nfunction addDateTimeStats (value: string, stats: DateStatistic) {\n  const dateAsNumber = +Date.parse(value)\n  stats.count += 1\n  const { mean } = statReduce(\n    {\n      mean: stats.mean !== undefined ? +Date.parse(stats.mean) : undefined\n    },\n    dateAsNumber,\n    stats.count - 1\n  )\n  stats.min =\n    stats.min === undefined ? value : value < stats.min ? value : stats.min\n  stats.max =\n    stats.max === undefined ? value : value > stats.max ? value : stats.max\n  stats.mean = mean !== undefined ? new Date(mean).toISOString() : undefined\n  if (stats.values.has(value))\n    stats.values.set(value, stats.values.get(value) + 1)\n  else stats.values.set(value, 1)\n}\n\n/** This requires slightly special treatment because date does not include time */\nfunction addDateStats (value: string, stats: DateStatistic) {\n  const dateAsNumber = dateToNumber(value)\n  stats.count += 1\n  const { mean } = statReduce(\n    {\n      mean: stats.mean !== undefined ? dateToNumber(stats.mean) : undefined\n    },\n    dateAsNumber,\n    stats.count - 1\n  )\n  stats.min =\n    stats.min === undefined ? value : value < stats.min ? value : stats.min\n  stats.max =\n    stats.max === undefined ? value : value > stats.max ? value : stats.max\n  stats.mean = mean !== undefined ? numberToDate(mean) : undefined\n  if (stats.values.has(value))\n    stats.values.set(value, stats.values.get(value) + 1)\n  else stats.values.set(value, 1)\n}\n\nfunction addStringStats (value: string, stats: StringStatistic) {\n  stats.count += 1\n  const lengthStats = statReduce(\n    {\n      min: stats.lengthMin,\n      max: stats.lengthMax,\n      variance: stats.lengthVariance,\n      mean: stats.lengthMean\n    },\n    value.length,\n    stats.count - 1\n  )\n  const wordStats = statReduce(\n    {\n      min: stats.wordsMin,\n      max: stats.wordsMax,\n      variance: stats.wordsVariance,\n      mean: stats.wordsMean\n    },\n    value.split(' ').length,\n    stats.count - 1\n  )\n  stats.lengthMin = lengthStats.min\n  stats.lengthMax = lengthStats.max\n  stats.lengthVariance = lengthStats.variance\n  stats.lengthMean = lengthStats.mean\n  stats.wordsMin = wordStats.min\n  stats.wordsMax = wordStats.max\n  stats.wordsVariance = wordStats.variance\n  stats.wordsMean = wordStats.mean\n  if (stats.values.has(value))\n    stats.values.set(value, stats.values.get(value) + 1)\n  else stats.values.set(value, 1)\n}\n\n/**\n * Compare two arrays of objects and return items in the second but not in the\n * first (added) and items in the first but not in the second (removed).\n * Compares using strict equality.\n */\nexport function diffArrays (\n  oldArray: Array<Object>,\n  newArray: Array<Object>\n): { added: Array<Object>, removed: Array<Object> } {\n  const added = newArray.filter(v => oldArray.indexOf(v) === -1)\n  const removed = oldArray.filter(v => newArray.indexOf(v) === -1)\n  return { added, removed }\n}\n\ntype MathStat = {\n  mean?: number,\n  variance?: number,\n  min?: number,\n  max?: number\n}\n\n/**\n * Reducer that computes running mean, variance, min and max\n * Adapted from http://www.johndcook.com/blog/standard_deviation/\n * @param {Object} p The previous value for the analysis\n * @param {Number} x New value to be included in analysis\n * @param {Number} i zero-based index of the current element being processed\n * @return {Object} New analysis including `x`\n */\nexport function statReduce (\n  { mean = NaN, variance = NaN, min = +Infinity, max = -Infinity }: MathStat,\n  x: number,\n  i: number\n): $ObjMap<MathStat, <V>(V) => $NonMaybeType<V>> {\n  mean = isNaN(mean) ? 0 : mean\n  x = x instanceof Date ? +x : x\n  const newMean = mean + (x - mean) / (i + 1)\n  return {\n    mean: newMean,\n    min: x < min ? x : min,\n    max: x > max ? x : max,\n    variance: i < 1 ? 0 : (variance * i + (x - mean) * (x - newMean)) / (i + 1)\n  }\n}\n\n/** Convert date in the format YYYY-MM-DD to a number */\nfunction dateToNumber (value: string): number {\n  const [year, month, day] = value.split('-').map(Number)\n  // Add 12 hours -> middle of day\n  return new Date(year, month - 1, day).getTime() + 12 * 60 * 60 * 1000\n}\n\nfunction numberToDate (value: number): string {\n  const date = new Date(value)\n  const YYYY = date.getFullYear()\n  const MM = leftPad(date.getMonth() + 1 + '', 2, '0')\n  const DD = leftPad(date.getDate() + '', 2, '0')\n  return `${YYYY}-${MM}-${DD}`\n}\n","// @flow\nimport * as valueTypes from '../../constants/value_types'\nimport { guessValueType } from './value_types'\nimport { flatObjectEntries } from '../../utils/flat_object_entries'\nimport { get } from '../../utils/get_set'\n\nimport type {\n  JSONObject,\n  FieldStatistic,\n  Statistics,\n  MediaArray,\n  Field,\n  TextField,\n  LinkField,\n  NumberField,\n  DateField,\n  DateTimeField,\n  SelectOptions,\n  SelectOneField,\n  SelectMultipleField\n} from '../../types'\n\nexport { default as createMemoizedStats } from './statistics'\n\nconst mediaTypes = [\n  valueTypes.VIDEO_URL,\n  valueTypes.AUDIO_URL,\n  valueTypes.IMAGE_URL\n]\n\nfunction compareKeys (a, b) {\n  return JSON.stringify(a[0]).localeCompare(JSON.stringify(b[0]))\n}\n\n/**\n * Takes a JSON object and optional array of JSON objects and returns an array\n * of field definitions. The field definitions are guessed from the arguments\n * passed. The returned field definitions can be used to render fields for\n * editing the properties of the object.\n */\nexport function getFields (\n  cur?: JSONObject = {},\n  stats?: Statistics\n): Array<Field> {\n  const entries = stats ? flatStatsEntries(stats) : flatObjectEntries(cur)\n  return entries.sort(compareKeys).reduce((acc, [keyArray]) => {\n    const key = JSON.stringify(keyArray)\n    const value = get(cur, keyArray)\n    const fieldStats = stats && stats[key]\n    const field = getField(keyArray, value, fieldStats)\n    if (field) acc.push(field)\n    return acc\n  }, [])\n}\n\nexport function getMedia (cur: JSONObject = {}): MediaArray {\n  return flatObjectEntries(cur).reduce((acc, [keyArray, value]) => {\n    const type = guessValueType(value)\n    if (mediaTypes.includes(type)) {\n      // $FlowFixMe flow does not understand type is only media type here\n      acc.push({ src: value, type })\n    }\n    return acc\n  }, [])\n}\n\nexport function getField (\n  keyArray: Array<string | number>,\n  value: any,\n  fieldStats?: FieldStatistic\n): Field {\n  const valueType = guessValueType(value)\n  // Initial implementation does not try to guess from statistics\n  switch (valueType) {\n    case valueTypes.BOOLEAN:\n      return createSelectOneField(keyArray, [true, false])\n    case valueTypes.STRING: {\n      const options = getOptions(fieldStats)\n      if (options.length) return createSelectOneField(keyArray, options)\n      else return createTextField(keyArray)\n    }\n    case valueTypes.NUMBER:\n      return createNumberField(keyArray)\n    case valueTypes.ARRAY: {\n      const options = getOptions(fieldStats)\n      return createSelectMultipleField(\n        keyArray,\n        options.length ? options : value,\n        { readonly: true }\n      )\n    }\n    case valueTypes.DATE:\n      return createDateField(keyArray, {\n        min: fieldStats && fieldStats.date.min,\n        max: fieldStats && fieldStats.date.max\n      })\n    case valueTypes.DATETIME:\n      return createDateTimeField(keyArray, {\n        min: fieldStats && fieldStats.date.min,\n        max: fieldStats && fieldStats.date.max\n      })\n    case valueTypes.URL:\n    case valueTypes.IMAGE_URL:\n    case valueTypes.AUDIO_URL:\n    case valueTypes.VIDEO_URL:\n      return createLinkField(keyArray)\n    default:\n      return createTextField(keyArray, { readonly: true })\n  }\n}\n\n// Don't include long strings in the options that can be selected\nconst MAX_OPTION_LENGTH = 30\n\nfunction getOptions (fieldStats?: FieldStatistic): SelectOptions {\n  const options = []\n  if (!fieldStats) return options\n\n  for (const value of fieldStats.string.values.keys()) {\n    if (value.length > MAX_OPTION_LENGTH) continue\n    options.push(value)\n  }\n\n  return options\n}\n\nfunction createTextField (\n  keyArray: Array<string | number>,\n  {\n    readonly = false,\n    appearance = 'single',\n    snakeCase = false\n  }: {\n    readonly?: boolean,\n    appearance?: 'single' | 'multiline',\n    snakeCase?: boolean\n  } = {}\n): TextField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    appearance: appearance,\n    type: 'text'\n  }\n}\n\nfunction createLinkField (keyArray: Array<string | number>): LinkField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: true,\n    type: 'link'\n  }\n}\n\nfunction createNumberField (\n  keyArray: Array<string | number>,\n  { readonly = false }: { readonly?: boolean } = {}\n): NumberField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    type: 'number'\n  }\n}\n\nfunction createSelectOneField (\n  keyArray: Array<string | number>,\n  options: SelectOptions,\n  {\n    readonly = false,\n    snakeCase = false\n  }: { readonly?: boolean, snakeCase?: boolean } = {}\n): SelectOneField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    type: 'select_one',\n    options: options\n  }\n}\n\nfunction createSelectMultipleField (\n  keyArray: Array<string | number>,\n  options: SelectOptions,\n  {\n    readonly = false,\n    snakeCase = false\n  }: { readonly?: boolean, snakeCase?: boolean } = {}\n): SelectMultipleField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    type: 'select_multiple',\n    options: options\n  }\n}\n\nfunction createDateField (\n  keyArray: Array<string | number>,\n  {\n    readonly = false,\n    min,\n    max\n  }: {\n    readonly?: boolean,\n    snakeCase?: boolean,\n    min?: string,\n    max?: string\n  } = {}\n): DateField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    type: 'date',\n    min_value: min,\n    max_value: max\n  }\n}\n\nfunction createDateTimeField (\n  keyArray: Array<string | number>,\n  {\n    readonly = false,\n    min,\n    max\n  }: {\n    readonly?: boolean,\n    snakeCase?: boolean,\n    min?: string,\n    max?: string\n  } = {}\n): DateTimeField {\n  return {\n    id: JSON.stringify([...arguments]),\n    key: keyArray,\n    readonly: readonly,\n    type: 'datetime',\n    min_value: min,\n    max_value: max\n  }\n}\n\nfunction flatStatsEntries (\n  stats: Statistics\n): Array<[Array<string | number>, FieldStatistic]> {\n  // $FlowFixMe\n  return Object.entries(stats).map(([key, value]) => [JSON.parse(key), value])\n}\n","// @flow\nimport mime from 'mime/lite'\nimport type { Observation } from 'mapeo-schema'\n\nimport { getFields as getFieldsFromTags } from '../lib/data_analysis'\nimport type {\n  PresetWithAdditionalFields,\n  Attachment,\n  Statistics\n} from '../types'\n\nexport function isObj (value: any): boolean {\n  const type = typeof value\n  return value !== null && (type === 'object' || type === 'function')\n}\n\nexport function isImageAttachment (attachment: Attachment): boolean {\n  const mimeType = attachment.type || mime.getType(attachment.id)\n  return mimeType ? mimeType.split('/')[0] === 'image' : false\n}\n\nexport function getLastImage (observation: Observation): Attachment | void {\n  const imageAttachments = (observation.attachments || []).filter(\n    isImageAttachment\n  )\n  if (!imageAttachments) return\n  return imageAttachments[imageAttachments.length - 1]\n}\n\nconst hiddenTags = {\n  categoryId: true,\n  notes: true,\n  note: true\n}\n\nexport function defaultGetPreset (\n  observation: Observation,\n  stats?: Statistics\n): PresetWithAdditionalFields {\n  return {\n    id: observation.id,\n    geometry: ['point'],\n    name: (observation.tags && observation.tags.name) || '',\n    tags: {},\n    fields: [],\n    additionalFields: getFieldsFromTags(observation.tags, stats).filter(\n      field => {\n        // Hacky - change. Hide categoryId and notes fields.\n        const fieldKey = Array.isArray(field.key) ? field.key[0] : field.key\n        if (hiddenTags[fieldKey]) return false\n        return true\n      }\n    )\n  }\n}\n\nexport function leftPad (str: string, len: number, char: string): string {\n  // doesn't need to pad\n  len = len - str.length\n  if (len <= 0) return str\n\n  var pad = ''\n  while (true) {\n    if (len & 1) pad += char\n    len >>= 1\n    if (len) char += char\n    else break\n  }\n  return pad + str\n}\n\nexport function getDateString (date: Date): string | void {\n  if (!(date instanceof Date)) return\n  const YYYY = date.getFullYear()\n  const MM = leftPad(date.getMonth() + 1 + '', 2, '0')\n  const DD = leftPad(date.getDate() + '', 2, '0')\n  return `${YYYY}-${MM}-${DD}`\n}\n\nconst shortDateRegExp = /^(\\d{4})-(\\d{2})-(\\d{2})$/\n\n/**\n * This is necessary because Date.parse() of a string of the form 'YYYY-MM-DD'\n * will assume the timezone is UTC, so in different timezones the returned date\n * will not be what is expected.\n */\nexport function parseDateString (str: string): Date | void {\n  if (!str) return\n  const match = str.match(shortDateRegExp)\n  if (!match) {\n    const date = Date.parse(str)\n    return Number.isNaN(date) ? undefined : new Date(date)\n  }\n  return new Date(+match[1], +match[2] - 1, +match[3])\n}\n","// @flow\nimport React, { useMemo, useCallback, useContext, useRef } from 'react'\nimport { Layer, Source, MapContext } from 'react-mapbox-gl'\nimport type { Observation } from 'mapeo-schema'\nimport type {\n  Point2D,\n  FeatureTemplate,\n  FeatureCollectionTemplate\n} from 'flow-geojson'\n\ntype Props = {\n  observations: Array<Observation>,\n  onMouseMove: any => any,\n  onMouseLeave: any => any,\n  onClick?: (id: string) => any,\n  print?: boolean\n}\n\ntype FeaturePoint2D = FeatureTemplate<Point2D>\ntype FeatureCollectionPoint2D = FeatureCollectionTemplate<FeaturePoint2D[]>\ntype GeoJsonSource = {\n  type: 'geojson',\n  data: FeatureCollectionPoint2D\n}\n\nconst observationSourceId = 'mapeo-observations-internal'\n\n// const labelStyleLayer = {\n//   id: 'labels',\n//   type: 'symbol',\n//   source: 'features',\n//   layout: {\n//     'text-field': '',\n//     'text-allow-overlap': true,\n//     'text-ignore-placement': true,\n//     'text-size': 9,\n//     'text-font': ['DIN Offc Pro Bold', 'Arial Unicode MS Bold']\n//   },\n//   paint: {\n//     'text-color': '#fff',\n//     'text-halo-color': 'rgba(100,100,100, 0.3)',\n//     'text-halo-width': 0.3\n//   }\n// }\n\nconst pointStyleLayer = {\n  id: 'points',\n  type: 'circle',\n  sourceId: observationSourceId,\n  paint: {\n    // make circles larger as the user zooms from z12 to z22\n    'circle-radius': {\n      base: 1.5,\n      stops: [\n        [7, 5],\n        [18, 25]\n      ]\n    },\n    'circle-color': '#ff0000',\n    'circle-opacity': 0.75,\n    'circle-stroke-width': 1.5,\n    'circle-stroke-color': '#ffffff',\n    'circle-stroke-opacity': 0.9\n  }\n}\n\nconst pointHoverStyleLayer = {\n  id: 'points-hover',\n  type: 'circle',\n  sourceId: observationSourceId,\n  paint: {\n    ...pointStyleLayer.paint,\n    'circle-opacity': [\n      'case',\n      ['boolean', ['feature-state', 'hover'], false],\n      1,\n      0\n    ],\n    'circle-stroke-width': 2.5,\n    'circle-stroke-color': '#ffffff',\n    'circle-stroke-opacity': [\n      'case',\n      ['boolean', ['feature-state', 'hover'], false],\n      1,\n      0\n    ]\n  }\n}\n\nfunction observationsToGeoJsonSource (\n  observations: Observation[]\n): GeoJsonSource {\n  return {\n    type: 'geojson',\n    data: {\n      type: 'FeatureCollection',\n      features: observations.reduce((acc, obs, i) => {\n        // Skip if null or undefined\n        if (obs.lat == null || obs.lon == null) return acc\n        const point: FeaturePoint2D = {\n          id: i,\n          type: 'Feature',\n          geometry: {\n            type: 'Point',\n            coordinates: [obs.lon, obs.lat]\n          },\n          properties: {\n            id: obs.id\n          }\n        }\n        acc.push(point)\n        return acc\n      }, [])\n    }\n  }\n}\n\nconst noop = () => {}\n\nconst ObservationLayer = ({\n  observations,\n  onClick = noop,\n  onMouseLeave,\n  onMouseMove,\n  print = false\n}: Props) => {\n  const hovered = useRef(null)\n  const map = useContext(MapContext)\n\n  const geoJsonSource = useMemo(\n    () => observationsToGeoJsonSource(observations),\n    [observations]\n  )\n\n  const handleMouseMove = useCallback(\n    e => {\n      if (print) return\n      map.getCanvas().style.cursor = e.features.length ? 'pointer' : ''\n      if (e.features.length === 0) return\n      if (hovered.current) {\n        map.setFeatureState(\n          { source: observationSourceId, id: hovered.current },\n          { hover: false }\n        )\n      }\n      hovered.current = e.features[0].id\n      map.setFeatureState(\n        { source: observationSourceId, id: hovered.current },\n        { hover: true }\n      )\n      onMouseMove(e)\n    },\n    [map, onMouseMove, print]\n  )\n\n  const handleMouseLeave = useCallback(\n    e => {\n      if (print) return\n      if (hovered.current) {\n        map.setFeatureState(\n          { source: observationSourceId, id: hovered.current },\n          { hover: false }\n        )\n      }\n      hovered.current = null\n      map.getCanvas().style.cursor = ''\n      onMouseLeave(e)\n    },\n    [map, onMouseLeave, print]\n  )\n\n  const handleClick = useCallback(\n    e => {\n      if (print) return\n      if (e.features.length === 0) return\n      onClick(e.features[0].properties.id)\n    },\n    [onClick, print]\n  )\n\n  return (\n    <>\n      <Source id={observationSourceId} geoJsonSource={geoJsonSource} />\n      <Layer\n        {...pointStyleLayer}\n        onClick={handleClick}\n        onMouseMove={handleMouseMove}\n        onMouseLeave={handleMouseLeave}\n      />\n      <Layer {...pointHoverStyleLayer} />\n    </>\n  )\n}\n\nexport default ObservationLayer\n","// @flow\nimport React from 'react'\nimport Img from 'react-image'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport BrokenImageIcon from '@material-ui/icons/BrokenImage'\nimport { makeStyles } from '@material-ui/core/styles'\n// import * as CSS from 'csstype'\n\nconst useStyles = makeStyles({\n  wrapper: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    top: 0,\n    position: 'relative',\n    backgroundSize: 'contain',\n    backgroundPosition: 'center',\n    backgroundRepeat: 'no-repeat'\n  }\n})\n\nconst ImageLoader = ({ classes, style }) => (\n  <div className={classes.wrapper} style={{ ...style, color: 'white' }}>\n    <CircularProgress color='inherit' />\n  </div>\n)\n\nconst BrokenImage = ({ classes, style }) => (\n  <div className={classes.wrapper} style={{ ...style, color: 'white' }}>\n    <BrokenImageIcon color='inherit' />\n  </div>\n)\n\ntype Props = {\n  style?: { [prop: string]: string | number },\n  src: string,\n  className?: string\n}\n\nconst Image = ({ style, src, className }: Props) => {\n  const classes = useStyles()\n  return (\n    <Img\n      src={src}\n      style={{ objectFit: 'contain', display: 'block', ...style }}\n      className={className}\n      loader={<ImageLoader style={style} classes={classes} />}\n      unloader={<BrokenImage style={style} classes={classes} />}\n    />\n  )\n}\n\nexport default Image\n","// @flow\nimport React, {\n  useContext,\n  useCallback,\n  useLayoutEffect,\n  useState,\n  useRef\n} from 'react'\nimport { MapContext } from 'react-mapbox-gl'\nimport Typography from '@material-ui/core/Typography'\nimport clsx from 'clsx'\n\nimport Image from '../internal/Image'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles({\n  wrapper: {\n    width: 200,\n    padding: 0,\n    backgroundColor: 'black',\n    cursor: 'pointer',\n    position: 'absolute',\n    willChange: 'transform',\n    top: 0,\n    left: 0,\n    pointerEvents: 'none'\n  },\n  wrapperImage: {\n    height: 200\n  },\n  image: {\n    width: 200,\n    height: 200,\n    objectFit: 'cover',\n    display: 'block',\n    background: '#000000'\n  },\n  titleBox: {\n    position: 'absolute',\n    bottom: 0,\n    width: '100%',\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    color: 'white',\n    padding: '0.25em 0.5em',\n    boxSizing: 'border-box'\n  },\n  title: {\n    color: 'white'\n  },\n  subheading: {\n    color: 'white'\n  }\n})\n\ntype Props = {\n  coordinates: [number, number],\n  imageUrl?: string,\n  title: string,\n  subtitle: string\n}\n\nconst Popup = ({ imageUrl, title, subtitle, coordinates }: Props) => {\n  const map = useContext(MapContext)\n  const ref = useRef(null)\n  const classes = useStyles()\n\n  const getPopupTransform = useCallback(() => {\n    if (!ref.current) return\n    const width = ref.current.offsetWidth\n    const height = ref.current.offsetHeight\n    const pos = map.project(coordinates).round()\n    let anchor\n\n    if (pos.y < height) {\n      anchor = 'top'\n    } else {\n      anchor = 'bottom'\n    }\n\n    if (pos.x > map.transform.width - width) {\n      anchor += '-right'\n    } else {\n      anchor += '-left'\n    }\n\n    const anchorTranslate = {\n      'top-left': 'translate(0,0)',\n      'top-right': 'translate(-100%,0)',\n      'bottom-left': 'translate(0,-100%)',\n      'bottom-right': 'translate(-100%,-100%)'\n    }\n\n    return `${anchorTranslate[anchor]} translate(${pos.x}px,${pos.y}px)`\n  }, [coordinates, map])\n\n  const [transform, setTransform] = useState(getPopupTransform())\n\n  const update = useCallback(() => setTransform(getPopupTransform()), [\n    getPopupTransform\n  ])\n\n  useLayoutEffect(() => {\n    map.on('move', update)\n    update()\n    return () => map.off('move', update)\n  }, [map, update])\n\n  return (\n    <div\n      className={clsx(classes.wrapper, { [classes.wrapperImage]: imageUrl })}\n      style={{ transform }}\n      ref={ref}\n    >\n      {imageUrl && <Image src={imageUrl} className={classes.image} />}\n      <div className={classes.titleBox}>\n        {title && (\n          <Typography variant='h6' className={classes.title}>\n            {title}\n          </Typography>\n        )}\n        {subtitle && (\n          <Typography variant='caption' className={classes.subheading}>\n            {subtitle}\n          </Typography>\n        )}\n      </div>\n    </div>\n  )\n}\n\nPopup.imageSize = 200\n\nexport default Popup\n","// @flow\nimport React, {\n  useState,\n  useMemo,\n  useCallback,\n  useRef,\n  useEffect,\n  useImperativeHandle\n} from 'react'\nimport { useIntl } from 'react-intl'\nimport ReactMapboxGl from 'react-mapbox-gl'\nimport mapboxgl from 'mapbox-gl'\nimport type { Observation } from 'mapeo-schema'\n\nimport { getLastImage } from '../utils/helpers'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ObservationLayer from './ObservationLayer'\nimport Popup from './Popup'\nimport type { CameraOptions, CommonViewContentProps } from '../types'\n\nexport type MapViewContentProps = {\n  /** Called with\n   * [CameraOptions](https://docs.mapbox.com/mapbox-gl-js/api/#cameraoptions)\n   * with properties `center`, `zoom`, `bearing`, `pitch` */\n  onMapMove?: CameraOptions => any,\n  /** Initial position of the map - an object with properties `center`, `zoom`,\n   * `bearing`, `pitch`. If this is not set then the map will by default zoom to\n   * the bounds of the observations. If you are going to unmount and re-mount\n   * this component (e.g. within tabs) then you will want to use onMove to store\n   * the position in state, and pass it as initialPosition for when the map\n   * re-mounts. */\n  initialMapPosition?: $Shape<CameraOptions>,\n  /** Mapbox access token */\n  mapboxAccessToken: string,\n  /** Mapbox style url */\n  mapStyle?: any\n}\n\ntype Props = {\n  ...$Exact<MapViewContentProps>,\n  ...$Exact<CommonViewContentProps>,\n  print?: boolean\n}\n\nexport type MapInstance = {\n  fitBounds: () => any,\n  flyTo: () => any\n}\n\nconst useStyles = makeStyles({\n  container: {\n    flex: 1\n  },\n  '@global': {\n    // The \"Improve Map\" link does not work when Mapeo Desktop is used offline,\n    // and since the data the user is looking at is mainly data that is not in\n    // OpenStreetMap, this link does not make much sense to the user.\n    '.mapbox-improve-map': {\n      display: 'none'\n    }\n  }\n})\n\nconst fitBoundsOptions = {\n  duration: 0,\n  padding: 10\n}\n\nconst noop = () => {}\n\nconst MapViewContent = (\n  {\n    observations,\n    mapboxAccessToken,\n    getPreset,\n    getMedia,\n    onClick,\n    initialMapPosition = {},\n    onMapMove = noop,\n    mapStyle = 'mapbox://styles/mapbox/outdoors-v10',\n    print = false\n  }: Props,\n  ref\n) => {\n  const map = useRef()\n  const classes = useStyles()\n  const intl = useIntl()\n  const [hovered, setHovered] = useState<?Observation>(null)\n  const [styleLoaded, setStyleLoaded] = useState(false)\n\n  useImperativeHandle(ref, () => ({\n    fitBounds: (...args: any) => {\n      if (!map.current) return\n      map.current.fitBounds.apply(map.current, args)\n    },\n    flyTo: (...args: any) => {\n      if (!map.current) return\n      map.current.flyTo.apply(map.current, args)\n    }\n  }))\n\n  // We don't want to change the map viewport if the observations array changes,\n  // which it will do if the filter changes. We only set the bounds for the very\n  // initial render, and only if initialMapPosition zoom and center are not set.\n  const initialBounds = useMemo(\n    () =>\n      initialMapPosition.center == null && initialMapPosition.zoom == null\n        ? getBounds(observations)\n        : undefined,\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  useEffect(() => {\n    if (\n      !map.current ||\n      !observations ||\n      !observations.length ||\n      map.current.__hasMoved ||\n      (initialMapPosition.center != null && initialMapPosition.zoom != null)\n    )\n      return\n    map.current.__hasMoved = true\n    const bounds = getBounds(observations)\n    map.current.flyTo({\n      center: [\n        bounds[0][0] + (bounds[1][0] - bounds[0][0]) / 2,\n        bounds[0][1] + (bounds[1][1] - bounds[0][1]) / 2\n      ],\n      zoom: 9,\n      bearing: 0,\n      pitch: 0\n    })\n  }, [\n    initialMapPosition.center,\n    initialMapPosition.zoom,\n    observations,\n    styleLoaded\n  ])\n\n  // We don't allow the map to be a controlled component - position can only be\n  // set when the map is initially mounted and after that state is internal\n  const position = useMemo(() => {\n    const { center, zoom, bearing, pitch } = initialMapPosition\n    const bounds = getBounds(observations)\n    // initialMapPosition overrides default behaviour of fitting the map to the\n    // bounds of the observations, but if any properties of initialMapPosition are\n    // we set some default values\n    return {\n      center: center || [\n        bounds[0][0] + (bounds[1][0] - bounds[0][0]) / 2,\n        bounds[0][1] + (bounds[1][1] - bounds[0][1]) / 2\n      ],\n      zoom: zoom ? [zoom] : [9],\n      bearing: bearing ? [bearing] : [0],\n      pitch: pitch ? [pitch] : [0]\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const Mapbox = useMemo(\n    () =>\n      ReactMapboxGl({\n        accessToken: mapboxAccessToken,\n        dragRotate: false,\n        pitchWithRotate: false,\n        attributionControl: false,\n        logoPosition: 'bottom-right',\n        scrollZoom: !print,\n        injectCSS: false\n      }),\n    [mapboxAccessToken, print]\n  )\n\n  const handleStyleLoad = useCallback(mapInstance => {\n    mapInstance.addControl(new mapboxgl.NavigationControl({}))\n    mapInstance.addControl(new mapboxgl.ScaleControl({}))\n    mapInstance.addControl(\n      new mapboxgl.AttributionControl({\n        compact: true\n      })\n    )\n    map.current = mapInstance\n    setStyleLoaded(true)\n  }, [])\n\n  const handleMouseMove = useCallback(\n    e => {\n      if (e.features.length === 0) return setHovered(null)\n      const obs = observations.find(\n        obs => obs.id === e.features[0].properties.id\n      )\n      setHovered(obs)\n    },\n    [observations]\n  )\n\n  const handleMouseLeave = useCallback(e => {\n    setHovered(null)\n  }, [])\n\n  const handleMapMove = useCallback(\n    (map, e) => {\n      onMapMove({\n        center: map.getCenter().toArray(),\n        zoom: map.getZoom(),\n        bearing: map.getBearing(),\n        pitch: map.getPitch()\n      })\n    },\n    [onMapMove]\n  )\n\n  function getLastImageUrl (observation: Observation): string | void {\n    const lastImageAttachment = getLastImage(observation)\n    if (!lastImageAttachment) return\n    const media = getMedia(lastImageAttachment, {\n      width: Popup.imageSize,\n      height: Popup.imageSize\n    })\n    if (media) return media.src\n  }\n\n  function getName (observation: Observation): string {\n    const preset = getPreset(observation)\n    return (preset && preset.name) || 'Observation'\n  }\n\n  return (\n    <Mapbox\n      style={mapStyle}\n      className={classes.container}\n      fitBounds={initialBounds}\n      fitBoundsOptions={fitBoundsOptions}\n      onStyleLoad={handleStyleLoad}\n      onMove={handleMapMove}\n      {...position}\n    >\n      <ObservationLayer\n        observations={observations}\n        onClick={onClick}\n        onMouseLeave={handleMouseLeave}\n        onMouseMove={handleMouseMove}\n        print={print}\n      />\n      {hovered && (\n        <Popup\n          imageUrl={getLastImageUrl(hovered)}\n          title={getName(hovered)}\n          subtitle={intl.formatTime(hovered.created_at, {\n            year: 'numeric',\n            month: 'long',\n            day: '2-digit'\n          })}\n          coordinates={\n            // $FlowFixMe - these are always non-nullish when on a map\n            [hovered.lon, hovered.lat]\n          }\n        />\n      )}\n    </Mapbox>\n  )\n}\n\nexport default React.forwardRef<Props, MapInstance>(MapViewContent)\n\nfunction getBounds (\n  observations: Observation[]\n): [[number, number], [number, number]] {\n  const extent = [\n    [-180, -85],\n    [180, 85]\n  ]\n  for (const { lat, lon } of observations) {\n    if (lon == null || lat == null) continue\n    if (extent[0][0] < lon) extent[0][0] = lon\n    if (extent[0][1] < lat) extent[0][1] = lat\n    if (extent[1][0] > lon) extent[1][0] = lon\n    if (extent[1][1] > lat) extent[1][1] = lat\n  }\n  return extent\n}\n","import React from 'react'\nimport { TextField as MuiTextField } from '@material-ui/core'\n\nconst TextField = ({ onChange, ...otherProps }) => {\n  const handleChange = event => onChange && onChange(event.target.value)\n  return (\n    <MuiTextField\n      fullWidth\n      variant='outlined'\n      margin='normal'\n      InputLabelProps={{ shrink: true }}\n      onChange={handleChange}\n      {...otherProps}\n    />\n  )\n}\n\nexport default TextField\n","// @flow\nexport const UTM = '@@MAPFILTER/COORD_FORMATS/UTM'\nexport const DEC_DEG = '@@MAPFILTER/COORD_FORMATS/DEC_DEG'\nexport const DEG_MIN_SEC = '@@MAPFILTER/COORD_FORMATS/DEG_MIN_SEC'\n","// @flow\nimport * as React from 'react'\nimport * as coordFormats from '../constants/coord_formats'\n\ntype SettingsContextType = {\n  coordFormat: $Values<typeof coordFormats>\n}\nexport const defaultSettings: SettingsContextType = {\n  coordFormat: coordFormats.UTM\n}\nexport const SettingsContext: React.Context<SettingsContextType> = React.createContext(\n  defaultSettings\n)\n","// @flow\nimport { useContext } from 'react'\nimport sexagesimal from '@mapbox/sexagesimal'\nimport { fromLatLon } from 'utm'\n\nimport * as coordFormats from '../constants/coord_formats'\nimport { SettingsContext } from './Context'\nimport type { Coordinates } from '../types'\nimport { leftPad } from '../utils/helpers'\n\nconst FormattedLocation = ({ latitude, longitude }: Coordinates) => {\n  const { coordFormat } = useContext(SettingsContext)\n  switch (coordFormat) {\n    case coordFormats.DEC_DEG:\n      return formatDecDeg({ latitude, longitude })\n    case coordFormats.DEG_MIN_SEC:\n      return sexagesimal\n        .formatPair({ lon: longitude, lat: latitude })\n        .replace(/'/g, '')\n        .replace(/\"/g, '')\n    case coordFormats.UTM:\n      return formatUtm({ latitude, longitude })\n  }\n  return null\n}\n\nexport default FormattedLocation\n\nfunction formatUtm ({ latitude, longitude }) {\n  try {\n    let { easting, northing, zoneNum, zoneLetter } = fromLatLon(\n      latitude,\n      longitude\n    )\n    easting = leftPad(easting.toFixed(), 6, '0')\n    northing = leftPad(northing.toFixed(), 6, '0')\n    return `UTM ${zoneNum}${zoneLetter} ${easting} ${northing}`\n  } catch (e) {\n    // Some coordinates (e.g. < 80S or 84N) cannot be formatted as UTM\n    return formatDecDeg({ latitude, longitude })\n  }\n}\n\nfunction formatDecDeg ({ latitude, longitude }) {\n  return `${latitude >= 0 ? '+' : ''}${latitude.toFixed(6)}, ${\n    longitude >= 0 ? '+' : ''\n  }${longitude.toFixed(6)}`\n}\n","import { defineMessages } from 'react-intl'\n\nexport default defineMessages({\n  // Name to show for an observation when it does not match any preset\n  defaultObservationName: 'Observation'\n})\n","// @flow\nimport * as React from 'react'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { FormattedTime, FormattedMessage } from 'react-intl'\n\nimport PlaceIcon from '@material-ui/icons/Place'\nimport Avatar from '@material-ui/core/Avatar'\nimport Typography from '@material-ui/core/Typography'\n\nimport FormattedLocation from '../internal/FormattedLocation'\nimport msgs from '../messages'\nimport type { Coordinates } from '../types'\n\nconst useStyles = makeStyles({\n  avatar: {\n    width: 50,\n    height: 50,\n    fontSize: 24,\n    fontWeight: 500\n  },\n  action: {\n    alignSelf: 'center',\n    margin: 0\n  }\n})\n\ntype Props = {\n  iconLabel?: string,\n  iconColor?: string,\n  name?: React.Node,\n  coords?: Coordinates,\n  createdAt?: Date,\n  action?: React.Node\n}\n\nconst FeatureHeader = ({\n  iconLabel,\n  iconColor = '#cccccc',\n  name,\n  coords,\n  createdAt,\n  action\n}: Props) => {\n  const classes = useStyles()\n  const subheaderParts = []\n  if (createdAt)\n    subheaderParts.push(\n      <FormattedTime\n        key='time'\n        value={createdAt}\n        year='numeric'\n        month='long'\n        day='2-digit'\n      />\n    )\n  if (coords) {\n    if (subheaderParts.length) subheaderParts.push(' \\u2014 ')\n    subheaderParts.push(<FormattedLocation key='location' {...coords} />)\n  }\n\n  return (\n    <CardHeader\n      classes={{ action: classes.action }}\n      avatar={\n        <Avatar\n          aria-label='Recipe'\n          style={{ backgroundColor: iconColor }}\n          className={classes.avatar}\n        >\n          {iconLabel || <PlaceIcon fontSize='large' />}\n        </Avatar>\n      }\n      action={action}\n      title={\n        <Typography variant='h5' component='h2'>\n          {name || <FormattedMessage {...msgs.defaultObservationName} />}\n        </Typography>\n      }\n      subheader={subheaderParts}\n    />\n  )\n}\n\nexport default FeatureHeader\n","// @flow\nimport React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport IconButton from '@material-ui/core/IconButton'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\nimport NavigateBeforeIcon from '@material-ui/icons/NavigateBefore'\nimport clsx from 'clsx'\nimport SwipeableViews from 'react-swipeable-views'\nimport AutoSizer from 'react-virtualized-auto-sizer'\n\nconst styles = {\n  container: {\n    backgroundColor: 'black',\n    position: 'relative'\n  },\n  widget: {\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    width: '100%',\n    display: 'flex'\n  },\n  buttonPrevContainer: {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    bottom: 0,\n    display: 'flex',\n    alignItems: 'center',\n    pointerEvents: 'none'\n  },\n  buttonNextContainer: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: 'flex',\n    alignItems: 'center',\n    pointerEvents: 'none'\n  },\n  dotsWidget: {\n    position: 'absolute',\n    bottom: 0,\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-end',\n    justifyContent: 'center',\n    marginBottom: 6,\n    pointerEvents: 'none'\n  },\n  button: {\n    color: 'white',\n    zIndex: 400,\n    pointerEvents: 'auto',\n    '&:hover': {\n      cursor: 'pointer',\n      backgroundColor: 'rgba(0, 0, 0, 0.35)'\n    }\n  },\n  dot: {\n    zIndex: 400,\n    width: '12px',\n    height: '12px',\n    borderRadius: '50%',\n    backgroundClip: 'content-box',\n    border: 'solid 4px transparent',\n    backgroundColor: 'rgba(255,255,255,0.5)',\n    pointerEvents: 'auto',\n    '&:hover': {\n      cursor: 'pointer'\n    }\n  },\n  dotHighlight: {\n    backgroundColor: 'rgba(255,255,255,1)'\n  }\n}\n\nconst useStyles = makeStyles(styles)\n\nconst NextPrevButtons = ({ index, total, onChangeIndex }) => {\n  const cx = useStyles()\n  if (total <= 1) return null\n  const showNext = total > 1 && index < total - 1\n  const showPrev = total > 1 && index > 0\n  return (\n    <>\n      <div className={cx.buttonPrevContainer}>\n        {showPrev && (\n          <IconButton\n            onClick={() => onChangeIndex(index - 1)}\n            className={cx.button}\n          >\n            <NavigateBeforeIcon />\n          </IconButton>\n        )}\n      </div>\n      <div className={cx.buttonNextContainer}>\n        {showNext && (\n          <IconButton\n            onClick={() => onChangeIndex(index + 1)}\n            className={cx.button}\n          >\n            <NavigateNextIcon />\n          </IconButton>\n        )}\n      </div>\n    </>\n  )\n}\n\nconst Dots = ({\n  index,\n  total,\n  onChangeIndex\n}: {\n  index: number,\n  total: number,\n  onChangeIndex: (index: number) => any\n}) => {\n  const cx = useStyles()\n  if (total <= 1) return null\n  return (\n    <div className={cx.dotsWidget}>\n      {Array(total)\n        .fill()\n        .map((_, i) => (\n          <div\n            key={i}\n            role='button'\n            className={clsx(cx.dot, {\n              [cx.dotHighlight]: index === i\n            })}\n            onClick={() => onChangeIndex(i)}\n          />\n        ))}\n    </div>\n  )\n}\n\nconst MediaItem = ({\n  src,\n  type,\n  width,\n  height\n}: {\n  src: string,\n  type: 'image',\n  width: number,\n  height: number\n}) => (\n  <div style={{ width, height, position: 'relative' }}>\n    <img\n      style={{ width, height, objectFit: 'contain', display: 'block' }}\n      src={src}\n    />\n  </div>\n)\n\nconst MediaCarousel = ({\n  items,\n  style,\n  initialIndex,\n  className\n}: {\n  /** Array of media items to show, only type=`image` is currently supported */\n  items: Array<{ type: 'image', src: string }>,\n  style?: {},\n  /** Initial index of image to show */\n  initialIndex?: number,\n  className?: string\n}) => {\n  const [index, setIndex] = useState(\n    // Initially display the *last* image unless initialIndex is set\n    initialIndex === undefined ? items.length - 1 : initialIndex\n  )\n  const cx = useStyles()\n  return (\n    <div style={style} className={clsx(cx.container, className)}>\n      <AutoSizer style={{ width: '100%', height: '100%' }}>\n        {({ width, height }) => (\n          <SwipeableViews\n            enableMouseEvents\n            index={index}\n            onChangeIndex={setIndex}\n          >\n            {items.map(({ src, type }, idx) => (\n              <MediaItem\n                key={idx}\n                src={src}\n                type={type}\n                width={width}\n                height={height}\n              />\n            ))}\n          </SwipeableViews>\n        )}\n      </AutoSizer>\n      <Dots index={index} total={items.length} onChangeIndex={setIndex} />\n      <NextPrevButtons\n        index={index}\n        total={items.length}\n        onChangeIndex={setIndex}\n      />\n    </div>\n  )\n}\n\nexport default MediaCarousel\n","// @flow\nimport type { Field, Key } from '../types'\n/**\n * Either returns the translated user-defined label for a field, or creates a\n * label from the field key by replacing _ and - with spaces and formatting in\n * title case\n */\nexport function getLocalizedFieldProp (\n  field: Field,\n  prop: 'label' | 'placeholder',\n  languageTag: string = 'en'\n): string {\n  // two-letter or three-letter ISO language code\n  const languageCode = languageTag.split('-')[0]\n  // choose most specific label translation available e.g. language tag with\n  // country code first, then just language code, then label without language\n  // specified\n  const label =\n    field[prop + ':' + languageTag] ||\n    field[prop + ':' + languageCode] ||\n    field[prop]\n  return label\n}\n\nexport function primitiveToString (\n  value: string | boolean | number | null\n): string {\n  if (typeof value === 'string') return value\n  // TODO: Create translatable strings\n  if (typeof value === 'boolean') return value ? 'True' : 'False'\n  if (typeof value === 'number') return value.toString()\n  // TODO: what to show (translated) for \"null\" field (vs. undefined)\n  if (value === null) return 'No Value'\n  return ''\n}\n\nexport function fieldKeyToLabel (key: Key): string | string[] {\n  const fieldkey = typeof key === 'string' ? [key] : [...key]\n  const labelArray = fieldkey.map(s => titleCase(s + ''))\n  return labelArray.length === 1 ? labelArray[0] : labelArray\n}\n\nexport function sentenceCase (str: string = '') {\n  // Matches the first letter in the string and the first letter that follows a\n  // period (and 1 or more spaces) and transforms that letter to uppercase.\n  return str.replace(/(^[a-z])|(\\.\\s*[a-z])/g, str => str.toUpperCase())\n}\n\n/**\n * For a string written in camel_case or snake-case, or space-separated, return\n * string formatted in title case\n */\nexport function titleCase (str: string) {\n  return str\n    .toLowerCase()\n    .split(/\\s|_|-/)\n    .map(word => capitalize(word))\n    .join(' ')\n}\n\nexport function capitalize (str: string) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n","// @flow\nimport * as React from 'react'\nimport TextField from './TextField'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { primitiveToString } from '../utils/strings'\nimport type {\n  SelectableFieldValue,\n  LabeledSelectOption,\n  SelectOptions\n} from '../types'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    height: 250\n  },\n  container: {\n    width: '100%'\n  },\n  paper: {\n    position: 'absolute',\n    zIndex: 1,\n    marginTop: theme.spacing(1),\n    left: 0,\n    right: 0\n  },\n  chip: {\n    margin: theme.spacing(0.5, 0.25)\n  },\n  inputRoot: {\n    flexWrap: 'wrap'\n  },\n  inputInput: {\n    width: 'auto',\n    flexGrow: 1\n  },\n  divider: {\n    height: theme.spacing(2)\n  }\n}))\n\nfunction renderInput (inputProps) {\n  const { InputProps, classes, ref, ...other } = inputProps\n\n  return (\n    <TextField\n      InputProps={{\n        inputRef: ref,\n        classes: {\n          root: classes.inputRoot,\n          input: classes.inputInput\n        },\n        ...InputProps\n      }}\n      {...other}\n    />\n  )\n}\n\ntype SelectOneProps = {\n  id?: string,\n  label: string | React.Element<any>,\n  value: SelectableFieldValue,\n  placeholder?: string,\n  onChange: (value: SelectableFieldValue | void) => any,\n  options: SelectOptions\n}\n\ntype SelectMultipleProps = {\n  ...$Exact<SelectOneProps>,\n  value: Array<SelectableFieldValue>\n}\n\nfunction Encoder (options: Array<LabeledSelectOption>) {\n  return {\n    toValue: (label: string | null): SelectableFieldValue | void => {\n      if (label === null) return\n      var opts = options.find(ops => ops.label === label)\n      return opts && typeof opts.value !== 'undefined' ? opts.value : label\n    },\n    toLabel: (value: SelectableFieldValue): string => {\n      var opts = options.find(ops => ops.value === value)\n      return (opts && opts.label) || primitiveToString(value)\n    }\n  }\n}\n\nfunction isSelectableFieldValue (\n  v: SelectableFieldValue | LabeledSelectOption\n): boolean {\n  return (\n    typeof v === 'string' ||\n    typeof v === 'boolean' ||\n    typeof v === 'number' ||\n    v === null\n  )\n}\n\nfunction getLabeledSelectOptions (\n  options: SelectOptions\n): Array<LabeledSelectOption> {\n  return options.map(opt =>\n    isSelectableFieldValue(opt)\n      ? // $FlowFixMe\n        { label: primitiveToString(opt), value: opt }\n      : // $FlowFixMe\n        opt\n  )\n}\n\n/**\n * A multi-select field that allows the user to enter a value that is not on the\n * list. Allows the selection of non-string values from a list, but the labels\n * for each item must be unique for this to work reliably\n */\nexport const SelectOne = ({\n  id,\n  value,\n  label,\n  options,\n  placeholder,\n  onChange,\n  ...props\n}: SelectOneProps) => {\n  const classes = useStyles()\n  const labeledOptions = getLabeledSelectOptions(options)\n  const encoder = Encoder(labeledOptions)\n\n  return (\n    <Autocomplete\n      id={id}\n      value={encoder.toLabel(value)}\n      onChange={(e, v: string) => onChange(encoder.toValue(v))}\n      options={labeledOptions.map(opt => opt.label)}\n      renderInput={params =>\n        renderInput({ ...params, classes, label, placeholder })\n      }\n      {...props}\n    />\n  )\n}\n\nexport const SelectMultiple = ({\n  id,\n  value,\n  label,\n  options,\n  placeholder,\n  onChange,\n  ...props\n}: SelectMultipleProps) => {\n  const classes = useStyles()\n  const labeledOptions = getLabeledSelectOptions(options)\n  const encoder = Encoder(labeledOptions)\n  let arrayValue = []\n  if (!Array.isArray(value)) arrayValue = [value]\n  else if (value) arrayValue = value\n\n  return (\n    <Autocomplete\n      id={id}\n      multiple\n      freeSolo\n      value={arrayValue.map(encoder.toLabel)}\n      onChange={(e, v) => onChange(v.map(encoder.toValue))}\n      options={labeledOptions.map(opt => opt.label)}\n      renderInput={params =>\n        renderInput({ ...params, classes, label, placeholder })\n      }\n      {...props}\n    />\n  )\n}\n","import React from 'react'\nimport { TextField as MuiTextField } from '@material-ui/core'\n\nconst TextField = ({ onChange, ...otherProps }) => {\n  const handleChange = event =>\n    onChange &&\n    onChange(\n      Number.isNaN(event.target.valueAsNumber)\n        ? undefined\n        : event.target.valueAsNumber\n    )\n  return (\n    <MuiTextField\n      fullWidth\n      variant='outlined'\n      margin='normal'\n      type='number'\n      InputLabelProps={{ shrink: true }}\n      onChange={handleChange}\n      {...otherProps}\n    />\n  )\n}\n\nexport default TextField\n","// @flow\nimport React from 'react'\nimport { DatePicker } from '@material-ui/pickers'\nimport { parseDateString, getDateString } from '../utils/helpers'\n\nconst DateField = ({ value, onChange, ...otherProps }: any) => {\n  const valueAsDate = parseDateString(value)\n  return (\n    <DatePicker\n      fullWidth\n      variant='inline'\n      inputVariant='outlined'\n      margin='normal'\n      format='dd/MM/yyyy'\n      autoOk\n      value={valueAsDate}\n      onChange={date => onChange(getDateString(date))}\n      {...otherProps}\n    />\n  )\n}\n\nexport default DateField\n","import React from 'react'\nimport { DateTimePicker } from '@material-ui/pickers'\n\nconst DateField = ({ value, onChange, ...otherProps }) => {\n  return (\n    <DateTimePicker\n      fullWidth\n      variant='inline'\n      inputVariant='outlined'\n      margin='normal'\n      value={value}\n      onChange={date =>\n        date === undefined ? onChange() : onChange(date.toISOString())\n      }\n      {...otherProps}\n    />\n  )\n}\n\nexport default DateField\n","// @flow\nimport * as React from 'react'\nimport { useIntl } from 'react-intl'\n\nimport { getLocalizedFieldProp, fieldKeyToLabel } from '../utils/strings'\nimport type { Field } from '../types'\n\nconst styles = {\n  groupText: {\n    color: 'rgba(0, 0, 0, 0.541176)'\n  }\n}\n\ntype Props = {\n  field: Field\n}\n\n/** Formats a field name nicely */\nconst FormattedFieldname = ({ field }: Props) => {\n  const { locale } = useIntl()\n  const label =\n    getLocalizedFieldProp(field, 'label', locale) || fieldKeyToLabel(field.key)\n  if (typeof label === 'string') {\n    return <span title={label}>{label}</span>\n  } else {\n    const groupText = label.slice(0, label.length - 1).join(' / ') + ' / '\n    const fieldText = label[label.length - 1]\n    return (\n      <span title={groupText + fieldText}>\n        <span style={styles.groupText}>{groupText}</span>\n        <span>{fieldText}</span>\n      </span>\n    )\n  }\n}\n\nexport default FormattedFieldname\n","// @flow\nimport React from 'react'\nimport { useIntl } from 'react-intl'\nimport { SelectOne, SelectMultiple } from './Select'\nimport TextField from './TextField'\nimport NumberField from './NumberField'\nimport DateField from './DateField'\nimport DateTimeField from './DateTimeField'\n\nimport { getLocalizedFieldProp } from '../utils/strings'\nimport FormattedFieldname from '../internal/FormattedFieldname'\nimport { type Field as FieldType, type Key } from '../types'\n\ntype Props = {\n  field: FieldType,\n  value: any,\n  onChange: (Key, any) => void\n}\n\nconst Field = ({ field, value, onChange }: Props) => {\n  const { locale } = useIntl()\n  const label = <FormattedFieldname field={field} />\n  const placeholder: string = getLocalizedFieldProp(\n    field,\n    'placeholder',\n    locale\n  )\n  const handleChange = newValue => {\n    onChange(field.key, newValue)\n  }\n\n  switch (field.type) {\n    // `textarea` is for legacy support of presets that use the iD presets\n    // schema. mapeo-schema uses type `text` with `appearance=multiline` for\n    // text areas (the default) and `appearance=singleline` for forcing fields\n    // to a single line. eslint-disable-next-line no-fallthrough\n    case 'textarea':\n    // `localized` fields are used in iD to add additional tags that append\n    // `:LANG_CODE` to the property key for language translations, e.g.\n    // `name:es` for a spanish translation of `name`. For now we will just show\n    // the non-translated name as an editable text field (translated names will\n    // appear as additional fields without the correct labels)\n    // eslint-disable-next-line no-fallthrough\n    case 'localized':\n    case 'text': {\n      // In mapeo-schema, text fields default to multiline appearance.\n      const isMultiline = field.appearance !== 'singleline'\n      return (\n        <TextField\n          value={value}\n          multiline={isMultiline}\n          onChange={handleChange}\n          label={label}\n          placeholder={placeholder}\n        />\n      )\n    }\n    case 'select_one':\n      return (\n        <SelectOne\n          value={value}\n          options={field.options}\n          onChange={handleChange}\n          label={label}\n          placeholder={placeholder}\n        />\n      )\n    case 'select_multiple':\n      return (\n        <SelectMultiple\n          value={value}\n          label={label}\n          options={field.options}\n          placeholder={placeholder}\n          onChange={handleChange}\n        />\n      )\n    case 'number':\n      return (\n        <NumberField\n          value={value}\n          onChange={handleChange}\n          label={label}\n          placeholder={placeholder}\n        />\n      )\n    case 'date':\n      return (\n        <DateField\n          value={value}\n          onChange={handleChange}\n          label={label}\n          placeholder={placeholder}\n        />\n      )\n    case 'datetime':\n      return (\n        <DateTimeField\n          value={value}\n          onChange={handleChange}\n          label={label}\n          placeholder={placeholder}\n        />\n      )\n    default:\n      return (\n        <TextField\n          value={value}\n          disabled\n          multiline\n          label={label}\n          placeholder={placeholder}\n          handleChange={handleChange}\n        />\n      )\n  }\n}\n\nexport default Field\n","// @flow\nimport React, { useState } from 'react'\nimport { makeStyles, withStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport TextField from './TextField'\nimport IconButton from '@material-ui/core/IconButton'\nimport CloseIcon from '@material-ui/icons/Close'\nimport Collapse from '@material-ui/core/Collapse'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport Fade from '@material-ui/core/Fade'\nimport DateFnsUtils from '@date-io/date-fns'\nimport enLocale from 'date-fns/locale/en-US'\nimport frLocale from 'date-fns/locale/fr'\nimport ptLocale from 'date-fns/locale/pt-BR'\nimport esLocale from 'date-fns/locale/es'\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers'\nimport MuiAccordion from '@material-ui/core/Accordion'\nimport MuiAccordionSummary from '@material-ui/core/AccordionSummary'\nimport MuiAccordionDetails from '@material-ui/core/AccordionDetails'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport MuiDialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport MenuIcon from '@material-ui/icons/MoreVert'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nimport { Typography } from '@material-ui/core'\nimport { useIntl, FormattedMessage, defineMessages } from 'react-intl'\nimport clone from 'clone-deep'\n\nimport FeatureHeader from '../internal/FeatureHeader'\nimport MediaCarousel from './MediaCarousel'\nimport { defaultGetPreset } from '../utils/helpers'\nimport { get, set } from '../utils/get_set'\nimport Field from './Field'\nimport type { Observation } from 'mapeo-schema'\nimport type {\n  PresetWithAdditionalFields,\n  GetMedia,\n  Attachment,\n  Key\n} from '../types'\n\nconst m = defineMessages({\n  confirmCloseTitle: 'Close without saving changes?',\n  confirmCloseDescription:\n    'You have made some changes, closing without saving will loose the changes you make',\n  confirmCloseButtonConfirm: 'Discard changes',\n  confirmCloseButtonCancel: 'Cancel',\n  confirmDeleteTitle: 'Delete observation?',\n  confirmDeleteButtonConfirm: 'Yes, delete',\n  confirmDeleteButtonCancel: 'Cancel',\n  // Header for section that includes the additional details for an observation\n  detailsHeader: 'Details',\n  // Header for section with additional fields that are not defined in the preset\n  additionalHeader: 'Additional data',\n  // Cancel button once observation has been edited\n  cancelEditButton: 'Cancel',\n  // Save edit button\n  saveEditButton: 'Save',\n  // Menu item to delete an observation\n  deleteObservationMenuItem: 'Delete observation'\n})\n\ntype ImageMediaItem = {\n  src: string,\n  type: 'image'\n}\n\ntype Props = {\n  open?: boolean,\n  onRequestClose: () => void,\n  onDelete: (id: string) => void,\n  observation: Observation,\n  // The initial image to show in the media carousel\n  initialImageIndex?: number,\n  onSave: (observation: Observation) => void,\n  getPreset?: Observation => PresetWithAdditionalFields | void,\n  /**\n   * For a given attachment, return `src` and `type`\n   */\n  getMedia: GetMedia\n}\n\nconst localeMap = {\n  en: enLocale,\n  fr: frLocale,\n  pt: ptLocale,\n  es: esLocale\n}\n\nfunction getLocaleData (locale) {\n  if (!locale) return localeMap.en\n  return localeMap[locale] || localeMap[locale.split('-')[0]] || localeMap.en\n}\n\nfunction defaultGetMedia ({ type, id }: Attachment) {\n  if (type && type.split('/')[0] !== 'image') return\n  return {\n    type: 'image',\n    src: id\n  }\n}\n\nconst ConfirmCloseDialog = ({ open, onCancel, onConfirm }) => (\n  <Dialog\n    disableBackdropClick\n    open={open}\n    onClose={onCancel}\n    aria-labelledby='close-dialog-title'\n    aria-describedby='close-dialog-description'\n  >\n    <DialogTitle id='close-dialog-title'>\n      <FormattedMessage {...m.confirmCloseTitle} />\n    </DialogTitle>\n    <MuiDialogContent>\n      <DialogContentText id='close-dialog-description'>\n        <FormattedMessage {...m.confirmCloseDescription} />\n      </DialogContentText>\n    </MuiDialogContent>\n    <DialogActions>\n      <Button onClick={onCancel} color='primary'>\n        <FormattedMessage {...m.confirmCloseButtonCancel} />\n      </Button>\n      <Button onClick={onConfirm} color='primary' autoFocus>\n        <FormattedMessage {...m.confirmCloseButtonConfirm} />\n      </Button>\n    </DialogActions>\n  </Dialog>\n)\n\nconst ConfirmDeleteDialog = ({ open, onCancel, onConfirm }) => (\n  <Dialog\n    disableBackdropClick\n    open={open}\n    onClose={onCancel}\n    aria-labelledby='delete-dialog-title'\n  >\n    <DialogTitle id='delete-dialog-title'>\n      <FormattedMessage {...m.confirmDeleteTitle} />\n    </DialogTitle>\n    <DialogActions>\n      <Button onClick={onCancel} color='primary'>\n        <FormattedMessage {...m.confirmDeleteButtonCancel} />\n      </Button>\n      <Button onClick={onConfirm} color='primary' autoFocus>\n        <FormattedMessage {...m.confirmDeleteButtonConfirm} />\n      </Button>\n    </DialogActions>\n  </Dialog>\n)\n\nconst Accordion = withStyles({\n  root: {\n    border: '1px solid rgba(0, 0, 0, .125)',\n    boxShadow: 'none',\n    '&:before': {\n      display: 'none'\n    },\n    '&$expanded': {\n      margin: 'auto'\n    }\n  },\n  expanded: {}\n})(MuiAccordion)\n\nconst AccordionSummary = withStyles({\n  root: {\n    '&$expanded': {\n      minHeight: 48\n    }\n  },\n  content: {\n    '&$expanded': {\n      margin: '12px 0'\n    }\n  },\n  expanded: {}\n})(MuiAccordionSummary)\n\nconst AccordionDetails = withStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'wrap',\n    padding: '0 21px 10px 21px',\n    '& > div:first-child': {\n      marginTop: 10\n    }\n  }\n})(MuiAccordionDetails)\n\nconst ObservationActions = ({ onDeleteClick }) => {\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const [confirm, setConfirm] = useState(null)\n\n  const handleOpenClick = event => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  const createHandleItemClick = (action: () => any = () => {}) => () => {\n    // Can't setState to a function\n    setConfirm(state => didConfirm => {\n      setConfirm(null)\n      if (didConfirm) action()\n      handleClose()\n    })\n  }\n\n  return (\n    <>\n      <IconButton\n        aria-controls='simple-menu'\n        aria-haspopup='true'\n        onClick={handleOpenClick}\n      >\n        <MenuIcon />\n      </IconButton>\n      <Menu\n        id='simple-menu'\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}\n      >\n        <MenuItem onClick={createHandleItemClick(onDeleteClick)}>\n          <FormattedMessage {...m.deleteObservationMenuItem} />\n        </MenuItem>\n      </Menu>\n      <ConfirmDeleteDialog\n        open={!!confirm}\n        onConfirm={() => confirm && confirm(true)}\n        onCancel={() => confirm && confirm(false)}\n      />\n    </>\n  )\n}\n\nconst DialogContent = ({\n  open = false,\n  onRequestClose,\n  onSave,\n  onDelete,\n  observation,\n  initialImageIndex,\n  getPreset = defaultGetPreset,\n  getMedia = defaultGetMedia\n}: {\n  ...$Exact<Props>,\n  onRequestClose: (shouldConfirm: boolean) => void\n}) => {\n  const cx = useStyles()\n  const [values, setValues] = useState(\n    observation.tags ? clone(observation.tags) : {}\n  )\n  const [dirty, setDirty] = useState(false)\n  const { locale } = useIntl()\n\n  const handleSave = () => {\n    onSave(set(observation, 'tags', values))\n    onRequestClose(false)\n  }\n\n  const handleRequestClose = () => {\n    // Ask for confirmation if form is dirty\n    onRequestClose(dirty)\n  }\n\n  const handleDeleteClick = () => {\n    onRequestClose(false)\n    onDelete(observation.id)\n  }\n\n  const handleChange = (key: Key, newValue: any) => {\n    setDirty(true)\n    setValues(set(values, key, newValue))\n  }\n\n  const preset = getPreset(observation) || {}\n  const coords =\n    observation.lat != null && observation.lon != null\n      ? {\n          latitude: observation.lat,\n          longitude: observation.lon\n        }\n      : undefined\n\n  const descriptionKey = values.note ? 'note' : 'notes'\n\n  const mediaItems: ImageMediaItem[] = (observation.attachments || []).reduce(\n    (acc, cur) => {\n      const item = getMedia(cur, { width: 800, height: 600 })\n      // $FlowFixMe - need to fix type refinement here\n      if (item && item.type === 'image') acc.push(item)\n      return acc\n    },\n    []\n  )\n\n  return (\n    <MuiPickersUtilsProvider\n      utils={DateFnsUtils}\n      locale={getLocaleData(locale)}\n    >\n      <>\n        <IconButton\n          className={cx.closeButton}\n          color='inherit'\n          onClick={handleRequestClose}\n          aria-label='Close'\n        >\n          <CloseIcon />\n        </IconButton>\n        {mediaItems.length > 0 && (\n          <div className={cx.mediaWrapper}>\n            <MediaCarousel\n              items={mediaItems}\n              initialIndex={initialImageIndex}\n              className={cx.media}\n            />\n          </div>\n        )}\n        <FeatureHeader\n          icon={preset.icon}\n          name={preset.name}\n          coords={coords}\n          createdAt={new Date(observation.created_at)}\n          action={<ObservationActions onDeleteClick={handleDeleteClick} />}\n        />\n        <TextField\n          value={values[descriptionKey]}\n          onChange={newValue => handleChange(descriptionKey, newValue)}\n          multiline\n          margin='dense'\n          label='Description'\n          className={cx.descriptionField}\n        />\n        {preset.fields.length > 0 && (\n          <Accordion TransitionProps={{ unmountOnExit: true }}>\n            <AccordionSummary\n              expandIcon={<ExpandMoreIcon />}\n              aria-controls='panel1a-content'\n              id='panel1a-header'\n            >\n              <Typography component='h2' className={cx.sectionHeading}>\n                <FormattedMessage {...m.detailsHeader} />\n              </Typography>\n            </AccordionSummary>\n            <AccordionDetails>\n              {preset.fields.map(field => (\n                <Field\n                  key={field.id}\n                  field={field}\n                  value={get(values, field.key)}\n                  onChange={handleChange}\n                />\n              ))}\n            </AccordionDetails>\n          </Accordion>\n        )}\n        {Array.isArray(preset.additionalFields) &&\n          preset.additionalFields.length > 0 && (\n            <Accordion>\n              <AccordionSummary\n                expandIcon={<ExpandMoreIcon />}\n                aria-controls='panel1a-content'\n                id='panel1a-header'\n              >\n                <Typography component='h2' className={cx.sectionHeading}>\n                  <FormattedMessage {...m.additionalHeader} />\n                </Typography>\n              </AccordionSummary>\n              <AccordionDetails>\n                {preset.additionalFields.map(field => (\n                  <Field\n                    key={field.id}\n                    field={field}\n                    value={get(values, field.key)}\n                    onChange={handleChange}\n                  />\n                ))}\n              </AccordionDetails>\n            </Accordion>\n          )}\n        <Fade in={dirty}>\n          <Collapse in={dirty} className={cx.actions}>\n            <Button\n              color='default'\n              variant='contained'\n              className={cx.button}\n              onClick={handleRequestClose}\n            >\n              <FormattedMessage {...m.cancelEditButton} />\n            </Button>\n            <Button\n              color='primary'\n              variant='contained'\n              className={cx.button}\n              onClick={handleSave}\n            >\n              <FormattedMessage {...m.saveEditButton} />\n            </Button>\n          </Collapse>\n        </Fade>\n      </>\n    </MuiPickersUtilsProvider>\n  )\n}\n\nconst ObservationDialog = ({ open, onRequestClose, ...otherProps }: Props) => {\n  const [confirm, setConfirm] = useState(null)\n\n  const handleRequestClose = shouldConfirm => {\n    if (!shouldConfirm) {\n      setConfirm(null)\n      onRequestClose()\n      return\n    }\n    setConfirm(state => didConfirm => {\n      setConfirm(null)\n      if (didConfirm) onRequestClose()\n    })\n  }\n  return (\n    <>\n      <Dialog\n        disableBackdropClick\n        open={open}\n        onClose={handleRequestClose}\n        scroll='body'\n        fullWidth\n        maxWidth='sm'\n      >\n        {open && (\n          <DialogContent {...otherProps} onRequestClose={handleRequestClose} />\n        )}\n      </Dialog>\n      <ConfirmCloseDialog\n        open={!!confirm}\n        onConfirm={() => confirm && confirm(true)}\n        onCancel={() => confirm && confirm(false)}\n      />\n    </>\n  )\n}\n\nexport default ObservationDialog\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    zIndex: 999,\n    left: 0,\n    top: 0,\n    color: 'white',\n    backgroundColor: 'rgba(0,0,0,0.4)',\n    borderRadius: '0 0 4px 0',\n    '&:hover': {\n      backgroundColor: 'rgba(0,0,0,0.5)'\n    }\n  },\n  descriptionField: {\n    boxSizing: 'border-box',\n    margin: '0 10px 13.5px 10px',\n    width: 'calc(100% - 20px)',\n    '& .MuiInputBase-inputMultiline': theme.typography.body1,\n    '& .MuiInputLabel-root': {\n      opacity: 0,\n      transition: 'opacity 200ms cubic-bezier(0.0, 0, 0.2, 1)'\n    },\n    '&:hover .MuiInputLabel-root, & .MuiInputLabel-root.Mui-focused': {\n      opacity: 1\n    },\n    '& .MuiOutlinedInput-notchedOutline': {\n      borderColor: 'rgba(0,0,0,0)'\n    }\n  },\n  sectionHeading: {\n    fontWeight: 500\n  },\n  mediaWrapper: {\n    width: '100%',\n    paddingTop: '75%',\n    position: 'relative',\n    height: 0\n  },\n  media: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%'\n  },\n  details: {\n    flexDirection: 'column',\n    flex: 1,\n    minWidth: 320,\n    flexBasis: '33%',\n    backgroundColor: 'white',\n    overflowY: 'scroll'\n  },\n  actions: {\n    margin: '0 10px',\n    textAlign: 'right'\n  },\n  button: {\n    marginLeft: theme.spacing(1),\n    marginTop: 14,\n    marginBottom: 14\n  }\n}))\n","// @flow\nimport { createMemoizedStats } from './lib/data_analysis/index'\nimport type { Statistics } from './types'\nimport type { Observation } from 'mapeo-schema'\n\nconst getStats = createMemoizedStats()\n\nexport default (observations: Array<Observation>): Statistics => {\n  return getStats(observations.map(obs => obs.tags || {}))\n}\n","// @flow\nimport * as React from 'react'\nimport isEqual from 'lodash/isEqual'\nimport createFilterOrig from 'mapeo-entity-filter'\n\nimport ObservationDialog from './ObservationDialog'\nimport getStats from './stats'\nimport { defaultGetPreset } from './utils/helpers'\n\nimport type { Observation } from 'mapeo-schema'\nimport type {\n  PresetWithFields,\n  PresetWithAdditionalFields,\n  GetMedia,\n  Filter,\n  GetIconUrl,\n  GetMediaUrl\n} from './types'\n\nexport type CommonViewProps = {\n  /** Array of observations to render */\n  observations?: Array<Observation>,\n  /** Called when an observation is editing/updated */\n  onUpdateObservation: (observation: Observation) => void,\n  onDeleteObservation: (id: string) => void,\n  /** A function called with an observation that should return a matching preset\n   * with field definitions */\n  presets?: PresetWithFields[],\n  getMediaUrl: GetMediaUrl,\n  getIconUrl?: GetIconUrl,\n  /** Filter to apply to observations */\n  filter?: Filter\n}\n\ntype Props = {\n  ...$Exact<CommonViewProps>,\n  children: ({\n    filteredObservations: Array<Observation>,\n    onClickObservation: (observationId: string, imageIndex?: number) => void,\n    getPreset: Observation => PresetWithAdditionalFields,\n    getMedia: GetMedia\n  }) => React.Node\n}\n\nconst noop = () => {}\n\n// This is a temporary wrapper to compile a filter that defines $preset into a\n// filter that will work with our dataset, which currently uses categoryId to\n// define which preset applies. We will need to improve how this works in the\n// future once we start matching presets like we do with iD\nconst createFilter = (filter: Filter | void) => {\n  if (!Array.isArray(filter) || filter[0] !== 'all' || filter.length < 2) {\n    return () => true\n  }\n  const presetFilter = filter.map(subFilter => {\n    if (\n      !Array.isArray(subFilter) ||\n      (subFilter[1] !== '$preset' && !isEqual(subFilter[1], ['$preset']))\n    ) {\n      return subFilter\n    }\n    return [subFilter[0], 'categoryId', ...subFilter.slice(2)]\n  })\n  return createFilterOrig(presetFilter)\n}\n\nconst WrappedMapView = ({\n  observations = [],\n  onUpdateObservation = noop,\n  onDeleteObservation = noop,\n  presets = [],\n  getMediaUrl,\n  filter,\n  children,\n  ...otherProps\n}: Props) => {\n  const stats = React.useMemo(() => getStats(observations), [observations])\n  const [editingObservation, setEditingObservation] = React.useState(null)\n  const [\n    editingInitialImageIndex,\n    setEditingInitialImageIndex\n  ] = React.useState()\n\n  const getPresetWithFallback = React.useCallback(\n    (observation: Observation): PresetWithAdditionalFields => {\n      const preset = getPreset(observation, presets)\n      const defaultPreset = defaultGetPreset(observation, stats)\n      if (!preset) return defaultPreset\n      return {\n        ...preset,\n        additionalFields: defaultPreset.additionalFields.filter(\n          // Any fields that are not defined in the preset we show as 'additionalFields'\n          additionalField => {\n            return !preset.fields.find(field => {\n              const fieldKey = Array.isArray(field.key)\n                ? field.key\n                : [field.key]\n              const additionalFieldKey = Array.isArray(additionalField.key)\n                ? additionalField.key\n                : [additionalField.key]\n              return isEqual(fieldKey, additionalFieldKey)\n            })\n          }\n        )\n      }\n    },\n    [presets, stats]\n  )\n\n  const handleObservationClick = React.useCallback(\n    (observationId, imageIndex) => {\n      setEditingInitialImageIndex(imageIndex)\n      setEditingObservation(observations.find(obs => obs.id === observationId))\n    },\n    [observations]\n  )\n\n  const getMedia = React.useCallback(\n    (attachment, { width = 800 } = {}) => {\n      const dpr = window.devicePixelRatio\n      const size =\n        width < 300 * dpr\n          ? 'thumbnail'\n          : width < 1200 * dpr\n          ? 'preview'\n          : 'original'\n      return {\n        src: getMediaUrl(attachment.id, size),\n        type: 'image'\n      }\n    },\n    [getMediaUrl]\n  )\n\n  const filterFunction = React.useMemo(() => createFilter(filter), [filter])\n  const filteredObservations = React.useMemo(\n    () => (filter ? observations.filter(filterFunction) : observations),\n    [observations, filterFunction, filter]\n  )\n\n  return (\n    <>\n      {children({\n        onClickObservation: handleObservationClick,\n        filteredObservations,\n        getPreset: getPresetWithFallback,\n        getMedia\n      })}\n      <ObservationDialog\n        open={!!editingObservation}\n        observation={editingObservation}\n        initialImageIndex={editingInitialImageIndex}\n        getPreset={getPresetWithFallback}\n        getMedia={getMedia}\n        onRequestClose={() => setEditingObservation(false)}\n        onSave={onUpdateObservation}\n        onDelete={onDeleteObservation}\n      />\n    </>\n  )\n}\n\nexport default WrappedMapView\n\n// TODO: Update this function to match presets like ID Editor\nfunction getPreset (\n  observation: Observation,\n  presets: PresetWithFields[]\n): PresetWithFields | void {\n  const tags = observation.tags\n  if (!tags || !tags.categoryId) return\n  const preset = presets.find(preset => preset.id === tags.categoryId)\n  return preset\n}\n","// @flow\nimport React from 'react'\n\nimport MapViewContent, {\n  type MapViewContentProps,\n  type MapInstance\n} from './MapViewContent'\nimport ViewWrapper, { type CommonViewProps } from '../ViewWrapper'\n\ntype Props = {\n  ...$Exact<CommonViewProps>,\n  ...$Exact<MapViewContentProps>\n}\n\nconst MapView = (\n  {\n    observations,\n    onUpdateObservation,\n    onDeleteObservation,\n    presets,\n    filter,\n    getMediaUrl,\n    ...otherProps\n  }: Props,\n  ref\n) => {\n  return (\n    <ViewWrapper\n      observations={observations}\n      onUpdateObservation={onUpdateObservation}\n      onDeleteObservation={onDeleteObservation}\n      presets={presets}\n      filter={filter}\n      getMediaUrl={getMediaUrl}\n    >\n      {({ onClickObservation, filteredObservations, getPreset, getMedia }) => (\n        <MapViewContent\n          ref={ref}\n          onClick={onClickObservation}\n          observations={filteredObservations}\n          getPreset={getPreset}\n          getMedia={getMedia}\n          {...otherProps}\n        />\n      )}\n    </ViewWrapper>\n  )\n}\n\nexport default React.forwardRef<Props, MapInstance>(MapView)\n","// @flow\nexport const TEXT: 'text' = 'text'\nexport const TEXTAREA: 'textarea' = 'textarea'\nexport const NUMBER: 'number' = 'number'\nexport const SELECT_ONE: 'select_one' = 'select_one'\nexport const SELECT_MULTIPLE: 'select_multiple' = 'select_multiple'\nexport const DATE: 'date' = 'date'\nexport const DATETIME: 'datetime' = 'datetime'\nexport const LINK: 'link' = 'link'\n","// @flow\nimport * as React from 'react'\nimport { FormattedDate, FormattedTime } from 'react-intl'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport { coerceValue } from '../lib/data_analysis/value_types'\nimport * as fieldTypes from '../constants/field_types'\nimport * as valueTypes from '../constants/value_types'\nimport type { Primitive, Field } from '../types'\n\nconst useStyles = makeStyles({\n  link: {\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n    whiteSpace: 'nowrap'\n  }\n})\n\ntype Props = {\n  value: Primitive | Array<Primitive>,\n  field: Field\n}\n\nconst defaultTextField: Field = {\n  id: 'default_text_field',\n  key: [],\n  type: fieldTypes.TEXT\n}\n\n/**\n * Format a value from a form, either by guessing the type or trying to coerce\n * the value to a type specified by `fieldType`.\n */\nconst FormattedValue = ({ value, field }: Props) => {\n  const classes = useStyles()\n  if (value === undefined || value === null) return null\n  try {\n    switch (field.type) {\n      case fieldTypes.SELECT_MULTIPLE: {\n        const valueAsArray = coerceValue(value, valueTypes.ARRAY).filter(\n          v => v != null\n        )\n        const values = valueAsArray.map<React.Node>((v, i) => (\n          <FormattedValue key={i} value={v} field={defaultTextField} />\n        ))\n        return joinReactChildren(values, ', ')\n      }\n      case fieldTypes.NUMBER: {\n        const valueAsNumber = coerceValue(value, valueTypes.NUMBER)\n        return valueAsNumber + ''\n      }\n      case fieldTypes.TEXT:\n      case fieldTypes.TEXTAREA:\n      case fieldTypes.SELECT_ONE: {\n        if (typeof value === 'boolean') return value ? 'yes' : 'no'\n        const valueAsString = coerceValue(value, valueTypes.STRING)\n        return valueAsString\n      }\n      case fieldTypes.DATE: {\n        const valueAsDate = coerceValue(value, valueTypes.DATE)\n        return (\n          <FormattedDate\n            value={valueAsDate}\n            year='numeric'\n            month='long'\n            day='2-digit'\n          />\n        )\n      }\n      case fieldTypes.DATETIME: {\n        const valueAsDatetime = coerceValue(value, valueTypes.DATETIME)\n        return (\n          <FormattedTime\n            value={valueAsDatetime}\n            year='numeric'\n            month='long'\n            day='2-digit'\n          />\n        )\n      }\n      case fieldTypes.LINK: {\n        const valueAsUrl = coerceValue(value, valueTypes.URL)\n        return (\n          <a\n            href={valueAsUrl}\n            target='_blank'\n            rel='noopener noreferrer'\n            className={classes.link}\n          >\n            {valueAsUrl}\n          </a>\n        )\n      }\n    }\n    return null\n  } catch (e) {\n    const valueAsString = coerceValue(value, valueTypes.STRING)\n    return valueAsString || null\n  }\n}\n\nexport default FormattedValue\n\nfunction joinReactChildren (\n  children: Array<React.Node>,\n  separator: React.Node\n): Array<React.Node> {\n  const joinedChildren = []\n  for (let i = 0; i < children.length; i++) {\n    joinedChildren.push(children[i])\n    if (i < children.length - 1) joinedChildren.push(separator)\n  }\n  return joinedChildren\n}\n","// @flow\nimport * as React from 'react'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Table from '@material-ui/core/Table'\nimport TableBody from '@material-ui/core/TableBody'\nimport TableCell from '@material-ui/core/TableCell'\nimport TableRow from '@material-ui/core/TableRow'\nimport AutoSizer from 'react-virtualized-auto-sizer'\n\nimport FormattedValue from '../internal/FormattedValue'\nimport FormattedFieldname from '../internal/FormattedFieldname'\nimport { get } from '../utils/get_set'\n\nimport type { Field, JSONObject, Primitive } from '../types'\n\nconst styles = {\n  root: {\n    overflow: 'auto'\n  },\n  row: {\n    verticalAlign: 'top',\n    position: 'relative'\n  },\n  col1: {\n    // padding: '14px 12px 14px 24px'\n  },\n  col1Text: {\n    fontWeight: 500,\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n    whiteSpace: 'nowrap',\n    direction: 'rtl'\n  },\n  col2: {\n    // padding: '14px 24px 14px 12px !important',\n    width: '100%',\n    maxWidth: 0,\n    whiteSpace: 'initial',\n    fontSize: '0.875rem'\n  },\n  col2Edit: {\n    paddingTop: '9px !important',\n    paddingBottom: '9px !important'\n  },\n  col2TextEdit: {\n    paddingTop: 5,\n    paddingBottom: 5\n  },\n  col2Text: {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis'\n  },\n  input: {\n    fontSize: 'inherit'\n  }\n}\n\nconst useStyles = makeStyles(styles)\n\n// function coerceValue(\n//   value: Primitive | Array<Primitive>,\n//   type: $Values<typeof valueTypes>\n// ) {\n//   try {\n//     return throwableCoerceValue(value, type)\n//   } catch (e) {}\n// }\n\n// const shouldNotWrap = {\n//   [FIELD_TYPES.UUID]: true,\n//   [FIELD_TYPES.IMAGE_URL]: true,\n//   [FIELD_TYPES.VIDEO_URL]: true,\n//   [FIELD_TYPES.MEDIA_URL]: true,\n//   [FIELD_TYPES.AUDIO_URL]: true\n// }\n\n// const ValueCellEdit = makePure(\n//   ({\n//     value,\n//     type,\n//     rowKey,\n//     coordFormat,\n//     fieldMetadata = {},\n//     onChange,\n//     classes\n//   }) => {\n//     const suggestions =\n//       Array.isArray(fieldMetadata.values) &&\n//       fieldMetadata.values.map(d => d.value)\n//     const isDiscreteField =\n//       type === FIELD_TYPES.STRING &&\n//       fieldMetadata.values &&\n//       fieldMetadata.values.length / fieldMetadata.count < 0.8\n//     if (isDiscreteField) {\n//       return (\n//         <Select\n//           value={value}\n//           onChange={(e, { newValue, type }) => onChange(rowKey, newValue)}\n//           suggestions={suggestions}\n//           style={styles.selectField}\n//         />\n//       )\n//     }\n//     if (type === FIELD_TYPES.BOOLEAN) {\n//       return (\n//         <MUISelect\n//           MenuProps={{ MenuListProps: { dense: true } }}\n//           fullWidth\n//           autoWidth\n//           value={value + ''}\n//           onChange={e => {\n//             const newValue =\n//               e.target.value === 'true'\n//                 ? true\n//                 : e.target.value === 'false'\n//                   ? false\n//                   : undefined\n//             onChange(rowKey, newValue)\n//           }}\n//           input={<Input className={classes.input} />}\n//           style={styles.muiSelect}>\n//           <MenuItem value=\"undefined\" />\n//           <MenuItem value=\"true\">Yes</MenuItem>\n//           <MenuItem value=\"false\">No</MenuItem>\n//         </MUISelect>\n//       )\n//     }\n//     if (type === FIELD_TYPES.STRING) {\n//       return (\n//         <TextField\n//           InputClassName={classes.input}\n//           fullWidth\n//           multiline\n//           value={value}\n//           onChange={e => onChange(rowKey, e.target.value)}\n//           style={styles.textField}\n//         />\n//       )\n//     }\n//     if (type === FIELD_TYPES.ARRAY) {\n//       return (\n//         <MultiSelect\n//           value={value}\n//           onChange={(e, { newValue, type }) => onChange(rowKey, newValue)}\n//           suggestions={suggestions}\n//           style={styles.selectField}\n//         />\n//       )\n//     }\n//     return (\n//       <ValueCell\n//         value={value}\n//         type={type}\n//         coordFormat={coordFormat}\n//         editMode\n//         classes={classes}\n//       />\n//     )\n//   }\n// )\n\nconst Label = ({ style, field }: { style: {}, field: Field }) => {\n  const classes = useStyles()\n  return (\n    <TableCell className={classes.col1} style={style}>\n      <Typography className={classes.col1Text}>\n        <FormattedFieldname field={field} />\n      </Typography>\n    </TableCell>\n  )\n}\n\ntype ValueProps = {\n  value: Primitive | Array<Primitive>,\n  field: Field\n}\n\nconst Value = (props: ValueProps) => {\n  const classes = useStyles()\n  return (\n    <TableCell className={classes.col2}>\n      <Typography className={classes.col2Text}>\n        <FormattedValue {...props} />\n      </Typography>\n    </TableCell>\n  )\n}\n\ntype Props = {|\n  tags?: JSONObject,\n  editMode?: boolean,\n  fields?: Array<Field>,\n  onChange?: (newTags: {}) => any,\n  width?: number\n|}\n\nconst DetailsTable = ({ fields = [], tags = {}, width }: Props) => {\n  const classes = useStyles()\n\n  function renderTable (width) {\n    return (\n      <Table className={classes.root} style={{ width: width }} size='small'>\n        <TableBody>\n          {fields\n            .map((field, i) => {\n              const value: Primitive | Array<Primitive> = get(tags, field.key)\n              if (isEmptyValue(value)) return null\n              return (\n                <TableRow\n                  key={i}\n                  className={classes.row}\n                  style={{ zIndex: fields.length - i }}\n                >\n                  <Label field={field} style={{ maxWidth: width / 3 - 36 }} />\n                  <Value value={value} field={field} />\n                </TableRow>\n              )\n            })\n            .filter(Boolean)}\n        </TableBody>\n      </Table>\n    )\n  }\n\n  if (typeof width === 'number') return renderTable(width)\n  return (\n    <AutoSizer disableHeight>\n      {({ width }) => {\n        return renderTable(width)\n      }}\n    </AutoSizer>\n  )\n}\n\nfunction isEmptyValue (value) {\n  return (\n    (typeof value === 'string' && value.length === 0) ||\n    value === undefined ||\n    value === null\n  )\n}\n\nexport default DetailsTable\n","const PPI = getPPI()\n\nexport function inch () {\n  return PPI\n}\n\nexport function cm () {\n  return PPI / 2.54\n}\n\n// We use CSS units of `in` and `cm` for print views, but we want the values in\n// pixels for the screen. PPI is normally 96, but just in case we measure it\n// once on page load.\nfunction getPPI () {\n  const div = document.createElement('div')\n  div.style.width = '1in'\n  div.style.position = 'absolute'\n  div.style.visibility = 'hidden'\n  document.body.appendChild(div)\n  const rect = div.getBoundingClientRect()\n  document.body.removeChild(div)\n  return rect.width\n}\n","// @flow\nimport React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport FeatureHeader from '../internal/FeatureHeader'\nimport Image from '../internal/Image'\nimport DetailsTable from './DetailsTable'\nimport { cm, inch } from '../utils/dom'\n\nimport type { Coordinates, Field, JSONObject, PaperSize } from '../types'\n\nconst useStyles = makeStyles({\n  imageWrapper: {\n    width: '100%',\n    height: '12cm',\n    borderTop: '1px solid rgb(224, 224, 224)'\n  },\n  notes: {\n    borderBottom: '1px solid rgb(224, 224, 224)',\n    paddingBottom: 16\n  }\n})\n\ntype Props = {|\n  name?: string,\n  iconLabel?: string,\n  iconColor?: string,\n  coords?: Coordinates,\n  createdAt?: Date,\n  imageSrc?: string,\n  fields: Array<Field>,\n  tags?: JSONObject,\n  paperSize: PaperSize\n|}\n\nconst ReportPageContent = ({\n  name,\n  iconLabel,\n  iconColor,\n  coords,\n  createdAt,\n  imageSrc,\n  fields,\n  tags,\n  paperSize\n}: Props) => {\n  const cx = useStyles()\n  const notes = tags && (tags.note || tags.notes)\n\n  return (\n    <>\n      <FeatureHeader\n        name={name}\n        iconLabel={iconLabel}\n        iconColor={iconColor}\n        coords={coords}\n        createdAt={createdAt}\n      />\n      {imageSrc && (\n        <div className={cx.imageWrapper}>\n          <Image style={{ width: '100%', height: '12cm' }} src={imageSrc} />\n        </div>\n      )}\n      {notes && <Typography className={cx.notes}>{notes}</Typography>}\n      {tags && (\n        <DetailsTable\n          fields={fields}\n          tags={tags}\n          width={paperSize === 'a4' ? 21 * cm() - inch() : 7.5 * inch()}\n        />\n      )}\n    </>\n  )\n}\n\nexport default ReportPageContent\n","// @flow\nimport * as React from 'react'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport insertCss from 'insert-css'\nimport clsx from 'clsx'\n\nconst useStyles = makeStyles({\n  container: {\n    padding: 20,\n    pageBreakAfter: 'always',\n    position: 'relative',\n    '@media only print': {\n      padding: 0\n    },\n    '&:last-child': {\n      pageBreakAfter: 'avoid !important'\n    },\n    boxSizing: 'border-box'\n  },\n  paper: {\n    position: 'relative',\n    overflow: 'hidden',\n    // backgroundColor: 'rgb(245,245,245)',\n    '@media only print': {\n      boxShadow: 'none !important',\n      borderRadius: '0 !important',\n      margin: 0,\n      overflow: 'auto',\n      '&:after': {\n        display: 'none'\n      }\n    },\n    '&:after': {\n      // Hides the page-break <hr> if it appears within the bottom-margin\n      content: \"''\",\n      position: 'absolute',\n      backgroundColor: 'rgb(255,255,255)',\n      width: '100%',\n      height: '0.5in',\n      bottom: 0\n    }\n  },\n  pageBreak: {\n    position: 'absolute',\n    left: 0,\n    width: '100%',\n    border: 'none',\n    margin: 0,\n    borderBottom: '3px dashed rgba(200,200,200, 0.75)',\n    '@media only print': {\n      display: 'none'\n    }\n  },\n  content: {\n    position: 'relative',\n    margin: '0.5in',\n    backgroundColor: 'white',\n    '@media only print': {\n      margin: 0,\n      outline: 'none'\n    }\n  },\n  letter: {\n    '&$paper': {\n      minWidth: '8.5in',\n      maxWidth: '8.5in',\n      '@media only print': {\n        /* for some reason we need to substract 2px for a perfect fit */\n        width: 'calc(8.5in - 1in - 2px)',\n        minWidth: 'calc(8.5in - 1in - 2px)',\n        maxWidth: 'calc(8.5in - 1in - 2px)'\n      }\n    },\n    '& $pageBreak': {\n      top: '10.5in'\n    },\n    '&$content': {\n      minHeight: '10in',\n      '@media only print': {\n        minHeight: 'calc(11in - 1in - 2px)'\n      }\n    }\n  },\n  a4: {\n    '&$paper': {\n      minWidth: '210mm',\n      maxWidth: '210mm',\n      '@media only print': {\n        /* for some reason we need to substract 2px for a perfect fit */\n        width: 'calc(210mm - 1in - 2px)',\n        minWidth: 'calc(210mm - 1in - 2px)',\n        maxWidth: 'calc(210mm - 1in - 2px)'\n      }\n    },\n    '& $pageBreak': {\n      top: 'calc(297mm - 0.5in)'\n    },\n    '&$content': {\n      minHeight: 'calc(297mm - 1in)',\n      '@media only print': {\n        minHeight: 'calc(297mm - 1in - 2px)'\n      }\n    }\n  },\n  '@global': {\n    '@media only print': {\n      body: {\n        margin: 0,\n        padding: 0\n      }\n    }\n  }\n})\n\ntype Props = {\n  // Called when page is clicked\n  onClick?: (event: SyntheticMouseEvent<HTMLElement>) => void,\n  paperSize: 'a4' | 'letter',\n  children: React.Node,\n  style?: Object,\n  classes?: Object\n}\n\nconst ReportPaper = ({\n  onClick,\n  paperSize,\n  children,\n  style,\n  classes = {}\n}: Props) => {\n  const cx = useStyles()\n  // This is global to the app - we add this once for every time the paper size\n  // changes, but only once. CSS header will grow, but should be ok unless the\n  // user changes paper size hundreds of times without reloading the appp\n  React.useMemo(() => insertCss(`@page {margin: 0.5in; size: ${paperSize};}`), [\n    paperSize\n  ])\n  return (\n    <div className={clsx(cx.container, classes.container)} style={style}>\n      <Paper\n        className={clsx(cx.paper, cx[paperSize], classes.paper)}\n        style={onClick ? { cursor: 'pointer' } : null}\n        onClick={onClick}\n        elevation={1}\n      >\n        <div className={clsx(cx.content, cx[paperSize], classes.content)}>\n          {children}\n        </div>\n        <hr className={cx.pageBreak} />\n      </Paper>\n    </div>\n  )\n}\n\nexport default ReportPaper\n","// @flow\nimport React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  AutoSizer,\n  List,\n  CellMeasurer,\n  CellMeasurerCache\n} from 'react-virtualized'\nimport type { Observation } from 'mapeo-schema'\n\n// import ReportFeature from './ReportFeature'\nimport ReportPageContent from './ReportPageContent'\nimport ReportPaper from './ReportPaper'\nimport MapView from '../MapView/MapViewContent'\nimport { cm, inch } from '../utils/dom'\nimport { getLastImage, defaultGetPreset } from '../utils/helpers'\n\nimport type { PaperSize, CameraOptions, CommonViewContentProps } from '../types'\n\nexport type ReportViewContentProps = {\n  /** Called with\n   * [CameraOptions](https://docs.mapbox.com/mapbox-gl-js/api/#cameraoptions)\n   * with properties `center`, `zoom`, `bearing`, `pitch` */\n  onMapMove?: CameraOptions => any,\n  /** Initial position of the map - an object with properties `center`, `zoom`,\n   * `bearing`, `pitch`. If this is not set then the map will by default zoom to\n   * the bounds of the observations. If you are going to unmount and re-mount\n   * this component (e.g. within tabs) then you will want to use onMove to store\n   * the position in state, and pass it as initialPosition for when the map\n   * re-mounts. */\n  initialMapPosition?: $Shape<CameraOptions>,\n  /** Mapbox access token */\n  mapboxAccessToken: string,\n  /** Mapbox style url */\n  mapStyle?: any\n}\n\ntype Props = {\n  ...$Exact<ReportViewContentProps>,\n  ...$Exact<CommonViewContentProps>,\n  /** Paper size for report */\n  paperSize?: PaperSize,\n  /** Render for printing (for screen display only visible observations are\n   * rendered, for performance reasons) */\n  print?: boolean\n}\n\nconst BORDER_SIZE = 0.5 * inch()\nconst noop = () => {}\n\nconst ReportViewContent = ({\n  observations,\n  onClick = () => {},\n  onMapMove,\n  initialMapPosition,\n  getPreset = defaultGetPreset,\n  getMedia,\n  paperSize = 'a4',\n  print = false,\n  mapboxAccessToken,\n  mapStyle\n}: Props) => {\n  const classes = useStyles()\n  const [mapPosition, setMapPosition] = useState()\n\n  const cacheRef = React.useRef(\n    new CellMeasurerCache({\n      fixedWidth: true,\n      minHeight: 200\n    })\n  )\n  const cache = cacheRef.current\n\n  const paperWidthPx = paperSize === 'a4' ? 21 * cm() : 8.5 * inch()\n\n  function getLastImageUrl (observation: Observation): string | void {\n    const lastImageAttachment = getLastImage(observation)\n    if (!lastImageAttachment) return\n    const media = getMedia(lastImageAttachment, {\n      width: paperWidthPx - 2 * BORDER_SIZE,\n      height: paperWidthPx - 2 * BORDER_SIZE\n    })\n    if (media) return media.src\n  }\n\n  function renderPage ({ index, key, style, parent }) {\n    return (\n      <CellMeasurer\n        cache={cache}\n        columnIndex={0}\n        key={key}\n        parent={parent}\n        rowIndex={index}\n      >\n        <div style={style}>\n          {index === 0\n            ? renderMapPage({ index, key })\n            : renderFeaturePage({ index: index - 1, key })}\n        </div>\n      </CellMeasurer>\n    )\n  }\n\n  function renderMapPage ({ key }: { key?: string } = {}) {\n    return (\n      <ReportPaper\n        key={key}\n        paperSize={paperSize}\n        classes={{ content: classes.paperContentMap }}\n      >\n        <MapView\n          mapStyle={mapStyle}\n          onClick={noop}\n          getPreset={getPreset}\n          observations={observations}\n          getMedia={getMedia}\n          initialMapPosition={initialMapPosition || mapPosition}\n          onMapMove={onMapMove || setMapPosition}\n          mapboxAccessToken={mapboxAccessToken}\n          print\n        />\n      </ReportPaper>\n    )\n  }\n\n  function renderFeaturePage ({ index, key }: { index: number, key?: string }) {\n    const observation = observations[index]\n    const coords =\n      typeof observation.lon === 'number' && typeof observation.lat === 'number'\n        ? {\n            longitude: observation.lon,\n            latitude: observation.lat\n          }\n        : undefined\n    const createdAt =\n      typeof observation.created_at === 'string'\n        ? new Date(observation.created_at)\n        : undefined\n    const preset = getPreset(observation) || {}\n    const fields = preset.fields.concat(preset.additionalFields)\n    return (\n      <ReportPaper\n        key={key}\n        paperSize={paperSize}\n        onClick={() => onClick(observation.id)}\n      >\n        <ReportPageContent\n          name={typeof preset.name === 'string' ? preset.name : undefined}\n          createdAt={createdAt}\n          coords={coords}\n          fields={fields}\n          imageSrc={getLastImageUrl(observation)}\n          tags={observation.tags}\n          paperSize={paperSize}\n        />\n      </ReportPaper>\n    )\n  }\n\n  function renderVirtualList () {\n    return (\n      <AutoSizer>\n        {({ height, width }) => (\n          <List\n            className={classes.reportWrapper + ' ' + classes[paperSize]}\n            containerStyle={{ overflowX: 'scroll' }}\n            height={height}\n            width={width}\n            rowCount={observations.length + 1 /* for additional map page */}\n            rowRenderer={renderPage}\n            deferredMeasurementCache={cache}\n            rowHeight={cache.rowHeight}\n            overscanRowCount={3}\n            estimatedRowSize={\n              200 /* paperSize === 'a4' ? 29.7 * cm() : 11 * inch()} */\n            }\n          />\n        )}\n      </AutoSizer>\n    )\n  }\n\n  function renderPrintList () {\n    return (\n      <React.Fragment>\n        {renderMapPage()}\n        {observations.map((_, index) =>\n          renderFeaturePage({ index, key: index + '' })\n        )}\n      </React.Fragment>\n    )\n  }\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.scrollWrapper}>\n        {print ? renderPrintList() : renderVirtualList()}\n      </div>\n    </div>\n  )\n}\n\nexport default ReportViewContent\n\nconst useStyles = makeStyles({\n  root: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: 'rgba(236, 236, 236, 1)',\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  },\n  reportWrapper: {\n    '@media only print': {\n      padding: 0,\n      minWidth: 'auto'\n    }\n  },\n  paperContentMap: {\n    display: 'flex'\n  },\n  letter: {\n    '&$reportWrapper': {\n      // minWidth: 8.5 * inch()\n    }\n  },\n  a4: {\n    '&$reportWrapper': {\n      // minWidth: 21 * cm()\n    }\n  },\n  scrollWrapper: {\n    flex: '1 1 auto',\n    overflow: 'hidden',\n    '@media only print': {\n      overflow: 'auto',\n      flex: 'initial',\n      position: 'static'\n    }\n  },\n  '@global': {\n    '@media only print': {\n      tr: {\n        pageBreakInside: 'avoid'\n      },\n      '.d-print-none': {\n        display: 'none'\n      },\n      '.mapboxgl-ctrl-group, .mapboxgl-ctrl-attrib': {\n        display: 'none'\n      }\n    }\n  }\n})\n","// @flow\n\nimport * as React from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles({\n  root: {\n    zIndex: 10,\n    top: 0,\n    left: 0,\n    right: 0,\n    padding: '8px !important',\n    flexDirection: 'row !important',\n    '@media only print': {\n      display: 'none'\n    }\n  }\n})\n\ntype Props = {\n  children: React.Node\n}\n\nconst Toolbar = ({ children }: Props) => {\n  const classes = useStyles()\n  return (\n    <AppBar\n      elevation={0}\n      color='default'\n      position='static'\n      className={classes.root + ' d-print-none'}\n    >\n      {children}\n    </AppBar>\n  )\n}\n\nexport default Toolbar\n","// @flow\nimport * as React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\n\nconst useStyles = makeStyles({\n  root: {\n    color: 'rgba(0, 0, 0, 0.67)',\n    padding: '3px 5px',\n    marginRight: 5,\n    minHeight: 16,\n    textTransform: 'initial',\n    '& svg': {\n      height: 18,\n      width: 18,\n      paddingRight: 6\n    }\n  }\n})\n\ntype Props = {\n  children: React.Node\n}\n\nconst ToolbarButton = ({ children, ...otherProps }: Props) => {\n  const classes = useStyles()\n  return (\n    <Button className={classes.root} {...otherProps}>\n      {children}\n    </Button>\n  )\n}\n\nToolbarButton.muiName = 'Button'\n\nexport default ToolbarButton\n","// @flow\nimport React from 'react'\nimport PrintIcon from '@material-ui/icons/Print'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport Input from '@material-ui/core/Input'\nimport FormControl from '@material-ui/core/FormControl'\nimport Select from '@material-ui/core/Select'\nimport { defineMessages, FormattedMessage } from 'react-intl'\n\nimport ToolbarButton from '../internal/ToolbarButton'\n\nimport type { PaperSize } from '../types'\n\nconst messages = defineMessages({\n  // Title of print settings dialog\n  dialogTitle: 'Print settings',\n  // Label for paper size selection field\n  paperSize: 'Paper size',\n  // Button label to close print settings dialog\n  close: 'Close',\n  // Button label to print a report\n  print: 'Print'\n})\n\ntype Props = {\n  requestPrint: () => void,\n  changePaperSize: (paperSize: PaperSize) => void,\n  paperSize: PaperSize\n}\n\ntype State = {\n  dialogOpen: boolean\n}\n\nclass PrintButton extends React.Component<Props, State> {\n  state = {\n    dialogOpen: false\n  }\n\n  handleKeyDown = (event: SyntheticKeyboardEvent<HTMLElement>) => {\n    if (!(event.key === 'p' && event.metaKey)) return\n    event.preventDefault()\n    window.addEventListener('keyup', this.handleKeyUp)\n  }\n\n  handleKeyUp = (event: SyntheticKeyboardEvent<HTMLElement>) => {\n    window.removeEventListener('keyup', this.handleKeyUp)\n    if (this.state.dialogOpen) {\n      this.props.requestPrint()\n    } else {\n      this.openDialog()\n    }\n  }\n\n  openDialog = () => this.setState({ dialogOpen: true })\n\n  closeDialog = () => this.setState({ dialogOpen: false })\n\n  handleChangePaperSize = (e: SyntheticInputEvent<HTMLSelectElement>) => {\n    // $FlowFixMe - Flow doesn't recognize value being one of options\n    const value: PaperSize = e.currentTarget.value\n    this.props.changePaperSize(value)\n  }\n\n  render () {\n    const { requestPrint, paperSize } = this.props\n    const { dialogOpen } = this.state\n    return (\n      <React.Fragment>\n        <ToolbarButton onClick={this.openDialog}>\n          <PrintIcon />\n          <FormattedMessage {...messages.print} />\n        </ToolbarButton>\n        <Dialog\n          open={dialogOpen}\n          onClose={this.closeDialog}\n          fullWidth\n          maxWidth='xs'\n          className='d-print-none'\n        >\n          <DialogTitle>\n            <FormattedMessage {...messages.dialogTitle} />\n          </DialogTitle>\n          <DialogContent>\n            <FormControl>\n              <InputLabel htmlFor='paper-size'>\n                <FormattedMessage {...messages.paperSize} />\n              </InputLabel>\n              <Select\n                native\n                value={paperSize}\n                onChange={this.handleChangePaperSize}\n                input={<Input id='paper-size' />}\n              >\n                <option value='a4'>A4 (210mm x 297mm)</option>\n                <option value='letter'>Letter (8.5&quot; x 11&quot;)</option>\n              </Select>\n            </FormControl>\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={this.closeDialog} color='primary'>\n              <FormattedMessage {...messages.close} />\n            </Button>\n            <Button\n              onClick={() => {\n                this.closeDialog()\n                requestPrint()\n              }}\n              color='primary'\n            >\n              <FormattedMessage {...messages.print} />\n            </Button>\n          </DialogActions>\n        </Dialog>\n      </React.Fragment>\n    )\n  }\n}\n\nexport default PrintButton\n","// @flow\nimport * as React from 'react'\nimport VisibilityOffIcon from '@material-ui/icons/VisibilityOff'\nimport Popover from '@material-ui/core/Popover'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\nimport Switch from '@material-ui/core/Switch'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { defineMessages, FormattedMessage } from 'react-intl'\n\nimport ToolbarButton from '../internal/ToolbarButton'\nimport type { FieldState } from '../types'\nconst msgs = defineMessages({\n  // Button label for hide fields menu\n  hideFieldsLabel: `{count} Hidden Fields`,\n  // Show all fields in report view\n  showAll: 'Show All',\n  // Hide all fields in report view\n  hideAll: 'Hide All'\n})\n\nconst useStyles = makeStyles(theme => {\n  return {\n    actions: {\n      margin: `${theme.spacing(1)}px ${theme.spacing(1) / 2}px`\n    },\n    button: {\n      margin: `0 ${theme.spacing(1) / 2}px`\n    },\n    listItem: {\n      paddingRight: 48\n    },\n    fieldname: {\n      maxWidth: 300,\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n      whiteSpace: 'nowrap'\n    }\n  }\n})\n\ntype Props = {|\n  fieldState: FieldState,\n  onFieldStateUpdate: FieldState => any\n|}\n\nconst HideFieldsButton = ({ fieldState, onFieldStateUpdate }: Props) => {\n  const classes = useStyles()\n  const [anchorEl, setAnchorEl] = React.useState(null)\n\n  function handleClick (event) {\n    setAnchorEl(event.currentTarget)\n  }\n\n  function handleClose () {\n    setAnchorEl(null)\n  }\n\n  function toggleFieldVisibility (id: string) {\n    const newState = fieldState\n      .slice()\n      .map(f => (f.id === id ? { ...f, hidden: !f.hidden } : f))\n    onFieldStateUpdate(newState)\n  }\n\n  function showAllFields () {\n    const newState = fieldState.slice().map(f => ({ ...f, hidden: false }))\n    onFieldStateUpdate(newState)\n  }\n\n  function hideAllFields () {\n    const newState = fieldState.slice().map(f => ({ ...f, hidden: true }))\n    onFieldStateUpdate(newState)\n  }\n\n  const open = Boolean(anchorEl)\n\n  const hiddenCount = fieldState.filter(f => f.hidden).length\n  console.log('hiddenCount', hiddenCount)\n  return (\n    <React.Fragment>\n      <ToolbarButton onClick={handleClick}>\n        <VisibilityOffIcon />\n        <FormattedMessage\n          {...msgs.hideFieldsLabel}\n          values={{ count: hiddenCount }}\n        />\n      </ToolbarButton>\n      <Popover\n        anchorEl={anchorEl}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        open={open}\n        onClose={handleClose}\n        PaperProps={{\n          style: {\n            maxHeight: '50vh',\n            minWidth: 200,\n            maxWidth: '50vw'\n          }\n        }}\n      >\n        <div className={classes.actions}>\n          <Button\n            size='small'\n            onClick={showAllFields}\n            className={classes.button}\n          >\n            <FormattedMessage {...msgs.showAll} />\n          </Button>\n          <Button\n            size='small'\n            onClick={hideAllFields}\n            className={classes.button}\n          >\n            <FormattedMessage {...msgs.hideAll} />\n          </Button>\n        </div>\n        <List dense>\n          {fieldState.map(f => (\n            <ListItem key={f.id} className={classes.listItem}>\n              <ListItemText className={classes.fieldname} primary={f.label} />\n              <ListItemSecondaryAction>\n                <Switch\n                  onClick={() => toggleFieldVisibility(f.id)}\n                  checked={!f.hidden}\n                />\n              </ListItemSecondaryAction>\n            </ListItem>\n          ))}\n        </List>\n      </Popover>\n    </React.Fragment>\n  )\n}\n\nexport default HideFieldsButton\n","// @flow\nimport React, { useState, useLayoutEffect, useMemo } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport ReportViewContent, {\n  type ReportViewContentProps\n} from './ReportViewContent'\nimport ViewWrapper, { type CommonViewProps } from '../ViewWrapper'\nimport Toolbar from '../internal/Toolbar'\nimport PrintButton from './PrintButton'\nimport HideFieldsButton from './HideFieldsButton'\nimport { fieldKeyToLabel } from '../utils/strings'\nimport getStats from '../stats'\n\nimport type { Observation } from 'mapeo-schema'\nimport type { PresetWithAdditionalFields, FieldState, Field } from '../types'\n\ntype Props = {\n  ...$Exact<CommonViewProps>,\n  ...$Exact<ReportViewContentProps>\n}\n\nconst hiddenTags = {\n  categoryId: true,\n  notes: true,\n  note: true\n}\n\nconst ReportView = ({\n  observations,\n  onUpdateObservation,\n  onDeleteObservation,\n  presets,\n  filter,\n  getMediaUrl,\n  ...otherProps\n}: Props) => {\n  const stats = useMemo(() => getStats(observations || []), [observations])\n  const cx = useStyles()\n  const [paperSize, setPaperSize] = useState('a4')\n  const [print, setPrint] = useState(false)\n\n  const [fieldState, setFieldState] = useState(() => {\n    // Lazy initial state to avoid this being calculated on every render\n    return Object.keys(stats)\n      .filter(key => {\n        // Hacky: don't include categoryId and notes in options of fields you can hide\n        const fieldKey = JSON.parse(key)\n        const fieldKeyString = Array.isArray(fieldKey) ? fieldKey[0] : fieldKey\n        if (hiddenTags[fieldKeyString]) return false\n        return true\n      })\n      .map(key => {\n        const fieldKey = JSON.parse(key)\n        const label = fieldKeyToLabel(fieldKey)\n        return {\n          id: key,\n          hidden: false,\n          label: Array.isArray(label) ? label.join('.') : label\n        }\n      })\n  })\n\n  useLayoutEffect(() => {\n    if (!print) return\n    let didCancel = false\n\n    // Wait for map to render\n    // TODO: SUPER hacky - we need to wait for the map to render\n    const timeoutId = setTimeout(() => {\n      if (didCancel) return\n      window.print()\n      setPrint(false)\n    }, 3000)\n    return () => {\n      didCancel = true\n      if (timeoutId) clearTimeout(timeoutId)\n    }\n  }, [print])\n\n  return (\n    <ViewWrapper\n      observations={observations}\n      onUpdateObservation={onUpdateObservation}\n      onDeleteObservation={onDeleteObservation}\n      presets={presets}\n      filter={filter}\n      getMediaUrl={getMediaUrl}\n    >\n      {({ onClickObservation, filteredObservations, getPreset, getMedia }) => {\n        // Get preset with fields filtered out\n        const getPresetWithFilteredFields = (\n          observation: Observation\n        ): PresetWithAdditionalFields => {\n          const preset = getPreset(observation)\n          return {\n            ...preset,\n            fields: preset.fields.filter(hiddenFieldsFilter(fieldState)),\n            additionalFields: preset.additionalFields.filter(\n              hiddenFieldsFilter(fieldState)\n            )\n          }\n        }\n        return (\n          <div className={cx.root}>\n            <Toolbar>\n              <PrintButton\n                requestPrint={() => setPrint(true)}\n                changePaperSize={newSize => setPaperSize(newSize)}\n                paperSize={paperSize}\n              />\n              <HideFieldsButton\n                fieldState={fieldState}\n                onFieldStateUpdate={setFieldState}\n              />\n            </Toolbar>\n            <ReportViewContent\n              onClick={onClickObservation}\n              observations={filteredObservations}\n              getPreset={getPresetWithFilteredFields}\n              getMedia={getMedia}\n              paperSize={paperSize}\n              print={print}\n              {...otherProps}\n            />\n          </div>\n        )\n      }}\n    </ViewWrapper>\n  )\n}\n\nexport default ReportView\n\nfunction hiddenFieldsFilter (fieldState: FieldState) {\n  return function (field: Field): boolean {\n    const state = fieldState.find(fs => {\n      const id = JSON.stringify(\n        Array.isArray(field.key) ? field.key : [field.key]\n      )\n      return fs.id === id\n    })\n    return state ? !state.hidden : true\n  }\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: 'absolute',\n    width: '100%',\n    top: 0,\n    bottom: 0,\n    display: 'flex',\n    flexDirection: 'column',\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  }\n}))\n","// @flow\nimport React, { useMemo } from 'react'\nimport AutoSizer from 'react-virtualized-auto-sizer'\nimport { FixedSizeGrid as Grid } from 'react-window'\nimport getScrollBarWidth from 'get-scrollbar-width'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport type { Observation } from 'mapeo-schema'\n\nconst useStyles = makeStyles({\n  image: {\n    border: '1px solid white',\n    boxSizing: 'border-box',\n    display: 'block',\n    height: '100%',\n    objectFit: 'cover',\n    width: '100%',\n    cursor: 'pointer',\n    backgroundColor: 'rgb(240, 240, 240)'\n  }\n})\n\ntype Props = {\n  /** Array of image attachments to render. Each attachment should have an id\n   * and and observationId, which points to the parent observation */\n  images: Array<{\n    index: number,\n    src: string,\n    observationId: $ElementType<Observation, 'id'>\n  }>,\n  /** Called with id of observation clicked and index of the attachment clicked */\n  onImageClick: (observationId: string, index?: number) => void,\n  /** Optional default size for grid items */\n  defaultSize?: number\n}\n\n/**\n * Renders a grid of images\n */\nconst ImageGrid = ({ images, onImageClick, defaultSize = 200 }: Props) => {\n  const scrollbarWidth = useMemo(() => getScrollBarWidth(), [])\n  const classes = useStyles()\n\n  return (\n    <div style={{ width: '100%', height: '100%', position: 'absolute' }}>\n      <AutoSizer>\n        {({ height, width }) => {\n          const columnsCount = Math.floor(width / defaultSize)\n          const rowsCount = Math.ceil(images.length / columnsCount)\n          let cellSize = width / columnsCount\n          const overflow = cellSize * rowsCount > height\n          if (overflow && scrollbarWidth) {\n            cellSize = (width - scrollbarWidth) / columnsCount\n          }\n\n          return (\n            <Grid\n              columnCount={columnsCount}\n              columnWidth={cellSize}\n              height={height}\n              rowCount={rowsCount}\n              rowHeight={cellSize}\n              width={width}\n            >\n              {({\n                columnIndex,\n                rowIndex,\n                style\n              }: {\n                columnIndex: number,\n                rowIndex: number,\n                style: {}\n              }) => {\n                const image = images[rowIndex * columnsCount + columnIndex]\n                if (!image) return null\n                return (\n                  <img\n                    key={rowIndex * columnsCount + columnIndex}\n                    src={image.src}\n                    className={classes.image}\n                    style={style}\n                    onClick={() =>\n                      onImageClick(image.observationId, image.index)\n                    }\n                  />\n                )\n              }}\n            </Grid>\n          )\n        }}\n      </AutoSizer>\n    </div>\n  )\n}\n\nexport default ImageGrid\n","// @flow\nimport React, { useMemo } from 'react'\n\nimport ImageGrid from './ImageGrid'\nimport { isImageAttachment } from '../utils/helpers'\nimport type { CommonViewContentProps } from '../types'\n\n/**\n * Displays a grid of all photos attached to observations.\n */\nconst MediaViewContent = ({\n  observations,\n  onClick,\n  getMedia\n}: CommonViewContentProps) => {\n  const images = useMemo(() => {\n    const images = []\n    const sortedObservations = observations.sort((a, b) => {\n      return a.created_at > b.created_at\n        ? -1\n        : a.created_at < b.created_at\n        ? 1\n        : 0\n    })\n    for (const obs of sortedObservations) {\n      const attachments = obs.attachments || []\n      for (let i = 0; i < attachments.length; i++) {\n        // Only return attachments with images\n        if (!isImageAttachment(attachments[i])) continue\n        // check we can actually get an image src for each one before adding it\n        const media = getMedia(attachments[i], { width: 200, height: 200 })\n        if (media)\n          images.push({\n            index: i,\n            src: media.src,\n            observationId: obs.id\n          })\n      }\n    }\n    return images\n  }, [observations, getMedia])\n\n  return <ImageGrid images={images} onImageClick={onClick} />\n}\n\nexport default MediaViewContent\n","// @flow\nimport React from 'react'\n\nimport MediaViewContent from './MediaViewContent'\nimport ViewWrapper, { type CommonViewProps } from '../ViewWrapper'\n\nconst MapView = ({\n  observations,\n  onUpdateObservation,\n  onDeleteObservation,\n  presets,\n  filter,\n  getMediaUrl,\n  ...otherProps\n}: CommonViewProps) => {\n  return (\n    <ViewWrapper\n      observations={observations}\n      onUpdateObservation={onUpdateObservation}\n      onDeleteObservation={onDeleteObservation}\n      presets={presets}\n      filter={filter}\n      getMediaUrl={getMediaUrl}\n    >\n      {({ onClickObservation, filteredObservations, getPreset, getMedia }) => (\n        <MediaViewContent\n          onClick={onClickObservation}\n          observations={filteredObservations}\n          getPreset={getPreset}\n          getMedia={getMedia}\n          {...otherProps}\n        />\n      )}\n    </ViewWrapper>\n  )\n}\n\nexport default MapView\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport MapIcon from '@material-ui/icons/Map'\nimport MediaIcon from '@material-ui/icons/Apps'\nimport ReportIcon from '@material-ui/icons/LibraryBooks'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Button from '@material-ui/core/Button'\nimport { defineMessages, useIntl } from 'react-intl'\nimport clsx from 'clsx'\n\nconst m = defineMessages({\n  mapTabLabel: 'Map',\n  mediaTabLabel: 'Media',\n  reportTabLabel: 'Report'\n})\n\nconst TabItem = ({ selected, ...props }) => {\n  const cx = useStyles()\n  return (\n    <Button\n      disableRipple\n      {...props}\n      className={clsx(cx.tabItem, selected && 'selected')}\n    />\n  )\n}\n\nconst MapFilterToolbar = ({ view, onChange, actionRight }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  const handleChange = view => e => onChange(view)\n  return (\n    <React.Fragment>\n      <AppBar\n        position='static'\n        color='inherit'\n        elevation={0}\n        className={cx.root}\n      >\n        <Toolbar className={cx.toolbar}>\n          <div className={cx.tabGroup}>\n            <TabItem\n              aria-label='map view'\n              selected={view === 'map'}\n              onClick={handleChange('map')}\n            >\n              <MapIcon />\n              <span className={cx.tabLabel}>{t(m.mapTabLabel)}</span>\n            </TabItem>\n            <TabItem\n              aria-label='media view'\n              selected={view === 'media'}\n              onClick={handleChange('media')}\n            >\n              <MediaIcon />\n              <span className={cx.tabLabel}>{t(m.mediaTabLabel)}</span>\n            </TabItem>\n            <TabItem\n              aria-label='report view'\n              selected={view === 'report'}\n              onClick={handleChange('report')}\n            >\n              <ReportIcon />\n              <span className={cx.tabLabel}>{t(m.reportTabLabel)}</span>\n            </TabItem>\n          </div>\n          {actionRight}\n        </Toolbar>\n      </AppBar>\n    </React.Fragment>\n  )\n}\n\nexport default MapFilterToolbar\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    borderLeft: '1px solid rgba(0, 0, 0, 0.12)',\n    '@media only print': {\n      display: 'none'\n    }\n  },\n  toolbar: {\n    justifyContent: 'space-between',\n    padding: '0 12px'\n  },\n  tabItem: {\n    height: '44px',\n    flex: '1',\n    border: '1px solid rgba(0, 0, 0, 0.12)',\n    color: 'rgba(0, 0, 0, 0.87)',\n    padding: '0 16px 0 16px',\n    justifyContent: 'stretch',\n    textTransform: 'capitalize',\n    '&.selected': {\n      color: 'white',\n      backgroundColor: '#2469f6 !important'\n    },\n    '&:not(:last-child)': {\n      borderTopRightRadius: '0',\n      borderBottomRightRadius: '0'\n    },\n    '&:not(:first-child)': {\n      borderLeft: '1px solid transparent',\n      marginLeft: '-1px',\n      borderTopLeftRadius: '0',\n      borderBottomLeftRadius: '0'\n    },\n    '& .MuiSvgIcon-root': {}\n  },\n  tab: {\n    height: 44,\n    flex: 1,\n    border: '1px solid rgba(0, 0, 0, 0.12)',\n    textTransform: 'capitalize',\n    color: 'rgba(0, 0, 0, 0.87)',\n    justifyContent: 'stretch',\n    '&.Mui-selected': {\n      color: 'white',\n      backgroundColor: '#2469F6 !important'\n    },\n    '& .MuiSvgIcon-root': {\n      marginRight: theme.spacing(1)\n    }\n  },\n  tabIcon: {},\n  tabLabel: {\n    fontFamily: theme.typography.fontFamily,\n    fontWeight: 500,\n    flex: 1\n  },\n  tabGroup: {\n    flex: 1,\n    maxWidth: 350,\n    display: 'inline-flex',\n    borderRadius: '4px',\n    backgroundColor: '#fff'\n  },\n  toolbarButton: {}\n}))\n","import React from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport MuiToolbar from '@material-ui/core/Toolbar'\nimport { FilterPanel } from 'react-mapfilter'\nimport { defineMessages, FormattedMessage } from 'react-intl'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { Typography } from '@material-ui/core'\n\nconst m = defineMessages({\n  filterHeader: 'Filter by'\n})\n\nconst LeftPanel = props => {\n  const cx = useStyles()\n  return (\n    <div className={cx.root}>\n      <AppBar\n        color='inherit'\n        position='static'\n        elevation={0}\n        className={cx.header}\n      >\n        <MuiToolbar>\n          <Typography variant='h6' component='h2'>\n            <FormattedMessage {...m.filterHeader} />\n          </Typography>\n        </MuiToolbar>\n      </AppBar>\n      <FilterPanel {...props} />\n    </div>\n  )\n}\n\nexport default LeftPanel\n\nconst useStyles = makeStyles({\n  root: {\n    flex: 0,\n    flexBasis: '30%',\n    minWidth: 300,\n    maxWidth: 400,\n    flexDirection: 'column',\n    display: 'flex',\n    backgroundColor: 'white',\n    '@media only print': {\n      display: 'none'\n    }\n  },\n  header: {\n    borderBottom: '1px solid rgba(0, 0, 0, 0.12)',\n    color: 'rgba(0, 0, 0, 0.7)'\n  }\n})\n","import React from 'react'\nimport styled from 'styled-components'\n\nconst Styled = styled.div`\n  display: inline-block;\n  position: relative;\n  width: 64px;\n  height: 64px;\n  div {\n    position: absolute;\n    top: 12px;\n    width: 11px;\n    height: 11px;\n    border-radius: 50%;\n    animation-timing-function: cubic-bezier(0, 1, 1, 0);\n  }\n  div:nth-child(1) {\n    left: 6px;\n    animation: lds-ellipsis1 0.6s infinite;\n  }\n  div:nth-child(2) {\n    left: 6px;\n    animation: lds-ellipsis2 0.6s infinite;\n    background-color: rgba(0, 5, 43, 1);\n  }\n  div:nth-child(3) {\n    left: 26px;\n    background-color: rgba(0, 5, 43, 1);\n    animation: lds-ellipsis2 0.6s infinite;\n  }\n  div:nth-child(4) {\n    left: 45px;\n    animation: lds-ellipsis3 0.6s infinite;\n  }\n  @keyframes lds-ellipsis1 {\n    0% {\n      transform: scale(0);\n      background-color: rgba(0, 5, 43, 0);\n    }\n    100% {\n      transform: scale(1);\n      background-color: rgba(0, 5, 43, 1);\n    }\n  }\n  @keyframes lds-ellipsis3 {\n    0% {\n      transform: scale(1);\n      background-color: rgba(0, 5, 43, 1);\n    }\n    100% {\n      transform: scale(0);\n      background-color: rgba(0, 5, 43, 0);\n    }\n  }\n  @keyframes lds-ellipsis2 {\n    0% {\n      transform: translate(0, 0);\n    }\n    100% {\n      transform: translate(19px, 0);\n    }\n  }\n`\n\nconst Loader = () => (\n  <Styled>\n    <div />\n    <div />\n    <div />\n    <div />\n  </Styled>\n)\n\nexport default Loader\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { defineMessages, useIntl } from 'react-intl'\nimport { Typography } from '@material-ui/core'\n\nimport Loader from '../Loader'\n\nconst m = defineMessages({\n  // Displayed whilst observations and presets load\n  loading: 'Loading'\n})\n\nconst Searching = () => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.root}>\n      <div className={cx.container}>\n        <Loader />\n        <div className={cx.text}>\n          <Typography gutterBottom variant='h2' className={cx.loadingTitle}>\n            {t(m.loading)}\n          </Typography>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Searching\n\nconst useStyles = makeStyles(theme => ({\n  text: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  container: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  loadingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  }\n}))\n","import { useState, useEffect } from 'react'\nimport api from '../../new-api'\n\nconst MapStyleProvider = ({ children }) => {\n  const [style, setStyle] = useState('mapbox://styles/mapbox/outdoors-v10')\n\n  useEffect(() => {\n    const offlineStyleURL = api.getMapStyleUrl('default')\n    // This is just to check whether an offline style is available, and if it\n    // is, use that as the map style. Otherwise, use the online mapbox style\n    api\n      .getMapStyle('default')\n      .then(() => setStyle(offlineStyleURL))\n      .catch(() => {})\n  }, [])\n\n  return children(style)\n}\n\nexport default MapStyleProvider\n","import yazl from 'yazl'\nimport run from 'run-parallel-limit'\nimport ky from 'ky/umd'\nimport once from 'once'\nimport logger from '../logger'\n\nconst concurrency = 3\n\n/**\n * Create a zipfile from a collection of strings/buffers and remote files\n * (remote files will be downloaded concurrently and streamed to the zipfile)\n *\n * @param {Array} localFiles Array of files to add to the zip archive. Must have\n * properties `data` which should be a Buffer or String, and `name`\n * which is the path to the file in the zipfile. Can also include options from\n * https://github.com/thejoshwolfe/yazl#addfilerealpath-metadatapath-options\n * @param {Array} remoteFiles Array of files to add to the zip archive. Must\n * have properties `url` and `name` which is the path to the file in the\n * zipfile. Can also include options from\n * https://github.com/thejoshwolfe/yazl#addfilerealpath-metadatapath-options\n * @returns {ReadableStream} readableStream of zipfile data\n */\nexport default function createZip (localFiles, remoteFiles) {\n  const zipfile = new yazl.ZipFile()\n  const missing = []\n\n  localFiles.forEach(({ data, metadataPath, ...options }) => {\n    if (typeof data === 'string') data = Buffer.from(data)\n    zipfile.addBuffer(data, metadataPath, options)\n  })\n\n  const tasks = remoteFiles.map(({ url, metadataPath, ...options }) => cb => {\n    cb = once(cb)\n    const start = Date.now()\n    logger.debug('Requesting', url)\n    // I tried doing this by adding streams to the zipfile, but it's really hard\n    // to catch errors when trying to download an image, so you end up with\n    // corrupt files in the zip. This uses a bit more memory, but images are\n    // only added once they have downloaded correctly\n    ky.get(url)\n      .arrayBuffer()\n      .then(arrBuf => {\n        logger.debug('Req end in ' + (Date.now() - start) + 'ms ' + metadataPath)\n        zipfile.addBuffer(Buffer.from(arrBuf), metadataPath, {\n          ...options,\n          store: true\n        })\n        cb()\n      })\n      .catch(err => {\n        missing.push(metadataPath)\n        logger.error('Error downloading file ' + metadataPath, err)\n        cb()\n      })\n  })\n  const start = Date.now()\n  logger.debug('Starting download')\n  run(tasks, concurrency, (...args) => {\n    logger.info('Downloaded images in ' + (Date.now() - start) + 'ms')\n    if (missing.length) {\n      zipfile.addBuffer(\n        Buffer.from(missing.join('\\r\\n') + '\\r\\n'),\n        'missing.txt'\n      )\n    }\n    zipfile.end()\n  })\n\n  return zipfile.outputStream\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport { TextField, DialogContentText } from '@material-ui/core'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport fsWriteStreamAtomic from 'fs-write-stream-atomic'\nimport path from 'path'\nimport { remote } from 'electron'\nimport pump from 'pump'\n\nimport ViewWrapper from 'react-mapfilter/commonjs/ViewWrapper'\n\nimport logger from '../../../logger'\nimport createZip from '../../create-zip'\n\nconst msgs = defineMessages({\n  // Title for webmaps export dialog\n  title: 'Export a map to share online',\n  // Save button\n  save: 'Save',\n  // cancel button\n  cancel: 'Cancel',\n  // Label for field to enter map title\n  titleLabel: 'Map Title',\n  // Label for field to enter map description\n  descriptionLabel: 'Map Description',\n  // Label for field to enter terms and conditions\n  termsLabel: 'Terms & Limitations',\n  // Helper text explaining terms and conditions field\n  termsHint: 'Add terms & limitations about how this data can be used',\n  // Label for field to enter custom map style\n  styleLabel: 'Map Style'\n})\n\n// const defaultMapStyle = 'mapbox://styles/mapbox/outdoors-v11'\n\nconst EditDialogContent = ({\n  observations,\n  getPreset,\n  getMediaUrl,\n  onClose\n}) => {\n  const classes = useStyles()\n  const { formatMessage } = useIntl()\n  const [saving, setSaving] = useState()\n  const [title, setTitle] = useState()\n  const [description, setDescription] = useState()\n  // const [terms, setTerms] = useState()\n  // const [mapStyle, setMapStyle] = useState(defaultMapStyle)\n\n  const handleClose = () => {\n    setSaving(false)\n    setTitle(undefined)\n    setDescription(undefined)\n    // setTerms(undefined)\n    // setMapStyle(defaultMapStyle)\n    onClose()\n  }\n\n  const handleSave = e => {\n    e.preventDefault()\n    setSaving(true)\n    const points = observationsToGeoJson(observations, getPreset)\n    const metadata = { title: title || '', description: description || '' }\n\n    remote.dialog\n      .showSaveDialog({\n        title: 'Guardar Mapa',\n        defaultPath: 'mapa-para-web',\n        filters: [{ name: 'Mapeo Webmap Package', extensions: ['mapeomap'] }]\n      })\n      .then(({ filePath, canceled }) => {\n        if (canceled) return handleClose()\n        const filepathWithExtension = path.join(\n          path.dirname(filePath),\n          path.basename(filePath, '.mapeomap') + '.mapeomap'\n        )\n        createArchive(filepathWithExtension, err => {\n          if (err) {\n            logger.error('MapExportDialog: Failed to create archive', err)\n          } else {\n            logger.debug('Successfully created map archive')\n          }\n          handleClose()\n        })\n      })\n      .catch(handleClose)\n\n    function createArchive (filePath, cb) {\n      const output = fsWriteStreamAtomic(filePath)\n\n      const localFiles = [\n        {\n          data: JSON.stringify(points, null, 2),\n          metadataPath: 'points.json'\n        },\n        {\n          data: JSON.stringify(metadata, null, 2),\n          metadataPath: 'metadata.json'\n        }\n      ]\n\n      const remoteFiles = points.features\n        .filter(point => point.properties.image)\n        .map(point => ({\n          url: getMediaUrl(point.properties.image, 'original'),\n          metadataPath: 'images/' + point.properties.image\n        }))\n\n      const archive = createZip(localFiles, remoteFiles)\n\n      pump(archive, output, cb)\n    }\n  }\n\n  return (\n    <form noValidate autoComplete='off'>\n      <DialogTitle id='responsive-dialog-title' style={{ paddingBottom: 8 }}>\n        <FormattedMessage {...msgs.title} />\n      </DialogTitle>\n\n      <DialogContent className={classes.content}>\n        <DialogContentText>\n          {`Vas a exportar ${observations.length} puntos a un mapa para compartir por internet.`}\n        </DialogContentText>\n        <TextField\n          label={formatMessage(msgs.titleLabel)}\n          value={title}\n          fullWidth\n          variant='outlined'\n          onChange={e => setTitle(e.target.value)}\n          margin='normal'\n          disabled={saving}\n        />\n        <TextField\n          label={formatMessage(msgs.descriptionLabel)}\n          value={description}\n          fullWidth\n          rows={3}\n          rowsMax={6}\n          multiline\n          variant='outlined'\n          margin='normal'\n          disabled={saving}\n          onChange={e => setDescription(e.target.value)}\n        />\n        {/**\n            <TextField\n            label={formatMessage(msgs.termsLabel)}\n            helperText={formatMessage(msgs.termsHint)}\n            value={terms}\n            rows={2}\n            rowsMax={4}\n            fullWidth\n            multiline\n            variant='outlined'\n            margin='normal'\n            onChange={e => setTerms(e.target.value)}\n          />\n          <TextField\n            label={formatMessage(msgs.styleLabel)}\n            value={mapStyle}\n            helperText={\n              <>\n                Enter a{' '}\n                <a\n                  href='https://docs.mapbox.com/help/glossary/style-url/'\n                  target='_black'\n                  rel='noreferrer'\n                >\n                  Mapbox Style Url\n                </a>\n              </>\n            }\n            fullWidth\n            variant='outlined'\n            margin='normal'\n            onChange={e => setMapStyle(e.target.value)}\n          />\n          */}\n      </DialogContent>\n\n      <DialogActions>\n        <Button disabled={saving} onClick={handleClose}>\n          {formatMessage(msgs.cancel)}\n        </Button>\n        <Button\n          disabled={saving}\n          onClick={handleSave}\n          color='primary'\n          variant='contained'\n          type='submit'\n        >\n          {formatMessage(msgs.save)}\n        </Button>\n      </DialogActions>\n    </form>\n  )\n}\n\nexport default function EditDialog ({\n  observations,\n  presets,\n  filter,\n  getMediaUrl,\n  onClose,\n  open,\n  ...otherProps\n}) {\n  return (\n    <Dialog\n      fullWidth\n      open={open}\n      onClose={onClose}\n      scroll='body'\n      aria-labelledby='responsive-dialog-title'\n    >\n      {open && (\n        <ViewWrapper\n          observations={observations}\n          presets={presets}\n          filter={filter}\n          getMediaUrl={getMediaUrl}\n        >\n          {({ onClickObservation, filteredObservations, getPreset }) => (\n            <EditDialogContent\n              observations={filteredObservations}\n              getPreset={getPreset}\n              getMediaUrl={getMediaUrl}\n              onClose={onClose}\n              {...otherProps}\n            />\n          )}\n        </ViewWrapper>\n      )}\n    </Dialog>\n  )\n}\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    position: 'relative'\n  },\n  title: {\n    marginLeft: theme.spacing(2),\n    flex: 1\n  },\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingTop: 0\n  }\n}))\n\nfunction observationsToGeoJson (observations = [], getPreset) {\n  const features = observations.map(obs => {\n    const preset = getPreset(obs)\n    const title = preset ? preset.name : 'Observacin'\n    const description = obs.tags && (obs.tags.notes || obs.tags.note)\n    const date = obs.created_at\n    const image =\n      obs.attachments && obs.attachments.length > 0\n        ? obs.attachments[obs.attachments.length - 1].id\n        : undefined\n    const coords = obs.lon != null && obs.lat != null && [obs.lon, obs.lat]\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: coords\n      },\n      properties: {\n        title,\n        description,\n        date,\n        image\n      }\n    }\n  })\n  return {\n    type: 'FeatureCollection',\n    features\n  }\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport { DialogContentText } from '@material-ui/core'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Select from '@material-ui/core/Select'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport { csvFormat } from 'd3-dsv'\nimport ViewWrapper from 'react-mapfilter/commonjs/ViewWrapper'\nimport flatten from 'flat'\nimport isodate from '@segment/isodate'\nimport { fromLatLon } from 'utm'\nimport { remote } from 'electron'\nimport path from 'path'\nimport fs from 'fs'\nimport fsWriteStreamAtomic from 'fs-write-stream-atomic'\nimport pump from 'pump'\n\nimport logger from '../../../logger'\nimport createZip from '../../create-zip'\n\nconst msgs = defineMessages({\n  // Title for webmaps export dialog\n  title: 'Export Observations',\n  // Save button\n  save: 'Save',\n  // Close button (shown if user has no data to export)\n  close: 'Close',\n  // cancel button\n  cancel: 'Cancel',\n  // Label for data format selector\n  format: 'Data format',\n  // Label for select to export all data or only filtered\n  filteredOrAll: 'Only filtered data or all data?',\n  exportAll: 'All {count} observations',\n  exportFiltered: '{count} filtered observations',\n  // Shown when there is no data to export\n  noData: \"You don't yet have any data to export.\",\n  // Label for select to include photos in export\n  includePhotos: 'Also export photos?',\n  // Hint shown when user has selected photos to be included in the export\n  includePhotosHint: 'Export will be a zip file including data and photos',\n  // Label for select option to include no photos in export\n  includePhotosNone: 'No Photos',\n  // Label for select option to include full size photos in export\n  includePhotosOriginal: 'Full size photos',\n  // Label for select option to include preview size photos in export\n  includePhotosPreview: 'Preview size photos',\n  // Default filename for exported data\n  defaultExportFilename: 'mapeo-observation-data'\n})\n\nconst ExportDialogContent = ({\n  filteredObservations = [],\n  allObservations = [],\n  getPreset,\n  getMediaUrl,\n  onClose\n}) => {\n  const classes = useStyles()\n  const [saving, setSaving] = useState()\n  const { formatMessage: t } = useIntl()\n  const isFiltered = allObservations.length !== filteredObservations.length\n  const [values, setValues] = React.useState({\n    format: 'geojson',\n    include: isFiltered && filteredObservations.length ? 'filtered' : 'all',\n    photos: 'none'\n  })\n\n  const handleChange = key => event => {\n    setValues(values => ({ ...values, [key]: event.target.value }))\n  }\n\n  const handleClose = () => {\n    setSaving(false)\n    onClose()\n  }\n\n  const handleSave = e => {\n    e.preventDefault()\n    setSaving(true)\n\n    const observationsToSave =\n      values.include === 'all' ? allObservations : filteredObservations\n\n    let exportData\n    let ext = values.format\n    switch (values.format) {\n      case 'geojson':\n        exportData = observationsToGeoJson(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n      case 'csv':\n        exportData = observationsToCsv(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n      case 'smart':\n        ext = 'csv'\n        exportData = observationsToSmartCsv(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n    }\n\n    const saveExt = values.photos === 'none' ? ext : 'zip'\n    remote.dialog\n      .showSaveDialog({\n        title: t(msgs.title),\n        defaultPath: t(msgs.defaultExportFilename) + '.' + saveExt,\n        filters: [{ name: saveExt + ' files', extensions: [saveExt] }]\n      })\n      .then(({ canceled, filePath }) => {\n        if (canceled) return handleClose()\n        const filepathWithExtension = path.join(\n          path.dirname(filePath),\n          path.basename(filePath, '.' + saveExt) + '.' + saveExt\n        )\n        onSelectFile(filepathWithExtension)\n      })\n\n    function onSelectFile (filePath) {\n      if (values.photos === 'none') {\n        fs.writeFile(filePath, exportData, err => {\n          if (err) logger.error('DataExportDialog: onSelectFile', err)\n          handleClose()\n        })\n        return\n      }\n\n      const photosToSave = []\n      observationsToSave.forEach(o => {\n        ;(o.attachments || []).forEach(a => {\n          if (!photosToSave.includes(a.id)) photosToSave.push(a.id)\n        })\n      })\n\n      const localFiles = [\n        {\n          data: exportData,\n          metadataPath: t(msgs.defaultExportFilename) + '.' + ext\n        }\n      ]\n      const remoteFiles = photosToSave.map(id => ({\n        url: getMediaUrl(id, values.photos),\n        metadataPath: 'images/' + id\n      }))\n      const output = fsWriteStreamAtomic(filePath)\n      const archive = createZip(localFiles, remoteFiles)\n\n      pump(archive, output, err => {\n        if (err) logger.error('DataExportDialog: pump create zip', err)\n        handleClose()\n      })\n    }\n  }\n\n  const noData = allObservations.length === 0\n\n  return (\n    <form noValidate autoComplete='off'>\n      <DialogTitle id='responsive-dialog-title' style={{ paddingBottom: 8 }}>\n        <FormattedMessage {...msgs.title} />\n      </DialogTitle>\n\n      <DialogContent className={classes.content}>\n        {noData ? (\n          <DialogContentText>\n            <FormattedMessage {...msgs.noData} />\n          </DialogContentText>\n        ) : (\n          <>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-format-label'>\n                <FormattedMessage {...msgs.format} />\n              </InputLabel>\n              <Select\n                labelId='select-format-label'\n                id='select-format'\n                value={values.format}\n                onChange={handleChange('format')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='geojson'>GeoJSON</MenuItem>\n                <MenuItem value='csv'>CSV</MenuItem>\n                <MenuItem value='smart'>Smart CSV</MenuItem>\n              </Select>\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-include-label'>\n                <FormattedMessage {...msgs.filteredOrAll} />\n              </InputLabel>\n              <Select\n                labelId='select-include-label'\n                id='select-include'\n                value={values.include}\n                onChange={handleChange('include')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='all'>\n                  <FormattedMessage\n                    {...msgs.exportAll}\n                    values={{ count: allObservations.length }}\n                  />\n                </MenuItem>\n                <MenuItem\n                  value='filtered'\n                  disabled={!isFiltered || !filteredObservations.length}\n                >\n                  <FormattedMessage\n                    {...msgs.exportFiltered}\n                    values={{\n                      count: isFiltered ? filteredObservations.length : 0\n                    }}\n                  />\n                </MenuItem>\n              </Select>\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-photos-label'>\n                <FormattedMessage {...msgs.includePhotos} />\n              </InputLabel>\n              <Select\n                labelId='select-photos-label'\n                id='select-photos'\n                value={values.photos}\n                onChange={handleChange('photos')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='none'>\n                  <FormattedMessage {...msgs.includePhotosNone} />\n                </MenuItem>\n                <MenuItem value='original'>\n                  <FormattedMessage {...msgs.includePhotosOriginal} />\n                </MenuItem>\n                <MenuItem value='preview'>\n                  <FormattedMessage {...msgs.includePhotosPreview} />\n                </MenuItem>\n              </Select>\n              {values.photos !== 'none' && (\n                <FormHelperText>\n                  <FormattedMessage {...msgs.includePhotosHint} />\n                </FormHelperText>\n              )}\n            </FormControl>\n          </>\n        )}\n      </DialogContent>\n\n      <DialogActions>\n        {noData ? (\n          <Button\n            onClick={handleClose}\n            color='primary'\n            variant='contained'\n            type='submit'\n          >\n            <FormattedMessage {...msgs.close} />\n          </Button>\n        ) : (\n          <>\n            <Button disabled={saving} onClick={handleClose}>\n              <FormattedMessage {...msgs.cancel} />\n            </Button>\n            <Button\n              disabled={saving}\n              onClick={handleSave}\n              color='primary'\n              variant='contained'\n              type='submit'\n            >\n              <FormattedMessage {...msgs.save} />\n            </Button>\n          </>\n        )}\n      </DialogActions>\n    </form>\n  )\n}\n\nexport default function DataExportDialog ({\n  observations,\n  presets,\n  filter,\n  getMediaUrl,\n  onClose,\n  open,\n  ...otherProps\n}) {\n  return (\n    <Dialog\n      fullWidth\n      open={open}\n      onClose={onClose}\n      scroll='body'\n      aria-labelledby='responsive-dialog-title'\n    >\n      {open && (\n        <ViewWrapper\n          observations={observations}\n          presets={presets}\n          filter={filter}\n          getMediaUrl={getMediaUrl}\n        >\n          {({ filteredObservations, getPreset }) => (\n            <ExportDialogContent\n              filteredObservations={filteredObservations}\n              allObservations={observations}\n              getPreset={getPreset}\n              getMediaUrl={getMediaUrl}\n              onClose={onClose}\n              {...otherProps}\n            />\n          )}\n        </ViewWrapper>\n      )}\n    </Dialog>\n  )\n}\n\nfunction observationsToGeoJson (obs, { photos } = {}) {\n  const features = obs.map(o => {\n    const feature = {\n      type: 'Feature',\n      geometry:\n        o.lat == null || o.lon == null\n          ? null\n          : {\n              type: 'Point',\n              coordinates: [o.lon, o.lat]\n            },\n      id: o.id,\n      properties: {\n        ...o.tags,\n        $created: o.created_at,\n        $modified: o.timestamp,\n        $version: o.version\n      }\n    }\n    if (photos && o.attachments && o.attachments.length) {\n      feature.properties.$photos = o.attachments.map(a => a.id)\n    }\n    return feature\n  })\n\n  return JSON.stringify(\n    {\n      type: 'FeatureCollection',\n      features\n    },\n    null,\n    2\n  )\n}\n\nfunction observationsToCsv (obs, { photos } = {}) {\n  const allKeys = {}\n  const rows = obs.map(o => {\n    const flattenedTags = flatten(o.tags)\n    const parsedTags = {}\n\n    Object.keys(flattenedTags).forEach(key => {\n      const value = flattenedTags[key]\n      // Remove unparsed objects (empty objects) from tags\n      if (typeof value === 'object') return\n      if (\n        !(value == null || (typeof value === 'string' && value.length === 0))\n      ) {\n        // Only export columns for non-empty values\n        allKeys[key] = true\n      }\n      if (typeof value === 'string' && isodate.is(value)) {\n        // Convert ISO dates to a format that Excel can recognize in a CSV\n        parsedTags[key] = formatCsvDatetime(value)\n      } else {\n        parsedTags[key] = value\n      }\n    })\n\n    const hasLocation = o.lat != null && o.lon != null\n    const { easting, northing, zoneNum, zoneLetter } = hasLocation\n      ? fromLatLon(o.lat, o.lon)\n      : {}\n    const locationData = hasLocation && {\n      // Round coordinates to 1cm precision\n      $lon: round(o.lon, 7),\n      $lat: round(o.lat, 7),\n      $utmX: round(easting, 2),\n      $utmY: round(northing, 2),\n      $utmZone: zoneNum && zoneLetter ? zoneNum + zoneLetter : null\n    }\n    const $photos =\n      photos && o.attachments && o.attachments.length\n        ? o.attachments.map(a => a.id).join(',')\n        : null\n\n    return {\n      ...parsedTags,\n      $id: o.id,\n      $created: formatCsvDatetime(o.created_at),\n      $modified: o.timestamp && formatCsvDatetime(o.timestamp),\n      $version: o.version,\n      $photos,\n      ...locationData\n    }\n  })\n\n  // We do this to order the columns of the CSV, otherwise csvFormat column\n  // order is non-deterministic\n  const columns = [\n    '$id',\n    '$created',\n    '$modified',\n    '$lon',\n    '$lat',\n    '$utmX',\n    '$utmY',\n    '$utmZone',\n    '$photos'\n  ].concat(Object.keys(allKeys).sort(), '$version')\n\n  return csvFormat(rows, columns)\n}\n\nfunction observationsToSmartCsv (obs, { photos } = {}) {\n  const rows = obs.map((o, i) => {\n    const locationData =\n      o.lat != null && o.lon != null ? { X: o.lon, Y: o.lat } : {}\n    const PHOTOS =\n      photos && o.attachments && o.attachments.length\n        ? o.attachments.map(a => a.id).join(',')\n        : null\n\n    return {\n      ID: i + 1,\n      MAPEO_ID: o.id,\n      DATE: formatCsvDate(o.created_at),\n      TIME: formatCsvTime(o.created_at),\n      COMMENT: o.tags.notes || o.tags.note,\n      PHOTOS,\n      ...locationData\n    }\n  })\n\n  // We do this to order the columns of the CSV, otherwise csvFormat column\n  // order is non-deterministic\n  const columns = 'ID,X,Y,DATE,TIME,COMMENT,PHOTOS,MAPEO_ID'.split(',')\n\n  return csvFormat(rows, columns)\n}\n\nfunction round (num, dp = 0) {\n  const factor = Math.pow(10, dp)\n  return Math.round(num * factor) / factor\n}\n\nfunction formatCsvDatetime (isoDateString) {\n  return formatCsvDate(isoDateString) + ' ' + formatCsvTime(isoDateString)\n}\n\nfunction formatCsvDate (isoDateString) {\n  const date = new Date(isoDateString)\n  const YYYY = date.getFullYear()\n  const MM = leftPad(date.getMonth() + 1, 2)\n  const DD = leftPad(date.getDate(), 2)\n  return `${YYYY}-${MM}-${DD}`\n}\n\nfunction formatCsvTime (isoDateString) {\n  const date = new Date(isoDateString)\n  const hh = leftPad(date.getHours(), 2)\n  const mm = leftPad(date.getMinutes(), 2)\n  const ss = leftPad(date.getSeconds(), 2)\n  return `${hh}:${mm}:${ss}`\n}\n\nfunction leftPad (num, len, char = 0) {\n  const str = num + ''\n  // doesn't need to pad\n  len = len - str.length\n  if (len <= 0) return str\n\n  var pad = ''\n  while (true) {\n    if (len & 1) pad += char\n    len >>= 1\n    if (len) char += char\n    else break\n  }\n  return pad + str\n}\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    position: 'relative'\n  },\n  title: {\n    marginLeft: theme.spacing(2),\n    flex: 1\n  },\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingTop: 0\n  },\n  formControl: {\n    marginBottom: theme.spacing(2),\n    '&:not(:last-child)': {\n      marginBottom: theme.spacing(4)\n    }\n  },\n  select: {\n    fontFamily: theme.typography.body1.fontFamily\n  }\n}))\n","import React from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport ExportIcon from '@material-ui/icons/MoreVert'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nconst m = defineMessages({\n  exportButton: 'Export Observation Data',\n  exportMap: 'Export Webmap',\n  exportData: 'Export Observations'\n})\n\nconst ExportButton = ({ onExport }) => {\n  const { formatMessage: t } = useIntl()\n  const [menuAnchor, setMenuAnchor] = React.useState(null)\n\n  const handleExportClick = event => {\n    setMenuAnchor(event.currentTarget)\n  }\n\n  const handleMenuItemClick = id => () => {\n    setMenuAnchor(null)\n    if (id) onExport(id)\n  }\n\n  return (\n    <>\n      <Tooltip title={t(m.exportButton)}>\n        <IconButton\n          aria-label='export'\n          color='inherit'\n          onClick={handleExportClick}\n          aria-controls='export-menu'\n          aria-haspopup='true'\n        >\n          <ExportIcon />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        id='export-menu'\n        anchorEl={menuAnchor}\n        open={Boolean(menuAnchor)}\n        onClose={handleMenuItemClick(null)}\n      >\n        <MenuItem onClick={handleMenuItemClick('map')}>\n          <FormattedMessage {...m.exportMap} />\n        </MenuItem>\n        <MenuItem onClick={handleMenuItemClick('data')}>\n          <FormattedMessage {...m.exportData} />\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nexport default ExportButton\n","import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport MapView from './MapView'\nimport ReportView from './ReportView'\nimport MediaView from './MediaView'\nimport { ipcRenderer } from 'electron'\nimport debounce from 'lodash/debounce'\nimport { defineMessages, FormattedMessage } from 'react-intl'\nimport mapboxgl from 'mapbox-gl'\nimport ErrorBoundary from 'react-error-boundary'\nimport { Typography } from '@material-ui/core'\n\nimport logger from '../../../logger'\nimport Toolbar from './Toolbar'\nimport FilterPanel from './FilterPanel'\nimport Loading from './Loading'\nimport MapStyleProvider from './MapStyleProvider'\nimport api from '../../new-api'\nimport MapExportDialog from './MapExportDialog'\nimport DataExportDialog from './DataExportDialog'\nimport ExportButton from './ExportButton'\n\nconst m = defineMessages({\n  errorTitle: 'Oh dear! An error has occurred',\n  errorDescription:\n    'The details below will be useful for finding a way to fix this'\n})\n\n// This is very strange. Something to do with the bundling is stopping this\n// being set from within the react-mapbox-gl library. We need to set this here\n// to force mapbox to understand the accessToken is set\nconst MAPBOX_ACCESS_TOKEN = (mapboxgl.accessToken =\n  'pk.eyJ1IjoiZ21hY2xlbm5hbiIsImEiOiJSaWVtd2lRIn0.ASYMZE2HhwkAw4Vt7SavEg')\n\n/**\n * Using normal state for this causes performance issues because it causes React\n * to re-render. Using a ref allows us to store position between tabs without re-renders\n */\nfunction usePositionRef () {\n  const key = 'mapFilterPosition'\n  const savedPosition = useMemo(() => {\n    try {\n      const item = window.localStorage.getItem(key)\n      return JSON.parse(item)\n    } catch (e) {}\n  }, [])\n\n  const position = useRef(savedPosition)\n\n  const persistPosition = useMemo(\n    () =>\n      debounce(() => {\n        if (!position.current) return\n        const item = JSON.stringify(position.current)\n        window.localStorage.setItem(key, item)\n      }, 500),\n    []\n  )\n\n  const setPosition = useCallback(\n    pos => {\n      position.current = pos\n      persistPosition()\n    },\n    [persistPosition]\n  )\n\n  return useMemo(() => [position, setPosition], [setPosition])\n}\n\nconst MyFallbackComponent = ({ componentStack, error }) => {\n  const cx = useStyles()\n  return (\n    <div className={cx.errorFallback}>\n      <Typography variant='h4' component='h1'>\n        <FormattedMessage {...m.errorTitle} />\n      </Typography>\n      <Typography>\n        <FormattedMessage {...m.errorDescription} />\n      </Typography>\n      <br />\n      <Typography variant='h6' component='h2'>\n        Error:\n      </Typography>\n      <Typography>{error.toString()}</Typography>\n      <Typography variant='h6' component='h2'>\n        Stacktrace:\n      </Typography>\n      <pre>{componentStack}</pre>\n    </div>\n  )\n}\n\nconst FilterView = ({ view, ...props }) => {\n  const cx = useStyles()\n  const mapRef = useRef()\n\n  useEffect(() => {\n    function zoomToData (_, loc) {\n      if (!mapRef.current || typeof mapRef.current.flyTo !== 'function') return\n      mapRef.current.flyTo({\n        center: loc,\n        zoom: 14\n      })\n    }\n    ipcRenderer.on('zoom-to-data-observation', zoomToData)\n    return () => {\n      ipcRenderer.removeListener('zoom-to-data-observation', zoomToData)\n    }\n  }, [])\n\n  return (\n    <div className={cx.viewWrapper}>\n      <ErrorBoundary FallbackComponent={MyFallbackComponent}>\n        {view === 'report' ? (\n          <ReportView {...props} />\n        ) : view === 'media' ? (\n          <MediaView {...props} />\n        ) : (\n          <MapView ref={mapRef} {...props} />\n        )}\n      </ErrorBoundary>\n    </div>\n  )\n}\n\nfunction usePresets () {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState()\n  const [presets, setPresets] = useState([])\n  const [fields, setFields] = useState([])\n\n  useEffect(() => {\n    async function getPresets () {\n      try {\n        const data = await api.getPresets()\n        const presets = mapToArray(data.presets)\n        const fields = mapToArray(data.fields)\n        const presetsWithFields = presets\n          .filter(p => p.geometry.includes('point'))\n          // Replace field ids with full field definitions\n          .map(p => addFieldDefinitions(p, fields))\n        setLoading(false)\n        setPresets(presetsWithFields)\n        setFields(fields)\n      } catch (e) {\n        logger.error('MapFilter get Presets', e)\n        setLoading(false)\n        setError(e)\n      }\n    }\n    getPresets()\n  }, [])\n\n  return useMemo(() => ({ presets, fields, error, loading }), [\n    presets,\n    fields,\n    error,\n    loading\n  ])\n}\n\nfunction useObservations () {\n  const isMounted = useRef(true)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState()\n  const [observations, setObservations] = useState([])\n\n  const updateObservation = useCallback(\n    observation => {\n      api\n        .updateObservation(observation.id, observation)\n        .then(obs => {\n          const index = observations.findIndex(o => o.id === obs.id)\n          const updatedObservations =\n            index > -1\n              ? [\n                  ...observations.slice(0, index),\n                  obs,\n                  ...observations.slice(index + 1)\n                ]\n              : [...observations, obs]\n          setObservations(updatedObservations)\n        })\n        .catch(err => {\n          logger.error('error updating observations', err)\n        })\n    },\n    [observations]\n  )\n\n  const deleteObservation = useCallback(\n    id => {\n      api\n        .deleteObservation(id)\n        .then(() => {\n          const index = observations.findIndex(o => o.id === id)\n          if (index === -1) throw new Error('Observation not found')\n          const updatedObservations = [\n            ...observations.slice(0, index),\n            ...observations.slice(index + 1)\n          ]\n          setObservations(updatedObservations)\n        })\n        .catch(err => {\n          logger.error('error deleting observation', err)\n        })\n    },\n    [observations]\n  )\n\n  function loadObservations () {\n    api\n      .getObservations()\n      .then(obs => {\n        if (!isMounted.current) return\n        setObservations(obs)\n        setLoading(false)\n      })\n      .catch(err => {\n        if (!isMounted.current) return\n        setError(err)\n        setLoading(false)\n      })\n  }\n\n  useEffect(() => {\n    const subscription = api.addDataChangedListener('territory-edit', () => {\n      loadObservations()\n    })\n    return () => {\n      subscription.remove()\n    }\n  }, [])\n\n  useEffect(() => {\n    loadObservations()\n    return () => (isMounted.current = false)\n  }, [])\n\n  return useMemo(\n    () => [\n      { loading, error, observations },\n      { updateObservation, deleteObservation }\n    ],\n    [loading, error, observations, updateObservation, deleteObservation]\n  )\n}\n\nconst MapFilter = () => {\n  const cx = useStyles()\n  const [view, setView] = useState('map')\n  const [filter, setFilter] = useState(null)\n  const [position, setPosition] = usePositionRef()\n  const [dialog, setDialog] = useState(null)\n\n  const [\n    { observationsLoading, observationsError, observations },\n    { updateObservation, deleteObservation }\n  ] = useObservations()\n  const {\n    presets,\n    fields,\n    error: presetsError,\n    loading: presetsLoading\n  } = usePresets()\n\n  if (observationsLoading || presetsLoading) {\n    return (\n      <div className={cx.root}>\n        <Loading />\n      </div>\n    )\n  }\n\n  if (observationsError) logger.error('observationsError', observationsError)\n  if (presetsError) logger.error('presetsError', presetsError)\n\n  return (\n    <div className={cx.root}>\n      <FilterPanel\n        observations={observations}\n        filter={filter}\n        onChangeFilter={setFilter}\n        presets={presets}\n        fields={fields}\n      />\n      <div className={cx.right}>\n        <Toolbar\n          view={view}\n          onChange={setView}\n          actionRight={<ExportButton onExport={setDialog} />}\n        />\n        <MapStyleProvider>\n          {styleUrl => (\n            <FilterView\n              view={view}\n              filter={filter}\n              observations={observations}\n              presets={presets}\n              onUpdateObservation={updateObservation}\n              onDeleteObservation={deleteObservation}\n              getMediaUrl={api.getMediaUrl}\n              getIconUrl={api.getIconUrl}\n              mapStyle={styleUrl}\n              mapboxAccessToken={MAPBOX_ACCESS_TOKEN}\n              onMapMove={setPosition}\n              initialMapPosition={\n                position.current == null ? undefined : position.current\n              }\n            />\n          )}\n        </MapStyleProvider>\n      </div>\n      <MapExportDialog\n        open={dialog === 'map'}\n        onClose={() => setDialog(null)}\n        observations={observations}\n        filter={filter}\n        presets={presets}\n        getMediaUrl={api.getMediaUrl}\n      />\n      <DataExportDialog\n        open={dialog === 'data'}\n        onClose={() => setDialog(null)}\n        observations={observations}\n        filter={filter}\n        presets={presets}\n        getMediaUrl={api.getMediaUrl}\n      />\n    </div>\n  )\n}\n\nexport default MapFilter\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    width: '100%',\n    height: '100%',\n    flexDirection: 'row',\n    backgroundColor: '#F5F5F5',\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  },\n  right: {\n    display: 'flex',\n    flexDirection: 'column',\n    flex: 1,\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  },\n  errorFallback: {\n    backgroundColor: '#C00',\n    color: '#FFF',\n    padding: 10\n  },\n  viewWrapper: {\n    position: 'relative',\n    flex: 1,\n    display: 'flex'\n  }\n}))\n\nfunction addFieldDefinitions (preset, fields) {\n  const fieldDefs = Array.isArray(preset.fields)\n    ? preset.fields.map(fieldId => fields.find(field => field.id === fieldId))\n    : []\n  return {\n    ...preset,\n    fields: fieldDefs.filter(Boolean)\n  }\n}\n\nfunction mapToArray (map) {\n  return Object.keys(map).map(id => ({\n    ...map[id],\n    id: id\n  }))\n}\n","import { useState, useEffect } from 'react'\nimport store from '../../store'\n\nconst createPersistedState = key =>\n  function usePersistedState (initialState) {\n    const [state, setState] = useState(() =>\n      store.get(\n        key,\n        typeof initialState === 'function' ? initialState() : initialState\n      )\n    )\n\n    // Only persist to storage if state changes.\n    useEffect(\n      () => {\n        // persist to storage\n        store.set(key, state)\n      },\n      [state]\n    )\n\n    return [state, setState]\n  }\n\nexport default createPersistedState\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { defineMessages, useIntl } from 'react-intl'\nimport { Typography } from '@material-ui/core'\n\nimport Loader from '../Loader'\n\nconst m = defineMessages({\n  // Title on sync screen when searching for devices\n  searchingTitle: 'Searching',\n  // Hint on sync screen when searching on wifi for devices\n  searchingHint:\n    'Make sure devices are turned on and connected to the same wifi network'\n})\n\nconst Searching = () => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingWrapper}>\n      <div className={cx.searching}>\n        <Loader />\n        <div className={cx.searchingText}>\n          <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n            {t(m.searchingTitle)}\n          </Typography>\n\n          <Typography>{t(m.searchingHint)}</Typography>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Searching\n\nconst useStyles = makeStyles(theme => ({\n  searchingText: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  searchingWrapper: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  searching: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  searchingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  }\n}))\n","import React, { useEffect, useState } from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Wifi, WifiOff } from '@material-ui/icons'\nimport { defineMessages, useIntl } from 'react-intl'\nimport wifi from 'node-wifi'\nimport { Tooltip } from '@material-ui/core'\n\nimport logger from '../../../logger'\n\nlet wifiInit = true\ntry {\n  wifi.init()\n} catch (e) {\n  logger.error('Failed to init node-wifi', e)\n  wifiInit = false\n}\n\nconst getQualityStyle = (connection) => {\n  if (connection.quality < 30) return { color: 'white', backgroundColor: 'red' }\n  if (connection.quality < 60) return { color: 'white', backgroundColor: 'orange' }\n  return { backgroundColor: '#E0E0E0' }\n}\n\nconst getWifiConnectionMessage = (connection) => {\n  if (connection.quality < 30) return m.qualityTooltipPoor\n  if (connection.quality < 60) return m.qualityTooltipWeak\n  return m.qualityTooltipAdequate\n}\n\nconst m = defineMessages({\n  // Title of sync screen\n  title: 'Available Devices',\n  disconnected: 'Disconnected',\n  disconnectedTooltip:\n    'You first need to connect to a WiFi network before being able to synchronize devices',\n  wifiError: 'Unknown',\n  wifiErrorTooltip: 'Your WiFi card or Operating System (OS) has not been recognized',\n  qualityTooltipPoor:\n    'The connection signal is very poor. Try getting closer to the WiFi router',\n  qualityTooltipWeak:\n    'The connection signal is weak. The synchronization might take a longer time to complete',\n  qualityTooltipAdequate: 'The connection signal is excellent',\n  quality: 'Quality: {quality}%',\n  // Button to sync from an existing sync file\n  selectSyncfile: 'Sync from a file',\n  // Button to create a new sync file\n  newSyncfile: 'Create new syncfile'\n})\nconst SyncAppBar = ({ onClickSelectSyncfile, onClickNewSyncfile }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  const [currentConnection, setCurrentConnection] = useState(null)\n  const [wifiError, setWifiError] = useState(!wifiInit)\n\n  // Check connection every 2 seconds\n  useEffect(() => {\n    const check = async () => {\n      try {\n        const conn = await wifi.getCurrentConnections()\n        setCurrentConnection(conn && conn[0])\n      } catch (err) {\n        logger.error('SyncAppBar failed to get current connections', err)\n        setWifiError(true)\n        setCurrentConnection(null)\n      }\n    }\n\n    // Run initial check, then refresh it every 2 seconds\n    check()\n    const intervalCheck = setInterval(check, 2000)\n    return () => clearInterval(intervalCheck)\n  }, [])\n\n  return (\n    <AppBar position='static' color='default' elevation={0} className={cx.root}>\n      <Toolbar>\n        <div className={cx.titleBar}>\n          <Typography variant='h6' component='h1' className={cx.title}>\n            {t(m.title)}\n          </Typography>\n\n          {currentConnection ? (\n            <Tooltip title={t(getWifiConnectionMessage(currentConnection))}>\n              <span className={cx.wifi}>\n                <Wifi className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {currentConnection.ssid}\n                </Typography>\n                <Typography\n                  variant='overline'\n                  component='span'\n                  className={cx.wifiQuality}\n                  style={getQualityStyle(currentConnection)}\n                >\n                  {t(m.quality, {\n                    quality: Math.min(100, currentConnection.quality).toFixed(0)\n                  })}\n                </Typography>\n              </span>\n            </Tooltip>\n          ) : !wifiError ? (\n            <Tooltip title={t(m.disconnectedTooltip)}>\n              <span className={cx.wifi}>\n                <WifiOff className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {t(m.disconnected)}\n                </Typography>\n              </span>\n            </Tooltip>\n          ) : (\n            <Tooltip title={t(m.wifiErrorTooltip)}>\n              <span className={cx.wifi}>\n                <WifiOff className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {t(m.wifiError)}\n                </Typography>\n              </span>\n            </Tooltip>\n          )}\n        </div>\n        <Button\n          onClick={onClickSelectSyncfile}\n          color='inherit'\n          variant='outlined'\n          className={cx.button}\n        >\n          {t(m.selectSyncfile)}\n        </Button>\n        <Button\n          onClick={onClickNewSyncfile}\n          color='inherit'\n          variant='outlined'\n          className={cx.button}\n        >\n          {t(m.newSyncfile)}\n        </Button>\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nexport default SyncAppBar\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    backgroundColor: 'white'\n  },\n  titleBar: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start'\n  },\n  title: {\n    lineHeight: 1.2\n  },\n  wifi: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  wifiIcon: {\n    fontSize: '1rem',\n    position: 'relative',\n    top: -1 // visual alignment\n  },\n  wifiName: {\n    lineHeight: 1.2,\n    marginLeft: 5\n  },\n  wifiQuality: {\n    lineHeight: 1.2,\n    marginLeft: 5,\n    fontWeight: 500,\n    padding: '1px 5px',\n    borderRadius: 1000\n  },\n  actionArea: {},\n  button: {\n    marginLeft: theme.spacing(2),\n    textTransform: 'none'\n  }\n}))\n","import React, { useState, useEffect } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport DoneIcon from '@material-ui/icons/Check'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faBolt } from '@fortawesome/free-solid-svg-icons'\nimport styled from 'styled-components'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Button from '@material-ui/core/Button'\nimport { useIntl, defineMessages } from 'react-intl'\n\nconst m = defineMessages({\n  // Button to sync a device\n  sync: 'Synchronize',\n  // Displayed when sync is starting\n  starting: 'Starting',\n  // Button when sync is complete\n  complete: 'Complete',\n  // Button to retry sync after error\n  retry: 'Retry',\n  // Disconnected\n  disconnected: 'Disconnected',\n  // Almost done! But progress is inaccurate.\n  finishing: 'Finishing'\n})\n\nconst SyncIcon = props => <FontAwesomeIcon icon={faBolt} {...props} />\n\nconst ProgressBackground = styled.div`\n  width: 32px;\n  height: 32px;\n  border-radius: 16px;\n  margin-left: 16px;\n  background-color: #c1c1c1;\n  align-items: center;\n  justify-content: center;\n  display: flex;\n`\n\nconst ProgressIcon = ({ progress }) => {\n  const [awaitingCompletion, setAwaitingCompletion] = useState(false)\n  const cx = useStyles()\n  // After 3 seconds of being frozen at 100%, show an indeterminate spinner -->\n  // give the user something to hope for (it should complete eventually)\n  useEffect(\n    () => {\n      if (Math.round(progress * 100) < 100) return\n      const timeoutId = setTimeout(() => setAwaitingCompletion(true), 3000)\n      return () => clearTimeout(timeoutId)\n    },\n    [progress]\n  )\n\n  return (\n    <ProgressBackground>\n      <CircularProgress\n        variant={progress && !awaitingCompletion ? 'static' : 'indeterminate'}\n        value={progress * 100}\n        color='inherit'\n        size={32}\n        thickness={5}\n        className={cx.progressCircle}\n      />\n    </ProgressBackground>\n  )\n}\n\nconst StyledButton = ({ className, ...props }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      variant='contained'\n      size='large'\n      className={className + ' ' + classes.button}\n      color='primary'\n      {...props}\n    />\n  )\n}\n\nconst SyncButton = ({ progress, connected, onClick, variant = 'ready' }) => {\n  const classes = useStyles()\n  const { formatMessage: t } = useIntl()\n  switch (variant) {\n    case 'ready':\n    case 'error':\n      return (\n        <StyledButton disabled={!connected} onClick={onClick}>\n          {!connected ? t(m.disconnected)\n            : variant === 'ready' ? t(m.sync) : t(m.retry)}\n          <SyncIcon className={classes.icon} />\n        </StyledButton>\n      )\n    case 'progress':\n      return (\n        <StyledButton disabled onClick={onClick} className={classes.progress}>\n          {!progress\n            ? t(m.starting)\n            : progress === 1\n              ? t(m.finishing)\n              : (progress * 100).toFixed(0) + '%'}\n          <ProgressIcon progress={progress} className={classes.icon} />\n        </StyledButton>\n      )\n\n    case 'complete':\n      return (\n        <StyledButton disabled={!connected} onClick={onClick}>\n          {t(m.complete)}\n          <DoneIcon className={classes.icon} />\n        </StyledButton>\n      )\n  }\n}\n\nexport default SyncButton\n\nconst useStyles = makeStyles(theme => ({\n  icon: {\n    marginLeft: theme.spacing(2)\n  },\n  button: {\n    minHeight: 48,\n    justifyContent: 'space-between'\n  },\n  progress: {\n    minWidth: 150,\n    fontVariantNumeric: 'tabular-nums',\n    fontWeight: 600\n  },\n  progressCircle: {\n    '& .MuiCircularProgress-circleStatic': {\n      transitionDuration: '50ms'\n    }\n  }\n}))\n","import React from 'react'\nimport { FormattedDate, FormattedRelativeTime } from 'react-intl'\n\n// We use relative dates for anything within the last 7 days, and then absolute\n// dates for anything else.\nconst USE_WORDS_WITHIN_SECONDS = 4 * 24 * 60 * 60 // 4 days\nconst MINUTE = 60\nconst HOUR = 60 * 60\nconst DAY = 60 * 60 * 24\n\nconst DateDistance = ({ date = new Date(), style }) => {\n  // Round distance to nearest 10 seconds\n  const distanceInSeconds = Math.floor((Date.now() - date) / 10000) * 10\n\n  const absValue = Math.abs(distanceInSeconds)\n\n  if (absValue > USE_WORDS_WITHIN_SECONDS) {\n    return (\n      <FormattedDate\n        value={date}\n        day='numeric'\n        month='long'\n        year='numeric'\n        hour='2-digit'\n        minute='2-digit'\n      />\n    )\n  } else if (absValue < MINUTE) {\n    return (\n      <FormattedRelativeTime\n        value={-distanceInSeconds}\n        numeric='auto'\n        updateIntervalInSeconds={5}\n      />\n    )\n  } else if (absValue < HOUR) {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / MINUTE)}\n        unit='minute'\n        updateIntervalInSeconds={30}\n      />\n    )\n  } else if (absValue < DAY) {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / HOUR)}\n        unit='hour'\n      />\n    )\n  } else {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / DAY)}\n        unit='day'\n      />\n    )\n  }\n}\n\nexport default DateDistance\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PhoneIcon from '@material-ui/icons/PhoneAndroid'\nimport LaptopIcon from '@material-ui/icons/Laptop'\nimport FileIcon from '@material-ui/icons/Usb'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport Paper from '@material-ui/core/Paper'\nimport { Typography } from '@material-ui/core'\nimport SyncButton from './SyncButton'\nimport DateDistance from '../DateDistance'\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst m = defineMessages({\n  // Message shown when there is an error while syncing\n  errorMsg: 'Syncronization Error',\n  // Shown before last sync time, e.g. 'Last synchronized: 2 hours ago'\n  lastSync: 'Last synchronized:',\n  // Prompt of how many database objects have synced\n  database: 'Database: {sofar} / {total}',\n  // Prompt for how many media items have synced\n  media: 'Photos: {sofar} / {total}'\n})\n\nconst SyncTarget = ({\n  // Unique identifier for the peer\n  id,\n  // User friendly peer name\n  name = 'Android Phone',\n  // See above peerStatus\n  status,\n  // If connected\n  connected,\n  // Sync progress object, with props `percent`, `mediaSofar`, `mediaTotal`,\n  // `dbSofar`, `dbTotal`\n  progress,\n  // The time of last completed sync in milliseconds since UNIX Epoch\n  lastCompleted,\n  errorMsg,\n  // \"mobile\" or \"desktop\" or \"file\"\n  deviceType,\n  onClick\n}) => {\n  const cx = useStyles()\n  const { formatMessage: t, formatNumber } = useIntl()\n  // TODO need to render device name in error screen\n  return (\n    <Paper className={cx.root}>\n      <div className={cx.wrapper}>\n        <div className={cx.content}>\n          {status === 'error' ? (\n            <ErrorIcon\n              fontSize='inherit'\n              className={cx.icon}\n              style={{ color: 'red' }}\n            />\n          ) : deviceType === 'desktop' ? (\n            <LaptopIcon fontSize='inherit' className={cx.icon} />\n          ) : deviceType === 'file' ? (\n            <FileIcon fontSize='inherit' className={cx.icon} />\n          ) : (\n            <PhoneIcon fontSize='inherit' className={cx.icon} />\n          )}\n          <Typography variant='h5' component='h2'>\n            {name}\n          </Typography>\n          {status === 'error' ? (\n            <Typography className={cx.errorDetail} align='center'>\n              {errorMsg}\n            </Typography>\n          ) : status === 'progress' && progress ? (\n            <Typography className={cx.progress} align='center'>\n              {t(m.database, {\n                sofar: formatNumber(progress.dbSofar),\n                total: formatNumber(progress.dbTotal)\n              })}\n              <br />\n              {t(m.media, {\n                sofar: formatNumber(progress.mediaSofar),\n                total: formatNumber(progress.mediaTotal)\n              })}\n            </Typography>\n          ) : (\n            lastCompleted && (\n              <Typography className={cx.lastSync}>\n                {t(m.lastSync)}\n                <br />\n                <DateDistance date={lastCompleted} />\n              </Typography>\n            )\n          )}\n        </div>\n        <SyncButton\n          connected={connected}\n          onClick={onClick}\n          variant={status}\n          progress={progress && progress.percent}\n        />\n      </div>\n    </Paper>\n  )\n}\n\nexport default SyncTarget\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    paddingTop: '100%',\n    position: 'relative'\n  },\n  icon: {\n    marginBottom: theme.spacing(2),\n    fontSize: 48\n  },\n  lastSync: {\n    textAlign: 'center',\n    fontStyle: 'italic'\n  },\n  errorDetail: {\n    textAlign: 'center',\n    fontStyle: 'italic'\n  },\n  content: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  wrapper: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    position: 'absolute',\n    display: 'flex',\n    flexDirection: 'column',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    padding: '10%'\n  },\n  progress: {\n    fontVariantNumeric: 'tabular-nums'\n  }\n}))\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst SyncGrid = ({ children }) => {\n  const cx = useStyles()\n  return <div className={cx.root}>{children}</div>\n}\n\nexport default SyncGrid\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'grid',\n    overflowY: 'scroll',\n    gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',\n    alignItems: 'start',\n    alignContent: 'start',\n    gridGap: 30,\n    padding: 20,\n    flex: 1\n  }\n}))\n","import React, { useEffect, useState } from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport api from '../../new-api'\n\nconst SyncFooter = () => {\n  const cx = useStyles()\n  const [encryptionKey, setEncryptionKey] = useState(null)\n\n  // Check encryption key on load\n  useEffect(() => {\n    const check = async () => {\n      const encryptionKey = await api.getEncryptionKey()\n      setEncryptionKey(encryptionKey)\n    }\n    check()\n  }, [])\n\n  return (\n    <AppBar position='static' color='default' elevation={0} className={cx.root}>\n      <Toolbar>\n        <div className={cx.titleBar}>\n          <Typography component='h2' className={cx.title}>\n            {encryptionKey}\n          </Typography>\n        </div>\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nexport default SyncFooter\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    backgroundColor: 'white'\n  },\n  titleBar: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start'\n  },\n  title: {\n    color: 'black'\n  }\n}))\n","import React, { useEffect, useState, useRef, useMemo, useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core'\nimport { remote } from 'electron'\nimport { useIntl, defineMessages } from 'react-intl'\nimport path from 'path'\n\nimport logger from '../../../logger'\nimport api from '../../new-api'\nimport Searching from './Searching'\nimport SyncAppBar from './SyncAppBar'\nimport SyncTarget from './SyncTarget'\nimport SyncGrid from './SyncGrid'\nimport SyncFooter from './SyncFooter'\n\nexport const peerStatus = {\n  READY: 'ready',\n  PROGRESS: 'progress',\n  ERROR: 'error',\n  COMPLETE: 'complete'\n}\n\nconst m = defineMessages({\n  openSyncFileDialog: 'Select a database to syncronize',\n  createSyncFileDialog: 'Create a new database to syncronize',\n  // Error message when trying to sync with an incompatible older version of Mapeo\n  errorMsgVersionThemBad: '{deviceName} needs to upgrade Mapeo',\n  // Error messagewhen trying to sync with an incompatible newer version of Mapeo\n  errorMsgVersionUsBad: 'You need to upgrade Mapeo to sync with {deviceName}'\n})\n\nconst IGNORED_ERROR_CODES = ['ECONNABORTED', 'ERR_MISSING_DATA']\n\nconst fileDialogFilters = [\n  {\n    name: 'Mapeo Data (*.mapeodata)',\n    extensions: ['mapeodata', 'mapeo-jungle', 'sync', 'zip']\n  }\n]\n\nconst SyncView = ({ focusState }) => {\n  const cx = useStyles()\n  const listenForSyncPeers = focusState === 'focused'\n  const [peers, syncPeer] = usePeers(listenForSyncPeers)\n  const { formatMessage: t } = useIntl()\n  logger.debug('render peers', peers)\n\n  const handleClickSelectSyncfile = () => {\n    remote.dialog.showOpenDialog(\n      {\n        title: t(m.openSyncFileDialog),\n        properties: ['openFile'],\n        filters: fileDialogFilters\n      }\n    ).then(({ filePaths }) => {\n      if (typeof filePaths === 'undefined' || filePaths.length !== 1) return\n      syncPeer(filePaths[0], { file: true })\n    }).catch(err => logger.error(err))\n  }\n\n  const handleClickNewSyncfile = () => {\n    remote.dialog.showSaveDialog(\n      {\n        title: t(m.openSyncFileDialog),\n        defaultPath: 'database.mapeodata',\n        filters: fileDialogFilters\n      }\n    ).then(({ canceled, filePath }) => {\n      if (canceled || !filePath) return\n      syncPeer(filePath, { file: true })\n    }).catch(err => logger.error(err))\n  }\n\n  return (\n    <div className={cx.root}>\n      <SyncAppBar\n        onClickSelectSyncfile={handleClickSelectSyncfile}\n        onClickNewSyncfile={handleClickNewSyncfile}\n      />\n      {peers.length === 0 && focusState === 'focused' ? (\n        <Searching />\n      ) : (\n        <SyncGrid>\n          {peers.map(peer => (\n            <SyncTarget\n              key={peer.id}\n              {...peer}\n              onClick={() => syncPeer(peer.id)}\n            />\n          ))}\n        </SyncGrid>\n      )}\n      <SyncFooter />\n    </div>\n  )\n}\n\nexport default SyncView\n\nfunction usePeers (listen) {\n  const { formatMessage } = useIntl()\n  const lastClosed = useRef(Date.now())\n  const [serverPeers, setServerPeers] = useState([])\n  const [syncErrors, setSyncErrors] = useState(new Map())\n  const [syncRequests, setSyncRequests] = useState(new Map())\n\n  // Keep a ref of the last time this view was closed (used to maintain peer\n  // \"completed\" state in the UI)\n  useEffect(\n    () => {\n      if (!listen) lastClosed.current = Date.now()\n    },\n    [listen]\n  )\n\n  useEffect(\n    () => {\n      // Only start listening if `listen` is true\n      if (!listen) return\n\n      const updatePeers = (updatedServerPeers = []) => {\n        logger.debug('Received peer update', updatedServerPeers)\n        setServerPeers(updatedServerPeers)\n        // NB: use callback version of setState because the new error state\n        // depends on the previous error state\n        setSyncErrors(syncErrors => {\n          const newErrors = new Map(syncErrors)\n          updatedServerPeers.forEach(peer => {\n            if (peer.state && peer.state.topic === 'replication-error') {\n              if (IGNORED_ERROR_CODES.indexOf(peer.state.code) === -1) {\n                newErrors.set(peer.id, peer.state)\n              }\n            } else {\n              // no error anymore, let's delete it\n              newErrors.delete(peer.id)\n            }\n          })\n          return newErrors\n        })\n        // Argh, this is hacky. This is making up for us not being able to rely\n        // on server state for rendering the UI\n        setSyncRequests(syncRequests => {\n          const newSyncRequests = new Map(syncRequests)\n          updatedServerPeers.forEach(peer => {\n            if (!peer.state) return\n            if (\n              (peer.state.topic === 'replication-error' ||\n              peer.state.topic === 'replication-complete') &&\n              !peer.connected\n            ) {\n              newSyncRequests.delete(peer.id)\n            }\n          })\n          return newSyncRequests\n        })\n      }\n\n      // Whenever the sync view becomes focused, announce for sync and start\n      // listening for updates to peer status\n      api.syncJoin()\n      const peerListener = api.addPeerListener(updatePeers)\n\n      // When the listen changes or component unmounts, cleanup listeners\n      return () => {\n        api.syncLeave()\n        if (peerListener) peerListener.remove()\n      }\n    },\n    [listen]\n  )\n\n  const peers = useMemo(\n    () =>\n      getPeersStatus({\n        syncRequests,\n        serverPeers,\n        syncErrors,\n        since: lastClosed.current,\n        formatMessage\n      }),\n    [serverPeers, syncErrors, syncRequests, formatMessage]\n  )\n\n  const syncPeer = useCallback(\n    (peerId, opts) => {\n      logger.info('Request sync start', peerId, serverPeers)\n      if (opts && opts.file) return api.syncStart({ filename: peerId })\n      const peer = serverPeers.find(peer => peer.id === peerId)\n      // Peer could have vanished in the moment the button was pressed\n      if (peer) {\n        // The server does always respond immediately with progress, especially\n        // if the two devices are already up to sync. We store the request state\n        // so the user can see the UI update when they click the button\n        setSyncRequests(syncRequests => {\n          const newSyncRequests = new Map(syncRequests)\n          newSyncRequests.set(peerId, true)\n          return newSyncRequests\n        })\n        api.syncStart(peer)\n      }\n    },\n    [serverPeers]\n  )\n\n  return [peers, syncPeer]\n}\n\n/**\n * The peer status from Mapeo Core does not 'remember' the completion of a sync.\n * If the user is not looking at the screen when sync completes, they might miss\n * it. This function derives a peer status from the server state and any errors\n */\nfunction getPeersStatus ({\n  serverPeers = [],\n  syncErrors,\n  syncRequests,\n  since,\n  formatMessage\n}) {\n  logger.debug('get peers status', serverPeers, syncErrors)\n  return serverPeers.map(serverPeer => {\n    let status = peerStatus.READY\n    let errorMsg\n    let complete\n    const state = serverPeer.state || {}\n    const name = serverPeer.filename\n      ? path.basename(serverPeer.name)\n      : serverPeer.name\n    if (\n      state.topic === 'replication-progress' ||\n      state.topic === 'replication-started' ||\n      syncRequests.has(serverPeer.id)\n    ) {\n      status = peerStatus.PROGRESS\n    } else if (\n      (state.lastCompletedDate || 0) > since ||\n      state.topic === 'replication-complete'\n    ) {\n      status = peerStatus.COMPLETE\n      complete = state.message\n    } else if (\n      syncErrors.has(serverPeer.id)\n    ) {\n      status = peerStatus.ERROR\n      const error = syncErrors.get(serverPeer.id)\n      if (error && error.code === 'ERR_VERSION_MISMATCH') {\n        if (\n          parseVersionMajor(state.usVersion || '') >\n          parseVersionMajor(state.themVersion || '')\n        ) {\n          errorMsg = formatMessage(m.errorMsgVersionThemBad, {\n            deviceName: name\n          })\n        } else {\n          errorMsg = formatMessage(m.errorMsgVersionUsBad, { deviceName: name })\n        }\n      } else if (error) {\n        errorMsg = error.message || 'Error'\n      }\n    }\n    return {\n      id: serverPeer.id,\n      name: name,\n      status: status,\n      started: serverPeer.started,\n      connected: serverPeer.connected,\n      lastCompleted: complete || state.lastCompletedDate,\n      errorMsg: errorMsg,\n      progress: getPeerProgress(serverPeer.state),\n      deviceType: serverPeer.filename ? 'file' : serverPeer.deviceType\n    }\n  })\n}\n\n// We combine media and database items in progress. In order to show roughtly\n// accurate progress, this weighting is how much more progress a media item\n// counts vs. a database item\nconst MEDIA_WEIGHTING = 50\nfunction getPeerProgress (peerState) {\n  if (\n    !peerState ||\n    peerState.topic !== 'replication-progress' ||\n    !peerState.message ||\n    !peerState.message.db ||\n    !peerState.message.media\n  ) {\n    return\n  }\n  const total =\n    (peerState.message.db.total || 0) +\n    (peerState.message.media.total || 0) * MEDIA_WEIGHTING\n  const sofar =\n    (peerState.message.db.sofar || 0) +\n    (peerState.message.media.sofar || 0) * MEDIA_WEIGHTING\n  const progress = total > 0 ? sofar / total : 0\n  // Round progress to 2-decimal places. PeerItem is memoized, so it will not\n  // update if progress does not change. Without rounding PeerItem updates\n  // unnecessarily on every progress change, when we are only showing the user a\n  // rounded percentage progress. Increase this to 3-decimal places if you want\n  // to show more detail to the user.\n  return {\n    percent: Math.round(progress * 100) / 100,\n    mediaSofar: peerState.message.media.sofar || 0,\n    mediaTotal: peerState.message.media.total || 0,\n    dbSofar: peerState.message.db.sofar || 0,\n    dbTotal: peerState.message.db.total || 0\n  }\n}\n\nexport function parseVersionMajor (versionString = '') {\n  const major = Number.parseInt(versionString.split('.')[0])\n  return isNaN(major) ? 0 : major\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    width: '100%',\n    position: 'relative',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#F5F5F5'\n  }\n}))\n","export default {\n  IDLE: 0,\n  AVAILABLE: 1,\n  DOWNLOADING: 2,\n  PROGRESS: 3,\n  READY_FOR_RESTART: 4,\n  ERROR: 5,\n  INACTIVE: 99\n}\n","import React from 'react'\nimport { LinearProgress, Typography, makeStyles } from '@material-ui/core'\nimport { defineMessages, useIntl } from 'react-intl'\nimport Button from '@material-ui/core/Button'\nimport FormattedDuration from 'react-intl-formatted-duration'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport Paper from '@material-ui/core/Paper'\nimport Loader from '../Loader'\n\nimport STATES from './states'\nexport { default as STATES } from './states'\n\nconst m = defineMessages({\n  // Title on sync screen when searching for devices\n  updateAvailable: 'Update',\n  updateNotAvailable: 'Mapeo is up to date! You are on the latest version.',\n  downloadButtonText: 'Download',\n  calculatingProgress: 'Estimating...',\n  downloadProgress: 'Downloading',\n  restartMapeoText: 'An update to Mapeo has been downloaded. Restart Mapeo to update.',\n  restartMapeoButton: 'Restart',\n  errorTitle: 'Error',\n  errorMessage: 'There was an error and Mapeo could not update. Try again later.',\n  patchUpdate: 'This update includes changes that fix critical errors. Please update as soon as possible.',\n  minorUpdate: 'This update includes improvements that may change your experience.',\n  majorUpdate: 'This update will make your application incompatible with earlier verions.',\n  unknownDownloadSpeed: 'Unknown',\n  estimatedDownloadTime: 'Estimated download time is'\n})\n\nconst errors = {\n  ERR_UPDATER_CHANNEL_FILE_NOT_FOUND: 'This channel does not have any updates'\n}\n\nexport const UpdateTab = ({ update }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  var internal = function () {\n    switch (update.state) {\n      case STATES.AVAILABLE:\n        return <Typography>{t(m.updateAvailable)}</Typography>\n      case STATES.DOWNLOADING:\n        return <Typography>{t(m.calculatingProgress)}</Typography>\n      case STATES.PROGRESS:\n        return <Typography>{t(m.downloadProgress)}</Typography>\n      case STATES.READY_FOR_RESTART:\n        return <Typography>{t(m.restartMapeoButton)}</Typography>\n      case STATES.ERROR:\n        return (\n          <Typography style={{ color: 'red' }}>\n            {t(m.errorTitle)}\n          </Typography>\n        )\n      default: // STATES.IDLE, STATES.UPDATE_NOT_AVAILABLE:\n        return null\n    }\n  }\n\n  return <div className={cx.updateTab}>{internal()}</div>\n}\n\nexport const UpdaterView = ({ update, setUpdate }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  var internal = function () {\n    switch (update.state) {\n      case STATES.AVAILABLE:\n        return <UpdateAvailableView cx={cx} update={update} setUpdate={setUpdate} />\n      case STATES.DOWNLOADING:\n        return <Typography>{t(m.calculatingProgress)}</Typography>\n      case STATES.PROGRESS:\n        return <DownloadProgressView cx={cx} percent={update.progress.percent} update={update} />\n      case STATES.READY_FOR_RESTART:\n        return <RestartView cx={cx} />\n      case STATES.UPDATE_NOT_AVAILABLE:\n        return <UpdateNotAvailableView cx={cx} />\n      case STATES.ERROR:\n        return (\n          <Typography>\n            <ErrorIcon\n              fontSize='inherit'\n              className={cx.icon}\n              style={{ color: 'red' }}\n            />\n            {t(m.errorMessage)}\n            {update.updateInfo.code}\n            {errors[update.updateInfo.code]}\n          </Typography>\n        )\n      default: // STATES.IDLE\n        return null\n    }\n  }\n\n  return (\n    <div className={cx.root}>\n      <div className={cx.searchingWrapper}>\n        <div className={cx.searching}>\n          {internal()}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nconst RestartView = ({ cx }) => {\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.restartMapeoText)}\n      </Typography>\n    </div>\n  )\n}\n\nconst DownloadProgressView = ({ cx, update, percent }) => {\n  /*\n      {\n        progress: {\n          total: 141164463,\n          delta: 1655048,\n          transferred: 11384326,\n          percent: 8.064583506402741,\n          bytesPerSecond: 2244544\n        }\n      }\n  */\n\n  const progress = update.progress\n  let estimatedTimeLeft\n\n  if (progress) {\n    estimatedTimeLeft = progress.total ? (progress.total - progress.transferred) / progress.bytesPerSecond : 0\n  }\n\n  return (\n    <div className={cx.searchingText}>\n      <Loader />\n      <LinearProgress variant='determinate' value={percent} color='secondary' />\n      <Typography>\n        {estimatedTimeLeft && <FormattedDuration seconds={estimatedTimeLeft} />}\n      </Typography>\n    </div>\n  )\n}\n\nconst UpdateAvailableView = ({ cx, update, setUpdate }) => {\n  const { formatMessage: t } = useIntl()\n\n  const { size, downloadSpeed, major, minor, patch } = update.updateInfo\n\n  const handleDownlaoadClick = setUpdate.downloadUpdate\n\n  const estimatedDownloadTime = downloadSpeed\n    ? <FormattedDuration seconds={size / downloadSpeed.bps} />\n    : t(m.unknownDownloadSpeed)\n\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.updateAvailable)}\n      </Typography>\n      <Paper className={cx.wrapper}>\n        <div className={cx.content}>\n\n          <Typography>\n            {\n              major\n                ? t(m.majorUpdate)\n                : minor\n                  ? t(m.minorUpdate)\n                  : patch\n                    ? t(m.patchUpdate)\n                    : ''\n            }\n          </Typography>\n\n          <Typography className={cx.estimatedDownloadTime}>\n            {t(m.estimatedDownloadTime)} {estimatedDownloadTime}\n          </Typography>\n\n          <Button\n            onClick={handleDownlaoadClick}\n            className={cx.button}\n            variant='contained'\n            size='large'\n            color='primary'\n          >\n            {t(m.downloadButtonText)}\n          </Button>\n\n        </div>\n      </Paper>\n    </div>\n  )\n}\n/*\n\nconst ExpandedNotes = ({ releaseSummary }) => {\n  return <div>\n    <Typography variant='body'>{releaseSummary}</Typography>\n  </div>\n}\n\nconst HiddenNotes = ({ releaseSummary }) => {\n  return <div>\n    <Typography variant='body'>{releaseSummary}</Typography>\n  </div>\n}\n*/\n\nconst UpdateNotAvailableView = ({ cx, update, downloadUpdateClick }) => {\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.updateNotAvailable)}\n      </Typography>\n    </div>\n  )\n}\n\nconst useStyles = makeStyles(theme => ({\n  searchingText: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  searchingWrapper: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  searching: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  searchingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  },\n  root: {\n    height: '100%',\n    width: '100%',\n    position: 'relative',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#F5F5F5'\n  },\n  wrapper: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    display: 'flex',\n    flexDirection: 'column',\n    padding: '10%'\n  },\n  content: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  button: {\n    marginTop: '15px'\n  },\n  estimatedDownloadTime: {\n    margin: '10px 0px'\n  },\n  icon: {\n    fontSize: 48\n  }\n}))\n","import { ipcRenderer } from 'electron'\n\nexport default Api(ipcRenderer)\n\nfunction Api (ipcRenderer) {\n  return {\n    addUpdateStatusListener: function (handler) {\n      function onupdate (ev, serverState, info) {\n        handler({ serverState, info })\n      }\n      ipcRenderer.on('update-status', onupdate)\n      return {\n        remove: () => ipcRenderer.removeListener('update-status', onupdate)\n      }\n    },\n    checkForUpdates: function () {\n      ipcRenderer.send('check-for-updates')\n    },\n    downloadUpdate: function () {\n      ipcRenderer.send('download-update')\n    },\n    quitAndInstall: function () {\n      ipcRenderer.send('quit-and-install')\n    }\n  }\n}\n","import React from 'react'\nimport { ipcRenderer } from 'electron'\nimport styled from 'styled-components'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport { Transition } from 'react-transition-group'\nimport {\n  LocationOn,\n  Map as MapIcon,\n  PhotoLibrary as ObservationIcon,\n  OfflineBolt as SyncIcon,\n  Warning as WarningIcon\n} from '@material-ui/icons'\n\nimport pkg from '../../../package.json'\nimport MapEditor from './MapEditor'\nimport LatLonDialog from './dialogs/LatLon'\nimport ErrorDialog from './dialogs/Error'\nimport ChangeLanguage from './dialogs/ChangeLanguage'\nimport TitleBarShim from './TitleBarShim'\nimport MapFilter from './MapFilter'\nimport { defineMessages, useIntl } from 'react-intl'\nimport createPersistedState from '../hooks/createPersistedState'\nimport SyncView from './SyncView'\nimport { STATES as updateStates, UpdaterView, UpdateTab } from './UpdaterView'\nimport useUpdater from './UpdaterView/useUpdater'\n\nconst m = defineMessages({\n  // MapEditor tab label\n  mapeditor: 'Territory',\n  // MapFilter tab label\n  mapfilter: 'Observations',\n  // Synchronize tab label\n  sync: 'Synchronize',\n  update: 'Update Mapeo'\n})\n\nconst transitionDuration = 100\n\nconst Root = styled.div`\n  position: absolute;\n  overflow: hidden;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  @media only print {\n    display: block;\n    height: auto;\n    width: auto;\n    overflow: visible;\n  }\n`\n\nconst Sidebar = styled.div`\n  display: flex;\n  flex-direction: column;\n  -webkit-app-region: drag;\n  -webkit-user-select: none;\n  background-color: #000033;\n  color: white;\n  z-index: 99;\n  @media only print {\n    display: none;\n  }\n`\n\nconst Logo = styled.div`\n  padding: 0 24px 0 18px;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  height: 64px;\n  h1 {\n    font-family: 'Rubik', sans-serif;\n    font-weight: 500;\n    font-size: 2em;\n    cursor: default;\n    margin: 0;\n  }\n`\n\nconst MapeoIcon = styled(LocationOn)`\n  margin-right: 3.5px;\n  margin-left: -5.5px;\n`\n\nconst StyledTabs = styled(Tabs)`\n  border-right: 1px solid rgba(0, 0, 0, 0.12);\n  -webkit-app-region: no-drag;\n  .PrivateTabIndicator-root-1 {\n    background-color: #ff9933;\n  }\n`\n\nconst StyledTab = styled(Tab)`\n  &.MuiTab-root {\n    padding: 6px 24px 6px 18px;\n    min-height: 64px;\n    font-size: 16px;\n    line-height: 28px;\n    font-weight: 400;\n    text-transform: capitalize;\n  }\n  &.Mui-selected {\n    background-color: #33335c;\n  }\n  & .MuiTab-wrapper {\n    justify-content: flex-start;\n    flex-direction: row;\n  }\n  & .MuiTab-wrapper > *:first-child {\n    margin-bottom: 4px;\n    margin-right: 11px;\n  }\n`\n\nconst TabContent = styled.div`\n  position: relative;\n  flex: 1;\n`\n\nconst StyledPanel = styled.div`\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  transition: opacity ${transitionDuration}ms ease-out;\n  @media only print {\n    position: relative;\n    width: auto;\n    height: auto;\n  }\n`\n\nconst Version = styled.div`\n  align-self: flex-start;\n  margin: auto 10px 10px 10px;\n  font-size: 0.8rem;\n  color: #aaaaaa;\n`\n\nconst focusStates = {\n  entering: 'focusing',\n  entered: 'focused',\n  exiting: 'blurring',\n  exited: 'blurred'\n}\n\nfunction TabPanel (props) {\n  const { value, index, component: Component, ...extras } = props\n\n  const transitionStyles = {\n    entering: { opacity: 1, zIndex: 1, display: 'block' },\n    entered: { opacity: 1, zIndex: 1, display: 'block' },\n    exiting: { opacity: 0 },\n    exited: { opacity: 0, display: 'block' }\n  }\n\n  return (\n    <Transition in={value === index} timeout={transitionDuration}>\n      {transitionState => (\n        <StyledPanel style={transitionStyles[transitionState]}>\n          {Component && <Component focusState={focusStates[transitionState]} {...extras} />}\n        </StyledPanel>\n      )}\n    </Transition>\n  )\n}\n\nconst useTabIndex = createPersistedState('currentView')\n\nexport default function Home ({ onSelectLanguage }) {\n  const [dialog, setDialog] = React.useState(null)\n  const [error, setError] = React.useState(null)\n  const [tabIndex, setTabIndex] = useTabIndex(0)\n  const [update, setUpdate] = useUpdater()\n  const { formatMessage: t } = useIntl()\n\n  React.useEffect(() => {\n    const openLatLonDialog = () => setDialog('LatLon')\n    const openErrorDialog = (ev, error) => {\n      console.log(error)\n      setError(error)\n    }\n    const openChangeLangDialog = () => setDialog('ChangeLanguage')\n    const refreshPage = () => window.location.reload()\n    ipcRenderer.on('error', openErrorDialog)\n    ipcRenderer.on('open-latlon-dialog', openLatLonDialog)\n    ipcRenderer.on('change-language-request', openChangeLangDialog)\n    ipcRenderer.on('force-refresh-window', refreshPage)\n    return () => {\n      ipcRenderer.removeListener('error', openErrorDialog)\n      ipcRenderer.removeListener('open-latlon-dialog', openLatLonDialog)\n      ipcRenderer.removeListener(\n        'change-language-request',\n        openChangeLangDialog\n      )\n      ipcRenderer.removeListener('force-refresh-window', openLatLonDialog)\n    }\n  }, [])\n\n  const hasUpdate = update.state !== updateStates.IDLE &&\n    update.state !== updateStates.UPDATE_NOT_AVAILABLE\n\n  return (\n    <Root>\n      <Sidebar>\n        <TitleBarShim />\n        <Logo>\n          <MapeoIcon fontSize='large' />\n          <h1>Mapeo</h1>\n        </Logo>\n        <StyledTabs\n          orientation='vertical'\n          variant='scrollable'\n          value={tabIndex}\n          onChange={(e, value) => setTabIndex(value)}\n        >\n          <StyledTab icon={<MapIcon />} label={t(m.mapeditor)} />\n          <StyledTab icon={<ObservationIcon />} label={t(m.mapfilter)} />\n          <StyledTab icon={<SyncIcon />} label={t(m.sync)} />\n          {hasUpdate && <StyledTab icon={<WarningIcon />} label={<UpdateTab update={update} />} />}\n        </StyledTabs>\n        <Version>Mapeo v{pkg.version}</Version>\n      </Sidebar>\n      <TabContent>\n        <TabPanel value={tabIndex} index={0} component={MapEditor} />\n        <TabPanel value={tabIndex} index={1} component={MapFilter} />\n        <TabPanel value={tabIndex} index={2} component={SyncView} />\n        <TabPanel value={tabIndex} index={3} component={UpdaterView} update={update} setUpdate={setUpdate} />\n      </TabContent>\n      <ChangeLanguage\n        open={dialog === 'ChangeLanguage'}\n        onCancel={() => {\n          setDialog(null)\n        }}\n        onSelectLanguage={lang => {\n          onSelectLanguage(lang)\n          setDialog(null)\n        }}\n      />\n      <LatLonDialog\n        open={dialog === 'LatLon'}\n        onClose={() => setDialog(null)}\n      />\n      <ErrorDialog\n        open={error !== null}\n        message={error}\n        onClose={() => setError(null)}\n      />\n    </Root>\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport semver from 'semver'\nimport { version as appVersion } from '../../../../package.json'\nimport STATES from './states'\nimport electronIpc from '../../electron-ipc'\n\nexport default function useUpdater () {\n  const [update, setUpdate] = useState({\n    progress: null,\n    updateInfo: null,\n    state: STATES.IDLE\n  })\n\n  useEffect(\n    () => {\n      const updateListener = electronIpc.addUpdateStatusListener(({ serverState, info }) => {\n        switch (serverState) {\n          case 'update-error':\n            setUpdate({\n              updateInfo: info,\n              progress: null,\n              state: STATES.ERROR\n            })\n            return\n          case 'update-downloaded':\n            setUpdate({\n              updateInfo: null,\n              progress: null,\n              state: STATES.READY_FOR_RESTART\n            })\n            return\n          case 'update-not-available':\n            setUpdate({\n              updateInfo: null,\n              progress: null,\n              state: STATES.UPDATE_NOT_AVAILABLE\n            })\n            return\n          case 'update-progress':\n            setUpdate({\n              progress: info.progress,\n              state: STATES.PROGRESS\n            })\n            return\n          case 'update-available':\n            var past = semver.parse(appVersion)\n            var next = semver.parse(info.version)\n            info.major = next.major > past.major\n            info.minor = next.minor > past.minor\n            info.patch = next.patch > past.patch\n\n            info.size = info.files.map((file) => file.size).reduce((a, b) => a + b, 0)\n\n            setUpdate({\n              updateInfo: info,\n              progress: null,\n              state: STATES.AVAILABLE\n            })\n            return\n          case 'update-inactive':\n            setUpdate({\n              progress: null,\n              updateInfo: null,\n              state: STATES.UPDATE_INACTIVE\n            })\n        }\n      })\n      return () => {\n        if (updateListener) updateListener.remove()\n      }\n    }\n    , [])\n\n  function downloadUpdate () {\n    setUpdate({\n      state: STATES.DOWNLOADING\n    })\n    electronIpc.downloadUpdate()\n  }\n\n  return [update, { downloadUpdate }]\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { remote, ipcRenderer } from 'electron'\nimport { StylesProvider, ThemeProvider } from '@material-ui/styles'\nimport { IntlProvider } from 'react-intl'\nimport isDev from 'electron-is-dev'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nimport logger from '../logger'\nimport theme from './theme'\nimport Home from './components/Home'\n\nif (!logger.configured) {\n  logger.configure({\n    label: 'renderer',\n    userDataPath: remote.app.getPath('userData'),\n    isDev\n  })\n  ipcRenderer.on('debugging', (ev, bool) => {\n    logger.debugging(bool)\n  })\n}\n\nconst initialLocale = ipcRenderer.sendSync('get-locale') // navigator.language.slice(0, 2)\n\nconst mdMsgs = {\n  en: require('../../translations/en.json'),\n  es: require('../../translations/es.json'),\n  pt: require('../../translations/pt.json')\n}\n\nconst mfMsgs = {\n  en: require('react-mapfilter/translations/en.json'),\n  es: require('react-mapfilter/translations/es.json'),\n  pt: require('react-mapfilter/translations/pt.json')\n}\n\nconst allMsgs = {\n  en: { ...mdMsgs.en, ...mfMsgs.en },\n  es: { ...mdMsgs.es, ...mfMsgs.es },\n  pt: { ...mdMsgs.pt, ...mfMsgs.pt }\n}\n\nif (!logger.configured) {\n  logger.configure({\n    label: 'renderer',\n    userDataPath: remote.app.getPath('userData'),\n    isDev\n  })\n  ipcRenderer.on('debugging', (ev, bool) => {\n    logger.debugging(bool)\n  })\n}\n\nconst App = () => {\n  const [locale, setLocale] = React.useState(initialLocale)\n\n  const handleLanguageChange = React.useCallback(lang => {\n    ipcRenderer.send('set-locale', lang)\n    setLocale(lang)\n    // Ideally this would just re-render the app in the new locale, but the way\n    // we squeeze iD editor into React and patch in React Components on top of\n    // it, trying to call `id.ui().restart(locale)` causes problems, so we\n    // refresh instead\n    ipcRenderer.send('force-refresh-window')\n  }, [])\n  logger.info('Rendering', locale)\n\n  return (\n    <StylesProvider injectFirst>\n      <ThemeProvider theme={theme}>\n        <CssBaseline />\n        <IntlProvider locale={locale} messages={allMsgs[locale]}>\n          <Home onSelectLanguage={handleLanguageChange} />\n        </IntlProvider>\n      </ThemeProvider>\n    </StylesProvider>\n  )\n}\n\nReactDOM.render(<App />, document.getElementById('root'))\n\nconst localStorage = window.localStorage\nwindow.testMode = function () {\n  logger.debug('Test mode, clearing cache')\n  localStorage.removeItem('lastView')\n  localStorage.removeItem('location')\n}\n"],"sourceRoot":""}