{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"react-intl\"","webpack:///external \"electron\"","webpack:///external \"@material-ui/core\"","webpack:///./src/logger.js","webpack:///external \"@material-ui/core/styles\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/map\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/object/assign\"","webpack:///external \"@material-ui/core/Button\"","webpack:///external \"@babel/runtime-corejs3/helpers/extends\"","webpack:///external \"styled-components\"","webpack:///external \"@material-ui/core/MenuItem\"","webpack:///external \"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/for-each\"","webpack:///external \"@material-ui/core/DialogContent\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/date/now\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/object/keys\"","webpack:///external \"@material-ui/core/Dialog\"","webpack:///external \"@material-ui/core/DialogTitle\"","webpack:///external \"path\"","webpack:///external \"@material-ui/core/DialogActions\"","webpack:///external \"@material-ui/icons\"","webpack:///external \"@material-ui/core/AppBar\"","webpack:///external \"@material-ui/core/Toolbar\"","webpack:///external \"@material-ui/core/FormControl\"","webpack:///external \"@material-ui/core/Typography\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/json/stringify\"","webpack:///external \"id-mapeo\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/includes\"","webpack:///external \"@material-ui/core/Select\"","webpack:///external \"react-mapfilter\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/map\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/find\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/filter\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/slice\"","webpack:///external \"react-dom\"","webpack:///./src/store.js","webpack:///external \"@babel/runtime-corejs3/core-js-stable/array/is-array\"","webpack:///external \"lodash/debounce\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/index-of\"","webpack:///external \"ky/umd\"","webpack:///external \"@material-ui/core/IconButton\"","webpack:///external \"@material-ui/core/Tooltip\"","webpack:///external \"@material-ui/icons/MoreVert\"","webpack:///external \"@material-ui/core/Menu\"","webpack:///external \"fs-write-stream-atomic\"","webpack:///external \"pump\"","webpack:///external \"react-mapfilter/commonjs/ViewWrapper\"","webpack:///external \"@material-ui/icons/Error\"","webpack:///external \"@material-ui/core/Paper\"","webpack:///external \"@material-ui/core/InputLabel\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/set-timeout\"","webpack:///external \"@material-ui/styles\"","webpack:///external \"electron-is-dev\"","webpack:///external \"insert-css\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/promise\"","webpack:///external \"@material-ui/core/DialogContentText\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/trim\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/parse-float\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/find-index\"","webpack:///external \"d3-dsv\"","webpack:///external \"node-wifi\"","webpack:///external \"react-intl-formatted-duration\"","webpack:///external \"semver\"","webpack:///external \"@material-ui/core/CssBaseline\"","webpack:///external \"@material-ui/core/Tabs\"","webpack:///external \"@material-ui/core/Tab\"","webpack:///external \"react-transition-group\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/every\"","webpack:///external \"@material-ui/core/Input\"","webpack:///external \"mapbox-gl\"","webpack:///external \"react-error-boundary\"","webpack:///external \"@material-ui/icons/Map\"","webpack:///external \"@material-ui/icons/Apps\"","webpack:///external \"@material-ui/icons/LibraryBooks\"","webpack:///external \"clsx\"","webpack:///external \"yazl\"","webpack:///external \"run-parallel-limit\"","webpack:///external \"once\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/sort\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/concat\"","webpack:///external \"@material-ui/core/FormHelperText\"","webpack:///external \"flat\"","webpack:///external \"@segment/isodate\"","webpack:///external \"utm\"","webpack:///external \"fs\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/number/parse-int\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/set-interval\"","webpack:///external \"@material-ui/icons/PhoneAndroid\"","webpack:///external \"@material-ui/icons/Laptop\"","webpack:///external \"@material-ui/icons/Usb\"","webpack:///external \"@material-ui/icons/Check\"","webpack:///external \"@fortawesome/react-fontawesome\"","webpack:///external \"@fortawesome/free-solid-svg-icons\"","webpack:///external \"@material-ui/core/CircularProgress\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/instance/reduce\"","webpack:///external \"@babel/runtime-corejs3/core-js-stable/array/from\"","webpack:///external \"winston\"","webpack:///external \"winston-daily-rotate-file\"","webpack:///external \"util\"","webpack:///external \"conf\"","webpack:///external \"@bugsnag/node\"","webpack:///external \"@bugsnag/browser\"","webpack:///external \"core-js/es/reflect\"","webpack:///external \"react-mapfilter/translations/en.json\"","webpack:///external \"react-mapfilter/translations/es.json\"","webpack:///external \"react-mapfilter/translations/pt.json\"","webpack:///./src/renderer/theme.js","webpack:///./src/renderer/new-api.js","webpack:///./src/renderer/components/MapEditor/ExportButton.js","webpack:///./src/renderer/components/MapEditor/index.js","webpack:///./src/renderer/components/dialogs/LatLon.js","webpack:///./src/renderer/components/dialogs/Error.js","webpack:///./src/renderer/components/dialogs/ChangeLanguage.js","webpack:///./src/renderer/components/TitleBarShim.js","webpack:///./src/renderer/components/MapFilter/Toolbar.js","webpack:///./src/renderer/components/MapFilter/FilterPanel.js","webpack:///./src/renderer/components/Loader.js","webpack:///./src/renderer/components/MapFilter/Loading.js","webpack:///./src/renderer/components/MapFilter/MapStyleProvider.js","webpack:///./src/renderer/create-zip.js","webpack:///./src/renderer/components/MapFilter/MapExportDialog.js","webpack:///./src/renderer/components/MapFilter/DataExportDialog.js","webpack:///./src/renderer/components/MapFilter/ExportButton.js","webpack:///./src/renderer/components/MapFilter/MapFilter.js","webpack:///./src/renderer/hooks/createPersistedState.js","webpack:///./src/renderer/components/SyncView/Searching.js","webpack:///./src/renderer/components/SyncView/SyncAppBar.js","webpack:///./src/renderer/components/SyncView/SyncButton.js","webpack:///./src/renderer/components/DateDistance.js","webpack:///./src/renderer/components/SyncView/SyncTarget.js","webpack:///./src/renderer/components/SyncView/SyncGrid.js","webpack:///./src/renderer/components/SyncView/SyncFooter.js","webpack:///./src/renderer/components/SyncView/index.js","webpack:///./src/renderer/components/UpdaterView/states.js","webpack:///./src/renderer/components/UpdaterView/index.js","webpack:///./src/renderer/electron-ipc.js","webpack:///./src/renderer/components/Home.js","webpack:///./src/renderer/components/UpdaterView/useUpdater.js","webpack:///./src/renderer/app.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","winston","path","DailyRotateFile","util","store","appVersion","version","Bugsnag","logger","constructor","this","createLogger","configured","_messageQueue","_debug","configure","userDataPath","isDev","label","_startBugsnag","prettyPrint","format","printf","level","message","timestamp","combine","dirname","join","transport","transports","close","mainLog","filename","datePattern","zippedArchive","maxFiles","on","debugging","add","errorTransport","Console","length","_drainQueue","debug","_level","set","port","error","Error","msg","pop","_log","args","log","notify","event","context","push","warn","arguments","err","info","releaseStage","apiKey","enabledReleaseStages","__proto__","unref","start","projectName","projectSuffix","configName","systemFontFamily","createMuiTheme","typography","fontFamily","body1","body2","caption","palette","primary","main","secondary","BASE_URL","remote","getGlobal","Api","baseUrl","ipc","startupTime","req","ky","extend","prefixUrl","timeout","headers","pragma","logRequest","prefix","promise","then","data","catch","url","json","api","getPresets","id","getObservations","getMapStyle","deleteObservation","delete","updateObservation","valueForServer","type","schemaVersion","put","createObservation","post","addPeerListener","handler","onPeerUpdate","peers","syncGetPeers","remove","removeListener","addDataChangedListener","ev","getEncryptionKey","resolve","reject","send","encryptionKey","syncJoin","syncLeave","syncStart","target","exportData","getIconUrl","iconId","size","roundedRatio","Math","min","ceil","window","devicePixelRatio","getMediaUrl","attachmentId","getMapStyleUrl","zoomToData","cb","middlewareClient","defineMessages","exportButton","exportGeoJson","exportShapefile","okButton","closeButton","dialogTitle","dialogSuccess","dialogError","saveTitle","defaultFilename","DialogTitle","DialogAction","children","onClick","color","variant","autoFocus","ExportButton","formatMessage","useIntl","status","setStatus","React","useState","cx","useStyles","menuAnchor","setMenuAnchor","handleMenuItemClick","ext","dialog","showSaveDialog","title","defaultPath","filters","extensions","canceled","filePath","dialogContent","indeterminate","aria-label","currentTarget","aria-controls","aria-haspopup","className","button","anchorEl","open","Boolean","onClose","aria-labelledby","maxWidth","fullWidth","disableBackdropClick","disableEscapeKeyDown","makeStyles","width","margin","notes","insertCss","localStorage","location","MapEditor","rootRef","useRef","customDefs","locale","toolbarEl","setToolbarEl","useCallback","_","loc","current","centerZoomEase","updateSettings","presets","ipcRenderer","sendSync","customCss","imagery","icons","translations","currentLocale","translationsInLocale","iD","en","fallbackFields","iDPresets","presetsObj","fields","fallbackPresets","presetId","preset","tags","categoryId","fieldId","field","snakeCase","snake_case","appearance","options","opt","mapeoOptions","iDStringOptions","strings","convertPresets","dataImagery","img","idx","unshift","iconsSvg","DOMParser","parseFromString","documentElement","defs","node","replaceChild","firstChild","useEffect","subscription","history","saved","toJSON","flush","fromJSON","refreshWindow","prevhash","getItem","hash","onHashChange","debounce","setItem","addEventListener","removeEventListener","useLayoutEffect","serverUrl","coreContext","assetPath","preauth","minEditableZoom","container","append","style","attr","ui","links","document","querySelectorAll","link","href","getAttribute","onclick","preventDefault","shell","openExternal","contributeBtn","querySelector","innerHTML","toolbar","select","aboutList","map","latlon","text","latlonToPosString","center","mouseCoordinates","onbeforeunload","e","save","returnValue","ref","ReactDOM","createPortal","pos","floor","toString","area","geometry","matchScore","line","point","relation","placeholder","LatLonDialog","latLon","setLatLon","onChange","match","exec","pt","stopPropagation","ErrorDialog","Component","render","props","cols","rows","disabled","languages","es","fr","ChangeLanguage","onCancel","onSelectLanguage","lang","setLang","code","TitleBarArea","styled","div","TitleBarShim","win","getCurrentWindow","getSize","getContentSize","mapTabLabel","mediaTabLabel","reportTabLabel","TabItem","selected","disableRipple","clsx","tabItem","MapFilterToolbar","view","actionRight","handleChange","Fragment","position","elevation","root","tabGroup","tabLabel","theme","borderLeft","display","justifyContent","padding","height","flex","border","textTransform","backgroundColor","borderTopRightRadius","borderBottomRightRadius","marginLeft","borderTopLeftRadius","borderBottomLeftRadius","tab","marginRight","spacing","tabIcon","fontWeight","borderRadius","toolbarButton","filterHeader","LeftPanel","header","component","flexBasis","minWidth","flexDirection","borderBottom","Styled","Loader","loading","Searching","gutterBottom","loadingTitle","alignItems","alignSelf","justifySelf","fontSize","MapStyleProvider","setStyle","offlineStyleURL","createZip","localFiles","remoteFiles","zipfile","yazl","ZipFile","missing","metadataPath","Buffer","from","addBuffer","tasks","once","arrayBuffer","arrBuf","run","end","outputStream","msgs","cancel","titleLabel","descriptionLabel","termsLabel","termsHint","styleLabel","EditDialogContent","observations","getPreset","classes","saving","setSaving","setTitle","description","setDescription","handleClose","undefined","noValidate","autoComplete","paddingBottom","content","rowsMax","multiline","points","features","obs","note","date","created_at","image","attachments","coordinates","lon","lat","properties","observationsToGeoJson","metadata","output","fsWriteStreamAtomic","archive","pump","createArchive","basename","EditDialog","filter","otherProps","scroll","onClickObservation","filteredObservations","appBar","paddingTop","filteredOrAll","exportAll","exportFiltered","noData","includePhotos","includePhotosHint","includePhotosNone","includePhotosOriginal","includePhotosPreview","defaultExportFilename","ExportDialogContent","allObservations","isFiltered","values","setValues","include","photos","formControl","labelId","count","observationsToSave","feature","$created","$modified","$version","$photos","a","allKeys","flattenedTags","flatten","parsedTags","isodate","is","formatCsvDatetime","hasLocation","easting","northing","zoneNum","zoneLetter","fromLatLon","locationData","$lon","round","$lat","$utmX","$utmY","$utmZone","$id","columns","csvFormat","observationsToCsv","X","Y","PHOTOS","ID","MAPEO_ID","DATE","formatCsvDate","TIME","formatCsvTime","COMMENT","split","observationsToSmartCsv","saveExt","fs","writeFile","photosToSave","onSelectFile","DataExportDialog","num","dp","factor","pow","isoDateString","Date","getFullYear","leftPad","getMonth","getDate","getHours","getMinutes","getSeconds","len","char","str","pad","marginBottom","exportMap","onExport","errorTitle","errorDescription","MAPBOX_ACCESS_TOKEN","mapboxgl","accessToken","MyFallbackComponent","componentStack","errorFallback","FilterView","mapRef","flyTo","zoom","viewWrapper","FallbackComponent","usePresets","setLoading","setError","setPresets","setFields","async","mapToArray","presetsWithFields","fieldDefs","addFieldDefinitions","useMemo","MapFilter","setView","setFilter","setPosition","savedPosition","item","JSON","parse","persistPosition","usePositionRef","setDialog","observationsLoading","observationsError","isMounted","setObservations","observation","index","updatedObservations","loadObservations","useObservations","presetsError","presetsLoading","Loading","FilterPanel","onChangeFilter","right","Toolbar","styleUrl","onUpdateObservation","onDeleteObservation","mapStyle","mapboxAccessToken","onMapMove","initialMapPosition","createPersistedState","initialState","state","setState","searchingTitle","searchingHint","searchingWrapper","searching","searchingText","wifiInit","wifi","init","getQualityStyle","connection","quality","disconnected","disconnectedTooltip","wifiError","wifiErrorTooltip","qualityTooltipPoor","qualityTooltipWeak","qualityTooltipAdequate","selectSyncfile","newSyncfile","SyncAppBar","onClickSelectSyncfile","onClickNewSyncfile","currentConnection","setCurrentConnection","setWifiError","check","conn","getCurrentConnections","intervalCheck","clearInterval","titleBar","wifiIcon","wifiName","ssid","wifiQuality","toFixed","lineHeight","top","actionArea","sync","starting","complete","retry","finishing","SyncIcon","icon","faBolt","ProgressBackground","ProgressIcon","progress","awaitingCompletion","setAwaitingCompletion","timeoutId","clearTimeout","thickness","progressCircle","StyledButton","SyncButton","connected","minHeight","fontVariantNumeric","transitionDuration","DateDistance","distanceInSeconds","absValue","abs","day","month","year","hour","minute","numeric","updateIntervalInSeconds","unit","errorMsg","lastSync","database","media","SyncTarget","lastCompleted","deviceType","formatNumber","wrapper","errorDetail","align","sofar","dbSofar","total","dbTotal","mediaSofar","mediaTotal","percent","textAlign","fontStyle","bottom","left","SyncGrid","overflowY","gridTemplateColumns","alignContent","gridGap","SyncFooter","setEncryptionKey","peerStatus","openSyncFileDialog","createSyncFileDialog","errorMsgVersionThemBad","errorMsgVersionUsBad","IGNORED_ERROR_CODES","fileDialogFilters","SyncView","focusState","listenForSyncPeers","syncPeer","listen","lastClosed","serverPeers","setServerPeers","syncErrors","setSyncErrors","syncRequests","setSyncRequests","peerListener","updatedServerPeers","newErrors","peer","topic","newSyncRequests","since","serverPeer","has","lastCompletedDate","parseVersionMajor","usVersion","themVersion","deviceName","started","getPeerProgress","getPeersStatus","peerId","opts","file","usePeers","showOpenDialog","filePaths","peerState","db","versionString","major","isNaN","IDLE","AVAILABLE","DOWNLOADING","PROGRESS","READY_FOR_RESTART","ERROR","INACTIVE","updateAvailable","updateNotAvailable","downloadButtonText","calculatingProgress","downloadProgress","restartMapeoText","restartMapeoButton","errorMessage","patchUpdate","minorUpdate","majorUpdate","unknownDownloadSpeed","estimatedDownloadTime","errors","ERR_UPDATER_CHANNEL_FILE_NOT_FOUND","UpdateTab","update","updateTab","STATES","internal","UpdaterView","setUpdate","UpdateAvailableView","DownloadProgressView","RestartView","UPDATE_NOT_AVAILABLE","UpdateNotAvailableView","updateInfo","estimatedTimeLeft","transferred","bytesPerSecond","seconds","downloadSpeed","minor","patch","handleDownlaoadClick","downloadUpdate","bps","downloadUpdateClick","marginTop","addUpdateStatusListener","onupdate","serverState","checkForUpdates","quitAndInstall","mapeditor","mapfilter","Root","Sidebar","Logo","MapeoIcon","LocationOn","StyledTabs","Tabs","StyledTab","Tab","TabContent","StyledPanel","Version","focusStates","entering","entered","exiting","exited","TabPanel","extras","transitionStyles","opacity","zIndex","in","transitionState","useTabIndex","Home","tabIndex","setTabIndex","updateListener","electronIpc","past","semver","next","files","b","UPDATE_INACTIVE","useUpdater","openLatLonDialog","openErrorDialog","console","openChangeLangDialog","reload","hasUpdate","updateStates","orientation","pkg","LatLon","app","getPath","bool","initialLocale","mdMsgs","mfMsgs","allMsgs","setLocale","handleLanguageChange","injectFirst","messages","getElementById","testMode","removeItem"],"mappings":"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EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,iC,cCAzBjC,EAAOD,QAAUkC,QAAQ,sD,cCAzBjC,EAAOD,QAAUkC,QAAQ,wB,cCAzBjC,EAAOD,QAAUkC,QAAQ,oB,cCAzBjC,EAAOD,QAAUkC,QAAQ,e,cCAzBjC,EAAOD,QAAUkC,QAAQ,kD,cCAzBjC,EAAOD,QAAUkC,QAAQ,wC,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,sD,cCAzBjC,EAAOD,QAAUkC,QAAQ,8D,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,kC,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,0B,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,yD,cCAzBjC,EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,cCAzBjC,EAAOD,QAAUkC,QAAQ,yB,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,cCAzBjC,EAAOD,QAAUkC,QAAQ,4B,cCAzBjC,EAAOD,QAAUkC,QAAQ,oC,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,uB,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,wD,cCAzBjC,EAAOD,QAAUkC,QAAQ,0D,cCAzBjC,EAAOD,QAAUkC,QAAQ,qC,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,qB,cCAzBjC,EAAOD,QAAUkC,QAAQ,Q,cCAzBjC,EAAOD,QAAUkC,QAAQ,O,cCAzBjC,EAAOD,QAAUkC,QAAQ,2D,cCAzBjC,EAAOD,QAAUkC,QAAQ,uD,cCAzBjC,EAAOD,QAAUkC,QAAQ,oC,cCAzBjC,EAAOD,QAAUkC,QAAQ,8B,cCAzBjC,EAAOD,QAAUkC,QAAQ,2B,c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","file":"build.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 111);\n","module.exports = require(\"react\");","module.exports = require(\"react-intl\");","module.exports = require(\"electron\");","module.exports = require(\"@material-ui/core\");","const winston = require('winston')\nconst path = require('path')\nconst DailyRotateFile = require('winston-daily-rotate-file')\nconst util = require('util')\n\nconst store = require('./store')\nconst appVersion = require('../package.json').version\n\nlet Bugsnag\n\nconst BUGSNAG_API_KEY = 'fcd92279c11ac971b4bd29b646ec4125'\n\nclass Logger {\n  constructor () {\n    this.winston = winston.createLogger()\n    this.configured = false\n    this._messageQueue = []\n    this._debug = store.get('debugging')\n  }\n\n  configure ({\n    userDataPath,\n    isDev,\n    label\n  }) {\n    this.isDev = isDev\n    this._startBugsnag(isDev ? 'development' : 'production')\n    const prettyPrint = winston.format.printf(({ level, message, label, timestamp }) => {\n      return `${timestamp} [${label}] ${level}: ${message}`\n    })\n\n    this.winston.format = winston.format.combine(\n      winston.format.label({ label }),\n      winston.format.timestamp(),\n      prettyPrint\n    )\n    this.dirname = path.join(userDataPath, 'logs')\n\n    for (const transport of this.winston.transports) {\n      if (transport.close) {\n        transport.close()\n      }\n    }\n\n    const mainLog = new (DailyRotateFile)({\n      filename: '%DATE%.log',\n      dirname: this.dirname,\n      datePattern: 'YYYY-MM-DD',\n      zippedArchive: true,\n      maxFiles: '365d',\n      level: 'info'\n    })\n    mainLog.name = 'main'\n    mainLog.on('new', () => {\n      // if debugging is on and a new log file is created, turn it off\n      this.debugging(false)\n    })\n    mainLog.on('rotate', () => {\n      // if debugging is on during a rotate, turn it off\n      this.debugging(false)\n    })\n    this.winston.add(mainLog)\n\n    const errorTransport = new (DailyRotateFile)({\n      filename: '%DATE%.error.log',\n      dirname: this.dirname,\n      datePattern: 'YYYY-MM',\n      zippedArchive: true,\n      maxFiles: '365d',\n      level: 'error'\n    })\n    this.winston.add(errorTransport)\n\n    if (isDev) {\n      this.winston.add(new winston.transports.Console({\n        level: 'debug'\n      }))\n    }\n    this.configured = true\n    if (this._messageQueue.length > 0) this._drainQueue()\n  }\n\n  debugging (debug) {\n    this._level(debug ? 'debug' : 'info')\n    store.set('debugging', debug)\n    this._debug = debug\n  }\n\n  _level (level) {\n    var port = this.winston.transports.find(t => t.name === 'main')\n    if (port) port.level = level\n    else this.error('logger', new Error('Could not find transport main'))\n  }\n\n  configured () {\n    return this.configured\n  }\n\n  _drainQueue () {\n    while (this._messageQueue.length) {\n      var msg = this._messageQueue.pop()\n      this._log(msg.level, msg.args)\n    }\n  }\n\n  _log (level, args) {\n    if (!this.configured) this._messageQueue.push({ level, args })\n    else {\n      this.winston.log({\n        level,\n        message: util.format(...args)\n      })\n      if (level === 'error') {\n        Bugsnag.notify(args[1], (event) => {\n          event.context = args[0]\n        })\n      }\n    }\n  }\n\n  warn () {\n    this._log('warn', Array.from(arguments))\n  }\n\n  error (context, err) {\n    if (!err) err = context\n    this._log('error', [context, err])\n  }\n\n  info () {\n    this._log('info', Array.from(arguments))\n  }\n\n  debug () {\n    this._log('debug', Array.from(arguments))\n  }\n\n  _startBugsnag (releaseStage) {\n    // This is really hacky because the @bugsnag/js package\n    // does not properly handle an electron background\n    // window with nodeIntegration: true\n    const args = {\n      releaseStage,\n      apiKey: BUGSNAG_API_KEY,\n      appVersion,\n      enabledReleaseStages: ['production']\n    }\n\n    setTimeout(function () {}).__proto__.unref = function () {}\n    try {\n      Bugsnag = require('@bugsnag/node')\n      Bugsnag.start(args)\n    } catch (err) {\n      logger.error('Failed to load bugsnag!', err)\n      Bugsnag = require('@bugsnag/browser')\n      Bugsnag.start(args)\n    }\n  }\n}\n\nconst logger = new Logger()\n\nmodule.exports = logger\n","module.exports = require(\"@material-ui/core/styles\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/map\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/object/assign\");","module.exports = require(\"@material-ui/core/Button\");","module.exports = require(\"@babel/runtime-corejs3/helpers/extends\");","module.exports = require(\"styled-components\");","module.exports = require(\"@material-ui/core/MenuItem\");","module.exports = require(\"@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\");","module.exports = require(\"@material-ui/core/DialogContent\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/date/now\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/object/keys\");","module.exports = require(\"@material-ui/core/Dialog\");","module.exports = require(\"@material-ui/core/DialogTitle\");","module.exports = require(\"path\");","module.exports = require(\"@material-ui/core/DialogActions\");","module.exports = require(\"@material-ui/icons\");","module.exports = require(\"@material-ui/core/AppBar\");","module.exports = require(\"@material-ui/core/Toolbar\");","module.exports = require(\"@material-ui/core/FormControl\");","module.exports = require(\"@material-ui/core/Typography\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\");","module.exports = require(\"id-mapeo\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\");","module.exports = require(\"@material-ui/core/Select\");","module.exports = require(\"react-mapfilter\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/map\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/find\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\");","module.exports = require(\"react-dom\");","const Store = require('conf')\n\nconst store = new Store({\n  projectName: 'Mapeo',\n  projectSuffix: '',\n  configName: 'mapeo-settings'\n})\n\nmodule.exports = store\n","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\");","module.exports = require(\"lodash/debounce\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\");","module.exports = require(\"ky/umd\");","module.exports = require(\"@material-ui/core/IconButton\");","module.exports = require(\"@material-ui/core/Tooltip\");","module.exports = require(\"@material-ui/icons/MoreVert\");","module.exports = require(\"@material-ui/core/Menu\");","module.exports = require(\"fs-write-stream-atomic\");","module.exports = require(\"pump\");","module.exports = require(\"react-mapfilter/commonjs/ViewWrapper\");","module.exports = require(\"@material-ui/icons/Error\");","module.exports = require(\"@material-ui/core/Paper\");","module.exports = require(\"@material-ui/core/InputLabel\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/set-timeout\");","module.exports = require(\"@material-ui/styles\");","module.exports = require(\"electron-is-dev\");","module.exports = require(\"insert-css\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/promise\");","module.exports = require(\"@material-ui/core/DialogContentText\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/trim\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/parse-float\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/find-index\");","module.exports = require(\"d3-dsv\");","module.exports = require(\"node-wifi\");","module.exports = require(\"react-intl-formatted-duration\");","module.exports = require(\"semver\");","module.exports = require(\"@material-ui/core/CssBaseline\");","module.exports = require(\"@material-ui/core/Tabs\");","module.exports = require(\"@material-ui/core/Tab\");","module.exports = require(\"react-transition-group\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/every\");","module.exports = require(\"@material-ui/core/Input\");","module.exports = require(\"mapbox-gl\");","module.exports = require(\"react-error-boundary\");","module.exports = require(\"@material-ui/icons/Map\");","module.exports = require(\"@material-ui/icons/Apps\");","module.exports = require(\"@material-ui/icons/LibraryBooks\");","module.exports = require(\"clsx\");","module.exports = require(\"yazl\");","module.exports = require(\"run-parallel-limit\");","module.exports = require(\"once\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/sort\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\");","module.exports = require(\"@material-ui/core/FormHelperText\");","module.exports = require(\"flat\");","module.exports = require(\"@segment/isodate\");","module.exports = require(\"utm\");","module.exports = require(\"fs\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/number/parse-int\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/set-interval\");","module.exports = require(\"@material-ui/icons/PhoneAndroid\");","module.exports = require(\"@material-ui/icons/Laptop\");","module.exports = require(\"@material-ui/icons/Usb\");","module.exports = require(\"@material-ui/icons/Check\");","module.exports = require(\"@fortawesome/react-fontawesome\");","module.exports = require(\"@fortawesome/free-solid-svg-icons\");","module.exports = require(\"@material-ui/core/CircularProgress\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/instance/reduce\");","module.exports = require(\"@babel/runtime-corejs3/core-js-stable/array/from\");","module.exports = require(\"winston\");","module.exports = require(\"winston-daily-rotate-file\");","module.exports = require(\"util\");","module.exports = require(\"conf\");","module.exports = require(\"@bugsnag/node\");","module.exports = require(\"@bugsnag/browser\");","module.exports = require(\"core-js/es/reflect\");","module.exports = require(\"react-mapfilter/translations/en.json\");","module.exports = require(\"react-mapfilter/translations/es.json\");","module.exports = require(\"react-mapfilter/translations/pt.json\");","import { createMuiTheme } from '@material-ui/core/styles'\n\nconst systemFontFamily = [\n  '-apple-system',\n  'BlinkMacSystemFont',\n  '\"Segoe UI\"',\n  'Roboto',\n  '\"Helvetica Neue\"',\n  'Arial',\n  'sans-serif',\n  '\"Apple Color Emoji\"',\n  '\"Segoe UI Emoji\"',\n  '\"Segoe UI Symbol\"'\n].join(',')\n\nexport default createMuiTheme({\n  typography: {\n    fontFamily: 'Rubik, sans-serif',\n    body1: {\n      fontFamily: systemFontFamily\n    },\n    body2: {\n      fontFamily: systemFontFamily\n    },\n    caption: {\n      fontFamily: systemFontFamily\n    }\n  },\n  palette: {\n    primary: {\n      main: '#0066FF'\n    },\n    secondary: {\n      main: '#FF9933'\n    }\n  }\n})\n","import { remote } from 'electron'\nimport 'core-js/es/reflect'\nimport ky from 'ky/umd'\nimport logger from '../logger'\n\nconst BASE_URL = 'http://' + remote.getGlobal('osmServerHost') + '/'\n\nexport default Api({\n  // window.middlewareClient is set in src/middleware/client-preload.js\n  ipc: window.middlewareClient,\n  baseUrl: BASE_URL\n})\n\nfunction Api ({ baseUrl, ipc }) {\n  // We append this to requests for presets and map styles, in order to override\n  // the local static server cache whenever the app is restarted. NB. sprite,\n  // font, and map tile requests might still be cached, only changes in the map\n  // style will be cache-busted.\n  const startupTime = Date.now()\n\n  const req = ky.extend({\n    prefixUrl: baseUrl,\n    // No timeout because indexing after first sync takes a long time, which mean\n    // requests to the server take a long time\n    timeout: false,\n    headers: {\n      'cache-control': 'no-cache',\n      pragma: 'no-cache'\n    }\n  })\n\n  function logRequest (prefix, promise) {\n    const start = Date.now()\n    promise\n      .then(data => {\n        logger.debug(prefix, Date.now() - start + 'ms')\n      })\n      .catch(error => {\n        // Preset errors aren't fatal errors.\n        if (prefix.indexOf('presets') > -1) logger.info(prefix, error)\n        else logger.error(prefix, error)\n      })\n    return promise\n  }\n  // Request convenience methods that wait for the server to be ready\n  function get (url) {\n    return logRequest('<GET: ' + url, req.get(url).json())\n  }\n  function del (url) {\n    return logRequest('<DEL: ' + url, req.delete(url).json())\n  }\n  function put (url, data) {\n    return logRequest('<PUT: ' + url, req.put(url, { json: data }).json())\n  }\n  function post (url, data) {\n    return logRequest('<POST: ' + url, req.post(url, { json: data }).json())\n  }\n\n  // All public methods\n  const api = {\n    /**\n     * GET async methods\n     */\n\n    getPresets: function getPresets (id) {\n      if (!id) id = 'default'\n      return get(`presets/${id}/presets.json?${startupTime}`)\n    },\n\n    getObservations: function getObservations () {\n      return get('observations')\n    },\n\n    getMapStyle: function getMapStyle (id) {\n      return get(`styles/${id}/style.json?${startupTime}`)\n    },\n\n    /**\n     * DELETE methods\n     */\n\n    deleteObservation: function deleteObservation (id) {\n      return del(`observations/${id}`)\n    },\n\n    /**\n     * PUT and POST methods\n     */\n\n    updateObservation: function updateObservation (id, value) {\n      const valueForServer = {\n        ...value,\n        type: 'observation',\n        schemaVersion: 3,\n        id\n      }\n      return put(`observations/${id}`, valueForServer)\n    },\n\n    createObservation: function createObservation (value) {\n      const valueForServer = {\n        ...value,\n        type: 'observation',\n        schemaVersion: 3\n      }\n      return post('observations', valueForServer)\n    },\n\n    /**\n     * SYNC methods\n     */\n\n    // Listens to the server for updates to the list of peers available for sync\n    // returns a remove() function to unscubribe\n    addPeerListener: function addPeerListener (handler) {\n      // We sidestep the http API here, and instead of polling the endpoint, we\n      // listen for an event from mapeo-core whenever the peers change, then\n      // request an updated peer list.\n      function onPeerUpdate (peers) {\n        logger.debug('peer-update', peers)\n        handler(peers)\n      }\n      ipc.on('peer-update', onPeerUpdate)\n      api.syncGetPeers().then(handler)\n      return {\n        remove: () => ipc.removeListener('peer-update', onPeerUpdate)\n      }\n    },\n\n    addDataChangedListener: function (ev, handler) {\n      ipc.on('sync-complete', handler)\n      ipc.on(ev, handler)\n      return {\n        remove: () => {\n          ipc.removeListener('sync-complete', handler)\n          ipc.removeListener(ev, handler)\n        }\n      }\n    },\n\n    getEncryptionKey: function () {\n      return new Promise((resolve, reject) => {\n        ipc.send('encryption-key', null, (err, encryptionKey) => {\n          if (err) return reject(err)\n          resolve(encryptionKey)\n        })\n      })\n    },\n\n    // Start listening for sync peers and advertise with `deviceName`\n    syncJoin: function syncJoin () {\n      logger.debug('Join sync')\n      ipc.send('sync-join')\n    },\n\n    // Stop listening for sync peers and stop advertising\n    syncLeave: function syncLeave () {\n      logger.debug('Leave sync')\n      ipc.send('sync-leave')\n    },\n\n    // Get a list of discovered sync peers\n    syncGetPeers: function syncGetPeers () {\n      return get('sync/peers').then(data => data && data.message)\n    },\n\n    // Start sync with a peer\n    syncStart: function syncStart (target) {\n      ipc.send('sync-start', target)\n    },\n\n    exportData: function (filename, { format = 'geojson' } = {}) {\n      return new Promise((resolve, reject) => {\n        ipc.send('export-data', { filename, format }, (err) => {\n          if (err) {\n            logger.error('export data', err)\n            reject(err)\n          } else resolve()\n        })\n      })\n    },\n\n    /**\n     * HELPER synchronous methods\n     */\n\n    // Return the url for an icon\n    getIconUrl: function getIconUrl (iconId, size = 'medium') {\n      // Some devices are @4x or above, but we only generate icons up to @3x\n      // Also we don't have @1.5x, so we round it up\n      const roundedRatio = Math.min(Math.ceil(window.devicePixelRatio), 3)\n      return `${baseUrl}presets/default/icons/${iconId}-medium@${roundedRatio}x.png`\n    },\n\n    // Return the url for a media attachment\n    getMediaUrl: function getMediaUrl (attachmentId, size = 'preview') {\n      return `${baseUrl}media/${size}/${attachmentId}`\n    },\n\n    // Return the url to a map style\n    getMapStyleUrl: function getMapStyleUrl (id) {\n      return `${baseUrl}styles/${id}/style.json?${startupTime}`\n    },\n\n    zoomToData: function (type, cb) {\n      ipc.send('zoom-to-data-get-centroid', type, cb)\n    }\n  }\n\n  return api\n}\n","import React from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport ExportIcon from '@material-ui/icons/MoreVert'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Dialog from '@material-ui/core/Dialog'\nimport MuiDialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport Button from '@material-ui/core/Button'\nimport { LinearProgress } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { remote } from 'electron'\n\nimport logger from '../../../logger'\nimport api from '../../new-api'\n\nconst m = defineMessages({\n  // Button tooltip on iD Editor toolbar\n  exportButton: 'Export map data',\n  // Menu item for exporting GeoJSON\n  exportGeoJson: 'Export GeoJSON',\n  // Menu item for exporting Shapefile\n  exportShapefile: 'Export Shapefile',\n  // OK button after successful export\n  okButton: 'OK',\n  // Close button after export error\n  closeButton: 'Close',\n  // Export dialog title - shown during export progress and after success/failure\n  dialogTitle: 'Exporting data',\n  // Export success message,\n  dialogSuccess: 'Export complete',\n  // Expor error message - if there was an error during export\n  dialogError: 'Export failed due to an internal error',\n  // Save dialog title\n  saveTitle: 'Export map data',\n  // Default filename for map export\n  defaultFilename: 'mapeo-map-data'\n})\n\nconst DialogTitle = () => (\n  <MuiDialogTitle id='dialog-title'>\n    <FormattedMessage {...m.dialogTitle} />\n  </MuiDialogTitle>\n)\n\nconst DialogAction = ({ children, onClick }) => (\n  <DialogActions>\n    <Button onClick={onClick} color='primary' variant='contained' autoFocus>\n      {children}\n    </Button>\n  </DialogActions>\n)\n\nconst ExportButton = () => {\n  const { formatMessage: t } = useIntl()\n  const [status, setStatus] = React.useState('idle')\n  const cx = useStyles()\n  const [menuAnchor, setMenuAnchor] = React.useState(null)\n\n  const handleExportClick = event => {\n    setMenuAnchor(event.currentTarget)\n  }\n\n  const handleMenuItemClick = format => () => {\n    setMenuAnchor(null)\n    const ext = format === 'shapefile' ? 'zip' : 'geojson'\n    remote.dialog.showSaveDialog(\n      {\n        title: t(m.saveTitle),\n        defaultPath: t(m.defaultFilename) + '.' + ext,\n        filters: [{ name: format, extensions: [ext] }]\n      }\n    ).then(({ canceled, filePath }) => {\n      if (!filePath || canceled) return\n      setStatus('pending')\n      api\n        .exportData(filePath, { format })\n        .then(() => {\n          setStatus('success')\n        })\n        .catch(err => {\n          setStatus('reject')\n          logger.error('ExportButton save dialog', err)\n        })\n    }\n    )\n  }\n\n  const close = event => {\n    setStatus('idle')\n  }\n\n  let dialogContent\n  switch (status) {\n    case 'idle':\n      dialogContent = null\n      break\n    case 'pending':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <LinearProgress indeterminate />\n          </DialogContent>\n        </>\n      )\n      break\n    case 'success':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <DialogContentText>\n              <FormattedMessage {...m.dialogSuccess} />\n            </DialogContentText>\n          </DialogContent>\n          <DialogAction onClick={close}>\n            <FormattedMessage {...m.okButton} />\n          </DialogAction>\n        </>\n      )\n      break\n    case 'reject':\n      dialogContent = (\n        <>\n          <DialogTitle />\n          <DialogContent>\n            <DialogContentText>\n              <FormattedMessage {...m.dialogError} />\n            </DialogContentText>\n          </DialogContent>\n          <DialogAction onClick={close}>\n            <FormattedMessage {...m.closeButton} />\n          </DialogAction>\n        </>\n      )\n      break\n  }\n\n  return (\n    <>\n      <Tooltip title={t(m.exportButton)}>\n        <IconButton\n          aria-label='export'\n          onClick={handleExportClick}\n          aria-controls='export-menu'\n          aria-haspopup='true'\n          className={cx.button}\n        >\n          <ExportIcon />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        id='export-menu'\n        anchorEl={menuAnchor}\n        open={Boolean(menuAnchor)}\n        onClose={handleMenuItemClick(null)}\n      >\n        <MenuItem onClick={handleMenuItemClick('geojson')}>\n          <FormattedMessage {...m.exportGeoJson} />\n        </MenuItem>\n      </Menu>\n      <Dialog\n        open={status !== 'idle'}\n        aria-labelledby='dialog-title'\n        maxWidth='xs'\n        fullWidth\n        disableBackdropClick={status === 'pending'}\n        disableEscapeKeyDown={status === 'pending'}\n        onClose={() => setStatus('idle')}\n      >\n        {dialogContent}\n      </Dialog>\n    </>\n  )\n}\n\nexport default ExportButton\n\nconst useStyles = makeStyles({\n  button: {\n    width: 40,\n    margin: '0 5px'\n  }\n})\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { ipcRenderer, remote, shell } from 'electron'\nimport iD from 'id-mapeo'\nimport debounce from 'lodash/debounce'\nimport insertCss from 'insert-css'\n\nimport api from '../../new-api'\nimport { defineMessages, useIntl } from 'react-intl'\nimport ExportButton from './ExportButton'\n\nconst m = defineMessages({\n  'feedback-contribute-button': 'Feedback & Contribute',\n  notes: 'Description'\n})\n\n// iD Editor style overrides\ninsertCss(`\n  .id-container .header {\n    height: 64px;\n  }\n  .id-container .pane {\n    bottom: 0;\n  }\n  .id-container .entity-editor-pane .inspector-body, .id-container .selection-list-pane .inspector-body {\n    top: 64px;\n  }\n  .id-container #bar {\n    height: 64px;\n    background-color: white;\n    padding: 0 8px 0 8px;\n    align-items: center;\n  }\n  .id-container #bar .toolbar-item .item-label {\n    display: none;\n  }\n  .id-container #bar .toolbar-item .item-content {\n    flex: 1;\n    display: inline-flex;\n    border-radius: 4px;\n  }\n  .id-container #bar .toolbar-item.sidebar-toggle {\n    display: none;\n  }\n  .id-container #bar > .toolbar-item.spacer:nth-child(2) {\n    display: none;\n  }\n  .id-container button.bar-button {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    background-color: rgba(0,0,0,0);\n    height: 44px;\n    font-family: Rubik, sans-serif;\n    font-weight: 500;\n    line-height: 1.75;\n    font-size: 0.875rem;\n    padding: 0 16px;\n  }\n  .id-container [dir='ltr'] .add-point .tooltip {\n    left: 0 !important;\n  }\n  .id-container [dir='ltr'] .add-point .tooltip .tooltip-arrow {\n    left: 20px;\n  }\n  .id-container button.bar-button.active {\n    background-color: #7092ff;\n  }\n  .id-container button.bar-button:not(:last-child) {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n  .id-container button.bar-button:not(:first-child) {\n    border-left: 1px solid transparent;\n    margin-left: -1px;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  }\n  .id-container .joined > *:last-child {\n    border-right-width: 1px;\n  }\n  .id-container button.save .count {\n    min-width: auto;\n    padding-left: 8px\n  }\n  .id-container #bar .mapeo-toolbar-item.mapeo-spacer {\n    width: 100%;\n    flex-grow: 2;\n  }\n  .id-container #bar .mapeo-toolbar-item {\n    display: flex;\n    flex: 0 1 auto;\n    flex-flow: column wrap;\n    justify-content: center;\n    position: relative;\n  }\n`)\n\nconst { localStorage, location } = window\n\nconst MapEditor = () => {\n  const rootRef = React.useRef()\n  const id = React.useRef()\n  const customDefs = React.useRef()\n  const { formatMessage: t, locale } = useIntl()\n  const [toolbarEl, setToolbarEl] = React.useState()\n\n  const zoomToData = React.useCallback((_, loc) => {\n    if (!id.current) return\n    id.current.map().centerZoomEase(loc, 14, 1000)\n  }, [])\n\n  React.useEffect(\n    function setupListeners () {\n      ipcRenderer.on('zoom-to-data-node', zoomToData)\n      ipcRenderer.on('zoom-to-latlon-response', zoomToData)\n      return () => {\n        ipcRenderer.removeListener('zoom-to-data-node', zoomToData)\n        ipcRenderer.removeListener('zoom-to-latlon-response', zoomToData)\n      }\n    },\n    [zoomToData]\n  )\n\n  React.useEffect(() => {\n    function refreshWindow () {\n      if (!id.current) return\n      var history = id.current.history()\n      var saved = history.toJSON()\n      id.current.flush()\n      if (saved) history.fromJSON(saved)\n      api.zoomToData('node', (_, loc) => {\n        zoomToData(_, loc)\n      })\n    }\n    const subscription = api.addDataChangedListener('observation-edit', () =>\n      refreshWindow()\n    )\n    return () => {\n      subscription.remove()\n    }\n  }, [zoomToData])\n\n  React.useEffect(function saveLocation () {\n    var prevhash = localStorage.getItem('location')\n    if (prevhash) location.hash = prevhash\n\n    const onHashChange = debounce(() => {\n      localStorage.setItem('location', window.location.hash)\n    }, 200)\n\n    window.addEventListener('hashchange', onHashChange)\n\n    return () => {\n      window.removeEventListener('hashchange', onHashChange)\n    }\n  }, [])\n\n  React.useLayoutEffect(\n    function initIdEditor () {\n      if (!rootRef.current) return\n      updateSettings()\n\n      var serverUrl = 'http://' + remote.getGlobal('osmServerHost')\n      id.current = window.id = iD\n        .coreContext()\n        .assetPath('node_modules/id-mapeo/dist/')\n        .preauth({ url: serverUrl })\n        .minEditableZoom(window.localStorage.getItem('minEditableZoom') || 14)\n\n      // Calling iD.coreContext() detects the locale from the browser. We need\n      // to override it with the app locale, before we call ui()\n      id.current.locale(locale)\n\n      if (!customDefs.current) {\n        customDefs.current = id.current\n          .container()\n          .append('svg')\n          .style('position', 'absolute')\n          .style('width', '0px')\n          .style('height', '0px')\n          .attr('id', 'custom-defs')\n          .append('defs')\n\n        customDefs.current.append('svg')\n      }\n\n      id.current.ui()(rootRef.current, function onLoad () {\n        var links = document.querySelectorAll('.id-container a[href^=\"http\"]')\n        links.forEach(function (link) {\n          var href = link.getAttribute('href')\n          link.onclick = function (event) {\n            event.preventDefault()\n            shell.openExternal(href)\n            return false\n          }\n        })\n\n        var contributeBtn = document.querySelector(\n          '.id-container .overlay-layer-attribution a'\n        )\n        if (contributeBtn) {\n          contributeBtn.innerHTML = t(m['feedback-contribute-button'])\n        }\n\n        // Add custom buttons to toolbar\n        const toolbar = id.current.container().select('#bar')\n        toolbar.append('div').attr('class', 'mapeo-toolbar-item mapeo-spacer')\n        setToolbarEl(toolbar.append('div').node())\n\n        // Update label on map move\n        var aboutList = id.current.container().select('#about-list')\n        var map = id.current.map()\n        var latlon = aboutList\n          .append('li')\n          .append('span')\n          .text(latlonToPosString(map.center()))\n        id.current.container().on('mousemove', function () {\n          var pos = map.mouseCoordinates()\n          var s = latlonToPosString(pos)\n          latlon.text(s)\n        })\n\n        updateSettings()\n\n        // iD uses onbeforeunload to prompt the user about unsaved changes.\n        // Electron does not prompt the user on this event, and iD saves changes\n        // to local storage anyway, so we can just ignore it\n        window.onbeforeunload = e => {\n          if (!id.current || typeof id.current.context !== 'function') return\n          id.current.context().save()\n          // This guarantees that the unload continues\n          delete e.returnValue\n        }\n        // setTimeout(() => id.current.flush(), 1500)\n      })\n    },\n    // This should have a dependency of `t` and `locale`, so that it re-runs if\n    // the locale or the `t` function changes, but we don't have an easy way to\n    // teardown iD editor and then recreate it, so we need to never re=-run this\n    // effect\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  function updateSettings () {\n    var presets = ipcRenderer.sendSync('get-user-data', 'presets')\n    var customCss = ipcRenderer.sendSync('get-user-data', 'css')\n    var imagery = ipcRenderer.sendSync('get-user-data', 'imagery')\n    var icons = ipcRenderer.sendSync('get-user-data', 'icons')\n    var translations = ipcRenderer.sendSync('get-user-data', 'translations')\n\n    if (translations && id.current) {\n      const currentLocale = id.current.locale()\n      // Todo fallback should be default language of presets. Currently it's\n      // random - it just uses the first locale returned from Object.keys()\n      const translationsInLocale =\n        translations[currentLocale] ||\n        translations[Object.keys(translations)[0]] ||\n        {}\n      if (translationsInLocale.presets) {\n        ;(iD.translations[currentLocale] || iD.translations.en).presets =\n          translationsInLocale.presets\n      }\n    }\n    if (presets) {\n      fallbackFields.notes.label = t(m.notes) // translate notes field\n      const iDPresets = convertPresets(presets)\n\n      if (!id.current) {\n        iDPresets.fields = { ...iD.data.presets.fields, ...iDPresets.fields }\n        iD.data.presets = iDPresets\n      }\n    }\n    if (customCss) insertCss(customCss)\n    if (imagery) {\n      // iD upgraded to use 'dataImagery' in 2.14.3, this is for backwards\n      // compatibility\n      if (imagery.dataImagery) imagery = imagery.dataImagery\n      imagery.forEach((img, idx) => {\n        // Add id\n        img.id = img.name + '_' + idx\n        iD.data.imagery.unshift(img)\n      })\n    }\n    if (icons) {\n      var parser = new window.DOMParser()\n      var iconsSvg = parser.parseFromString(icons, 'image/svg+xml')\n        .documentElement\n      var defs = customDefs.current && customDefs.current.node()\n      if (defs) defs.replaceChild(iconsSvg, defs.firstChild)\n    }\n  }\n\n  return (\n    <div className='id-container'>\n      <div ref={rootRef} />\n      {toolbarEl && ReactDOM.createPortal(<ExportButton />, toolbarEl)}\n    </div>\n  )\n}\n\nexport default MapEditor\n\nfunction latlonToPosString (pos) {\n  pos[0] = (Math.floor(pos[0] * 1000000) / 1000000).toString()\n  pos[1] = (Math.floor(pos[1] * 1000000) / 1000000).toString()\n  while (pos[0].length < 10) pos[0] += '0'\n  while (pos[1].length < 10) pos[1] += '0'\n  return pos.toString()\n}\n\n// iD Editor requires that [fallback presets are\n// defined](https://github.com/openstreetmap/iD/tree/develop/data/presets#custom-presets),\n// so that entities on the map always match _something_.\nconst fallbackPresets = {\n  area: {\n    name: 'Area',\n    tags: {},\n    geometry: ['area'],\n    matchScore: 0.1\n  },\n  line: {\n    name: 'Line',\n    tags: {},\n    geometry: ['line'],\n    matchScore: 0.1\n  },\n  point: {\n    name: 'Point',\n    tags: {},\n    geometry: ['point', 'vertex'],\n    matchScore: 0.1\n  },\n  relation: {\n    name: 'Relation',\n    tags: {},\n    geometry: ['relation'],\n    matchScore: 0.1\n  }\n}\n\n// iD Editor requires that a \"name\" field is always defined.\nconst fallbackFields = {\n  name: {\n    key: 'name',\n    type: 'localized',\n    label: 'Name',\n    placeholder: 'Common name (if any)'\n  },\n  notes: {\n    key: 'notes',\n    type: 'textarea',\n    label: 'Description'\n  }\n}\n\n/**\n * Presets for Mapeo use a slightly different schema than presets for iD Editor.\n * Currently the main difference is select_one fields\n */\nfunction convertPresets (presetsObj) {\n  const fields = { ...fallbackFields, ...presetsObj.fields }\n  const presets = { ...fallbackPresets, ...presetsObj.presets }\n\n  // In Mapeo Mobile (and Observation View) we do not yet use the preset.tags\n  // property to match presets to entities on the map. Instead we match based on\n  // categoryId === presetId. For using presets from Mapeo Mobile in iD, if a\n  // preset does not have any properties set on `preset.tags` then we use\n  // `categoryId`\n  Object.keys(presets).forEach(presetId => {\n    const preset = presets[presetId]\n    if (\n      Object.keys(preset.tags || {}).length === 0 &&\n      // Skip for fallback presets `point`, `line`, `area`, `relation`\n      !Object.keys(fallbackPresets).includes(presetId)\n    ) {\n      presets[presetId] = {\n        ...preset,\n        tags: {\n          categoryId: presetId\n        }\n      }\n    }\n  })\n\n  Object.keys(fields).forEach(fieldId => {\n    const field = fields[fieldId]\n    let type\n    let snakeCase\n    switch (field.type) {\n      // The iD equivalent of the mapeo select_one is a `combo` field\n      case 'select_one':\n        type = 'combo'\n        // iD defaults to combo fields being \"snake case\", which means that it\n        // converts any value selected / entered to snake case. Mapeo defaults\n        // snake_case to false.\n        snakeCase =\n          typeof field.snake_case === 'boolean' ? field.snake_case : false\n        break\n      // iD equivalent of select_multiple is `semiCombo`, but note that iD\n      // stores the value as a semi-colon separated string, whereas Mapeo will\n      // store this as an array, so this field is not compatible between the\n      // two.\n      case 'select_multiple':\n        type = 'semiCombo'\n        break\n      // Mapeo does not have a `textarea` field, instead text fields have an\n      // appearance of `singleline` or `multiline`, with the default\n      // `multiline`.\n      case 'text':\n        if (!field.appearance || field.appearance === 'multiline') {\n          type = 'textarea'\n        } else {\n          type = 'text'\n        }\n        break\n      default:\n        type = field.type\n    }\n\n    fields[fieldId] = {\n      ...field,\n      type,\n      snake_case: snakeCase\n    }\n\n    // Mapeo supports translatable descriptions of field values for select\n    // fields with an array of option objects with \"label\" and \"value\"\n    // properties. iD supports this with a separate property `strings.options`\n    // which is an object of value:name pairs. This does not allow ordering of\n    // options like Mapeo supports.\n    // https://github.com/openstreetmap/iD/tree/develop/data/presets#strings\n    if (\n      Array.isArray(field.options) &&\n      field.options.every(opt => typeof opt === 'object')\n    ) {\n      const mapeoOptions = field.options\n      const iDStringOptions = {}\n      mapeoOptions.forEach(opt => {\n        iDStringOptions[opt.value] = opt.label\n      })\n      delete fields[fieldId].options\n      fields[fieldId].strings = { options: iDStringOptions }\n    }\n  })\n\n  return {\n    ...presetsObj,\n    fields,\n    presets\n  }\n}\n","import DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Input from '@material-ui/core/Input'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormControl from '@material-ui/core/FormControl'\nimport React, { useState } from 'react'\nimport { ipcRenderer } from 'electron'\n\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst m = defineMessages({\n  'dialog-enter-latlon-coordinates': 'Enter Coordinates',\n  'button-submit': 'Submit'\n})\n\nconst LatLonDialog = ({ onClose, open }) => {\n  const { formatMessage: t } = useIntl()\n  const [latLon, setLatLon] = useState()\n\n  const submitHandler = event => {\n    var rx = /(-?\\d+\\.?\\d*)[^01234567890-]+(-?\\d+\\.?\\d*)/\n    var match = rx.exec(latLon)\n    if (match) {\n      var pt = [parseFloat(match[1].trim()), parseFloat(match[2].trim())]\n      ipcRenderer.send('zoom-to-latlon-request', pt[0], pt[1])\n      onClose()\n    }\n    if (event) {\n      event.preventDefault()\n      event.stopPropagation()\n    }\n    return false\n  }\n\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle>{t(m['dialog-enter-latlon-coordinates'])}</DialogTitle>\n      <DialogContent>\n        <FormControl>\n          <Input\n            id='latlon-text'\n            placeholder='Lon, Lat'\n            type='text'\n            value={latLon}\n            onChange={event => setLatLon(event.target.value)}\n          />\n          <DialogActions>\n            <Button onClick={submitHandler}>{t(m['button-submit'])}</Button>\n          </DialogActions>\n        </FormControl>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default LatLonDialog\n","import React from 'react'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nexport default class ErrorDialog extends React.Component {\n  render () {\n    // TODO: escape this html for displaying newlines\n    return (\n      <Dialog open={this.props.open} onClose={this.props.onClose}>\n        <DialogTitle>Error</DialogTitle>\n        <DialogContent>\n          <textarea cols='20' rows='40' value={this.props.message} disabled />\n        </DialogContent>\n      </Dialog>\n    )\n  }\n}\n","import DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Select from '@material-ui/core/Select'\nimport Dialog from '@material-ui/core/Dialog'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormControl from '@material-ui/core/FormControl'\nimport React, { useState } from 'react'\n\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst languages = {\n  es: 'Espaol',\n  en: 'English',\n  fr: 'Franais',\n  pt: 'Portugus'\n}\n\nconst m = defineMessages({\n  'dialog-enter-language': 'Choose a language',\n  'button-submit': 'Submit',\n  'button-cancel': 'Cancel'\n})\n\nconst ChangeLanguage = ({ onCancel, onSelectLanguage, open }) => {\n  const { formatMessage: t, locale } = useIntl()\n  // Set default state to app locale\n  const [lang, setLang] = useState(locale)\n\n  const submitHandler = () => {\n    onSelectLanguage(lang)\n  }\n\n  const closeHandler = () => {\n    // This will remember state between open/close, so if the user cancels this\n    // should reset to the currently selected locale\n    setLang(locale)\n    onCancel()\n  }\n\n  return (\n    <Dialog open={open} onClose={onCancel} fullWidth maxWidth='xs'>\n      <DialogTitle>{t(m['dialog-enter-language'])}</DialogTitle>\n      <DialogContent>\n        <FormControl>\n          <Select\n            id='dialog-change-language'\n            value={lang}\n            onChange={event => setLang(event.target.value)}\n          >\n            {Object.keys(languages).map(code => (\n              <MenuItem key={code} value={code}>\n                {languages[code]} ({code})\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button color='default' onClick={closeHandler}>\n          {t(m['button-cancel'])}\n        </Button>\n        <Button color='primary' onClick={submitHandler}>\n          {t(m['button-submit'])}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default ChangeLanguage\n","import React from 'react'\nimport { remote } from 'electron'\nimport styled from 'styled-components'\n\nconst TitleBarArea = styled.div`\n  position: relative;\n  height: 22px;\n`\n\n// Create a space for MacOS title bar buttons on a frameless Window\nconst TitleBarShim = () => {\n  const win = remote.getCurrentWindow()\n  const titleBarSize = win.getSize()[1] - win.getContentSize()[1]\n  if (titleBarSize > 0) return null\n  return <TitleBarArea />\n}\n\nexport default TitleBarShim\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport MapIcon from '@material-ui/icons/Map'\nimport MediaIcon from '@material-ui/icons/Apps'\nimport ReportIcon from '@material-ui/icons/LibraryBooks'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Button from '@material-ui/core/Button'\nimport { defineMessages, useIntl } from 'react-intl'\nimport clsx from 'clsx'\n\nconst m = defineMessages({\n  mapTabLabel: 'Map',\n  mediaTabLabel: 'Media',\n  reportTabLabel: 'Report'\n})\n\nconst TabItem = ({ selected, ...props }) => {\n  const cx = useStyles()\n  return (\n    <Button\n      disableRipple\n      {...props}\n      className={clsx(cx.tabItem, selected && 'selected')}\n    />\n  )\n}\n\nconst MapFilterToolbar = ({ view, onChange, actionRight }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  const handleChange = view => e => onChange(view)\n  return (\n    <React.Fragment>\n      <AppBar\n        position='static'\n        color='inherit'\n        elevation={0}\n        className={cx.root}\n      >\n        <Toolbar className={cx.toolbar}>\n          <div className={cx.tabGroup}>\n            <TabItem\n              aria-label='map view'\n              selected={view === 'map'}\n              onClick={handleChange('map')}\n            >\n              <MapIcon />\n              <span className={cx.tabLabel}>{t(m.mapTabLabel)}</span>\n            </TabItem>\n            <TabItem\n              aria-label='media view'\n              selected={view === 'media'}\n              onClick={handleChange('media')}\n            >\n              <MediaIcon />\n              <span className={cx.tabLabel}>{t(m.mediaTabLabel)}</span>\n            </TabItem>\n            <TabItem\n              aria-label='report view'\n              selected={view === 'report'}\n              onClick={handleChange('report')}\n            >\n              <ReportIcon />\n              <span className={cx.tabLabel}>{t(m.reportTabLabel)}</span>\n            </TabItem>\n          </div>\n          {actionRight}\n        </Toolbar>\n      </AppBar>\n    </React.Fragment>\n  )\n}\n\nexport default MapFilterToolbar\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    borderLeft: '1px solid rgba(0, 0, 0, 0.12)',\n    '@media only print': {\n      display: 'none'\n    }\n  },\n  toolbar: {\n    justifyContent: 'space-between',\n    padding: '0 12px'\n  },\n  tabItem: {\n    height: '44px',\n    flex: '1',\n    border: '1px solid rgba(0, 0, 0, 0.12)',\n    color: 'rgba(0, 0, 0, 0.87)',\n    padding: '0 16px 0 16px',\n    justifyContent: 'stretch',\n    textTransform: 'capitalize',\n    '&.selected': {\n      color: 'white',\n      backgroundColor: '#2469f6 !important'\n    },\n    '&:not(:last-child)': {\n      borderTopRightRadius: '0',\n      borderBottomRightRadius: '0'\n    },\n    '&:not(:first-child)': {\n      borderLeft: '1px solid transparent',\n      marginLeft: '-1px',\n      borderTopLeftRadius: '0',\n      borderBottomLeftRadius: '0'\n    },\n    '& .MuiSvgIcon-root': {}\n  },\n  tab: {\n    height: 44,\n    flex: 1,\n    border: '1px solid rgba(0, 0, 0, 0.12)',\n    textTransform: 'capitalize',\n    color: 'rgba(0, 0, 0, 0.87)',\n    justifyContent: 'stretch',\n    '&.Mui-selected': {\n      color: 'white',\n      backgroundColor: '#2469F6 !important'\n    },\n    '& .MuiSvgIcon-root': {\n      marginRight: theme.spacing(1)\n    }\n  },\n  tabIcon: {},\n  tabLabel: {\n    fontFamily: theme.typography.fontFamily,\n    fontWeight: 500,\n    flex: 1\n  },\n  tabGroup: {\n    flex: 1,\n    maxWidth: 350,\n    display: 'inline-flex',\n    borderRadius: '4px',\n    backgroundColor: '#fff'\n  },\n  toolbarButton: {}\n}))\n","import React from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport MuiToolbar from '@material-ui/core/Toolbar'\nimport { FilterPanel } from 'react-mapfilter'\nimport { defineMessages, FormattedMessage } from 'react-intl'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { Typography } from '@material-ui/core'\n\nconst m = defineMessages({\n  filterHeader: 'Filter by'\n})\n\nconst LeftPanel = props => {\n  const cx = useStyles()\n  return (\n    <div className={cx.root}>\n      <AppBar\n        color='inherit'\n        position='static'\n        elevation={0}\n        className={cx.header}\n      >\n        <MuiToolbar>\n          <Typography variant='h6' component='h2'>\n            <FormattedMessage {...m.filterHeader} />\n          </Typography>\n        </MuiToolbar>\n      </AppBar>\n      <FilterPanel {...props} />\n    </div>\n  )\n}\n\nexport default LeftPanel\n\nconst useStyles = makeStyles({\n  root: {\n    flex: 0,\n    flexBasis: '30%',\n    minWidth: 300,\n    maxWidth: 400,\n    flexDirection: 'column',\n    display: 'flex',\n    backgroundColor: 'white',\n    '@media only print': {\n      display: 'none'\n    }\n  },\n  header: {\n    borderBottom: '1px solid rgba(0, 0, 0, 0.12)',\n    color: 'rgba(0, 0, 0, 0.7)'\n  }\n})\n","import React from 'react'\nimport styled from 'styled-components'\n\nconst Styled = styled.div`\n  display: inline-block;\n  position: relative;\n  width: 64px;\n  height: 64px;\n  div {\n    position: absolute;\n    top: 12px;\n    width: 11px;\n    height: 11px;\n    border-radius: 50%;\n    animation-timing-function: cubic-bezier(0, 1, 1, 0);\n  }\n  div:nth-child(1) {\n    left: 6px;\n    animation: lds-ellipsis1 0.6s infinite;\n  }\n  div:nth-child(2) {\n    left: 6px;\n    animation: lds-ellipsis2 0.6s infinite;\n    background-color: rgba(0, 5, 43, 1);\n  }\n  div:nth-child(3) {\n    left: 26px;\n    background-color: rgba(0, 5, 43, 1);\n    animation: lds-ellipsis2 0.6s infinite;\n  }\n  div:nth-child(4) {\n    left: 45px;\n    animation: lds-ellipsis3 0.6s infinite;\n  }\n  @keyframes lds-ellipsis1 {\n    0% {\n      transform: scale(0);\n      background-color: rgba(0, 5, 43, 0);\n    }\n    100% {\n      transform: scale(1);\n      background-color: rgba(0, 5, 43, 1);\n    }\n  }\n  @keyframes lds-ellipsis3 {\n    0% {\n      transform: scale(1);\n      background-color: rgba(0, 5, 43, 1);\n    }\n    100% {\n      transform: scale(0);\n      background-color: rgba(0, 5, 43, 0);\n    }\n  }\n  @keyframes lds-ellipsis2 {\n    0% {\n      transform: translate(0, 0);\n    }\n    100% {\n      transform: translate(19px, 0);\n    }\n  }\n`\n\nconst Loader = () => (\n  <Styled>\n    <div />\n    <div />\n    <div />\n    <div />\n  </Styled>\n)\n\nexport default Loader\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { defineMessages, useIntl } from 'react-intl'\nimport { Typography } from '@material-ui/core'\n\nimport Loader from '../Loader'\n\nconst m = defineMessages({\n  // Displayed whilst observations and presets load\n  loading: 'Loading'\n})\n\nconst Searching = () => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.root}>\n      <div className={cx.container}>\n        <Loader />\n        <div className={cx.text}>\n          <Typography gutterBottom variant='h2' className={cx.loadingTitle}>\n            {t(m.loading)}\n          </Typography>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Searching\n\nconst useStyles = makeStyles(theme => ({\n  text: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  container: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  loadingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  }\n}))\n","import { useState, useEffect } from 'react'\nimport api from '../../new-api'\n\nconst MapStyleProvider = ({ children }) => {\n  const [style, setStyle] = useState('mapbox://styles/mapbox/outdoors-v10')\n\n  useEffect(() => {\n    const offlineStyleURL = api.getMapStyleUrl('default')\n    // This is just to check whether an offline style is available, and if it\n    // is, use that as the map style. Otherwise, use the online mapbox style\n    api\n      .getMapStyle('default')\n      .then(() => setStyle(offlineStyleURL))\n      .catch(() => {})\n  }, [])\n\n  return children(style)\n}\n\nexport default MapStyleProvider\n","import yazl from 'yazl'\nimport run from 'run-parallel-limit'\nimport ky from 'ky/umd'\nimport once from 'once'\nimport logger from '../logger'\n\nconst concurrency = 3\n\n/**\n * Create a zipfile from a collection of strings/buffers and remote files\n * (remote files will be downloaded concurrently and streamed to the zipfile)\n *\n * @param {Array} localFiles Array of files to add to the zip archive. Must have\n * properties `data` which should be a Buffer or String, and `name`\n * which is the path to the file in the zipfile. Can also include options from\n * https://github.com/thejoshwolfe/yazl#addfilerealpath-metadatapath-options\n * @param {Array} remoteFiles Array of files to add to the zip archive. Must\n * have properties `url` and `name` which is the path to the file in the\n * zipfile. Can also include options from\n * https://github.com/thejoshwolfe/yazl#addfilerealpath-metadatapath-options\n * @returns {ReadableStream} readableStream of zipfile data\n */\nexport default function createZip (localFiles, remoteFiles) {\n  const zipfile = new yazl.ZipFile()\n  const missing = []\n\n  localFiles.forEach(({ data, metadataPath, ...options }) => {\n    if (typeof data === 'string') data = Buffer.from(data)\n    zipfile.addBuffer(data, metadataPath, options)\n  })\n\n  const tasks = remoteFiles.map(({ url, metadataPath, ...options }) => cb => {\n    cb = once(cb)\n    const start = Date.now()\n    logger.debug('Requesting', url)\n    // I tried doing this by adding streams to the zipfile, but it's really hard\n    // to catch errors when trying to download an image, so you end up with\n    // corrupt files in the zip. This uses a bit more memory, but images are\n    // only added once they have downloaded correctly\n    ky.get(url)\n      .arrayBuffer()\n      .then(arrBuf => {\n        logger.debug('Req end in ' + (Date.now() - start) + 'ms ' + metadataPath)\n        zipfile.addBuffer(Buffer.from(arrBuf), metadataPath, {\n          ...options,\n          store: true\n        })\n        cb()\n      })\n      .catch(err => {\n        missing.push(metadataPath)\n        logger.error('Error downloading file ' + metadataPath, err)\n        cb()\n      })\n  })\n  const start = Date.now()\n  logger.debug('Starting download')\n  run(tasks, concurrency, (...args) => {\n    logger.info('Downloaded images in ' + (Date.now() - start) + 'ms')\n    if (missing.length) {\n      zipfile.addBuffer(\n        Buffer.from(missing.join('\\r\\n') + '\\r\\n'),\n        'missing.txt'\n      )\n    }\n    zipfile.end()\n  })\n\n  return zipfile.outputStream\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport { TextField, DialogContentText } from '@material-ui/core'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport fsWriteStreamAtomic from 'fs-write-stream-atomic'\nimport path from 'path'\nimport { remote } from 'electron'\nimport pump from 'pump'\n\nimport ViewWrapper from 'react-mapfilter/commonjs/ViewWrapper'\n\nimport logger from '../../../logger'\nimport createZip from '../../create-zip'\n\nconst msgs = defineMessages({\n  // Title for webmaps export dialog\n  title: 'Export a map to share online',\n  // Save button\n  save: 'Save',\n  // cancel button\n  cancel: 'Cancel',\n  // Label for field to enter map title\n  titleLabel: 'Map Title',\n  // Label for field to enter map description\n  descriptionLabel: 'Map Description',\n  // Label for field to enter terms and conditions\n  termsLabel: 'Terms & Limitations',\n  // Helper text explaining terms and conditions field\n  termsHint: 'Add terms & limitations about how this data can be used',\n  // Label for field to enter custom map style\n  styleLabel: 'Map Style'\n})\n\n// const defaultMapStyle = 'mapbox://styles/mapbox/outdoors-v11'\n\nconst EditDialogContent = ({\n  observations,\n  getPreset,\n  getMediaUrl,\n  onClose\n}) => {\n  const classes = useStyles()\n  const { formatMessage } = useIntl()\n  const [saving, setSaving] = useState()\n  const [title, setTitle] = useState()\n  const [description, setDescription] = useState()\n  // const [terms, setTerms] = useState()\n  // const [mapStyle, setMapStyle] = useState(defaultMapStyle)\n\n  const handleClose = () => {\n    setSaving(false)\n    setTitle(undefined)\n    setDescription(undefined)\n    // setTerms(undefined)\n    // setMapStyle(defaultMapStyle)\n    onClose()\n  }\n\n  const handleSave = e => {\n    e.preventDefault()\n    setSaving(true)\n    const points = observationsToGeoJson(observations, getPreset)\n    const metadata = { title: title || '', description: description || '' }\n\n    remote.dialog.showSaveDialog(\n      {\n        title: 'Guardar Mapa',\n        defaultPath: 'mapa-para-web',\n        filters: [{ name: 'Mapeo Webmap Package', extensions: ['mapeomap'] }]\n      }\n    ).then(({ filePath, canceled }) => {\n      if (canceled) return handleClose()\n      const filepathWithExtension = path.join(\n        path.dirname(filePath),\n        path.basename(filePath, '.mapeomap') + '.mapeomap'\n      )\n      createArchive(filepathWithExtension, err => {\n        if (err) {\n          logger.error('MapExportDialog: Failed to create archive', err)\n        } else {\n          logger.debug('Successfully created map archive')\n        }\n        handleClose()\n      })\n    }).catch(handleClose)\n\n    function createArchive (filePath, cb) {\n      const output = fsWriteStreamAtomic(filePath)\n\n      const localFiles = [\n        {\n          data: JSON.stringify(points, null, 2),\n          metadataPath: 'points.json'\n        },\n        {\n          data: JSON.stringify(metadata, null, 2),\n          metadataPath: 'metadata.json'\n        }\n      ]\n\n      const remoteFiles = points.features\n        .filter(point => point.properties.image)\n        .map(point => ({\n          url: getMediaUrl(point.properties.image, 'original'),\n          metadataPath: 'images/' + point.properties.image\n        }))\n\n      const archive = createZip(localFiles, remoteFiles)\n\n      pump(archive, output, cb)\n    }\n  }\n\n  return (\n    <form noValidate autoComplete='off'>\n      <DialogTitle id='responsive-dialog-title' style={{ paddingBottom: 8 }}>\n        <FormattedMessage {...msgs.title} />\n      </DialogTitle>\n\n      <DialogContent className={classes.content}>\n        <DialogContentText>\n          {`Vas a exportar ${\n            observations.length\n          } puntos a un mapa para compartir por internet.`}\n        </DialogContentText>\n        <TextField\n          label={formatMessage(msgs.titleLabel)}\n          value={title}\n          fullWidth\n          variant='outlined'\n          onChange={e => setTitle(e.target.value)}\n          margin='normal'\n          disabled={saving}\n        />\n        <TextField\n          label={formatMessage(msgs.descriptionLabel)}\n          value={description}\n          fullWidth\n          rows={3}\n          rowsMax={6}\n          multiline\n          variant='outlined'\n          margin='normal'\n          disabled={saving}\n          onChange={e => setDescription(e.target.value)}\n        />\n        {/**\n            <TextField\n            label={formatMessage(msgs.termsLabel)}\n            helperText={formatMessage(msgs.termsHint)}\n            value={terms}\n            rows={2}\n            rowsMax={4}\n            fullWidth\n            multiline\n            variant='outlined'\n            margin='normal'\n            onChange={e => setTerms(e.target.value)}\n          />\n          <TextField\n            label={formatMessage(msgs.styleLabel)}\n            value={mapStyle}\n            helperText={\n              <>\n                Enter a{' '}\n                <a\n                  href='https://docs.mapbox.com/help/glossary/style-url/'\n                  target='_black'\n                  rel='noreferrer'\n                >\n                  Mapbox Style Url\n                </a>\n              </>\n            }\n            fullWidth\n            variant='outlined'\n            margin='normal'\n            onChange={e => setMapStyle(e.target.value)}\n          />\n          */}\n      </DialogContent>\n\n      <DialogActions>\n        <Button disabled={saving} onClick={handleClose}>\n          {formatMessage(msgs.cancel)}\n        </Button>\n        <Button\n          disabled={saving}\n          onClick={handleSave}\n          color='primary'\n          variant='contained'\n          type='submit'\n        >\n          {formatMessage(msgs.save)}\n        </Button>\n      </DialogActions>\n    </form>\n  )\n}\n\nexport default function EditDialog ({\n  observations,\n  presets,\n  filter,\n  getMediaUrl,\n  onClose,\n  open,\n  ...otherProps\n}) {\n  return (\n    <Dialog\n      fullWidth\n      open={open}\n      onClose={onClose}\n      scroll='body'\n      aria-labelledby='responsive-dialog-title'\n    >\n      {open && (\n        <ViewWrapper\n          observations={observations}\n          presets={presets}\n          filter={filter}\n          getMediaUrl={getMediaUrl}\n        >\n          {({ onClickObservation, filteredObservations, getPreset }) => (\n            <EditDialogContent\n              observations={filteredObservations}\n              getPreset={getPreset}\n              getMediaUrl={getMediaUrl}\n              onClose={onClose}\n              {...otherProps}\n            />\n          )}\n        </ViewWrapper>\n      )}\n    </Dialog>\n  )\n}\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    position: 'relative'\n  },\n  title: {\n    marginLeft: theme.spacing(2),\n    flex: 1\n  },\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingTop: 0\n  }\n}))\n\nfunction observationsToGeoJson (observations = [], getPreset) {\n  const features = observations.map(obs => {\n    const preset = getPreset(obs)\n    const title = preset ? preset.name : 'Observacin'\n    const description = obs.tags && (obs.tags.notes || obs.tags.note)\n    const date = obs.created_at\n    const image =\n      obs.attachments && obs.attachments.length > 0\n        ? obs.attachments[obs.attachments.length - 1].id\n        : undefined\n    const coords = obs.lon != null && obs.lat != null && [obs.lon, obs.lat]\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: coords\n      },\n      properties: {\n        title,\n        description,\n        date,\n        image\n      }\n    }\n  })\n  return {\n    type: 'FeatureCollection',\n    features\n  }\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport { DialogContentText } from '@material-ui/core'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Select from '@material-ui/core/Select'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport { csvFormat } from 'd3-dsv'\nimport ViewWrapper from 'react-mapfilter/commonjs/ViewWrapper'\nimport flatten from 'flat'\nimport isodate from '@segment/isodate'\nimport { fromLatLon } from 'utm'\nimport { remote } from 'electron'\nimport path from 'path'\nimport fs from 'fs'\nimport fsWriteStreamAtomic from 'fs-write-stream-atomic'\nimport pump from 'pump'\n\nimport logger from '../../../logger'\nimport createZip from '../../create-zip'\n\nconst msgs = defineMessages({\n  // Title for webmaps export dialog\n  title: 'Export Observations',\n  // Save button\n  save: 'Save',\n  // Close button (shown if user has no data to export)\n  close: 'Close',\n  // cancel button\n  cancel: 'Cancel',\n  // Label for data format selector\n  format: 'Data format',\n  // Label for select to export all data or only filtered\n  filteredOrAll: 'Only filtered data or all data?',\n  exportAll: 'All {count} observations',\n  exportFiltered: '{count} filtered observations',\n  // Shown when there is no data to export\n  noData: \"You don't yet have any data to export.\",\n  // Label for select to include photos in export\n  includePhotos: 'Also export photos?',\n  // Hint shown when user has selected photos to be included in the export\n  includePhotosHint: 'Export will be a zip file including data and photos',\n  // Label for select option to include no photos in export\n  includePhotosNone: 'No Photos',\n  // Label for select option to include full size photos in export\n  includePhotosOriginal: 'Full size photos',\n  // Label for select option to include preview size photos in export\n  includePhotosPreview: 'Preview size photos',\n  // Default filename for exported data\n  defaultExportFilename: 'mapeo-observation-data'\n})\n\nconst ExportDialogContent = ({\n  filteredObservations = [],\n  allObservations = [],\n  getPreset,\n  getMediaUrl,\n  onClose\n}) => {\n  const classes = useStyles()\n  const [saving, setSaving] = useState()\n  const { formatMessage: t } = useIntl()\n  const isFiltered = allObservations.length !== filteredObservations.length\n  const [values, setValues] = React.useState({\n    format: 'geojson',\n    include: isFiltered && filteredObservations.length ? 'filtered' : 'all',\n    photos: 'none'\n  })\n\n  const handleChange = key => event => {\n    setValues(values => ({ ...values, [key]: event.target.value }))\n  }\n\n  const handleClose = () => {\n    setSaving(false)\n    onClose()\n  }\n\n  const handleSave = e => {\n    e.preventDefault()\n    setSaving(true)\n\n    const observationsToSave =\n      values.include === 'all' ? allObservations : filteredObservations\n\n    let exportData\n    let ext = values.format\n    switch (values.format) {\n      case 'geojson':\n        exportData = observationsToGeoJson(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n      case 'csv':\n        exportData = observationsToCsv(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n      case 'smart':\n        ext = 'csv'\n        exportData = observationsToSmartCsv(observationsToSave, {\n          photos: values.photos !== 'none'\n        })\n        break\n    }\n\n    const saveExt = values.photos === 'none' ? ext : 'zip'\n    remote.dialog.showSaveDialog(\n      {\n        title: t(msgs.title),\n        defaultPath: t(msgs.defaultExportFilename) + '.' + saveExt,\n        filters: [{ name: saveExt + ' files', extensions: [saveExt] }]\n      }\n    ).then(({ canceled, filePath }) => {\n      if (canceled) return handleClose()\n      const filepathWithExtension = path.join(\n        path.dirname(filePath),\n        path.basename(filePath, '.' + saveExt) + '.' + saveExt\n      )\n      onSelectFile(filepathWithExtension)\n    })\n\n    function onSelectFile (filePath) {\n      if (values.photos === 'none') {\n        fs.writeFile(filePath, exportData, err => {\n          if (err) logger.error('DataExportDialog: onSelectFile', err)\n          handleClose()\n        })\n        return\n      }\n\n      const photosToSave = []\n      observationsToSave.forEach(o => {\n        ;(o.attachments || []).forEach(a => {\n          if (!photosToSave.includes(a.id)) photosToSave.push(a.id)\n        })\n      })\n\n      const localFiles = [\n        {\n          data: exportData,\n          metadataPath: t(msgs.defaultExportFilename) + '.' + ext\n        }\n      ]\n      const remoteFiles = photosToSave.map(id => ({\n        url: getMediaUrl(id, values.photos),\n        metadataPath: 'images/' + id\n      }))\n      const output = fsWriteStreamAtomic(filePath)\n      const archive = createZip(localFiles, remoteFiles)\n\n      pump(archive, output, err => {\n        if (err) logger.error('DataExportDialog: pump create zip', err)\n        handleClose()\n      })\n    }\n  }\n\n  const noData = allObservations.length === 0\n\n  return (\n    <form noValidate autoComplete='off'>\n      <DialogTitle id='responsive-dialog-title' style={{ paddingBottom: 8 }}>\n        <FormattedMessage {...msgs.title} />\n      </DialogTitle>\n\n      <DialogContent className={classes.content}>\n        {noData ? (\n          <DialogContentText>\n            <FormattedMessage {...msgs.noData} />\n          </DialogContentText>\n        ) : (\n          <>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-format-label'>\n                <FormattedMessage {...msgs.format} />\n              </InputLabel>\n              <Select\n                labelId='select-format-label'\n                id='select-format'\n                value={values.format}\n                onChange={handleChange('format')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='geojson'>GeoJSON</MenuItem>\n                <MenuItem value='csv'>CSV</MenuItem>\n                <MenuItem value='smart'>Smart CSV</MenuItem>\n              </Select>\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-include-label'>\n                <FormattedMessage {...msgs.filteredOrAll} />\n              </InputLabel>\n              <Select\n                labelId='select-include-label'\n                id='select-include'\n                value={values.include}\n                onChange={handleChange('include')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='all'>\n                  <FormattedMessage\n                    {...msgs.exportAll}\n                    values={{ count: allObservations.length }}\n                  />\n                </MenuItem>\n                <MenuItem\n                  value='filtered'\n                  disabled={!isFiltered || !filteredObservations.length}\n                >\n                  <FormattedMessage\n                    {...msgs.exportFiltered}\n                    values={{\n                      count: isFiltered ? filteredObservations.length : 0\n                    }}\n                  />\n                </MenuItem>\n              </Select>\n            </FormControl>\n            <FormControl className={classes.formControl}>\n              <InputLabel id='select-photos-label'>\n                <FormattedMessage {...msgs.includePhotos} />\n              </InputLabel>\n              <Select\n                labelId='select-photos-label'\n                id='select-photos'\n                value={values.photos}\n                onChange={handleChange('photos')}\n                className={classes.select}\n                disabled={saving}\n              >\n                <MenuItem value='none'>\n                  <FormattedMessage {...msgs.includePhotosNone} />\n                </MenuItem>\n                <MenuItem value='original'>\n                  <FormattedMessage {...msgs.includePhotosOriginal} />\n                </MenuItem>\n                <MenuItem value='preview'>\n                  <FormattedMessage {...msgs.includePhotosPreview} />\n                </MenuItem>\n              </Select>\n              {values.photos !== 'none' && (\n                <FormHelperText>\n                  <FormattedMessage {...msgs.includePhotosHint} />\n                </FormHelperText>\n              )}\n            </FormControl>\n          </>\n        )}\n      </DialogContent>\n\n      <DialogActions>\n        {noData ? (\n          <Button\n            onClick={handleClose}\n            color='primary'\n            variant='contained'\n            type='submit'\n          >\n            <FormattedMessage {...msgs.close} />\n          </Button>\n        ) : (\n          <>\n            <Button disabled={saving} onClick={handleClose}>\n              <FormattedMessage {...msgs.cancel} />\n            </Button>\n            <Button\n              disabled={saving}\n              onClick={handleSave}\n              color='primary'\n              variant='contained'\n              type='submit'\n            >\n              <FormattedMessage {...msgs.save} />\n            </Button>\n          </>\n        )}\n      </DialogActions>\n    </form>\n  )\n}\n\nexport default function DataExportDialog ({\n  observations,\n  presets,\n  filter,\n  getMediaUrl,\n  onClose,\n  open,\n  ...otherProps\n}) {\n  return (\n    <Dialog\n      fullWidth\n      open={open}\n      onClose={onClose}\n      scroll='body'\n      aria-labelledby='responsive-dialog-title'\n    >\n      {open && (\n        <ViewWrapper\n          observations={observations}\n          presets={presets}\n          filter={filter}\n          getMediaUrl={getMediaUrl}\n        >\n          {({ filteredObservations, getPreset }) => (\n            <ExportDialogContent\n              filteredObservations={filteredObservations}\n              allObservations={observations}\n              getPreset={getPreset}\n              getMediaUrl={getMediaUrl}\n              onClose={onClose}\n              {...otherProps}\n            />\n          )}\n        </ViewWrapper>\n      )}\n    </Dialog>\n  )\n}\n\nfunction observationsToGeoJson (obs, { photos } = {}) {\n  const features = obs.map(o => {\n    const feature = {\n      type: 'Feature',\n      geometry:\n        o.lat == null || o.lon == null\n          ? null\n          : {\n            type: 'Point',\n            coordinates: [o.lon, o.lat]\n          },\n      id: o.id,\n      properties: {\n        ...o.tags,\n        $created: o.created_at,\n        $modified: o.timestamp,\n        $version: o.version\n      }\n    }\n    if (photos && o.attachments && o.attachments.length) {\n      feature.properties.$photos = o.attachments.map(a => a.id)\n    }\n    return feature\n  })\n\n  return JSON.stringify(\n    {\n      type: 'FeatureCollection',\n      features\n    },\n    null,\n    2\n  )\n}\n\nfunction observationsToCsv (obs, { photos } = {}) {\n  const allKeys = {}\n  const rows = obs.map(o => {\n    const flattenedTags = flatten(o.tags)\n    const parsedTags = {}\n\n    Object.keys(flattenedTags).forEach(key => {\n      const value = flattenedTags[key]\n      // Remove unparsed objects (empty objects) from tags\n      if (typeof value === 'object') return\n      if (\n        !(value == null || (typeof value === 'string' && value.length === 0))\n      ) {\n        // Only export columns for non-empty values\n        allKeys[key] = true\n      }\n      if (typeof value === 'string' && isodate.is(value)) {\n        // Convert ISO dates to a format that Excel can recognize in a CSV\n        parsedTags[key] = formatCsvDatetime(value)\n      } else {\n        parsedTags[key] = value\n      }\n    })\n\n    const hasLocation = o.lat != null && o.lon != null\n    const { easting, northing, zoneNum, zoneLetter } = hasLocation\n      ? fromLatLon(o.lat, o.lon)\n      : {}\n    const locationData = hasLocation && {\n      // Round coordinates to 1cm precision\n      $lon: round(o.lon, 7),\n      $lat: round(o.lat, 7),\n      $utmX: round(easting, 2),\n      $utmY: round(northing, 2),\n      $utmZone: zoneNum && zoneLetter ? zoneNum + zoneLetter : null\n    }\n    const $photos =\n      photos && o.attachments && o.attachments.length\n        ? o.attachments.map(a => a.id).join(',')\n        : null\n\n    return {\n      ...parsedTags,\n      $id: o.id,\n      $created: formatCsvDatetime(o.created_at),\n      $modified: o.timestamp && formatCsvDatetime(o.timestamp),\n      $version: o.version,\n      $photos,\n      ...locationData\n    }\n  })\n\n  // We do this to order the columns of the CSV, otherwise csvFormat column\n  // order is non-deterministic\n  const columns = [\n    '$id',\n    '$created',\n    '$modified',\n    '$lon',\n    '$lat',\n    '$utmX',\n    '$utmY',\n    '$utmZone',\n    '$photos'\n  ].concat(Object.keys(allKeys).sort(), '$version')\n\n  return csvFormat(rows, columns)\n}\n\nfunction observationsToSmartCsv (obs, { photos } = {}) {\n  const rows = obs.map((o, i) => {\n    const locationData =\n      o.lat != null && o.lon != null ? { X: o.lon, Y: o.lat } : {}\n    const PHOTOS =\n      photos && o.attachments && o.attachments.length\n        ? o.attachments.map(a => a.id).join(',')\n        : null\n\n    return {\n      ID: i + 1,\n      MAPEO_ID: o.id,\n      DATE: formatCsvDate(o.created_at),\n      TIME: formatCsvTime(o.created_at),\n      COMMENT: o.tags.notes || o.tags.note,\n      PHOTOS,\n      ...locationData\n    }\n  })\n\n  // We do this to order the columns of the CSV, otherwise csvFormat column\n  // order is non-deterministic\n  const columns = 'ID,X,Y,DATE,TIME,COMMENT,PHOTOS,MAPEO_ID'.split(',')\n\n  return csvFormat(rows, columns)\n}\n\nfunction round (num, dp = 0) {\n  const factor = Math.pow(10, dp)\n  return Math.round(num * factor) / factor\n}\n\nfunction formatCsvDatetime (isoDateString) {\n  return formatCsvDate(isoDateString) + ' ' + formatCsvTime(isoDateString)\n}\n\nfunction formatCsvDate (isoDateString) {\n  const date = new Date(isoDateString)\n  const YYYY = date.getFullYear()\n  const MM = leftPad(date.getMonth() + 1, 2)\n  const DD = leftPad(date.getDate(), 2)\n  return `${YYYY}-${MM}-${DD}`\n}\n\nfunction formatCsvTime (isoDateString) {\n  const date = new Date(isoDateString)\n  const hh = leftPad(date.getHours(), 2)\n  const mm = leftPad(date.getMinutes(), 2)\n  const ss = leftPad(date.getSeconds(), 2)\n  return `${hh}:${mm}:${ss}`\n}\n\nfunction leftPad (num, len, char = 0) {\n  const str = num + ''\n  // doesn't need to pad\n  len = len - str.length\n  if (len <= 0) return str\n\n  var pad = ''\n  while (true) {\n    if (len & 1) pad += char\n    len >>= 1\n    if (len) char += char\n    else break\n  }\n  return pad + str\n}\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    position: 'relative'\n  },\n  title: {\n    marginLeft: theme.spacing(2),\n    flex: 1\n  },\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingTop: 0\n  },\n  formControl: {\n    marginBottom: theme.spacing(2),\n    '&:not(:last-child)': {\n      marginBottom: theme.spacing(4)\n    }\n  },\n  select: {\n    fontFamily: theme.typography.body1.fontFamily\n  }\n}))\n","import React from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport ExportIcon from '@material-ui/icons/MoreVert'\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nconst m = defineMessages({\n  exportButton: 'Export Observation Data',\n  exportMap: 'Export Webmap',\n  exportData: 'Export Observations'\n})\n\nconst ExportButton = ({ onExport }) => {\n  const { formatMessage: t } = useIntl()\n  const [menuAnchor, setMenuAnchor] = React.useState(null)\n\n  const handleExportClick = event => {\n    setMenuAnchor(event.currentTarget)\n  }\n\n  const handleMenuItemClick = id => () => {\n    setMenuAnchor(null)\n    if (id) onExport(id)\n  }\n\n  return (\n    <>\n      <Tooltip title={t(m.exportButton)}>\n        <IconButton\n          aria-label='export'\n          color='inherit'\n          onClick={handleExportClick}\n          aria-controls='export-menu'\n          aria-haspopup='true'\n        >\n          <ExportIcon />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        id='export-menu'\n        anchorEl={menuAnchor}\n        open={Boolean(menuAnchor)}\n        onClose={handleMenuItemClick(null)}\n      >\n        <MenuItem onClick={handleMenuItemClick('map')}>\n          <FormattedMessage {...m.exportMap} />\n        </MenuItem>\n        <MenuItem onClick={handleMenuItemClick('data')}>\n          <FormattedMessage {...m.exportData} />\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nexport default ExportButton\n","import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { MapView, ReportView, MediaView } from 'react-mapfilter'\nimport { ipcRenderer } from 'electron'\nimport debounce from 'lodash/debounce'\nimport { defineMessages, FormattedMessage } from 'react-intl'\nimport mapboxgl from 'mapbox-gl'\nimport ErrorBoundary from 'react-error-boundary'\nimport { Typography } from '@material-ui/core'\n\nimport logger from '../../../logger'\nimport Toolbar from './Toolbar'\nimport FilterPanel from './FilterPanel'\nimport Loading from './Loading'\nimport MapStyleProvider from './MapStyleProvider'\nimport api from '../../new-api'\nimport MapExportDialog from './MapExportDialog'\nimport DataExportDialog from './DataExportDialog'\nimport ExportButton from './ExportButton'\n\nconst m = defineMessages({\n  errorTitle: 'Oh dear! An error has occurred',\n  errorDescription:\n    'The details below will be useful for finding a way to fix this'\n})\n\n// This is very strange. Something to do with the bundling is stopping this\n// being set from within the react-mapbox-gl library. We need to set this here\n// to force mapbox to understand the accessToken is set\nconst MAPBOX_ACCESS_TOKEN = (mapboxgl.accessToken =\n  'pk.eyJ1IjoiZ21hY2xlbm5hbiIsImEiOiJSaWVtd2lRIn0.ASYMZE2HhwkAw4Vt7SavEg')\n\n/**\n * Using normal state for this causes performance issues because it causes React\n * to re-render. Using a ref allows us to store position between tabs without re-renders\n */\nfunction usePositionRef () {\n  const key = 'mapFilterPosition'\n  const savedPosition = useMemo(() => {\n    try {\n      const item = window.localStorage.getItem(key)\n      return JSON.parse(item)\n    } catch (e) {}\n  }, [])\n\n  const position = useRef(savedPosition)\n\n  const persistPosition = useMemo(\n    () =>\n      debounce(() => {\n        if (!position.current) return\n        const item = JSON.stringify(position.current)\n        window.localStorage.setItem(key, item)\n      }, 500),\n    []\n  )\n\n  const setPosition = useCallback(\n    pos => {\n      position.current = pos\n      persistPosition()\n    },\n    [persistPosition]\n  )\n\n  return useMemo(() => [position, setPosition], [setPosition])\n}\n\nconst MyFallbackComponent = ({ componentStack, error }) => {\n  const cx = useStyles()\n  return (\n    <div className={cx.errorFallback}>\n      <Typography variant='h4' component='h1'>\n        <FormattedMessage {...m.errorTitle} />\n      </Typography>\n      <Typography>\n        <FormattedMessage {...m.errorDescription} />\n      </Typography>\n      <br />\n      <Typography variant='h6' component='h2'>\n        Error:\n      </Typography>\n      <Typography>{error.toString()}</Typography>\n      <Typography variant='h6' component='h2'>\n        Stacktrace:\n      </Typography>\n      <pre>{componentStack}</pre>\n    </div>\n  )\n}\n\nconst FilterView = ({ view, ...props }) => {\n  const cx = useStyles()\n  const mapRef = useRef()\n\n  useEffect(() => {\n    function zoomToData (_, loc) {\n      if (!mapRef.current || typeof mapRef.current.flyTo !== 'function') return\n      mapRef.current.flyTo({\n        center: loc,\n        zoom: 14\n      })\n    }\n    ipcRenderer.on('zoom-to-data-observation', zoomToData)\n    return () => {\n      ipcRenderer.removeListener('zoom-to-data-observation', zoomToData)\n    }\n  }, [])\n\n  return (\n    <div className={cx.viewWrapper}>\n      <ErrorBoundary FallbackComponent={MyFallbackComponent}>\n        {view === 'report' ? (\n          <ReportView {...props} />\n        ) : view === 'media' ? (\n          <MediaView {...props} />\n        ) : (\n          <MapView ref={mapRef} {...props} />\n        )}\n      </ErrorBoundary>\n    </div>\n  )\n}\n\nfunction usePresets () {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState()\n  const [presets, setPresets] = useState([])\n  const [fields, setFields] = useState([])\n\n  useEffect(() => {\n    async function getPresets () {\n      try {\n        const data = await api.getPresets()\n        const presets = mapToArray(data.presets)\n        const fields = mapToArray(data.fields)\n        const presetsWithFields = presets\n          .filter(p => p.geometry.includes('point'))\n          // Replace field ids with full field definitions\n          .map(p => addFieldDefinitions(p, fields))\n        setLoading(false)\n        setPresets(presetsWithFields)\n        setFields(fields)\n      } catch (e) {\n        logger.error('MapFilter get Presets', e)\n        setLoading(false)\n        setError(e)\n      }\n    }\n    getPresets()\n  }, [])\n\n  return useMemo(() => ({ presets, fields, error, loading }), [\n    presets,\n    fields,\n    error,\n    loading\n  ])\n}\n\nfunction useObservations () {\n  const isMounted = useRef(true)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState()\n  const [observations, setObservations] = useState([])\n\n  const updateObservation = useCallback(\n    observation => {\n      api\n        .updateObservation(observation.id, observation)\n        .then(obs => {\n          const index = observations.findIndex(o => o.id === obs.id)\n          const updatedObservations =\n            index > -1\n              ? [\n                ...observations.slice(0, index),\n                obs,\n                ...observations.slice(index + 1)\n              ]\n              : [...observations, obs]\n          setObservations(updatedObservations)\n        })\n        .catch(err => {\n          logger.error('error updating observations', err)\n        })\n    },\n    [observations]\n  )\n\n  const deleteObservation = useCallback(\n    id => {\n      api\n        .deleteObservation(id)\n        .then(() => {\n          const index = observations.findIndex(o => o.id === id)\n          if (index === -1) throw new Error('Observation not found')\n          const updatedObservations = [\n            ...observations.slice(0, index),\n            ...observations.slice(index + 1)\n          ]\n          setObservations(updatedObservations)\n        })\n        .catch(err => {\n          logger.error('error deleting observation', err)\n        })\n    },\n    [observations]\n  )\n\n  function loadObservations () {\n    api\n      .getObservations()\n      .then(obs => {\n        if (!isMounted.current) return\n        setObservations(obs)\n        setLoading(false)\n      })\n      .catch(err => {\n        if (!isMounted.current) return\n        setError(err)\n        setLoading(false)\n      })\n  }\n\n  useEffect(() => {\n    const subscription = api.addDataChangedListener(\n      'territory-edit',\n      () => {\n        loadObservations()\n      })\n    return () => {\n      subscription.remove()\n    }\n  }, [])\n\n  useEffect(() => {\n    loadObservations()\n    return () => (isMounted.current = false)\n  }, [])\n\n  return useMemo(\n    () => [\n      { loading, error, observations },\n      { updateObservation, deleteObservation }\n    ],\n    [loading, error, observations, updateObservation, deleteObservation]\n  )\n}\n\nconst MapFilter = () => {\n  const cx = useStyles()\n  const [view, setView] = useState('map')\n  const [filter, setFilter] = useState(null)\n  const [position, setPosition] = usePositionRef()\n  const [dialog, setDialog] = useState(null)\n\n  const [\n    { observationsLoading, observationsError, observations },\n    { updateObservation, deleteObservation }\n  ] = useObservations()\n  const {\n    presets,\n    fields,\n    error: presetsError,\n    loading: presetsLoading\n  } = usePresets()\n\n  if (observationsLoading || presetsLoading) {\n    return (\n      <div className={cx.root}>\n        <Loading />\n      </div>\n    )\n  }\n\n  if (observationsError) logger.error('observationsError', observationsError)\n  if (presetsError) logger.error('presetsError', presetsError)\n\n  return (\n    <div className={cx.root}>\n      <FilterPanel\n        observations={observations}\n        filter={filter}\n        onChangeFilter={setFilter}\n        presets={presets}\n        fields={fields}\n      />\n      <div className={cx.right}>\n        <Toolbar\n          view={view}\n          onChange={setView}\n          actionRight={<ExportButton onExport={setDialog} />}\n        />\n        <MapStyleProvider>\n          {styleUrl => (\n            <FilterView\n              view={view}\n              filter={filter}\n              observations={observations}\n              presets={presets}\n              onUpdateObservation={updateObservation}\n              onDeleteObservation={deleteObservation}\n              getMediaUrl={api.getMediaUrl}\n              getIconUrl={api.getIconUrl}\n              mapStyle={styleUrl}\n              mapboxAccessToken={MAPBOX_ACCESS_TOKEN}\n              onMapMove={setPosition}\n              initialMapPosition={\n                position.current == null ? undefined : position.current\n              }\n            />\n          )}\n        </MapStyleProvider>\n      </div>\n      <MapExportDialog\n        open={dialog === 'map'}\n        onClose={() => setDialog(null)}\n        observations={observations}\n        filter={filter}\n        presets={presets}\n        getMediaUrl={api.getMediaUrl}\n      />\n      <DataExportDialog\n        open={dialog === 'data'}\n        onClose={() => setDialog(null)}\n        observations={observations}\n        filter={filter}\n        presets={presets}\n        getMediaUrl={api.getMediaUrl}\n      />\n    </div>\n  )\n}\n\nexport default MapFilter\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    width: '100%',\n    height: '100%',\n    flexDirection: 'row',\n    backgroundColor: '#F5F5F5',\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  },\n  right: {\n    display: 'flex',\n    flexDirection: 'column',\n    flex: 1,\n    '@media only print': {\n      width: 'auto',\n      height: 'auto',\n      position: 'static',\n      backgroundColor: 'inherit',\n      display: 'block'\n    }\n  },\n  errorFallback: {\n    backgroundColor: '#C00',\n    color: '#FFF',\n    padding: 10\n  },\n  viewWrapper: {\n    position: 'relative',\n    flex: 1,\n    display: 'flex'\n  }\n}))\n\nfunction addFieldDefinitions (preset, fields) {\n  const fieldDefs = Array.isArray(preset.fields)\n    ? preset.fields.map(fieldId => fields.find(field => field.id === fieldId))\n    : []\n  return {\n    ...preset,\n    fields: fieldDefs.filter(Boolean)\n  }\n}\n\nfunction mapToArray (map) {\n  return Object.keys(map).map(id => ({\n    ...map[id],\n    id: id\n  }))\n}\n","import { useState, useEffect } from 'react'\nimport store from '../../store'\n\nconst createPersistedState = key =>\n  function usePersistedState (initialState) {\n    const [state, setState] = useState(() =>\n      store.get(\n        key,\n        typeof initialState === 'function' ? initialState() : initialState\n      )\n    )\n\n    // Only persist to storage if state changes.\n    useEffect(\n      () => {\n        // persist to storage\n        store.set(key, state)\n      },\n      [state]\n    )\n\n    return [state, setState]\n  }\n\nexport default createPersistedState\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { defineMessages, useIntl } from 'react-intl'\nimport { Typography } from '@material-ui/core'\n\nimport Loader from '../Loader'\n\nconst m = defineMessages({\n  // Title on sync screen when searching for devices\n  searchingTitle: 'Searching',\n  // Hint on sync screen when searching on wifi for devices\n  searchingHint:\n    'Make sure devices are turned on and connected to the same wifi network'\n})\n\nconst Searching = () => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingWrapper}>\n      <div className={cx.searching}>\n        <Loader />\n        <div className={cx.searchingText}>\n          <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n            {t(m.searchingTitle)}\n          </Typography>\n\n          <Typography>{t(m.searchingHint)}</Typography>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Searching\n\nconst useStyles = makeStyles(theme => ({\n  searchingText: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  searchingWrapper: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  searching: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  searchingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  }\n}))\n","import React, { useEffect, useState } from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Wifi, WifiOff } from '@material-ui/icons'\nimport { defineMessages, useIntl } from 'react-intl'\nimport wifi from 'node-wifi'\nimport { Tooltip } from '@material-ui/core'\n\nimport logger from '../../../logger'\n\nlet wifiInit = true\ntry {\n  wifi.init()\n} catch (e) {\n  logger.error('Failed to init node-wifi', e)\n  wifiInit = false\n}\n\nconst getQualityStyle = (connection) => {\n  if (connection.quality < 30) return { color: 'white', backgroundColor: 'red' }\n  if (connection.quality < 60) return { color: 'white', backgroundColor: 'orange' }\n  return { backgroundColor: '#E0E0E0' }\n}\n\nconst getWifiConnectionMessage = (connection) => {\n  if (connection.quality < 30) return m.qualityTooltipPoor\n  if (connection.quality < 60) return m.qualityTooltipWeak\n  return m.qualityTooltipAdequate\n}\n\nconst m = defineMessages({\n  // Title of sync screen\n  title: 'Available Devices',\n  disconnected: 'Disconnected',\n  disconnectedTooltip:\n    'You first need to connect to a WiFi network before being able to synchronize devices',\n  wifiError: 'Unknown',\n  wifiErrorTooltip: 'Your WiFi card or Operating System (OS) has not been recognized',\n  qualityTooltipPoor:\n    'The connection signal is very poor. Try getting closer to the WiFi router',\n  qualityTooltipWeak:\n    'The connection signal is weak. The synchronization might take a longer time to complete',\n  qualityTooltipAdequate: 'The connection signal is excellent',\n  quality: 'Quality: {quality}%',\n  // Button to sync from an existing sync file\n  selectSyncfile: 'Sync from a file',\n  // Button to create a new sync file\n  newSyncfile: 'Create new syncfile'\n})\nconst SyncAppBar = ({ onClickSelectSyncfile, onClickNewSyncfile }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n  const [currentConnection, setCurrentConnection] = useState(null)\n  const [wifiError, setWifiError] = useState(!wifiInit)\n\n  // Check connection every 2 seconds\n  useEffect(() => {\n    const check = async () => {\n      try {\n        const conn = await wifi.getCurrentConnections()\n        setCurrentConnection(conn && conn[0])\n      } catch (err) {\n        logger.error('SyncAppBar failed to get current connections', err)\n        setWifiError(true)\n        setCurrentConnection(null)\n      }\n    }\n\n    // Run initial check, then refresh it every 2 seconds\n    check()\n    const intervalCheck = setInterval(check, 2000)\n    return () => clearInterval(intervalCheck)\n  }, [])\n\n  return (\n    <AppBar position='static' color='default' elevation={0} className={cx.root}>\n      <Toolbar>\n        <div className={cx.titleBar}>\n          <Typography variant='h6' component='h1' className={cx.title}>\n            {t(m.title)}\n          </Typography>\n\n          {currentConnection ? (\n            <Tooltip title={t(getWifiConnectionMessage(currentConnection))}>\n              <span className={cx.wifi}>\n                <Wifi className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {currentConnection.ssid}\n                </Typography>\n                <Typography\n                  variant='overline'\n                  component='span'\n                  className={cx.wifiQuality}\n                  style={getQualityStyle(currentConnection)}\n                >\n                  {t(m.quality, {\n                    quality: Math.min(100, currentConnection.quality).toFixed(0)\n                  })}\n                </Typography>\n              </span>\n            </Tooltip>\n          ) : !wifiError ? (\n            <Tooltip title={t(m.disconnectedTooltip)}>\n              <span className={cx.wifi}>\n                <WifiOff className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {t(m.disconnected)}\n                </Typography>\n              </span>\n            </Tooltip>\n          ) : (\n            <Tooltip title={t(m.wifiErrorTooltip)}>\n              <span className={cx.wifi}>\n                <WifiOff className={cx.wifiIcon} />\n                <Typography variant='overline' component='span' className={cx.wifiName}>\n                  {t(m.wifiError)}\n                </Typography>\n              </span>\n            </Tooltip>\n          )}\n        </div>\n        <Button\n          onClick={onClickSelectSyncfile}\n          color='inherit'\n          variant='outlined'\n          className={cx.button}\n        >\n          {t(m.selectSyncfile)}\n        </Button>\n        <Button\n          onClick={onClickNewSyncfile}\n          color='inherit'\n          variant='outlined'\n          className={cx.button}\n        >\n          {t(m.newSyncfile)}\n        </Button>\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nexport default SyncAppBar\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    backgroundColor: 'white'\n  },\n  titleBar: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start'\n  },\n  title: {\n    lineHeight: 1.2\n  },\n  wifi: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  wifiIcon: {\n    fontSize: '1rem',\n    position: 'relative',\n    top: -1 // visual alignment\n  },\n  wifiName: {\n    lineHeight: 1.2,\n    marginLeft: 5\n  },\n  wifiQuality: {\n    lineHeight: 1.2,\n    marginLeft: 5,\n    fontWeight: 500,\n    padding: '1px 5px',\n    borderRadius: 1000\n  },\n  actionArea: {},\n  button: {\n    marginLeft: theme.spacing(2),\n    textTransform: 'none'\n  }\n}))\n","import React, { useState, useEffect } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport DoneIcon from '@material-ui/icons/Check'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faBolt } from '@fortawesome/free-solid-svg-icons'\nimport styled from 'styled-components'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Button from '@material-ui/core/Button'\nimport { useIntl, defineMessages } from 'react-intl'\n\nconst m = defineMessages({\n  // Button to sync a device\n  sync: 'Synchronize',\n  // Displayed when sync is starting\n  starting: 'Starting',\n  // Button when sync is complete\n  complete: 'Complete',\n  // Button to retry sync after error\n  retry: 'Retry',\n  // Disconnected\n  disconnected: 'Disconnected',\n  // Almost done! But progress is inaccurate.\n  finishing: 'Finishing'\n})\n\nconst SyncIcon = props => <FontAwesomeIcon icon={faBolt} {...props} />\n\nconst ProgressBackground = styled.div`\n  width: 32px;\n  height: 32px;\n  border-radius: 16px;\n  margin-left: 16px;\n  background-color: #c1c1c1;\n  align-items: center;\n  justify-content: center;\n  display: flex;\n`\n\nconst ProgressIcon = ({ progress }) => {\n  const [awaitingCompletion, setAwaitingCompletion] = useState(false)\n  const cx = useStyles()\n  // After 3 seconds of being frozen at 100%, show an indeterminate spinner -->\n  // give the user something to hope for (it should complete eventually)\n  useEffect(\n    () => {\n      if (Math.round(progress * 100) < 100) return\n      const timeoutId = setTimeout(() => setAwaitingCompletion(true), 3000)\n      return () => clearTimeout(timeoutId)\n    },\n    [progress]\n  )\n\n  return (\n    <ProgressBackground>\n      <CircularProgress\n        variant={progress && !awaitingCompletion ? 'static' : 'indeterminate'}\n        value={progress * 100}\n        color='inherit'\n        size={32}\n        thickness={5}\n        className={cx.progressCircle}\n      />\n    </ProgressBackground>\n  )\n}\n\nconst StyledButton = ({ className, ...props }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      variant='contained'\n      size='large'\n      className={className + ' ' + classes.button}\n      color='primary'\n      {...props}\n    />\n  )\n}\n\nconst SyncButton = ({ progress, connected, onClick, variant = 'ready' }) => {\n  const classes = useStyles()\n  const { formatMessage: t } = useIntl()\n  switch (variant) {\n    case 'ready':\n    case 'error':\n      return (\n        <StyledButton disabled={!connected} onClick={onClick}>\n          {!connected ? t(m.disconnected)\n            : variant === 'ready' ? t(m.sync) : t(m.retry)}\n          <SyncIcon className={classes.icon} />\n        </StyledButton>\n      )\n    case 'progress':\n      return (\n        <StyledButton disabled onClick={onClick} className={classes.progress}>\n          {!progress\n            ? t(m.starting)\n            : progress === 1\n              ? t(m.finishing)\n              : (progress * 100).toFixed(0) + '%'}\n          <ProgressIcon progress={progress} className={classes.icon} />\n        </StyledButton>\n      )\n\n    case 'complete':\n      return (\n        <StyledButton disabled={!connected} onClick={onClick}>\n          {t(m.complete)}\n          <DoneIcon className={classes.icon} />\n        </StyledButton>\n      )\n  }\n}\n\nexport default SyncButton\n\nconst useStyles = makeStyles(theme => ({\n  icon: {\n    marginLeft: theme.spacing(2)\n  },\n  button: {\n    minHeight: 48,\n    justifyContent: 'space-between'\n  },\n  progress: {\n    minWidth: 150,\n    fontVariantNumeric: 'tabular-nums',\n    fontWeight: 600\n  },\n  progressCircle: {\n    '& .MuiCircularProgress-circleStatic': {\n      transitionDuration: '50ms'\n    }\n  }\n}))\n","import React from 'react'\nimport { FormattedDate, FormattedRelativeTime } from 'react-intl'\n\n// We use relative dates for anything within the last 7 days, and then absolute\n// dates for anything else.\nconst USE_WORDS_WITHIN_SECONDS = 4 * 24 * 60 * 60 // 4 days\nconst MINUTE = 60\nconst HOUR = 60 * 60\nconst DAY = 60 * 60 * 24\n\nconst DateDistance = ({ date = new Date(), style }) => {\n  // Round distance to nearest 10 seconds\n  const distanceInSeconds = Math.floor((Date.now() - date) / 10000) * 10\n\n  const absValue = Math.abs(distanceInSeconds)\n\n  if (absValue > USE_WORDS_WITHIN_SECONDS) {\n    return (\n      <FormattedDate\n        value={date}\n        day='numeric'\n        month='long'\n        year='numeric'\n        hour='2-digit'\n        minute='2-digit'\n      />\n    )\n  } else if (absValue < MINUTE) {\n    return (\n      <FormattedRelativeTime\n        value={-distanceInSeconds}\n        numeric='auto'\n        updateIntervalInSeconds={5}\n      />\n    )\n  } else if (absValue < HOUR) {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / MINUTE)}\n        unit='minute'\n        updateIntervalInSeconds={30}\n      />\n    )\n  } else if (absValue < DAY) {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / HOUR)}\n        unit='hour'\n      />\n    )\n  } else {\n    return (\n      <FormattedRelativeTime\n        value={-Math.round(distanceInSeconds / DAY)}\n        unit='day'\n      />\n    )\n  }\n}\n\nexport default DateDistance\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PhoneIcon from '@material-ui/icons/PhoneAndroid'\nimport LaptopIcon from '@material-ui/icons/Laptop'\nimport FileIcon from '@material-ui/icons/Usb'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport Paper from '@material-ui/core/Paper'\nimport { Typography } from '@material-ui/core'\nimport SyncButton from './SyncButton'\nimport DateDistance from '../DateDistance'\nimport { defineMessages, useIntl } from 'react-intl'\n\nconst m = defineMessages({\n  // Message shown when there is an error while syncing\n  errorMsg: 'Syncronization Error',\n  // Shown before last sync time, e.g. 'Last synchronized: 2 hours ago'\n  lastSync: 'Last synchronized:',\n  // Prompt of how many database objects have synced\n  database: 'Database: {sofar} / {total}',\n  // Prompt for how many media items have synced\n  media: 'Photos: {sofar} / {total}'\n})\n\nconst SyncTarget = ({\n  // Unique identifier for the peer\n  id,\n  // User friendly peer name\n  name = 'Android Phone',\n  // See above peerStatus\n  status,\n  // If connected\n  connected,\n  // Sync progress object, with props `percent`, `mediaSofar`, `mediaTotal`,\n  // `dbSofar`, `dbTotal`\n  progress,\n  // The time of last completed sync in milliseconds since UNIX Epoch\n  lastCompleted,\n  errorMsg,\n  // \"mobile\" or \"desktop\" or \"file\"\n  deviceType,\n  onClick\n}) => {\n  const cx = useStyles()\n  const { formatMessage: t, formatNumber } = useIntl()\n  // TODO need to render device name in error screen\n  return (\n    <Paper className={cx.root}>\n      <div className={cx.wrapper}>\n        <div className={cx.content}>\n          {status === 'error' ? (\n            <ErrorIcon\n              fontSize='inherit'\n              className={cx.icon}\n              style={{ color: 'red' }}\n            />\n          ) : deviceType === 'desktop' ? (\n            <LaptopIcon fontSize='inherit' className={cx.icon} />\n          ) : deviceType === 'file' ? (\n            <FileIcon fontSize='inherit' className={cx.icon} />\n          ) : (\n            <PhoneIcon fontSize='inherit' className={cx.icon} />\n          )}\n          <Typography variant='h5' component='h2'>\n            {name}\n          </Typography>\n          {status === 'error' ? (\n            <Typography className={cx.errorDetail} align='center'>\n              {errorMsg}\n            </Typography>\n          ) : status === 'progress' && progress ? (\n            <Typography className={cx.progress} align='center'>\n              {t(m.database, {\n                sofar: formatNumber(progress.dbSofar),\n                total: formatNumber(progress.dbTotal)\n              })}\n              <br />\n              {t(m.media, {\n                sofar: formatNumber(progress.mediaSofar),\n                total: formatNumber(progress.mediaTotal)\n              })}\n            </Typography>\n          ) : (\n            lastCompleted && (\n              <Typography className={cx.lastSync}>\n                {t(m.lastSync)}\n                <br />\n                <DateDistance date={lastCompleted} />\n              </Typography>\n            )\n          )}\n        </div>\n        <SyncButton\n          connected={connected}\n          onClick={onClick}\n          variant={status}\n          progress={progress && progress.percent}\n        />\n      </div>\n    </Paper>\n  )\n}\n\nexport default SyncTarget\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    paddingTop: '100%',\n    position: 'relative'\n  },\n  icon: {\n    marginBottom: theme.spacing(2),\n    fontSize: 48\n  },\n  lastSync: {\n    textAlign: 'center',\n    fontStyle: 'italic'\n  },\n  errorDetail: {\n    textAlign: 'center',\n    fontStyle: 'italic'\n  },\n  content: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  wrapper: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    position: 'absolute',\n    display: 'flex',\n    flexDirection: 'column',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    padding: '10%'\n  },\n  progress: {\n    fontVariantNumeric: 'tabular-nums'\n  }\n}))\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst SyncGrid = ({ children }) => {\n  const cx = useStyles()\n  return <div className={cx.root}>{children}</div>\n}\n\nexport default SyncGrid\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'grid',\n    overflowY: 'scroll',\n    gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',\n    alignItems: 'start',\n    alignContent: 'start',\n    gridGap: 30,\n    padding: 20,\n    flex: 1\n  }\n}))\n","import React, { useEffect, useState } from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport api from '../../new-api'\n\nconst SyncFooter = () => {\n  const cx = useStyles()\n  const [encryptionKey, setEncryptionKey] = useState(null)\n\n  // Check encryption key on load\n  useEffect(() => {\n    const check = async () => {\n      const encryptionKey = await api.getEncryptionKey()\n      setEncryptionKey(encryptionKey)\n    }\n    check()\n  }, [])\n\n  return (\n    <AppBar position='static' color='default' elevation={0} className={cx.root}>\n      <Toolbar>\n        <div className={cx.titleBar}>\n          <Typography component='h2' className={cx.title}>\n            {encryptionKey}\n          </Typography>\n        </div>\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nexport default SyncFooter\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    backgroundColor: 'white'\n  },\n  titleBar: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start'\n  },\n  title: {\n    color: 'black'\n  }\n}))\n","import React, { useEffect, useState, useRef, useMemo, useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core'\nimport { remote } from 'electron'\nimport { useIntl, defineMessages } from 'react-intl'\nimport path from 'path'\n\nimport logger from '../../../logger'\nimport api from '../../new-api'\nimport Searching from './Searching'\nimport SyncAppBar from './SyncAppBar'\nimport SyncTarget from './SyncTarget'\nimport SyncGrid from './SyncGrid'\nimport SyncFooter from './SyncFooter'\n\nexport const peerStatus = {\n  READY: 'ready',\n  PROGRESS: 'progress',\n  ERROR: 'error',\n  COMPLETE: 'complete'\n}\n\nconst m = defineMessages({\n  openSyncFileDialog: 'Select a database to syncronize',\n  createSyncFileDialog: 'Create a new database to syncronize',\n  // Error message when trying to sync with an incompatible older version of Mapeo\n  errorMsgVersionThemBad: '{deviceName} needs to upgrade Mapeo',\n  // Error messagewhen trying to sync with an incompatible newer version of Mapeo\n  errorMsgVersionUsBad: 'You need to upgrade Mapeo to sync with {deviceName}'\n})\n\nconst IGNORED_ERROR_CODES = ['ECONNABORTED', 'ERR_MISSING_DATA']\n\nconst fileDialogFilters = [\n  {\n    name: 'Mapeo Data (*.mapeodata)',\n    extensions: ['mapeodata', 'mapeo-jungle', 'sync', 'zip']\n  }\n]\n\nconst SyncView = ({ focusState }) => {\n  const cx = useStyles()\n  const listenForSyncPeers = focusState === 'focused'\n  const [peers, syncPeer] = usePeers(listenForSyncPeers)\n  const { formatMessage: t } = useIntl()\n  logger.debug('render peers', peers)\n\n  const handleClickSelectSyncfile = () => {\n    remote.dialog.showOpenDialog(\n      {\n        title: t(m.openSyncFileDialog),\n        properties: ['openFile'],\n        filters: fileDialogFilters\n      }\n    ).then(({ filePaths }) => {\n      if (typeof filePaths === 'undefined' || filePaths.length !== 1) return\n      syncPeer(filePaths[0], { file: true })\n    }).catch(err => logger.error(err))\n  }\n\n  const handleClickNewSyncfile = () => {\n    remote.dialog.showSaveDialog(\n      {\n        title: t(m.openSyncFileDialog),\n        defaultPath: 'database.mapeodata',\n        filters: fileDialogFilters\n      }\n    ).then(({ canceled, filePath }) => {\n      if (canceled || !filePath) return\n      syncPeer(filePath, { file: true })\n    }).catch(err => logger.error(err))\n  }\n\n  return (\n    <div className={cx.root}>\n      <SyncAppBar\n        onClickSelectSyncfile={handleClickSelectSyncfile}\n        onClickNewSyncfile={handleClickNewSyncfile}\n      />\n      {peers.length === 0 && focusState === 'focused' ? (\n        <Searching />\n      ) : (\n        <SyncGrid>\n          {peers.map(peer => (\n            <SyncTarget\n              key={peer.id}\n              {...peer}\n              onClick={() => syncPeer(peer.id)}\n            />\n          ))}\n        </SyncGrid>\n      )}\n      <SyncFooter />\n    </div>\n  )\n}\n\nexport default SyncView\n\nfunction usePeers (listen) {\n  const { formatMessage } = useIntl()\n  const lastClosed = useRef(Date.now())\n  const [serverPeers, setServerPeers] = useState([])\n  const [syncErrors, setSyncErrors] = useState(new Map())\n  const [syncRequests, setSyncRequests] = useState(new Map())\n\n  // Keep a ref of the last time this view was closed (used to maintain peer\n  // \"completed\" state in the UI)\n  useEffect(\n    () => {\n      if (!listen) lastClosed.current = Date.now()\n    },\n    [listen]\n  )\n\n  useEffect(\n    () => {\n      // Only start listening if `listen` is true\n      if (!listen) return\n\n      const updatePeers = (updatedServerPeers = []) => {\n        logger.debug('Received peer update', updatedServerPeers)\n        setServerPeers(updatedServerPeers)\n        // NB: use callback version of setState because the new error state\n        // depends on the previous error state\n        setSyncErrors(syncErrors => {\n          const newErrors = new Map(syncErrors)\n          updatedServerPeers.forEach(peer => {\n            if (peer.state && peer.state.topic === 'replication-error') {\n              if (IGNORED_ERROR_CODES.indexOf(peer.state.code) === -1) {\n                newErrors.set(peer.id, peer.state)\n              }\n            } else {\n              // no error anymore, let's delete it\n              newErrors.delete(peer.id)\n            }\n          })\n          return newErrors\n        })\n        // Argh, this is hacky. This is making up for us not being able to rely\n        // on server state for rendering the UI\n        setSyncRequests(syncRequests => {\n          const newSyncRequests = new Map(syncRequests)\n          updatedServerPeers.forEach(peer => {\n            if (!peer.state) return\n            if (\n              (peer.state.topic === 'replication-error' ||\n              peer.state.topic === 'replication-complete') &&\n              !peer.connected\n            ) {\n              newSyncRequests.delete(peer.id)\n            }\n          })\n          return newSyncRequests\n        })\n      }\n\n      // Whenever the sync view becomes focused, announce for sync and start\n      // listening for updates to peer status\n      api.syncJoin()\n      const peerListener = api.addPeerListener(updatePeers)\n\n      // When the listen changes or component unmounts, cleanup listeners\n      return () => {\n        api.syncLeave()\n        if (peerListener) peerListener.remove()\n      }\n    },\n    [listen]\n  )\n\n  const peers = useMemo(\n    () =>\n      getPeersStatus({\n        syncRequests,\n        serverPeers,\n        syncErrors,\n        since: lastClosed.current,\n        formatMessage\n      }),\n    [serverPeers, syncErrors, syncRequests, formatMessage]\n  )\n\n  const syncPeer = useCallback(\n    (peerId, opts) => {\n      logger.info('Request sync start', peerId, serverPeers)\n      if (opts && opts.file) return api.syncStart({ filename: peerId })\n      const peer = serverPeers.find(peer => peer.id === peerId)\n      // Peer could have vanished in the moment the button was pressed\n      if (peer) {\n        // The server does always respond immediately with progress, especially\n        // if the two devices are already up to sync. We store the request state\n        // so the user can see the UI update when they click the button\n        setSyncRequests(syncRequests => {\n          const newSyncRequests = new Map(syncRequests)\n          newSyncRequests.set(peerId, true)\n          return newSyncRequests\n        })\n        api.syncStart(peer)\n      }\n    },\n    [serverPeers]\n  )\n\n  return [peers, syncPeer]\n}\n\n/**\n * The peer status from Mapeo Core does not 'remember' the completion of a sync.\n * If the user is not looking at the screen when sync completes, they might miss\n * it. This function derives a peer status from the server state and any errors\n */\nfunction getPeersStatus ({\n  serverPeers = [],\n  syncErrors,\n  syncRequests,\n  since,\n  formatMessage\n}) {\n  logger.debug('get peers status', serverPeers, syncErrors)\n  return serverPeers.map(serverPeer => {\n    let status = peerStatus.READY\n    let errorMsg\n    let complete\n    const state = serverPeer.state || {}\n    const name = serverPeer.filename\n      ? path.basename(serverPeer.name)\n      : serverPeer.name\n    if (\n      state.topic === 'replication-progress' ||\n      state.topic === 'replication-started' ||\n      syncRequests.has(serverPeer.id)\n    ) {\n      status = peerStatus.PROGRESS\n    } else if (\n      (state.lastCompletedDate || 0) > since ||\n      state.topic === 'replication-complete'\n    ) {\n      status = peerStatus.COMPLETE\n      complete = state.message\n    } else if (\n      syncErrors.has(serverPeer.id)\n    ) {\n      status = peerStatus.ERROR\n      const error = syncErrors.get(serverPeer.id)\n      if (error && error.code === 'ERR_VERSION_MISMATCH') {\n        if (\n          parseVersionMajor(state.usVersion || '') >\n          parseVersionMajor(state.themVersion || '')\n        ) {\n          errorMsg = formatMessage(m.errorMsgVersionThemBad, {\n            deviceName: name\n          })\n        } else {\n          errorMsg = formatMessage(m.errorMsgVersionUsBad, { deviceName: name })\n        }\n      } else if (error) {\n        errorMsg = error.message || 'Error'\n      }\n    }\n    return {\n      id: serverPeer.id,\n      name: name,\n      status: status,\n      started: serverPeer.started,\n      connected: serverPeer.connected,\n      lastCompleted: complete || state.lastCompletedDate,\n      errorMsg: errorMsg,\n      progress: getPeerProgress(serverPeer.state),\n      deviceType: serverPeer.filename ? 'file' : serverPeer.deviceType\n    }\n  })\n}\n\n// We combine media and database items in progress. In order to show roughtly\n// accurate progress, this weighting is how much more progress a media item\n// counts vs. a database item\nconst MEDIA_WEIGHTING = 50\nfunction getPeerProgress (peerState) {\n  if (\n    !peerState ||\n    peerState.topic !== 'replication-progress' ||\n    !peerState.message ||\n    !peerState.message.db ||\n    !peerState.message.media\n  ) {\n    return\n  }\n  const total =\n    (peerState.message.db.total || 0) +\n    (peerState.message.media.total || 0) * MEDIA_WEIGHTING\n  const sofar =\n    (peerState.message.db.sofar || 0) +\n    (peerState.message.media.sofar || 0) * MEDIA_WEIGHTING\n  const progress = total > 0 ? sofar / total : 0\n  // Round progress to 2-decimal places. PeerItem is memoized, so it will not\n  // update if progress does not change. Without rounding PeerItem updates\n  // unnecessarily on every progress change, when we are only showing the user a\n  // rounded percentage progress. Increase this to 3-decimal places if you want\n  // to show more detail to the user.\n  return {\n    percent: Math.round(progress * 100) / 100,\n    mediaSofar: peerState.message.media.sofar || 0,\n    mediaTotal: peerState.message.media.total || 0,\n    dbSofar: peerState.message.db.sofar || 0,\n    dbTotal: peerState.message.db.total || 0\n  }\n}\n\nexport function parseVersionMajor (versionString = '') {\n  const major = Number.parseInt(versionString.split('.')[0])\n  return isNaN(major) ? 0 : major\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    width: '100%',\n    position: 'relative',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#F5F5F5'\n  }\n}))\n","export default {\n  IDLE: 0,\n  AVAILABLE: 1,\n  DOWNLOADING: 2,\n  PROGRESS: 3,\n  READY_FOR_RESTART: 4,\n  ERROR: 5,\n  INACTIVE: 99\n}\n","import React from 'react'\nimport { LinearProgress, Typography, makeStyles } from '@material-ui/core'\nimport { defineMessages, useIntl } from 'react-intl'\nimport Button from '@material-ui/core/Button'\nimport FormattedDuration from 'react-intl-formatted-duration'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport Paper from '@material-ui/core/Paper'\nimport Loader from '../Loader'\n\nimport STATES from './states'\nexport { default as STATES } from './states'\n\nconst m = defineMessages({\n  // Title on sync screen when searching for devices\n  updateAvailable: 'Update',\n  updateNotAvailable: 'Mapeo is up to date! You are on the latest version.',\n  downloadButtonText: 'Download',\n  calculatingProgress: 'Estimating...',\n  downloadProgress: 'Downloading',\n  restartMapeoText: 'An update to Mapeo has been downloaded. Restart Mapeo to update.',\n  restartMapeoButton: 'Restart',\n  errorTitle: 'Error',\n  errorMessage: 'There was an error and Mapeo could not update. Try again later.',\n  patchUpdate: 'This update includes changes that fix critical errors. Please update as soon as possible.',\n  minorUpdate: 'This update includes improvements that may change your experience.',\n  majorUpdate: 'This update will make your application incompatible with earlier verions.',\n  unknownDownloadSpeed: 'Unknown',\n  estimatedDownloadTime: 'Estimated download time is'\n})\n\nconst errors = {\n  ERR_UPDATER_CHANNEL_FILE_NOT_FOUND: 'This channel does not have any updates'\n}\n\nexport const UpdateTab = ({ update }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  var internal = function () {\n    switch (update.state) {\n      case STATES.AVAILABLE:\n        return <Typography>{t(m.updateAvailable)}</Typography>\n      case STATES.DOWNLOADING:\n        return <Typography>{t(m.calculatingProgress)}</Typography>\n      case STATES.PROGRESS:\n        return <Typography>{t(m.downloadProgress)}</Typography>\n      case STATES.READY_FOR_RESTART:\n        return <Typography>{t(m.restartMapeoButton)}</Typography>\n      case STATES.ERROR:\n        return (\n          <Typography style={{ color: 'red' }}>\n            {t(m.errorTitle)}\n          </Typography>\n        )\n      default: // STATES.IDLE, STATES.UPDATE_NOT_AVAILABLE:\n        return null\n    }\n  }\n\n  return <div className={cx.updateTab}>{internal()}</div>\n}\n\nexport const UpdaterView = ({ update, setUpdate }) => {\n  const cx = useStyles()\n  const { formatMessage: t } = useIntl()\n\n  var internal = function () {\n    switch (update.state) {\n      case STATES.AVAILABLE:\n        return <UpdateAvailableView cx={cx} update={update} setUpdate={setUpdate} />\n      case STATES.DOWNLOADING:\n        return <Typography>{t(m.calculatingProgress)}</Typography>\n      case STATES.PROGRESS:\n        return <DownloadProgressView cx={cx} percent={update.progress.percent} update={update} />\n      case STATES.READY_FOR_RESTART:\n        return <RestartView cx={cx} />\n      case STATES.UPDATE_NOT_AVAILABLE:\n        return <UpdateNotAvailableView cx={cx} />\n      case STATES.ERROR:\n        return (\n          <Typography>\n            <ErrorIcon\n              fontSize='inherit'\n              className={cx.icon}\n              style={{ color: 'red' }}\n            />\n            {t(m.errorMessage)}\n            {update.updateInfo.code}\n            {errors[update.updateInfo.code]}\n          </Typography>\n        )\n      default: // STATES.IDLE\n        return null\n    }\n  }\n\n  return (\n    <div className={cx.root}>\n      <div className={cx.searchingWrapper}>\n        <div className={cx.searching}>\n          {internal()}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nconst RestartView = ({ cx }) => {\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.restartMapeoText)}\n      </Typography>\n    </div>\n  )\n}\n\nconst DownloadProgressView = ({ cx, update, percent }) => {\n  /*\n      {\n        progress: {\n          total: 141164463,\n          delta: 1655048,\n          transferred: 11384326,\n          percent: 8.064583506402741,\n          bytesPerSecond: 2244544\n        }\n      }\n  */\n\n  const progress = update.progress\n  let estimatedTimeLeft\n\n  if (progress) {\n    estimatedTimeLeft = progress.total ? (progress.total - progress.transferred) / progress.bytesPerSecond : 0\n  }\n\n  return (\n    <div className={cx.searchingText}>\n      <Loader />\n      <LinearProgress variant='determinate' value={percent} color='secondary' />\n      <Typography>\n        {estimatedTimeLeft && <FormattedDuration seconds={estimatedTimeLeft} />}\n      </Typography>\n    </div>\n  )\n}\n\nconst UpdateAvailableView = ({ cx, update, setUpdate }) => {\n  const { formatMessage: t } = useIntl()\n\n  const { size, downloadSpeed, major, minor, patch } = update.updateInfo\n\n  const handleDownlaoadClick = setUpdate.downloadUpdate\n\n  const estimatedDownloadTime = downloadSpeed\n    ? <FormattedDuration seconds={size / downloadSpeed.bps} />\n    : t(m.unknownDownloadSpeed)\n\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.updateAvailable)}\n      </Typography>\n      <Paper className={cx.wrapper}>\n        <div className={cx.content}>\n\n          <Typography>\n            {\n              major\n                ? t(m.majorUpdate)\n                : minor\n                  ? t(m.minorUpdate)\n                  : patch\n                    ? t(m.patchUpdate)\n                    : ''\n            }\n          </Typography>\n\n          <Typography className={cx.estimatedDownloadTime}>\n            {t(m.estimatedDownloadTime)} {estimatedDownloadTime}\n          </Typography>\n\n          <Button\n            onClick={handleDownlaoadClick}\n            className={cx.button}\n            variant='contained'\n            size='large'\n            color='primary'\n          >\n            {t(m.downloadButtonText)}\n          </Button>\n\n        </div>\n      </Paper>\n    </div>\n  )\n}\n/*\n\nconst ExpandedNotes = ({ releaseSummary }) => {\n  return <div>\n    <Typography variant='body'>{releaseSummary}</Typography>\n  </div>\n}\n\nconst HiddenNotes = ({ releaseSummary }) => {\n  return <div>\n    <Typography variant='body'>{releaseSummary}</Typography>\n  </div>\n}\n*/\n\nconst UpdateNotAvailableView = ({ cx, update, downloadUpdateClick }) => {\n  const { formatMessage: t } = useIntl()\n  return (\n    <div className={cx.searchingText}>\n      <Typography gutterBottom variant='h2' className={cx.searchingTitle}>\n        {t(m.updateNotAvailable)}\n      </Typography>\n    </div>\n  )\n}\n\nconst useStyles = makeStyles(theme => ({\n  searchingText: {\n    maxWidth: 300,\n    marginLeft: theme.spacing(2)\n  },\n  searchingWrapper: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    flex: 1,\n    alignSelf: 'stretch',\n    justifySelf: 'stretch'\n  },\n  searching: {\n    color: '#00052b',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center'\n  },\n  searchingTitle: {\n    fontSize: '2em',\n    fontWeight: 400\n  },\n  root: {\n    height: '100%',\n    width: '100%',\n    position: 'relative',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#F5F5F5'\n  },\n  wrapper: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    display: 'flex',\n    flexDirection: 'column',\n    padding: '10%'\n  },\n  content: {\n    flex: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  button: {\n    marginTop: '15px'\n  },\n  estimatedDownloadTime: {\n    margin: '10px 0px'\n  },\n  icon: {\n    fontSize: 48\n  }\n}))\n","import { ipcRenderer } from 'electron'\n\nexport default Api(ipcRenderer)\n\nfunction Api (ipcRenderer) {\n  return {\n    addUpdateStatusListener: function (handler) {\n      function onupdate (ev, serverState, info) {\n        handler({ serverState, info })\n      }\n      ipcRenderer.on('update-status', onupdate)\n      return {\n        remove: () => ipcRenderer.removeListener('update-status', onupdate)\n      }\n    },\n    checkForUpdates: function () {\n      ipcRenderer.send('check-for-updates')\n    },\n    downloadUpdate: function () {\n      ipcRenderer.send('download-update')\n    },\n    quitAndInstall: function () {\n      ipcRenderer.send('quit-and-install')\n    }\n  }\n}\n","import React from 'react'\nimport { ipcRenderer } from 'electron'\nimport styled from 'styled-components'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport { Transition } from 'react-transition-group'\nimport {\n  LocationOn,\n  Map as MapIcon,\n  PhotoLibrary as ObservationIcon,\n  OfflineBolt as SyncIcon,\n  Warning as WarningIcon\n} from '@material-ui/icons'\n\nimport pkg from '../../../package.json'\nimport MapEditor from './MapEditor'\nimport LatLonDialog from './dialogs/LatLon'\nimport ErrorDialog from './dialogs/Error'\nimport ChangeLanguage from './dialogs/ChangeLanguage'\nimport TitleBarShim from './TitleBarShim'\nimport MapFilter from './MapFilter'\nimport { defineMessages, useIntl } from 'react-intl'\nimport createPersistedState from '../hooks/createPersistedState'\nimport SyncView from './SyncView'\nimport { STATES as updateStates, UpdaterView, UpdateTab } from './UpdaterView'\nimport useUpdater from './UpdaterView/useUpdater'\n\nconst m = defineMessages({\n  // MapEditor tab label\n  mapeditor: 'Territory',\n  // MapFilter tab label\n  mapfilter: 'Observations',\n  // Synchronize tab label\n  sync: 'Synchronize',\n  update: 'Update Mapeo'\n})\n\nconst transitionDuration = 100\n\nconst Root = styled.div`\n  position: absolute;\n  overflow: hidden;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  @media only print {\n    display: block;\n    height: auto;\n    width: auto;\n    overflow: visible;\n  }\n`\n\nconst Sidebar = styled.div`\n  display: flex;\n  flex-direction: column;\n  -webkit-app-region: drag;\n  -webkit-user-select: none;\n  background-color: #000033;\n  color: white;\n  z-index: 99;\n  @media only print {\n    display: none;\n  }\n`\n\nconst Logo = styled.div`\n  padding: 0 24px 0 18px;\n  margin: 0 0 12px 0;\n  display: flex;\n  align-items: center;\n  height: 64px;\n  h1 {\n    font-family: 'Rubik', sans-serif;\n    font-weight: 500;\n    font-size: 2em;\n    cursor: default;\n    margin: 0;\n  }\n`\n\nconst MapeoIcon = styled(LocationOn)`\n  margin-right: 3.5px;\n  margin-left: -5.5px;\n`\n\nconst StyledTabs = styled(Tabs)`\n  border-right: 1px solid rgba(0, 0, 0, 0.12);\n  -webkit-app-region: no-drag;\n  .PrivateTabIndicator-root-1 {\n    background-color: #ff9933;\n  }\n`\n\nconst StyledTab = styled(Tab)`\n  &.MuiTab-root {\n    padding: 6px 24px 6px 18px;\n    min-height: 64px;\n    font-size: 16px;\n    line-height: 28px;\n    font-weight: 400;\n    text-transform: capitalize;\n  }\n  &.Mui-selected {\n    background-color: #33335c;\n  }\n  & .MuiTab-wrapper {\n    justify-content: flex-start;\n    flex-direction: row;\n  }\n  & .MuiTab-wrapper > *:first-child {\n    margin-bottom: 4px;\n    margin-right: 11px;\n  }\n`\n\nconst TabContent = styled.div`\n  position: relative;\n  flex: 1;\n`\n\nconst StyledPanel = styled.div`\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  transition: opacity ${transitionDuration}ms ease-out;\n  @media only print {\n    position: relative;\n    width: auto;\n    height: auto;\n  }\n`\n\nconst Version = styled.div`\n  align-self: flex-start;\n  margin: auto 10px 10px 10px;\n  font-size: 0.8rem;\n  color: #aaaaaa;\n`\n\nconst focusStates = {\n  entering: 'focusing',\n  entered: 'focused',\n  exiting: 'blurring',\n  exited: 'blurred'\n}\n\nfunction TabPanel (props) {\n  const { value, index, component: Component, ...extras } = props\n\n  const transitionStyles = {\n    entering: { opacity: 1, zIndex: 1, display: 'block' },\n    entered: { opacity: 1, zIndex: 1, display: 'block' },\n    exiting: { opacity: 0 },\n    exited: { opacity: 0, display: 'block' }\n  }\n\n  return (\n    <Transition in={value === index} timeout={transitionDuration}>\n      {transitionState => (\n        <StyledPanel style={transitionStyles[transitionState]}>\n          {Component && <Component focusState={focusStates[transitionState]} {...extras} />}\n        </StyledPanel>\n      )}\n    </Transition>\n  )\n}\n\nconst useTabIndex = createPersistedState('currentView')\n\nexport default function Home ({ onSelectLanguage }) {\n  const [dialog, setDialog] = React.useState(null)\n  const [error, setError] = React.useState(null)\n  const [tabIndex, setTabIndex] = useTabIndex(0)\n  const [update, setUpdate] = useUpdater()\n  const { formatMessage: t } = useIntl()\n\n  React.useEffect(() => {\n    const openLatLonDialog = () => setDialog('LatLon')\n    const openErrorDialog = (ev, error) => {\n      console.log(error)\n      setError(error)\n    }\n    const openChangeLangDialog = () => setDialog('ChangeLanguage')\n    const refreshPage = () => window.location.reload()\n    ipcRenderer.on('error', openErrorDialog)\n    ipcRenderer.on('open-latlon-dialog', openLatLonDialog)\n    ipcRenderer.on('change-language-request', openChangeLangDialog)\n    ipcRenderer.on('force-refresh-window', refreshPage)\n    return () => {\n      ipcRenderer.removeListener('error', openErrorDialog)\n      ipcRenderer.removeListener('open-latlon-dialog', openLatLonDialog)\n      ipcRenderer.removeListener(\n        'change-language-request',\n        openChangeLangDialog\n      )\n      ipcRenderer.removeListener('force-refresh-window', openLatLonDialog)\n    }\n  }, [])\n\n  const hasUpdate = update.state !== updateStates.IDLE &&\n    update.state !== updateStates.UPDATE_NOT_AVAILABLE\n\n  return (\n    <Root>\n      <Sidebar>\n        <TitleBarShim />\n        <Logo>\n          <MapeoIcon fontSize='large' />\n          <h1>Mapeo</h1>\n        </Logo>\n        <StyledTabs\n          orientation='vertical'\n          variant='scrollable'\n          value={tabIndex}\n          onChange={(e, value) => setTabIndex(value)}\n        >\n          <StyledTab icon={<MapIcon />} label={t(m.mapeditor)} />\n          <StyledTab icon={<ObservationIcon />} label={t(m.mapfilter)} />\n          <StyledTab icon={<SyncIcon />} label={t(m.sync)} />\n          {hasUpdate && <StyledTab icon={<WarningIcon />} label={<UpdateTab update={update} />} />}\n        </StyledTabs>\n        <Version>Mapeo v{pkg.version}</Version>\n      </Sidebar>\n      <TabContent>\n        <TabPanel value={tabIndex} index={0} component={MapEditor} />\n        <TabPanel value={tabIndex} index={1} component={MapFilter} />\n        <TabPanel value={tabIndex} index={2} component={SyncView} />\n        <TabPanel value={tabIndex} index={3} component={UpdaterView} update={update} setUpdate={setUpdate} />\n      </TabContent>\n      <ChangeLanguage\n        open={dialog === 'ChangeLanguage'}\n        onCancel={() => {\n          setDialog(null)\n        }}\n        onSelectLanguage={lang => {\n          onSelectLanguage(lang)\n          setDialog(null)\n        }}\n      />\n      <LatLonDialog\n        open={dialog === 'LatLon'}\n        onClose={() => setDialog(null)}\n      />\n      <ErrorDialog\n        open={error !== null}\n        message={error}\n        onClose={() => setError(null)}\n      />\n    </Root>\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport semver from 'semver'\nimport { version as appVersion } from '../../../../package.json'\nimport STATES from './states'\nimport electronIpc from '../../electron-ipc'\n\nexport default function useUpdater () {\n  const [update, setUpdate] = useState({\n    progress: null,\n    updateInfo: null,\n    state: STATES.IDLE\n  })\n\n  useEffect(\n    () => {\n      const updateListener = electronIpc.addUpdateStatusListener(({ serverState, info }) => {\n        switch (serverState) {\n          case 'update-error':\n            setUpdate({\n              updateInfo: info,\n              progress: null,\n              state: STATES.ERROR\n            })\n            return\n          case 'update-downloaded':\n            setUpdate({\n              updateInfo: null,\n              progress: null,\n              state: STATES.READY_FOR_RESTART\n            })\n            return\n          case 'update-not-available':\n            setUpdate({\n              updateInfo: null,\n              progress: null,\n              state: STATES.UPDATE_NOT_AVAILABLE\n            })\n            return\n          case 'update-progress':\n            setUpdate({\n              progress: info.progress,\n              state: STATES.PROGRESS\n            })\n            return\n          case 'update-available':\n            var past = semver.parse(appVersion)\n            var next = semver.parse(info.version)\n            info.major = next.major > past.major\n            info.minor = next.minor > past.minor\n            info.patch = next.patch > past.patch\n\n            info.size = info.files.map((file) => file.size).reduce((a, b) => a + b, 0)\n\n            setUpdate({\n              updateInfo: info,\n              progress: null,\n              state: STATES.AVAILABLE\n            })\n            return\n          case 'update-inactive':\n            setUpdate({\n              progress: null,\n              updateInfo: null,\n              state: STATES.UPDATE_INACTIVE\n            })\n        }\n      })\n      return () => {\n        if (updateListener) updateListener.remove()\n      }\n    }\n    , [])\n\n  function downloadUpdate () {\n    setUpdate({\n      state: STATES.DOWNLOADING\n    })\n    electronIpc.downloadUpdate()\n  }\n\n  return [update, { downloadUpdate }]\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { remote, ipcRenderer } from 'electron'\nimport { StylesProvider, ThemeProvider } from '@material-ui/styles'\nimport { IntlProvider } from 'react-intl'\nimport isDev from 'electron-is-dev'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nimport logger from '../logger'\nimport theme from './theme'\nimport Home from './components/Home'\n\nif (!logger.configured) {\n  logger.configure({\n    label: 'renderer',\n    userDataPath: remote.app.getPath('userData'),\n    isDev\n  })\n  ipcRenderer.on('debugging', (ev, bool) => {\n    logger.debugging(bool)\n  })\n}\n\nconst initialLocale = ipcRenderer.sendSync('get-locale') // navigator.language.slice(0, 2)\n\nconst mdMsgs = {\n  en: require('../../translations/en.json'),\n  es: require('../../translations/es.json'),\n  pt: require('../../translations/pt.json')\n}\n\nconst mfMsgs = {\n  en: require('react-mapfilter/translations/en.json'),\n  es: require('react-mapfilter/translations/es.json'),\n  pt: require('react-mapfilter/translations/pt.json')\n}\n\nconst allMsgs = {\n  en: { ...mdMsgs.en, ...mfMsgs.en },\n  es: { ...mdMsgs.es, ...mfMsgs.es },\n  pt: { ...mdMsgs.pt, ...mfMsgs.pt }\n}\n\nif (!logger.configured) {\n  logger.configure({\n    label: 'renderer',\n    userDataPath: remote.app.getPath('userData'),\n    isDev\n  })\n  ipcRenderer.on('debugging', (ev, bool) => {\n    logger.debugging(bool)\n  })\n}\n\nconst App = () => {\n  const [locale, setLocale] = React.useState(initialLocale)\n\n  const handleLanguageChange = React.useCallback(lang => {\n    ipcRenderer.send('set-locale', lang)\n    setLocale(lang)\n    // Ideally this would just re-render the app in the new locale, but the way\n    // we squeeze iD editor into React and patch in React Components on top of\n    // it, trying to call `id.ui().restart(locale)` causes problems, so we\n    // refresh instead\n    ipcRenderer.send('force-refresh-window')\n  }, [])\n  logger.info('Rendering', locale)\n\n  return (\n    <StylesProvider injectFirst>\n      <ThemeProvider theme={theme}>\n        <CssBaseline />\n        <IntlProvider locale={locale} messages={allMsgs[locale]}>\n          <Home onSelectLanguage={handleLanguageChange} />\n        </IntlProvider>\n      </ThemeProvider>\n    </StylesProvider>\n  )\n}\n\nReactDOM.render(<App />, document.getElementById('root'))\n\nconst localStorage = window.localStorage\nwindow.testMode = function () {\n  logger.debug('Test mode, clearing cache')\n  localStorage.removeItem('lastView')\n  localStorage.removeItem('location')\n}\n"],"sourceRoot":""}